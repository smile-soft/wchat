!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Wchat=t()}}(function(){var define,module,exports;return function i(r,o,l){function c(e,t){if(!o[e]){if(!r[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(u)return u(e,!0);var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}var a=o[e]={exports:{}};r[e][0].call(a.exports,function(t){return c(r[e][1][t]||t)},a,a.exports,i,r,o,l)}return o[e].exports}for(var u="function"==typeof require&&require,t=0;t<l.length;t++)c(l[t]);return c}({1:[function(t,e,n){var s,a=!(e.exports=function(t,e){if("string"!=typeof t)throw new TypeError("String expected");e||(e=document);var n=/<([\w:]+)/.exec(t);if(!n)return e.createTextNode(t);t=t.replace(/^\s+|\s+$/g,"");var s=n[1];if("body"==s){var a=e.createElement("html");return a.innerHTML=t,a.removeChild(a.lastChild)}var i=u[s]||u._default,r=i[0],o=i[1],l=i[2];(a=e.createElement("div")).innerHTML=o+t+l;for(;r--;)a=a.lastChild;if(a.firstChild==a.lastChild)return a.removeChild(a.firstChild);var c=e.createDocumentFragment();for(;a.firstChild;)c.appendChild(a.removeChild(a.firstChild));return c});"undefined"!=typeof document&&((s=document.createElement("div")).innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>',a=!s.getElementsByTagName("link").length,s=void 0);var u={legend:[1,"<fieldset>","</fieldset>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],_default:a?[1,"X<div>","</div>"]:[0,"",""]};u.td=u.th=[3,"<table><tbody><tr>","</tr></tbody></table>"],u.option=u.optgroup=[1,'<select multiple="multiple">',"</select>"],u.thead=u.tbody=u.colgroup=u.caption=u.tfoot=[1,"<table>","</table>"],u.polyline=u.ellipse=u.polygon=u.circle=u.text=u.line=u.path=u.rect=u.g=[1,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1">',"</svg>"]},{}],2:[function(t,e,n){function s(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function l(t){return"function"==typeof t}function c(t){return"object"==typeof t&&null!==t}function u(t){return void 0===t}((e.exports=s).EventEmitter=s).prototype._events=void 0,s.prototype._maxListeners=void 0,s.defaultMaxListeners=10,s.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},s.prototype.emit=function(t){var e,n,s,a,i,r;if(this._events||(this._events={}),"error"===t&&(!this._events.error||c(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var o=new Error('Uncaught, unspecified "error" event. ('+e+")");throw o.context=e,o}if(u(n=this._events[t]))return!1;if(l(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(c(n))for(a=Array.prototype.slice.call(arguments,1),s=(r=n.slice()).length,i=0;i<s;i++)r[i].apply(this,a);return!0},s.prototype.on=s.prototype.addListener=function(t,e){var n;if(!l(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,l(e.listener)?e.listener:e),this._events[t]?c(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,c(this._events[t])&&!this._events[t].warned&&(n=u(this._maxListeners)?s.defaultMaxListeners:this._maxListeners)&&0<n&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},s.prototype.once=function(t,e){if(!l(e))throw TypeError("listener must be a function");var n=!1;function s(){this.removeListener(t,s),n||(n=!0,e.apply(this,arguments))}return s.listener=e,this.on(t,s),this},s.prototype.removeListener=function(t,e){var n,s,a,i;if(!l(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(a=(n=this._events[t]).length,s=-1,n===e||l(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(c(n)){for(i=a;0<i--;)if(n[i]===e||n[i].listener&&n[i].listener===e){s=i;break}if(s<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(s,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},s.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(l(n=this._events[t]))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},s.prototype.listeners=function(t){return this._events&&this._events[t]?l(this._events[t])?[this._events[t]]:this._events[t].slice():[]},s.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(l(e))return 1;if(e)return e.length}return 0},s.listenerCount=function(t,e){return t.listenerCount(e)}},{}],3:[function(t,e,n){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},{}],4:[function(t,e,n){var s=t("../internal/arrayEach"),a=t("../internal/baseEach"),i=t("../internal/createForEach")(s,a);e.exports=i},{"../internal/arrayEach":10,"../internal/baseEach":15,"../internal/createForEach":28}],5:[function(t,e,n){var s=t("../internal/getNative")(Date,"now")||function(){return(new Date).getTime()};e.exports=s},{"../internal/getNative":32}],6:[function(t,e,n){var b=t("../lang/isObject"),x=t("../date/now"),v=Math.max;e.exports=function(s,a,t){var i,r,o,l,c,u,d,f=0,p=!1,m=!0;if("function"!=typeof s)throw new TypeError("Expected a function");if(a=a<0?0:+a||0,!0===t){var _=!0;m=!1}else b(t)&&(_=!!t.leading,p="maxWait"in t&&v(+t.maxWait||0,a),m="trailing"in t?!!t.trailing:m);function e(t,e){e&&clearTimeout(e),r=u=d=void 0,t&&(f=x(),o=s.apply(c,i),u||r||(i=c=void 0))}function g(){var t=a-(x()-l);t<=0||a<t?e(d,r):u=setTimeout(g,t)}function h(){e(m,u)}function n(){if(i=arguments,l=x(),c=this,d=m&&(u||!_),!1===p)var t=_&&!u;else{r||_||(f=l);var e=p-(l-f),n=e<=0||p<e;n?(r&&(r=clearTimeout(r)),f=l,o=s.apply(c,i)):r||(r=setTimeout(h,e))}return n&&u?u=clearTimeout(u):u||a===p||(u=setTimeout(g,a)),t&&(n=!0,o=s.apply(c,i)),!n||u||r||(i=c=void 0),o}return n.cancel=function(){u&&clearTimeout(u),r&&clearTimeout(r),r=u=d=void(f=0)},n}},{"../date/now":5,"../lang/isObject":48}],7:[function(t,e,n){var o=Math.max;e.exports=function(i,r){if("function"!=typeof i)throw new TypeError("Expected a function");return r=o(void 0===r?i.length-1:+r||0,0),function(){for(var t=arguments,e=-1,n=o(t.length-r,0),s=Array(n);++e<n;)s[e]=t[r+e];switch(r){case 0:return i.call(this,s);case 1:return i.call(this,t[0],s);case 2:return i.call(this,t[0],t[1],s)}var a=Array(r+1);for(e=-1;++e<r;)a[e]=t[e];return a[r]=s,i.apply(this,a)}}},{}],8:[function(t,e,n){var i=t("./debounce"),r=t("../lang/isObject");e.exports=function(t,e,n){var s=!0,a=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return!1===n?s=!1:r(n)&&(s="leading"in n?!!n.leading:s,a="trailing"in n?!!n.trailing:a),i(t,e,{leading:s,maxWait:+e,trailing:a})}},{"../lang/isObject":48,"./debounce":6}],9:[function(t,e,n){e.exports=function(t,e){var n=-1,s=t.length;for(e||(e=Array(s));++n<s;)e[n]=t[n];return e}},{}],10:[function(t,e,n){e.exports=function(t,e){for(var n=-1,s=t.length;++n<s&&!1!==e(t[n],n,t););return t}},{}],11:[function(t,e,n){var a=Object.prototype.hasOwnProperty;e.exports=function(t,e,n,s){return void 0!==t&&a.call(s,n)?t:e}},{}],12:[function(t,e,n){var c=t("../object/keys");e.exports=function(t,e,n){for(var s=-1,a=c(e),i=a.length;++s<i;){var r=a[s],o=t[r],l=n(o,e[r],r,t,e);(l==l?l===o:o!=o)&&(void 0!==o||r in t)||(t[r]=l)}return t}},{"../object/keys":52}],13:[function(t,e,n){var s=t("./baseCopy"),a=t("../object/keys");e.exports=function(t,e){return null==e?t:s(e,a(e),t)}},{"../object/keys":52,"./baseCopy":14}],14:[function(t,e,n){e.exports=function(t,e,n){n||(n={});for(var s=-1,a=e.length;++s<a;){var i=e[s];n[i]=t[i]}return n}},{}],15:[function(t,e,n){var s=t("./baseForOwn"),a=t("./createBaseEach")(s);e.exports=a},{"./baseForOwn":18,"./createBaseEach":26}],16:[function(t,e,n){var s=t("./createBaseFor")();e.exports=s},{"./createBaseFor":27}],17:[function(t,e,n){var s=t("./baseFor"),a=t("../object/keysIn");e.exports=function(t,e){return s(t,e,a)}},{"../object/keysIn":53,"./baseFor":16}],18:[function(t,e,n){var s=t("./baseFor"),a=t("../object/keys");e.exports=function(t,e){return s(t,e,a)}},{"../object/keys":52,"./baseFor":16}],19:[function(t,e,n){var s=t("./arrayEach"),p=t("./baseMergeDeep"),a=t("../lang/isArray"),m=t("./isArrayLike"),_=t("../lang/isObject"),g=t("./isObjectLike"),h=t("../lang/isTypedArray"),b=t("../object/keys");e.exports=function i(r,o,l,c,u){if(!_(r))return r;var d=m(o)&&(a(o)||h(o)),f=d?void 0:b(o);return s(f||o,function(t,e){if(f&&(t=o[e=t]),g(t))c||(c=[]),u||(u=[]),p(r,o,e,i,l,c,u);else{var n=r[e],s=l?l(n,t,e,r,o):void 0,a=void 0===s;a&&(s=t),void 0===s&&(!d||e in r)||!a&&(s==s?s===n:n!=n)||(r[e]=s)}}),r}},{"../lang/isArray":44,"../lang/isObject":48,"../lang/isTypedArray":50,"../object/keys":52,"./arrayEach":10,"./baseMergeDeep":20,"./isArrayLike":33,"./isObjectLike":37}],20:[function(t,e,n){var f=t("./arrayCopy"),p=t("../lang/isArguments"),m=t("../lang/isArray"),_=t("./isArrayLike"),g=t("../lang/isPlainObject"),h=t("../lang/isTypedArray"),b=t("../lang/toPlainObject");e.exports=function(t,e,n,s,a,i,r){for(var o=i.length,l=e[n];o--;)if(i[o]==l)return void(t[n]=r[o]);var c=t[n],u=a?a(c,l,n,t,e):void 0,d=void 0===u;d&&(_(u=l)&&(m(l)||h(l))?u=m(c)?c:_(c)?f(c):[]:g(l)||p(l)?u=p(c)?b(c):g(c)?c:{}:d=!1),i.push(l),r.push(u),d?t[n]=s(u,l,a,i,r):(u==u?u!==c:c==c)&&(t[n]=u)}},{"../lang/isArguments":43,"../lang/isArray":44,"../lang/isPlainObject":49,"../lang/isTypedArray":50,"../lang/toPlainObject":51,"./arrayCopy":9,"./isArrayLike":33}],21:[function(t,e,n){e.exports=function(e){return function(t){return null==t?void 0:t[e]}}},{}],22:[function(t,e,n){e.exports=function(t){return null==t?"":t+""}},{}],23:[function(t,e,n){e.exports=function(t,e){for(var n=-1,s=e.length,a=Array(s);++n<s;)a[n]=t[e[n]];return a}},{}],24:[function(t,e,n){var s=t("../utility/identity");e.exports=function(i,r,t){if("function"!=typeof i)return s;if(void 0===r)return i;switch(t){case 1:return function(t){return i.call(r,t)};case 3:return function(t,e,n){return i.call(r,t,e,n)};case 4:return function(t,e,n,s){return i.call(r,t,e,n,s)};case 5:return function(t,e,n,s,a){return i.call(r,t,e,n,s,a)}}return function(){return i.apply(r,arguments)}}},{"../utility/identity":59}],25:[function(t,e,n){var c=t("./bindCallback"),u=t("./isIterateeCall"),s=t("../function/restParam");e.exports=function(l){return s(function(t,e){var n=-1,s=null==t?0:e.length,a=2<s?e[s-2]:void 0,i=2<s?e[2]:void 0,r=1<s?e[s-1]:void 0;for("function"==typeof a?(a=c(a,r,5),s-=2):s-=(a="function"==typeof r?r:void 0)?1:0,i&&u(e[0],e[1],i)&&(a=s<3?void 0:a,s=1);++n<s;){var o=e[n];o&&l(t,o,a)}return t})}},{"../function/restParam":7,"./bindCallback":24,"./isIterateeCall":35}],26:[function(t,e,n){var o=t("./getLength"),l=t("./isLength"),c=t("./toObject");e.exports=function(i,r){return function(t,e){var n=t?o(t):0;if(!l(n))return i(t,e);for(var s=r?n:-1,a=c(t);(r?s--:++s<n)&&!1!==e(a[s],s,a););return t}}},{"./getLength":31,"./isLength":36,"./toObject":42}],27:[function(t,e,n){var c=t("./toObject");e.exports=function(l){return function(t,e,n){for(var s=c(t),a=n(t),i=a.length,r=l?i:-1;l?r--:++r<i;){var o=a[r];if(!1===e(s[o],o,s))break}return t}}},{"./toObject":42}],28:[function(t,e,n){var i=t("./bindCallback"),r=t("../lang/isArray");e.exports=function(s,a){return function(t,e,n){return"function"==typeof e&&void 0===n&&r(t)?s(t,e):a(t,i(e,n,3))}}},{"../lang/isArray":44,"./bindCallback":24}],29:[function(t,e,n){var s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"};e.exports=function(t){return s[t]}},{}],30:[function(t,e,n){var s={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};e.exports=function(t){return"\\"+s[t]}},{}],31:[function(t,e,n){var s=t("./baseProperty")("length");e.exports=s},{"./baseProperty":21}],32:[function(t,e,n){var s=t("../lang/isNative");e.exports=function(t,e){var n=null==t?void 0:t[e];return s(n)?n:void 0}},{"../lang/isNative":47}],33:[function(t,e,n){var s=t("./getLength"),a=t("./isLength");e.exports=function(t){return null!=t&&a(s(t))}},{"./getLength":31,"./isLength":36}],34:[function(t,e,n){var s=/^\d+$/;e.exports=function(t,e){return e=null==e?9007199254740991:e,-1<(t="number"==typeof t||s.test(t)?+t:-1)&&t%1==0&&t<e}},{}],35:[function(t,e,n){var i=t("./isArrayLike"),r=t("./isIndex"),o=t("../lang/isObject");e.exports=function(t,e,n){if(!o(n))return!1;var s=typeof e;if("number"==s?i(n)&&r(e,n.length):"string"==s&&e in n){var a=n[e];return t==t?t===a:a!=a}return!1}},{"../lang/isObject":48,"./isArrayLike":33,"./isIndex":34}],36:[function(t,e,n){e.exports=function(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=9007199254740991}},{}],37:[function(t,e,n){e.exports=function(t){return!!t&&"object"==typeof t}},{}],38:[function(t,e,n){e.exports=/<%-([\s\S]+?)%>/g},{}],39:[function(t,e,n){e.exports=/<%([\s\S]+?)%>/g},{}],40:[function(t,e,n){e.exports=/<%=([\s\S]+?)%>/g},{}],41:[function(t,e,n){var l=t("../lang/isArguments"),c=t("../lang/isArray"),u=t("./isIndex"),d=t("./isLength"),f=t("../object/keysIn"),p=Object.prototype.hasOwnProperty;e.exports=function(t){for(var e=f(t),n=e.length,s=n&&t.length,a=!!s&&d(s)&&(c(t)||l(t)),i=-1,r=[];++i<n;){var o=e[i];(a&&u(o,s)||p.call(t,o))&&r.push(o)}return r}},{"../lang/isArguments":43,"../lang/isArray":44,"../object/keysIn":53,"./isIndex":34,"./isLength":36}],42:[function(t,e,n){var s=t("../lang/isObject");e.exports=function(t){return s(t)?t:Object(t)}},{"../lang/isObject":48}],43:[function(t,e,n){var s=t("../internal/isArrayLike"),a=t("../internal/isObjectLike"),i=Object.prototype,r=i.hasOwnProperty,o=i.propertyIsEnumerable;e.exports=function(t){return a(t)&&s(t)&&r.call(t,"callee")&&!o.call(t,"callee")}},{"../internal/isArrayLike":33,"../internal/isObjectLike":37}],44:[function(t,e,n){var s=t("../internal/getNative"),a=t("../internal/isLength"),i=t("../internal/isObjectLike"),r=Object.prototype.toString,o=s(Array,"isArray")||function(t){return i(t)&&a(t.length)&&"[object Array]"==r.call(t)};e.exports=o},{"../internal/getNative":32,"../internal/isLength":36,"../internal/isObjectLike":37}],45:[function(t,e,n){var s=t("../internal/isObjectLike"),a=Object.prototype.toString;e.exports=function(t){return s(t)&&"string"==typeof t.message&&"[object Error]"==a.call(t)}},{"../internal/isObjectLike":37}],46:[function(t,e,n){var s=t("./isObject"),a=Object.prototype.toString;e.exports=function(t){return s(t)&&"[object Function]"==a.call(t)}},{"./isObject":48}],47:[function(t,e,n){var s=t("./isFunction"),a=t("../internal/isObjectLike"),i=/^\[object .+?Constructor\]$/,r=Object.prototype,o=Function.prototype.toString,l=r.hasOwnProperty,c=RegExp("^"+o.call(l).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(t){return null!=t&&(s(t)?c.test(o.call(t)):a(t)&&i.test(t))}},{"../internal/isObjectLike":37,"./isFunction":46}],48:[function(t,e,n){e.exports=function(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}},{}],49:[function(t,e,n){var s=t("../internal/baseForIn"),a=t("./isArguments"),i=t("../internal/isObjectLike"),r=Object.prototype,o=r.hasOwnProperty,l=r.toString;e.exports=function(t){var e,n;return!(!i(t)||"[object Object]"!=l.call(t)||a(t)||!(o.call(t,"constructor")||"function"!=typeof(e=t.constructor)||e instanceof e))&&(s(t,function(t,e){n=e}),void 0===n||o.call(t,n))}},{"../internal/baseForIn":17,"../internal/isObjectLike":37,"./isArguments":43}],50:[function(t,e,n){var s=t("../internal/isLength"),a=t("../internal/isObjectLike"),i={};i["[object Float32Array]"]=i["[object Float64Array]"]=i["[object Int8Array]"]=i["[object Int16Array]"]=i["[object Int32Array]"]=i["[object Uint8Array]"]=i["[object Uint8ClampedArray]"]=i["[object Uint16Array]"]=i["[object Uint32Array]"]=!0,i["[object Arguments]"]=i["[object Array]"]=i["[object ArrayBuffer]"]=i["[object Boolean]"]=i["[object Date]"]=i["[object Error]"]=i["[object Function]"]=i["[object Map]"]=i["[object Number]"]=i["[object Object]"]=i["[object RegExp]"]=i["[object Set]"]=i["[object String]"]=i["[object WeakMap]"]=!1;var r=Object.prototype.toString;e.exports=function(t){return a(t)&&s(t.length)&&!!i[r.call(t)]}},{"../internal/isLength":36,"../internal/isObjectLike":37}],51:[function(t,e,n){var s=t("../internal/baseCopy"),a=t("../object/keysIn");e.exports=function(t){return s(t,a(t))}},{"../internal/baseCopy":14,"../object/keysIn":53}],52:[function(t,e,n){var s=t("../internal/getNative"),a=t("../internal/isArrayLike"),i=t("../lang/isObject"),r=t("../internal/shimKeys"),o=s(Object,"keys"),l=o?function(t){var e=null==t?void 0:t.constructor;return"function"==typeof e&&e.prototype===t||"function"!=typeof t&&a(t)?r(t):i(t)?o(t):[]}:r;e.exports=l},{"../internal/getNative":32,"../internal/isArrayLike":33,"../internal/shimKeys":41,"../lang/isObject":48}],53:[function(t,e,n){var l=t("../lang/isArguments"),c=t("../lang/isArray"),u=t("../internal/isIndex"),d=t("../internal/isLength"),f=t("../lang/isObject"),p=Object.prototype.hasOwnProperty;e.exports=function(t){if(null==t)return[];f(t)||(t=Object(t));var e=t.length;e=e&&d(e)&&(c(t)||l(t))&&e||0;for(var n=t.constructor,s=-1,a="function"==typeof n&&n.prototype===t,i=Array(e),r=0<e;++s<e;)i[s]=s+"";for(var o in t)r&&u(o,e)||"constructor"==o&&(a||!p.call(t,o))||i.push(o);return i}},{"../internal/isIndex":34,"../internal/isLength":36,"../lang/isArguments":43,"../lang/isArray":44,"../lang/isObject":48}],54:[function(t,e,n){var s=t("../internal/baseMerge"),a=t("../internal/createAssigner")(s);e.exports=a},{"../internal/baseMerge":19,"../internal/createAssigner":25}],55:[function(t,e,n){var s=t("../internal/baseToString"),a=t("../internal/escapeHtmlChar"),i=/[&<>"'`]/g,r=RegExp(i.source);e.exports=function(t){return(t=s(t))&&r.test(t)?t.replace(i,a):t}},{"../internal/baseToString":22,"../internal/escapeHtmlChar":29}],56:[function(t,e,n){var g=t("../internal/assignOwnDefaults"),h=t("../internal/assignWith"),b=t("../utility/attempt"),x=t("../internal/baseAssign"),v=t("../internal/baseToString"),y=t("../internal/baseValues"),w=t("../internal/escapeStringChar"),k=t("../lang/isError"),E=t("../internal/isIterateeCall"),S=t("../object/keys"),C=t("../internal/reInterpolate"),L=t("./templateSettings"),T=/\b__p \+= '';/g,O=/\b(__p \+=) '' \+/g,A=/(__e\(.*?\)|\b__t\)) \+\n'';/g,j=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,I=/($^)/,N=/['\n\r\u2028\u2029\\]/g;e.exports=function(r,t,e){var n=L.imports._.templateSettings||L;e&&E(r,t,e)&&(t=e=void 0),r=v(r),t=h(x({},e||t),n,g);var o,l,s=h(x({},t.imports),n.imports,g),a=S(s),i=y(s,a),c=0,u=t.interpolate||I,d="__p += '",f=RegExp((t.escape||I).source+"|"+u.source+"|"+(u===C?j:I).source+"|"+(t.evaluate||I).source+"|$","g"),p="sourceURL"in t?"//# sourceURL="+t.sourceURL+"\n":"";r.replace(f,function(t,e,n,s,a,i){return n||(n=s),d+=r.slice(c,i).replace(N,w),e&&(o=!0,d+="' +\n__e("+e+") +\n'"),a&&(l=!0,d+="';\n"+a+";\n__p += '"),n&&(d+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),c=i+t.length,t}),d+="';\n";var m=t.variable;m||(d="with (obj) {\n"+d+"\n}\n"),d=(l?d.replace(T,""):d).replace(O,"$1").replace(A,"$1;"),d="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(l?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var _=b(function(){return Function(a,p+"return "+d).apply(void 0,i)});if(_.source=d,k(_))throw _;return _}},{"../internal/assignOwnDefaults":11,"../internal/assignWith":12,"../internal/baseAssign":13,"../internal/baseToString":22,"../internal/baseValues":23,"../internal/escapeStringChar":30,"../internal/isIterateeCall":35,"../internal/reInterpolate":40,"../lang/isError":45,"../object/keys":52,"../utility/attempt":58,"./templateSettings":57}],57:[function(t,e,n){var s=t("./escape"),a={escape:t("../internal/reEscape"),evaluate:t("../internal/reEvaluate"),interpolate:t("../internal/reInterpolate"),variable:"",imports:{_:{escape:s}}};e.exports=a},{"../internal/reEscape":38,"../internal/reEvaluate":39,"../internal/reInterpolate":40,"./escape":55}],58:[function(t,e,n){var s=t("../lang/isError"),a=t("../function/restParam")(function(t,e){try{return t.apply(void 0,e)}catch(t){return s(t)?t:new Error(t)}});e.exports=a},{"../function/restParam":7,"../lang/isError":45}],59:[function(t,e,n){e.exports=function(t){return t}},{}],60:[function(t,e,n){var s,a="";t("./debug");e.exports={init:function(t){return(s=document.createElement("audio")).setAttribute("autoplay",!0),s.volume=.5,document.body.appendChild(s),t&&(a=t),this},play:function(t,e){s&&(t&&""!==t&&(s.src=a+t+".wav",e?s.setAttribute("loop",!0):s.removeAttribute("loop")),s.play())},stop:function(){s.pause(),s.currentTime=0}}},{"./debug":63}],61:[function(t,e,n){var O,s,a,i=t("./lodash-fns"),r=t("./debug"),A=[],o=!1,l=!1,v=null,j="",c="",y=0,I=i.throttle(d,100,{trailing:!0,leading:!0}),w=0,k=0;function u(){v.style.left=w,v.style.top=k,a=window.requestAnimationFrame(u)}function d(t){s("cobrowsing/event",{entity:j,events:t})}function f(t){var e=t||window.event,n=e.type,s=e.target,a=s.nodeName,i=document.body,r={},o=null,l=document.getElementsByTagName(s.nodeName),c=document.documentElement.scrollTop||document.body.scrollTop,u=document.documentElement.scrollLeft||document.body.scrollLeft,d=0;if(3===s.nodeType&&(s=s.parentNode),"user"!==j||!function(t,e){var n=e.parentNode;for(;null!=n;){if(n==t)return!0;n=n.parentNode}return!1}(O,s)){for(d=0;d<A.length;d++)if(A[d].event==n)return void A.splice(d,1);for(d=0;d<l.length;d++)l[d]==s&&(o=d);if(r.event=n,r.entity=j,r.tn=a,r.tni=o,r.w=i.offsetWidth,r.h=i.offsetHeight,r.sx=u,r.sy=c,"mousemove"===n||"mouseover"===n||"mouseout"===n){var f=e.pageX||e.clientX+c,p=e.pageY||e.clientY+u;r.x=f,r.y=p}else if("scroll"===n);else if("keyup"==n||"keydown"==n||"keypress"==n){var m=e.charCode||e.keyCode||e.which,_=function(t){var e=0;if(document.selection){t.focus();var n=document.selection.createRange();n.moveStart("character",-t.value.length),e=n.text.length}else e=t.type&&("email"===t.type||"number"===t.type)||!t.selectionStart&&"0"!=t.selectionStart?null:t.selectionStart;return e}(s);if("INPUT"===a&&"password"===s.type)return;if("keyup"==n){if(null!==_&&(86!=m||!e.metaKey&&!e.ctrlKey))return;var g=s.value;g&&(g=g.replace(/\n/g,"<br>"),r.value=g)}else if("keydown"==n){if(null===_||8!=m&&46!=m&&190!=m)return;if(!s.value)return;r.pos=_,r.code=m}else if("keypress"===n){if(null===_||8==m||46==m)return;r.pos=_,r.code=m}}else if("change"===n){if("INPUT"===a&&"password"===s.type)return;r.value=s.value}else if("mouseup"==n||"select"==n){var h=window.getSelection()||document.selection.createRange().text,b=h.anchorOffset,x=h.focusOffset,v=0,y="",w=0,k="",E=0,S="",C=0,L="",T=!1;if(null!==h.anchorNode){for(k=h.anchorNode.parentNode,d=0;d<k.childNodes.length;d++)k.childNodes[d]==h.anchorNode&&(w=d);for(y=k.nodeName.toLowerCase(),l=document.getElementsByTagName(y),d=0;d<l.length;d++)l[d]===k&&(v=d);for(L=h.focusNode.parentNode,d=0;d<L.childNodes.length;d++)L.childNodes[d]==h.focusNode&&(C=d);for(S=L.nodeName.toLowerCase(),l=document.getElementsByTagName(S),d=0;d<l.length;d++)l[d]===L&&(E=d);y===S&&v===E&&w===C&&x<b&&(T=!0),r.sn=y,r.sni=v,r.schi=w,r.en=S,r.eni=E,r.echi=C,r.so=T?x:b,r.eo=T?b:x}}else"click"==n&&(r.scx=e.screenX,r.scy=e.screenY);I(r)}}function p(t,e,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent&&t.attachEvent("on"+e,n)}function m(t,e,n){t.removeEventListener?t.removeEventListener(e,n,!1):t.detachEvent&&t.detachEvent("on"+e,n)}e.exports={init:function(t){if(o)return r.info("Cobrowsing already initiated");p(document,"keyup",f),p(document,"keydown",f),p(document,"keypress",f),p(document,"mouseup",f),p(document,"click",f),p(document,"change",f),O="string"==typeof t.widget?document.querySelector(t.widget):t.widget,j=t.entity,s=t.emit,c=t.path,o=!0,r.log("cobrowsing module initiated with parameters: ",t),s("cobrowsing/init")},isInitiated:function(){return o},share:function(){if(l)return r.info("Browser already shared");p(document,"scroll",f),p(document,"select",f),p(document,"mousemove",f),t=document.body,v||((v=document.createElement("img")).className="wc-rmt-ptr",v.setAttribute("src",c+"images/pointer.png"),v.style.position="absolute",t.firstChild?t.insertBefore(v,t.firstChild):t.appendChild(v),u()),l=!0,r.log("browser shared"),s("cobrowsing/shared",{entity:j});var t},unshare:function(){if(!l)return r.info("Browser already unshared");m(document,"scroll",f),m(document,"select",f),m(document,"mousemove",f),function(){if(!v)return;cancelAnimationFrame(a),v.parentNode.removeChild(v),v=null}(),l=!1,s("cobrowsing/unshared",{entity:j}),r.log("browser unshared")},emitEvents:d,updateEvents:function(t){var e,n=document.documentElement,s={};if(t.events){if((s=t.events).timestamp<y)return;if(s.entity===j)return;if(s.url){var a=s.url,i=document.URL;-1!==i.indexOf("chatSessionId")&&(i=i.substr(0,i.indexOf("chatSessionId")-1)),a!=i&&(x=a,document.URL!==x&&(document.location.href=x))}if(s.w&&"user"===s.entity){var r=document.body,o=r.offsetWidth;o!==s.w&&(document.body.style.width=s.w+"px")}if("mousemove"===s.event)v&&(w=s.x+"px",k=s.y+"px");else if("scroll"===s.event)void 0!==s.tn&&((e="#document"===s.tn?n:document.getElementsByTagName(s.tn)[s.tni])&&(e.scrollTop=s.sy,e.scrollLeft=s.sx),console.log("scroll event: ",e,s.sy));else if("mouseup"===s.event||"select"===s.event){if(s.sn){var l=document.getElementsByTagName(s.sn)[s.sni],c=document.getElementsByTagName(s.en)[s.eni];if(document.createRange&&void 0!==l&&void 0!==c){var u=document.createRange();u.setStart(l.childNodes[s.schi],s.so),u.setEnd(c.childNodes[s.echi],s.eo);var d=window.getSelection();d.removeAllRanges(),d.addRange(u)}}}else if("keyup"===s.event||"keydown"===s.event||"keypress"===s.event){if(void 0!==s.tn&&void 0!==s.tni&&(e=document.getElementsByTagName(s.tn)[s.tni])){var f,p=e.value;if(8==s.code){if(s.pos==p.length-1)f=p.substr(0,s.pos-1);else{if(0===s.pos)return;f=p.substr(0,s.pos-1)+p.substr(s.pos)}e.value=f}else if(46==s.code)f=p.substr(0,s.pos)+p.substr(s.pos+1),e.value=f;else if(190==s.code)f=p.substr(0,s.pos)+"."+p.substr(s.pos),e.value=f;else if(void 0!==s.value){var m=s.value;m=m.replace(/<br>/g,"\n"),e.value=m}else{var _=String.fromCharCode(s.code);f=p?p.substr(0,s.pos)+_+p.substr(s.pos):_,e.value=f}}}else if("change"===s.event)(e=document.getElementsByTagName(s.tn)[s.tni]).value=s.value;else if("click"===s.event)(e=document.getElementsByTagName(s.tn)[s.tni])&&e.click();else if(e=document.getElementsByTagName(s.tn)[s.tni]){var g=function(t,e,n,s,a){var i,r={bubbles:!0,cancelable:"mousemove"!=t,view:window,detail:0,screenX:e,screenY:n,clientX:s,clientY:a,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:void 0};if("function"==typeof document.createEvent)(i=document.createEvent("MouseEvents")).initMouseEvent(t,r.bubbles,r.cancelable,r.view,r.detail,r.screenX,r.screenY,r.clientX,r.clientY,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.button,document.body.parentNode);else if(document.createEventObject){for(var o in i=document.createEventObject(),r)i[o]=r[o];i.button={0:1,1:4,2:2}[i.button]||i.button}return i}(s.event,s.x,s.y,s.x,s.y);b=g,!void((h=e).dispatchEvent?h.dispatchEvent(b):h.fireEvent&&h.fireEvent("on"+type,b))}"click"!==s.event&&"scroll"!==s.event||A.push(s)}var h,b;var x;t.timestamp&&(y=t.timestamp)}}},{"./debug":63,"./lodash-fns":64}],62:[function(p,m,t){(function(n){var t=p("events").EventEmitter,i=p("./storage"),r=p("./request"),o=p("./debug"),l=n.location,a=p("./lodash-fns"),e=p("inherits"),s=1,c="",u=!1,d=null;function f(t){return this.options=t||{},this.options.serverUrl=this.options.server+"/ipcc/$$$",this.session={},this.options.wsServer||this.options.pageid?(c=this.options.wsServer?this.options.wsServer:"main.ringotel.net/chatbot/WebChat/",c+=("/"!==c[c.length-1]?"/":"")+this.options.pageid,this.createWebsocket(),this.on("session/create",this.onSessionCreate.bind(this)),this.on("Error",this.onError),this):console.error("Cannot initiate module: pageid is undefined")}e(f,t),(m.exports=f).prototype.onError=function(t){o.log("Error: ",t)},f.prototype.onSessionCreate=function(t){this.session=a.merge(this.session,t),i.saveState("sid",t.sid)},f.prototype.setSessionTimeout=function(){var t=this.session.sessionTimeout;clearTimeout(d),t&&(d=setTimeout(this.onSessionTimeout.bind(this),1e3*t))},f.prototype.onSessionTimeout=function(){this.emit("session/timeout")},f.prototype.sendData=function(t){this.websocket&&this.websocket.send(JSON.stringify(t))},f.prototype.onWebsocketMessage=function(t){var e=JSON.parse(t.data);e.method;if(e.method)if("session"===e.method)this.emit("session/create",e.params);else if("messages"===e.method)e.params.list&&e.params.list.map(function(t,e,n){return t.sequence=e+1+"/"+n.length,this.emit("message/new",t),t}.bind(this));else if("message"===e.method)e.params.typing?this.emit("message/typing"):(this.emit("message/new",e.params),this.setSessionTimeout());else if("openShare"===e.method){if(this.session.sharedId===e.params.id)return;if(e.params.url&&l.href!==e.params.url)return window.location=e.params.url;e.params.id&&(this.session.sharedId=e.params.id,this.emit("session/joined",{url:l.href}),this.shareOpened(e.params.id,l.href))}else"shareOpened"===e.method?e.params.id&&(this.session.sharedId=e.params.id,this.emit("session/joined",{url:l.href})):"shareClosed"===e.method?(clearInterval(this.openShareInteval),this.session.sharedId="",this.emit("session/disjoin")):"events"===e.method&&this.emit("cobrowsing/update",e.params)},f.prototype.init=function(){u=!0;var t=i.getState("entity","session"),e=i.getState("sid");if(strIndex=l.href.indexOf("chatSessionId"),o.log("initModule: ",this.session,t,e),-1!==strIndex){e=this.getSidFromUrl(l.href),t="agent";var n=l.href.substr(0,strIndex);n="?"===n[n.length-1]?n.substr(0,n.length-1):n,i.saveState("sid",e),this.joinSession(n)}else"agent"===t?(e=i.getState("sid"),this.joinSession(l.href)):(t="user",this.createSession({sid:e,url:l.href}));this.session.sid=e,this.session.entity=t,i.saveState("entity",t,"session")},f.prototype.createSession=function(n){var t={method:"createSession",params:{url:n.url||l.href,lang:this.detectLanguage()}};if(n.sid&&(t.params.sid=n.sid),this.websocket)return this.sendData(t);r.post(this.options.serverUrl,t,function(t,e){t?this.emit("Error",t,{method:"createSession",params:n}):this.emit("session/create",e.result)}.bind(this))},f.prototype.joinSession=function(t){this.openShareInteval=setInterval(function(){this.openShare(t)}.bind(this),3e3),n.onclose=function(){this.shareClosed()}.bind(this)},f.prototype.updateEvents=function(t,n){if(this.session.sharedId){if(data={method:"events",params:{sid:this.session.sid,id:this.session.sharedId,timestamp:i.getState("eventTimestamp","cache"),events:t}},this.websocket)return this.sendData(data);r.post(this.options.serverUrl,data,function(t,e){if(t)return this.emit("Error",t,data),n(t);e.result.timestamp>i.getState("eventTimestamp","cache")?(i.saveState("eventTimestamp",e.result.timestamp,"cache"),n&&n(null,e.result)):n&&n(null,{events:[]})}.bind(this))}},f.prototype.getLanguages=function(t){o.log("this.session: ",this.session),t(null,this.session.langs)},f.prototype.chatRequest=function(n,s){n.sid=this.session.sid,o.log("chatRequest params: ",n);var t={method:"chatRequest",params:n};if(this.setSessionTimeout(),this.websocket)return this.sendData(t);r.post(this.options.serverUrl,t,function(t,e){if(t)return this.emit("Error",t,{method:"chatRequest",params:n}),void(s&&s(t));n.url=l.href,this.emit("chat/start",a.merge(n,e.result)),s&&s(null,e)}.bind(this))},f.prototype.getMessages=function(n){r.post(this.options.serverUrl,{method:"getMessages",params:{sid:this.session.sid,timestamp:i.getState("msgTimestamp")}},function(t,e){if(t)return this.emit("Error",t,{method:"getMessages"}),n(t);e.result.timestamp>i.getState("msgTimestamp")&&(i.saveState("msgTimestamp",e.result.timestamp),e.result.messages&&this.emit("message/new",e.result)),e.result.typing&&this.emit("message/typing",e.result),n&&n(null,e.result)}.bind(this))},f.prototype.closeChat=function(n){var s={method:"closeChat",params:{sid:this.session.sid}};if(n&&(s.params.rating=n),this.websocket)return this.sendData(s);r.post(this.options.serverUrl,s,function(t,e){t?this.emit("Error",t,s):(i.saveState("chat",!1),this.emit("chat/close",{rating:n,url:l.href}))}.bind(this))},f.prototype.sendMessage=function(t,e){var n={method:"message",params:{sid:this.session.sid,content:t.message}};if(this.setSessionTimeout(),this.websocket)t.file?(s={file:t.file,filename:t.message,sid:this.session.sid},a=new FormData,Object.keys(s).map(function(t){if("file"===t)a.append(t,s[t],s.filename||"");else{if("filename"===t)return t;a.append(t,s[t])}return t}),o.log("toFormData: ",s,a.get("filename")),n=a,r.upload("https://"+c,n,function(t,e){console.error("sendMessage: ",t,e)})):(n.params.content=t.message,this.sendData(n));else var s,a},f.prototype.sendEmail=function(n,s){n.sid=this.session.sid;var t={method:"sendMail",params:n};if(this.websocket)return this.sendData(t);r.post(this.options.serverUrl,t,function(t,e){if(t)return this.emit("Error",t,{method:"sendEmail",params:n}),void(s&&s(t));this.emit("chat/send",n),s&&s(null,e)}.bind(this))},f.prototype.requestCallback=function(n,s){n.sid=this.session.sid;var t={method:"requestCallback",params:n};if(this.websocket)return this.sendData(t);r.post(this.options.serverUrl,t,function(t,e){if(t)return this.emit("Error",t,{method:"requestCallback",params:n}),s(t);s&&s(null,e.result)}.bind(this))},f.prototype.disjoinSession=function(n){var t={method:"disjoinSession",params:{sid:n}};if(this.websocket)return this.sendData(t);r.post(this.options.serverUrl,t,function(t,e){t?this.emit("Error",t,{method:"disjoinSession",params:{sid:n}}):this.emit("session/disjoin",{url:l.href})}.bind(this))},f.prototype.shareOpened=function(){var t={method:"shareOpened",params:{id:this.session.sharedId,url:l.href}};if(this.websocket)return this.sendData(t)},f.prototype.shareClosed=function(){var t={method:"shareClosed",params:{id:this.session.sharedId,url:l.href}};if(this.websocket)return this.sendData(t)},f.prototype.openShare=function(t){var e={method:"openShare",params:{sid:this.session.sid,url:t}};if(this.websocket)return this.sendData(e);r.post(this.options.serverUrl,e,function(t,e){t&&this.emit("Error",t,{method:"openShare",params:{state:state}})}.bind(this))},f.prototype.setChatTimeout=function(t){return setTimeout(function(){this.emit("chat/timeout")}.bind(this),1e3*t)},f.prototype.userIsTyping=function(){var t={method:"typing",params:{sid:this.session.sid}};if(this.websocket)return this.sendData(t);r.post(this.options.serverUrl,t,function(t){t&&this.emit("Error",t,{method:"setChatTimeout"})}.bind(this))},f.prototype.userReadMessages=function(){var t={method:"messageRead",params:{}};if(this.websocket)return this.sendData(t);r.post(this.options.serverUrl,t,function(t){t&&this.emit("Error",t,{method:"setChatTimeout"})}.bind(this))},f.prototype.updateUrl=function(n){var t={method:"updateUrl",params:{sid:this.session.sid,url:n}};if(this.websocket)return this.sendData(t);r.post(this.options.serverUrl,t,function(t,e){t&&this.emit("Error",t,{method:"updateUrl",params:{url:n}})}.bind(this))},f.prototype.linkFollowed=function(n){var t={method:"linkFollowed",params:{sid:this.session.sid,url:n}};if(this.websocket)return this.sendData(t);r.post(this.options.serverUrl,t,function(t,e){t&&this.emit("Error",t,{method:"linkFollowed",params:{url:n}})}.bind(this))},f.prototype.detectLanguage=function(t){var e,n=i.getState("lang","session"),s=[];for(var a in t)s.push(a);return n?e=n:this.session.lang?e=this.session.lang:this.session.properties&&this.session.properties.lang?e=this.session.properties.lang:(this.session.langFromUrl||this.session.properties&&this.session.properties.langFromUrl)&&l.pathname.split("/").map(function(t){return t=function(t){var e=t;"ua"===t?e="uk":"us"!==t&&"gb"!==t||(e="en");return e}(t),-1!==s.indexOf(t)&&(e=t),t}),e||(e=(navigator.language||navigator.userLanguage).split("-")[0]),-1===s.indexOf(e)&&(e="en"),o.log("detected lang: ",s,n,this.session.lang,this.session.langFromUrl,e),this.session.lang=e},f.prototype.getSidFromUrl=function(t){var e=t.substring(t.indexOf("chatSessionId="));return e=e.substring(e.indexOf("=")+1)},f.prototype.createWebsocket=function(t){var e=new WebSocket("wss://"+c,"json.api.smile-soft.com");e.onopen=function(t){o.log("WebSocket opened: ",t),s=1,u||this.init()}.bind(this),e.onmessage=this.onWebsocketMessage.bind(this),e.onclose=this.onWebsocketClose.bind(this),e.onerror=this.onError,n.onbeforeunload=function(){e.onclose=function(){},e.close()},this.websocket=e},f.prototype.onWebsocketClose=function(t){o.log("WebSocket closed",t);var e=function(t){var e=1e3*(Math.pow(2,t)-1);3e4<e&&(e=3e4);return Math.random()*e}(s);setTimeout(function(){s++,this.createWebsocket()}.bind(this),e)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./debug":63,"./lodash-fns":64,"./request":66,"./storage":67,events:2,inherits:3}],63:[function(t,e,n){(function(n){function t(t,e){n.localStorage.getItem("swc.debug")&&[].forEach.call(t,function(t){n.console[e]?n.console[e](t):n.console.log(t)})}e.exports={log:function(){t(arguments,"log")},info:function(){t(arguments,"info")},warn:function(){t(arguments,"warn")},error:function(){t(arguments,"error")}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],64:[function(t,e,n){var s=t("lodash/string/template"),a=t("lodash/collection/foreach"),i=t("lodash/object/merge"),r=t("lodash/function/throttle");e.exports={template:s,forEach:a,merge:i,throttle:r,debounce:function(s,a,i){var r;return function(){var t=this,e=arguments,n=i&&!r;clearTimeout(r),r=setTimeout(function(){r=null,i||s.apply(t,e)},a),n&&s.apply(t,e)}},poll:function(e,n,s,t,a){var i=Number(new Date)+(t||2e3);a=a||300,function t(){e()?n():Number(new Date)<i?setTimeout(t,a):s(new Error("timed out for "+e+": "+arguments))}()},findParent:function(t,e){for(var n=e.charAt(0);t&&t!==document;t=t.parentNode)if("."===n){if(t.classList.contains(e.substr(1)))return t}else if("#"===n){if(t.id===e.substr(1))return t}else if("["===n){if(t.hasAttribute(e.substr(1,e.length-2)))return t}else if(t.nodeName===e.toUpperCase())return t;return!1}}},{"lodash/collection/foreach":4,"lodash/function/throttle":8,"lodash/object/merge":54,"lodash/string/template":56}],65:[function(t,e,n){var s=t("./widget.js");t("./core.js");e.exports=s.module},{"./core.js":62,"./widget.js":70}],66:[function(t,e,n){var o=t("./debug"),a={};function i(t,e,n,s){var a,i,r;(a=new XMLHttpRequest).open(t,e,!0),r=setTimeout(function(){a.abort()},6e4),a.onreadystatechange=function(){if(4==a.readyState&&(clearTimeout(r),a.response)){if((i="POST"===t?JSON.parse(a.response):a.response).error)return s(i.error);s(null,i)}},o.log("XmlHttpRequest: ",n),"POST"===t&&("object"!=typeof n||n instanceof FormData||(n=JSON.stringify(n),a.setRequestHeader("Content-Type","application/json; charset=UTF-8"))),n?a.send(n):a.send()}e.exports={post:function(t,e,n){i("POST",t,e,function(t,e){if(o.log("post respose: ",t,e),t)return n(t);n(null,e)})},get:function(n,t,s){if(n&&a[n])return s(null,a[n]);i("GET",t,null,function(t,e){if(t)return s(t);n&&(a[n]=e),s(null,e)})},put:function(t,e,n){i("PUT",t,e,function(t,e){if(o.log("put respose: ",t,e),t)return n(t);n(null,e)})},upload:function(t,e,n){i("POST",t,e,function(t,e){if(o.log("post respose: ",t,e),t)return n(t);n(null,e)})}}},{"./debug":63}],67:[function(t,e,n){(function(t){var s=t.localStorage,a=t.sessionStorage,i="swc",r=".",o={sid:null,eventTimestamp:0,msgTimestamp:0,entity:null,chat:null};function n(t,e){return"session"===e?JSON.parse(a.getItem(i+r+t)):JSON.parse(s.getItem(i+r+t))}function l(t,e,n){return"session"===n?a.setItem(i+r+t,JSON.stringify(e)):s.setItem(i+r+t,JSON.stringify(e)),e}function c(t,e){"session"===e?a.removeItem(i+r+t):s.removeItem(i+r+t)}e.exports={get:n,set:l,remove:c,getState:function(t,e){return e?"cache"===e?o[t]:n(t,e):void 0!==o[t]&&null!==o[t]?o[t]:n(t)},saveState:function(t,e,n){o[t]=e,"cache"!==n&&l(t,e,n);return e},removeState:function(t,e){delete o[t],c(t)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],68:[function(require,module,exports){var _={},escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},escapeRegexp=new RegExp("["+Object.keys(escapeMap).join("")+"]","g");_.escape=function(t){return t?String(t).replace(escapeRegexp,function(t){return escapeMap[t]}):""},exports.email=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){var prefix=defaults.prefix;__p+='\n<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">\n<html xmlns="http://www.w3.org/1999/xhtml">\n    <head>\n        <meta http-equiv="Content-Type" content="text/html; charset=windows-1251" />\n        \x3c!--[if !mso]>\x3c!--\x3e\n            <meta http-equiv="X-UA-Compatible" content="IE=edge" />\n        \x3c!--<![endif]--\x3e\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title></title>\n        \x3c!--[if (gte mso 9)|(IE)]>\n        <style type="text/css">\n            table {border-collapse: collapse;}\n        </style>\n        <![endif]--\x3e\n        <style type="text/css">\n            /* Basics */\n            body {\n            Margin: 0;\n                padding: 0;\n                min-width: 100%;\n                background-color: #ffffff;\n            }\n            table {\n                border-spacing: 0;\n                font-family: sans-serif;\n                color: #333333;\n            }\n            td {\n                padding: 0;\n            }\n            img {\n                border: 0;\n            }\n            .wrapper {\n                width: 100%;\n                table-layout: fixed;\n                -webkit-text-size-adjust: 100%;\n                -ms-text-size-adjust: 100%;\n                background-color: #F1F1F1;\n            }\n            .webkit {\n                max-width: 500px;\n            }\n            .outer {\n            Margin: 0 auto;\n                height: 100%;\n                width: 95%;\n                max-width: 500px;\n                padding: 10px;\n            }\n            p {\n                Margin: 0;\n            }\n            a {\n                color: #ee6a56;\n                text-decoration: underline;\n            }\n            .h1 {\n                font-size: 21px;\n                font-weight: bold;\n                Margin-bottom: 18px;\n            }\n            .h2 {\n                font-size: 18px;\n                font-weight: bold;\n                Margin-bottom: 12px;\n            }\n             \n            /* One column layout */\n            .one-column .contents {\n                text-align: left;\n                color:#505050;\n                font-family:Arial;\n                font-size:14px;\n                line-height:150%;\n            }\n            .one-column p {\n                font-size: 14px;\n                Margin-bottom: 10px;\n            }\n            .'+__e(prefix)+"-message {\n                display: block;\n                margin-bottom: 10px;\n                padding: 10px;\n                background-color: #FFFFFF;\n                border-bottom: 4px solid #CCCCCC;\n            }\n            ."+__e(prefix)+"-message img {\n                width: 100%;\n                max-width: 500px;\n                height: auto;\n            }\n            ."+__e(prefix)+"-message span {\n                font-weight: bold;\n                color: #999999;\n            }\n            ."+__e(prefix)+"-agent-msg ."+__e(prefix)+"-message-from {\n                color: #555555;\n            }\n            ."+__e(prefix)+"-user-msg ."+__e(prefix)+"-message-from {\n                color: #F75B5D;\n            }\n\n            ."+__e(prefix)+"-message ."+__e(prefix)+'-message-time {\n                position: relative;\n                float: right;\n            }\n            .copyright {\n                margin-top: 5px;\n                font-size: 12px;\n                font-style: italic;\n                color: #CCCCCC;\n                text-align: right;\n            }\n\n        </style>\n    </head>\n    <body>\n        <center class="wrapper">\n            <div class="webkit">\n                \x3c!--[if (gte mso 9)|(IE)]>\n                <table width="500" align="center" cellpadding="0" cellspacing="0" border="0">\n                <tr>\n                <td>\n                <![endif]--\x3e\n                <table class="outer" align="center" cellpadding="0" cellspacing="0" border="0">\n                    <tr>\n                        <td class="one-column">\n                            <table width="100%">\n                                <tr>\n                                    <td class="inner contents">\n                                        '+(null==(__t=content)?"":__t)+"\n                                    </td>\n                                </tr>\n                            </table>\n                        </td>\n                    </tr>\n                </table>\n                \x3c!--[if (gte mso 9)|(IE)]>\n                </td>\n                </tr>\n                </table>\n                <![endif]--\x3e\n            </div>\n        </center>\n    </body>\n</html>"}return __p};var _={},escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},escapeRegexp=new RegExp("["+Object.keys(escapeMap).join("")+"]","g");_.escape=function(t){return t?String(t).replace(escapeRegexp,function(t){return escapeMap[t]}):""},exports.forms=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj)__p+='<div class="'+__e(defaults.prefix)+"-message "+__e(defaults.prefix)+"-"+__e(message.entity)+'-msg">\n\t<span class="'+__e(defaults.prefix)+'-message-from">'+__e(message.from)+'</span>\n\t<div class="'+__e(defaults.prefix)+'-message-content" ',"user"===message.entity&&(__p+=" style=\"border-color:'"+__e(defaults.styles.primary.backgroundColor)+'" '),__p+='>\n\t\t<form id="'+__e(defaults.prefix)+"-"+__e(form.name)+'" name="'+__e(form.name)+'" ',form.autocomplete&&(__p+='autocomplete="on"'),__p+=' data-validate-form="true">\n\t\t\t',form.description&&(__p+='\n\t\t\t\t<p style="margin: 10px 0">'+(null==(__t=frases.FORMS.DESCRIPTIONS[form.description]||form.description)?"":__t)+"</p>\n\t\t\t"),__p+="\n\t\t\t",_.forEach(form.fields,function(t){__p+="\n\t\t\t\t","select"===t.type?(__p+='\n\t\t\t\t\t<select name="'+__e(t.name)+'">\n\t\t\t\t\t\t',_.forEach(t.options,function(t){__p+='\n\t\t\t\t\t\t\t<option value="'+__e(t.value)+'" ',t.selected&&(__p+=" selected "),__p+=" >\n\t\t\t\t\t\t\t\t"+__e(frases.FORMS.PLACEHOLDERS[t.text]||t.text)+"\n\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t"}),__p+="\n\t\t\t\t\t</select>\n\t\t\t\t"):"textarea"===t.type?(__p+='\n\t\t\t\t\t<textarea \n\t\t\t\t\t\tname="'+__e(t.name)+'"\n\t\t\t\t\t\tplaceholder="'+(null==(__t=frases.FORMS.PLACEHOLDERS[t.placeholder]||frases.FORMS.PLACEHOLDERS[t.name])?"":__t)+" ",t.required&&(__p+="*"),__p+='"\n\t\t\t\t\t></textarea>\n\t\t\t\t'):(__p+='\n\t\t\t\t\t<input \n\t\t\t\t\t\ttype="'+(null==(__t=t.type||"text")?"":__t)+'"\n\t\t\t\t\t\tplaceholder="'+(null==(__t=frases.FORMS.PLACEHOLDERS[t.placeholder]||frases.FORMS.PLACEHOLDERS[t.name])?"":__t)+" ",t.required&&(__p+="*"),__p+='"\n\t\t\t\t\t\tname="'+__e(t.name)+'" ',t.value&&(__p+='\n\t\t\t\t\t\tvalue="'+__e(credentials[t.value])+'" '),__p+=" ",t.required&&(__p+="required"),__p+="\n\t\t\t\t\t/>\n\t\t\t\t"),__p+="\n\t\t\t"}),__p+='\n\t\t\t<button \n\t\t\t\ttype="submit"\n\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block"\n\t\t\t\tstyle="background-color: '+__e(defaults.styles.primary.backgroundColor)+"; color: "+__e(defaults.styles.primary.color)+"; border: 1px solid "+__e(defaults.styles.primary.backgroundColor)+';">'+__e(frases.FORMS.send)+'</button>\n\t\t\t<button\n\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block"\n\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="rejectForm">'+__e(frases.FORMS.cancel)+'</button>\n\t\t</form>\n\t</div>\n\t<span class="'+__e(defaults.prefix)+'-message-time"> '+__e(message.time)+"</span>\n</div>";return __p};var _={},escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},escapeRegexp=new RegExp("["+Object.keys(escapeMap).join("")+"]","g");_.escape=function(t){return t?String(t).replace(escapeRegexp,function(t){return escapeMap[t]}):""},exports.message=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj)__p+='<div class="'+__e(defaults.prefix)+"-message "+__e(defaults.prefix)+"-"+__e(message.entity)+'-msg">\n\t<span class="'+__e(defaults.prefix)+'-message-from">'+__e(message.from)+'</span>\n\t<div class="'+__e(defaults.prefix)+'-message-content"\n\t\t',"user"!==message.entity&&(__p+=' \n\t\t\tstyle="border-color:'+(null==(__t=defaults.styles.primary.backgroundColor)?"":__t)+'" \n\t\t'),__p+=">\n\t\t<p>"+(null==(__t=message.content)?"":__t)+'</p>\n\t</div>\n\t<span class="'+__e(defaults.prefix)+'-message-time"> '+__e(message.time)+"</span>\n</div>";return __p};var _={},escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},escapeRegexp=new RegExp("["+Object.keys(escapeMap).join("")+"]","g");_.escape=function(t){return t?String(t).replace(escapeRegexp,function(t){return escapeMap[t]}):""},exports.widget=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){var frases=translations;__p+="\n";var panels=frases.PANELS;__p+="\n";var channels=defaults.channels;__p+="\n";var positionClass="right"===defaults.position?"position-right":"position-left";__p+='\n<div id="'+__e(defaults.prefix)+'-wg-cont" class="'+__e(defaults.prefix)+"-wg-cont "+__e(positionClass)+'">\n\n\t\x3c!-- ***** Panes container ***** --\x3e\n\t<div \n\t\tid="'+__e(defaults.prefix)+'-wg-panes" \n\t\tclass="'+__e(defaults.prefix)+'-wg-panes" \n\t\tstyle="',defaults.styles.width&&(__p+="width: "+__e(defaults.styles.width)+";"),__p+='">\n\n\t\t\x3c!-- ***** Top bar ***** --\x3e\n\t\t<div \n\t\t\tclass="'+__e(defaults.prefix)+'-top-bar" \n\t\t\tstyle="background: '+__e(defaults.styles.primary.backgroundColor)+"; color: "+__e(defaults.styles.primary.color)+';">\n\n\t\t\t\x3c!-- Main title --\x3e\n\t\t\t<h4 class="'+__e(defaults.prefix)+"-wg-title "+__e(defaults.prefix)+'-uppercase">\n\t\t\t\t'+__e(defaults.title||frases.TOP_BAR.title)+'\n\t\t\t</h4>\n\n\t\t\t<div class="'+__e(defaults.prefix)+'-wg-state-cont">\n\t\t\t\t\x3c!-- <span class="'+__e(defaults.prefix)+'-wg-state-icon"> </span> --\x3e\n\t\t\t\t<span class="'+__e(defaults.prefix)+'-wg-state"></span>\n\t\t\t</div>\n\n\t\t\t\x3c!-- Action buttons (minimize, close) --\x3e\n\t\t\t<div class="'+__e(defaults.prefix)+'-wg-minimize">\n\n\t\t\t\t\x3c!--<a \n\t\t\t\t\thref="#" \n\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="closeWidget">\n\t\t\t\t\t\n\t\t\t\t\t<span style="font-weight: bold">_</span>\n\t\t\t\t\n\t\t\t\t</a>--\x3e\n\t\t\t\t\n\t\t\t\t<a \n\t\t\t\t\thref="#" \n\t\t\t\t\tstyle="color: '+__e(defaults.styles.primary.color)+'"\n\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="closeWidget"\n\t\t\t\t\t<span class="'+__e(defaults.prefix)+'-icon-close"></span>\n\n\t\t\t\t</a>\n\n\t\t\t</div>\n\t\t</div>\n\t\t\x3c!-- ***** Top bar ends ***** --\x3e\n\n\t\t\x3c!-- ***** Connection types pane ***** --\x3e\n\t\t<div \n\t\t\tclass="'+__e(defaults.prefix)+'-wg-pane" \n\t\t\tdata-'+__e(defaults.prefix)+'-pane="chooseConnection">\n\t\t\t\n\t\t\t\x3c!-- Panel\'s image container --\x3e\n\t\t\t<div \n\t\t\t\tclass="'+__e(defaults.prefix)+"-pane-header "+__e(defaults.prefix)+'-dark" \n\t\t\t\t',defaults.styles.intro.backgroundImage&&(__p+=' \n\t\t\t\t\tstyle="background-image: url('+__e(defaults.clientPath)+__e(defaults.styles.intro.backgroundImage)+')" \n\t\t\t\t'),__p+='>\n\n\t\t\t\t\x3c!-- The text displayed on image --\x3e\n\t\t\t\t<div class="'+__e(defaults.prefix)+"-backdrop-cont "+__e(defaults.prefix)+'-white">\n\t\t\t\t\t<br>\n\t\t\t\t\t<p>'+__e(panels.CONNECTION_TYPES.choose_conn_type)+'</p>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\n\t\t\t\t<form \n\t\t\t\t\tid="'+__e(defaults.prefix)+'-init-form" \n\t\t\t\t\tname="'+__e(defaults.prefix)+'InitForm">\n\n\t\t\t\t\t',channels.webrtc&&(__p+=" \n\t\t\t\t\t\t\x3c!-- Display call button if WebRTC is enabled and supported by the browser --\x3e\n\t\t\t\t\t\t",defaults.webrtcEnabled?__p+=' \n\t\t\t\t\t\t\t<button \n\t\t\t\t\t\t\t\ttype="button" \n\t\t\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n\t\t\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\t\t\tbackground: '+__e(defaults.styles.primary.backgroundColor)+"; \n\t\t\t\t\t\t\t\t\tcolor: "+__e(defaults.styles.primary.color)+"; \n\t\t\t\t\t\t\t\t\tborder: 1px solid "+__e(defaults.styles.primary.color)+';"\n\t\t\t\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="initCall">\n\n\t\t\t\t\t\t\t\t'+__e(panels.CONNECTION_TYPES.call_agent_btn)+"\n\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\x3c!-- If WebRTC is not supported and fallback is set --\x3e\n\t\t\t\t\t\t":channels.webrtc.fallback&&channels.webrtc.fallback.sipCall&&(__p+='\n\t\t\t\t\t\t\t<button \n\t\t\t\t\t\t\t\ttype="button" \n\t\t\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n\t\t\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\t\t\tbackground: '+__e(defaults.styles.primary.backgroundColor)+"; \n\t\t\t\t\t\t\t\t\tcolor: "+__e(defaults.styles.primary.color)+"; \n\t\t\t\t\t\t\t\t\tborder: 1px solid "+__e(defaults.styles.primary.color)+';"\n\t\t\t\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="initFallbackCall">\n\n\t\t\t\t\t\t\t\t'+__e(panels.CONNECTION_TYPES.call_agent_btn)+"\n\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t"),__p+="\n\t\t\t\t\t"),__p+="\n\n\t\t\t\t\t\x3c!-- Display callback button if callback task is configured in the settings --\x3e\n\t\t\t\t\t",channels.callback&&channels.callback.task&&(__p+='\n\t\t\t\t\t\t<button \n\t\t\t\t\t\t\ttype="button" \n\t\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n\t\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\t\tbackground: '+__e(defaults.styles.primary.backgroundColor)+"; \n\t\t\t\t\t\t\t\tcolor: "+__e(defaults.styles.primary.color)+"; \n\t\t\t\t\t\t\t\tborder: 1px solid "+__e(defaults.styles.primary.color)+';"\n\t\t\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="initCallback">\n\n\t\t\t\t\t\t\t'+__e(panels.CONNECTION_TYPES.callback_btn)+"\n\n\t\t\t\t\t\t</button>\n\t\t\t\t\t"),__p+="\n\n\t\t\t\t\t\x3c!-- Init chat button --\x3e\n\t\t\t\t\t",defaults.chat&&(__p+='\n\t\t\t\t\t<button\n\t\t\t\t\t\ttype="button" \n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n\t\t\t\t\t\tstyle="background: '+__e(defaults.styles.primary.backgroundColor)+"; color: "+__e(defaults.styles.primary.color)+"; border: 1px solid "+__e(defaults.styles.primary.color)+';"\n\t\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="initChat">\n\t\t\t\t\t\t'+__e(panels.CONNECTION_TYPES.chat_agent_btn)+"\n\t\t\t\t\t</button>\n\t\t\t\t\t"),__p+='\n\n\t\t\t\t\t\x3c!-- Close widget button --\x3e\n\t\t\t\t\t<a href="#" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block" data-'+__e(defaults.prefix)+'-handler="closeWidget">'+__e(panels.CONNECTION_TYPES.cancel)+"</a>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t\t\x3c!-- ***** Connection types pane ends ***** --\x3e\n\n\t\t\x3c!-- ***** Intro pane. Displayed if configured in the settings object. ***** --\x3e\n\t\t",defaults.intro&&defaults.intro.length&&(__p+='\n\t\t\t<div \n\t\t\t\tclass="'+__e(defaults.prefix)+'-wg-pane" \n\t\t\t\tdata-'+__e(defaults.prefix)+'-pane="credentials">\n\n\t\t\t\t\x3c!-- Panel\'s image container --\x3e\n\t\t\t\t<div \n\t\t\t\t\tclass="'+__e(defaults.prefix)+"-pane-header "+__e(defaults.prefix)+'-dark" \n\t\t\t\t\t',defaults.styles.intro.backgroundImage&&(__p+=' \n\t\t\t\t\t\tstyle="background-image: url('+__e(defaults.clientPath)+__e(defaults.styles.intro.backgroundImage)+')" \n\t\t\t\t\t'),__p+='>\n\n\t\t\t\t\t\x3c!-- The text displayed on image --\x3e\n\t\t\t\t\t<div class="'+__e(defaults.prefix)+"-backdrop-cont "+__e(defaults.prefix)+'-white">\n\t\t\t\t\t\t<br>\n\t\t\t\t\t\t<p>'+__e(defaults.introMessage||panels.INTRO.intro_message)+'</p>\n\t\t\t\t\t</div>\n\n\t\t\t\t</div>\n\n\t\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\t\t\t\t\t<form \n\t\t\t\t\t\tid="'+__e(defaults.prefix)+'-intro-form" \n\t\t\t\t\t\tname="'+__e(defaults.prefix)+'IntroForm" \n\t\t\t\t\t\tdata-validate-form="true">\n\n\t\t\t\t\t\t\x3c!-- Iterating over intro array, which is a list of objects --\x3e\n\t\t\t\t\t\t',_.forEach(defaults.intro,function(t){__p+="\n\t\t\t\t\t\t\t","lang"===t.name?(__p+='\n\t\t\t\t\t\t\t\t<select name="lang">\n\t\t\t\t\t\t\t\t\t',_.forEach(languages,function(t){__p+='\n\t\t\t\t\t\t\t\t\t\t<option \n\t\t\t\t\t\t\t\t\t\t\tvalue="'+__e(t)+'" \n\t\t\t\t\t\t\t\t\t\t\t',t===currLang&&(__p+=" selected "),__p+=" >\n\t\t\t\t\t\t\t\t\t\t\t"+__e(translations[t].lang)+"\n\t\t\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t\t"}),__p+="\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t"):"message"===t.name?(__p+='\n\t\t\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\t\t\tname="message"\n\t\t\t\t\t\t\t\t\tplaceholder="'+(null==(__t=panels.INTRO.PLACEHOLDERS[t.name])?"":__t)+" ",t.required&&(__p+=" * "),__p+='"\n\t\t\t\t\t\t\t\t></textarea>\n\t\t\t\t\t\t\t'):"consent"===t.name?(__p+='\n\t\t\t\t\t\t\t\t<label for="'+__e(defaults.sid)+"-"+__e(t.name)+'">\n\t\t\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\t\ttype="checkbox" \n\t\t\t\t\t\t\t\t\tid="'+__e(defaults.sid)+"-"+__e(t.name)+'"\n\t\t\t\t\t\t\t\t\tname="'+__e(t.name)+'" \n\t\t\t\t\t\t\t\t\t',t.required&&(__p+=" required "),__p+=">\n\t\t\t\t\t\t\t\t\t"+(null==(__t=defaults.consentText)?"":__t)+"\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t"):"checkbox"===t.type?(__p+='\n\t\t\t\t\t\t\t\t<label for="'+__e(defaults.sid)+"-"+__e(t.name)+'">\n\t\t\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\t\ttype="checkbox" \n\t\t\t\t\t\t\t\t\tid="'+__e(defaults.sid)+"-"+__e(t.name)+'"\n\t\t\t\t\t\t\t\t\tname="'+__e(t.name)+'" \n\t\t\t\t\t\t\t\t\t',t.required&&(__p+=" required "),__p+=">\n\t\t\t\t\t\t\t\t\t"+__e(t.placeholder)+"\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t"):(__p+='\n\t\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\t\ttype="'+(null==(__t=t.type||"text")?"":__t)+'"\n\t\t\t\t\t\t\t\t\tplaceholder="'+(null==(__t=panels.INTRO.PLACEHOLDERS[t.name])?"":__t)+" ",t.required&&(__p+=" * "),__p+='" \n\t\t\t\t\t\t\t\t\tname="'+__e(t.name)+'" \n\t\t\t\t\t\t\t\t\t',t.save&&(__p+=' value="'+__e(credentials[t.name])+'" '),__p+=" \n\t\t\t\t\t\t\t\t\t",t.required&&(__p+=" required "),__p+=">\n\t\t\t\t\t\t\t"),__p+="\n\n\t\t\t\t\t\t"}),__p+='\n\t\t\t\t\t\t<br><br>\n\t\t\t\t\t\t\x3c!-- Init chat with intro properties --\x3e\n\t\t\t\t\t\t<button \n\t\t\t\t\t\t\ttype="submit" \n\t\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n\t\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\t\tbackground: '+__e(defaults.styles.primary.backgroundColor)+"; \n\t\t\t\t\t\t\t\tcolor: "+__e(defaults.styles.primary.color)+"; \n\t\t\t\t\t\t\t\tborder: 1px solid "+__e(defaults.styles.primary.color)+';">\n\n\t\t\t\t\t\t\t'+__e(panels.INTRO.start_dialog_button)+'\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t\x3c!-- Close widget button --\x3e\n\t\t\t\t\t\t<a href="#" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block" data-'+__e(defaults.prefix)+'-handler="closeWidget">'+__e(panels.INTRO.cancel)+"</a>\n\t\t\t\t\t</form>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"),__p+='\n\t\t\x3c!-- ***** Intro pane ends ***** --\x3e\n\n\t\t\x3c!-- ***** Messages pane ***** --\x3e\n\t\t<div  class="'+__e(defaults.prefix)+'-wg-pane" data-'+__e(defaults.prefix)+'-pane="messages">\n\t\t\t\n\t\t\t\x3c!-- Messages container --\x3e\n\t\t\t<ul \n\t\t\t\tid="'+__e(defaults.prefix)+'-messages-cont" \n\t\t\t\tclass="'+__e(defaults.prefix)+'-messages-cont" \n\t\t\t\tstyle="\n\t\t\t\t\t',defaults.styles.height&&(__p+="\n\t\t\t\t\t\theight: "+__e(defaults.styles.height)+";\n\t\t\t\t\t"),__p+='">\n\t\t\t\t\t\n\t\t\t</ul>\n\n\t\t\t<div class="'+__e(defaults.prefix)+'-write-cont">\n\t\t\t\t\n\t\t\t\t\x3c!-- End dialog button --\x3e\n\t\t\t\t<div class="'+__e(defaults.prefix)+'-action-btns">\n\t\t\t\t\t<a href="#" class="'+__e(defaults.prefix)+'-end-dialog-btn" data-'+__e(defaults.prefix)+'-handler="finish">'+__e(panels.MESSAGES.end_dialog)+'</a>\n\t\t\t\t\t<a href="#" class="'+__e(defaults.prefix)+'-trigger-sounds-btn" data-'+__e(defaults.prefix)+'-handler="triggerSounds">\n\t\t\t\t\t\t<span \n\t\t\t\t\t\t\tclass="',defaults.sounds?__p+=__e(defaults.prefix)+"-icon-bell":__p+=__e(defaults.prefix)+"-icon-bell-slash",__p+='">\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\n\t\t\t\t\x3c!-- "Agent is typing" indicator --\x3e\n\t\t\t\t<div class="'+__e(defaults.prefix)+'-loader">\n\t\t\t\t\t<span></span>\n\t\t\t\t\t<span></span>\n\t\t\t\t\t<span></span>\n\t\t\t\t</div>\n\n\t\t\t\t\x3c!-- "Attach file" button --\x3e\n\t\t\t\t<label \n\t\t\t\t\tclass="'+__e(defaults.prefix)+'-sendfile-cont" \n\t\t\t\t\tfor="'+__e(defaults.prefix)+'-file-select">\n\n\t\t\t\t\t<input \n\t\t\t\t\t\ttype="file" \n\t\t\t\t\t\tid="'+__e(defaults.prefix)+'-file-select">\n\t\t\t\t\t\n\t\t\t\t\t<span \n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+'-icon-upload" \n\t\t\t\t\t\tstyle="color: '+__e(defaults.styles.primary.backgroundColor)+'">\n\t\t\t\t\t</span>\n\n\t\t\t\t</label>\n\n\t\t\t\t<div id="'+__e(defaults.prefix)+'-message-text-clone"  class="'+__e(defaults.prefix)+'-msg-textarea-clone" ></div>\n\n\t\t\t\t\x3c!-- Field for typing the user message --\x3e\n\t\t\t\t<textarea \n\t\t\t\t\tid="'+__e(defaults.prefix)+'-message-text" \n\t\t\t\t\tclass="'+__e(defaults.prefix)+'-msg-textarea" \n\t\t\t\t\tplaceholder="'+__e(panels.MESSAGES.PLACEHOLDERS.message)+'" \n\t\t\t\t\tmaxlength="1000"></textarea>\n\t\t\t\t\n\t\t\t\t\x3c!-- "Send a message" button --\x3e\n\t\t\t\t<a \n\t\t\t\t\thref="#" \n\t\t\t\t\tclass="'+__e(defaults.prefix)+"-sendmsg-btn "+__e(defaults.prefix)+'-button" \n\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="sendMessage">\n\n\t\t\t\t\t<span \n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+'-icon-paper-plane" \n\t\t\t\t\t\tstyle="color: '+__e(defaults.styles.primary.backgroundColor)+'">\n\t\t\t\t\t</span>\n\t\t\t\t</a>\n\n\t\t\t</div>\n\t\t</div>\n\t\t\x3c!-- ***** Messages pane ends ***** --\x3e\n\n\t\t\x3c!-- ***** Offline pane ***** --\x3e\n\t\t<div \n\t\t\tclass="'+__e(defaults.prefix)+'-wg-pane" \n\t\t\tdata-'+__e(defaults.prefix)+'-pane="sendemail">\n\n\t\t\t\x3c!-- Panel\'s image container --\x3e\n\t\t\t<div \n\t\t\t\tclass="'+__e(defaults.prefix)+"-pane-header "+__e(defaults.prefix)+'-dark" \n\t\t\t\t',defaults.styles.sendmail.backgroundImage&&(__p+=' \n\t\t\t\t\tstyle="background-image: url('+__e(defaults.clientPath)+__e(defaults.styles.sendmail.backgroundImage)+')" \n\t\t\t\t'),__p+='>\n\n\t\t\t\t\x3c!-- The text displayed on image --\x3e\n\t\t\t\t<div class="'+__e(defaults.prefix)+"-backdrop-cont "+__e(defaults.prefix)+'-dark">\n\t\t\t\t\t<p>'+__e(panels.OFFLINE.offline_message)+'</p>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\n\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\t\t\t\t<h4 class="'+__e(defaults.prefix)+'-uppercase">'+__e(panels.OFFLINE.send_message_header)+'</h4>\n\t\t\t\t<form id="'+__e(defaults.prefix)+'-sendmail-form" data-validate-form="true">\n\t\t\t\t\t<input type="text" name="uname" placeholder="'+__e(panels.OFFLINE.PLACEHOLDERS.uname)+'">\n\t\t\t\t\t<input type="email" name="email" placeholder="'+__e(panels.OFFLINE.PLACEHOLDERS.email)+' *" required>\n\t\t\t\t\t<textarea name="text" placeholder="'+__e(panels.OFFLINE.PLACEHOLDERS.message)+'" maxlength="1500"></textarea>\n\n\t\t\t\t\t\x3c!--<input type="file" name="file" id="'+__e(defaults.prefix)+'-contactfile" class="'+__e(defaults.prefix)+'-inputfile" />\n\t\t\t\t\t<label for="'+__e(defaults.prefix)+'-contactfile">'+__e(panels.OFFLINE.choose_file)+'</label> --\x3e\n\n\t\t\t\t\t\x3c!-- "Send offline message" button --\x3e\n\t\t\t\t\t<button \n\t\t\t\t\t\ttype="submit" \n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\tbackground: '+__e(defaults.styles.primary.backgroundColor)+"; \n\t\t\t\t\t\t\tcolor: "+__e(defaults.styles.primary.color)+"; \n\t\t\t\t\t\t\tborder: 1px solid "+__e(defaults.styles.primary.color)+';">\n\n\t\t\t\t\t\t'+__e(panels.OFFLINE.send_message_button)+'\n\t\t\t\t\t\t\t\n\t\t\t\t\t</button>\n\n\t\t\t\t\t\x3c!-- Close widget button --\x3e\n\t\t\t\t\t<a href="#" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block" data-'+__e(defaults.prefix)+'-handler="closeWidget">'+__e(panels.OFFLINE.close)+'</a>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t\t\x3c!-- ***** Offline pane ends ***** --\x3e\n\n\t\t\x3c!-- ***** Close chat pane ***** --\x3e\n\t\t<div \n\t\t\tclass="'+__e(defaults.prefix)+'-wg-pane" \n\t\t\tdata-'+__e(defaults.prefix)+'-pane="closechat">\n\n\t\t\t\x3c!-- Panel\'s image container --\x3e\n\t\t\t<div \n\t\t\t\tclass="'+__e(defaults.prefix)+"-pane-header "+__e(defaults.prefix)+'-white" \n\t\t\t\t',defaults.styles.closeChat.backgroundImage&&(__p+=' \n\t\t\t\t\tstyle="background-image: url('+__e(defaults.clientPath)+__e(defaults.styles.closeChat.backgroundImage)+')" \n\t\t\t\t'),__p+='>\n\n\t\t\t\t\x3c!-- The text displayed on image --\x3e\n\t\t\t\t<div class="'+__e(defaults.prefix)+"-backdrop-cont "+__e(defaults.prefix)+'-white">\n\t\t\t\t\t<br>\n\t\t\t\t\t<p>'+__e(panels.CLOSE_CHAT.close_chat_header)+'</p>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\n\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\t\t\t\t<form id="'+__e(defaults.prefix)+'-closechat-form" data-validate-form="true">\n\t\t\t\t\t<label for="'+__e(defaults.prefix)+'-send-dialog">\n\t\t\t\t\t\t<input type="checkbox" name="sendDialog" id="'+__e(defaults.prefix)+'-send-dialog" />\n\t\t\t\t\t\t<span>'+__e(panels.CLOSE_CHAT.send_dialog_label)+'</span>\n\t\t\t\t\t</label>\n\t\t\t\t\t<input type="email" name="email" placeholder="'+__e(panels.CLOSE_CHAT.PLACEHOLDERS.email)+'">\n\t\t\t\t\t<select name="rating">\n\t\t\t\t\t\t<option value="">--- '+__e(panels.CLOSE_CHAT.rate_agent)+' ---</option>\n\t\t\t\t\t\t<option value="5">'+__e(frases.AGENT_RATES.excellent)+'</option>\n\t\t\t\t\t\t<option value="4">'+__e(frases.AGENT_RATES.good)+'</option>\n\t\t\t\t\t\t<option value="3">'+__e(frases.AGENT_RATES.fair)+'</option>\n\t\t\t\t\t\t<option value="2">'+__e(frases.AGENT_RATES.bad)+'</option>\n\t\t\t\t\t</select>\n\t\t\t\t\t<textarea placeholder="'+__e(panels.CLOSE_CHAT.PLACEHOLDERS.comment)+'" name="text" maxlength="1500"></textarea>\n\n\t\t\t\t\t\x3c!-- End chat and close widget button --\x3e\n\t\t\t\t\t<button \n\t\t\t\t\t\ttype="submit" \n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\tbackground: '+__e(defaults.styles.primary.backgroundColor)+"; \n\t\t\t\t\t\t\tcolor: "+__e(defaults.styles.primary.color)+"; \n\t\t\t\t\t\t\tborder: 1px solid "+__e(defaults.styles.primary.color)+';">\n\n\t\t\t\t\t\t'+__e(panels.CLOSE_CHAT.finish_dialog_button)+'\n\t\t\t\t\t\t\t\n\t\t\t\t\t</button>\n\n\t\t\t\t\t\x3c!-- "Back to the chat" button --\x3e\n\t\t\t\t\t<a href="#messages" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block">'+__e(panels.CLOSE_CHAT.back)+'</a>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t\t\x3c!-- ***** Close chat pane ends ***** --\x3e\n\n\t\t\x3c!-- ***** Audio call pane ***** --\x3e\n\t\t<div class="'+__e(defaults.prefix)+'-wg-pane" data-'+__e(defaults.prefix)+'-pane="callAgent">\n\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\t\t\t\t<div id="'+__e(defaults.prefix)+'-call-spinner" class="'+__e(defaults.prefix)+'-spinner-pane">\n\t\t\t\t\t<h3 class="'+__e(defaults.prefix)+'-text-center">'+__e(panels.AUDIO_CALL.confirm_access)+'</h3>\n\t\t\t\t\t<h3 class="'+__e(defaults.prefix)+"-text-center "+__e(defaults.prefix)+"-loader "+__e(defaults.prefix)+'-shown" style="position: relative;">\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t</h3>\n\t\t\t\t</div>\n\t\t\t\t<div id="'+__e(defaults.prefix)+'-call-info" class="'+__e(defaults.prefix)+'-hidden">\n\t\t\t\t\t<h3 class="'+__e(defaults.prefix)+'-text-center" id="'+__e(defaults.prefix)+'-call-state">'+__e(panels.AUDIO_CALL.calling_agent)+'</h3>\n\t\t\t\t\t<h3 class="'+__e(defaults.prefix)+'-text-center" id="'+__e(defaults.prefix)+'-call-timer">00:00</h3>\n\t\t\t\t</div>\n\t\t\t\t<form id="'+__e(defaults.prefix)+'-call-control">\n\t\t\t\t\t<hr>\n\t\t\t\t\t<button\n\t\t\t\t\t\tid="'+__e(defaults.prefix)+'-tryagain-btn"\n\t\t\t\t\t\ttype="button"\n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+"-block "+__e(defaults.prefix)+'-hidden"\n\t\t\t\t\t\tstyle="background: '+__e(defaults.styles.primary.backgroundColor)+"; color: "+__e(defaults.styles.primary.color)+"; border: 1px solid "+__e(defaults.styles.primary.color)+';"\n\t\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="initCall">\n\t\t\t\t\t\t'+__e(panels.AUDIO_CALL.try_again)+'\n\t\t\t\t\t</button>\t\n\t\t\t\t\t<button \n\t\t\t\t\t\ttype="button"\n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-warn "+__e(defaults.prefix)+'-block"\n\t\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="endCall">\n\n\t\t\t\t\t\t'+__e(panels.AUDIO_CALL.end_call)+'\n\n\t\t\t\t\t</button>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t\t\x3c!-- ***** Audio call pane ends ***** --\x3e\n\n\t\t\x3c!-- ***** Audio call fallback pane ***** --\x3e\n\t\t<div class="'+__e(defaults.prefix)+'-wg-pane" data-'+__e(defaults.prefix)+'-pane="callAgentFallback">\n\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\t\t\t\t<div class="'+__e(defaults.prefix)+'-text-center">\n\t\t\t\t\t<h3>'+__e(panels.AUDIO_CALL_FALLBACK.DOWNLOAD_MSG)+"</h3>\n\t\t\t\t\t<br>\n\t\t\t\t\t",channels.webrtc&&channels.webrtc.fallback&&(__p+='\n\t\t\t\t\t\t<a href="'+__e(channels.webrtc.fallback.sipCall)+'">call.jnlp</a>\n\t\t\t\t\t'),__p+='\n\t\t\t\t</div>\n\t\t\t\t<form>\n\t\t\t\t\t<hr>\n\t\t\t\t\t<a href="#chooseConnection" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block">'+__e(panels.CALLBACK.back)+'</a>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t\t\x3c!-- ***** Audio call fallback pane ends ***** --\x3e\n\n\t\t\x3c!-- ***** Callback pane ***** --\x3e\n\t\t<div \n\t\t\tclass="'+__e(defaults.prefix)+'-wg-pane" \n\t\t\tdata-'+__e(defaults.prefix)+'-pane="callback">\n\n\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\t\t\t\t<div id="'+__e(defaults.prefix)+'-callback-spinner" class="'+__e(defaults.prefix)+"-hidden "+__e(defaults.prefix)+'-spinner-pane">\n\t\t\t\t\t<h3 class="'+__e(defaults.prefix)+'-text-center">'+__e(panels.CALLBACK.sending_request)+'</h3>\n\t\t\t\t\t<h3 class="'+__e(defaults.prefix)+"-text-center "+__e(defaults.prefix)+"-loader "+__e(defaults.prefix)+'-shown" style="position: relative;">\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t</h3>\n\t\t\t\t</div>\n\t\t\t\t<form id="'+__e(defaults.prefix)+'-callback-settings">\n\t\t\t\t\t',channels.callback&&!1!==channels.callback.time?__p+='\n\t\t\t\t\t\t<p class="'+__e(defaults.prefix)+'-text-center">'+__e(panels.CALLBACK.title)+"</p>\n\t\t\t\t\t":__p+='\n\t\t\t\t\t\t<p class="'+__e(defaults.prefix)+'-text-center">'+__e(panels.CALLBACK.title_asap)+"</p>\n\t\t\t\t\t",__p+="\n\t\t\t\t\t<hr>\n\t\t\t\t\t<label>"+__e(panels.CALLBACK.LABELS.phone)+'</label>\n\t\t\t\t\t<input type="tel" name="phone" placeholder="'+__e(panels.CALLBACK.PLACEHOLDERS.phone)+'" required>\n\t\t\t\t\t',channels.callback&&!1!==channels.callback.time&&(__p+="\n\t\t\t\t\t\t<label>"+__e(panels.CALLBACK.LABELS.time)+'</label>\n\t\t\t\t\t\t<select name="time">\n\t\t\t\t\t\t\t',_.forEach(panels.CALLBACK.TIME_POINTS,function(t){__p+='\n\t\t\t\t\t\t\t\t<option value="'+__e(t.minutes)+'">'+__e(t.label)+"</option>\n\t\t\t\t\t\t\t"}),__p+="\n\t\t\t\t\t\t</select>\n\t\t\t\t\t"),__p+="\n\t\t\t\t\t",channels.callback&&channels.callback.message!==undefined&&(__p+="\n\t\t\t\t\t\t<label>"+__e(panels.CALLBACK.LABELS.message)+'</label>\n\t\t\t\t\t\t<textarea name="message" placeholder="'+__e(panels.CALLBACK.PLACEHOLDERS.message)+'" maxlength="1500"></textarea>\n\t\t\t\t\t'),__p+='\n\t\t\t\t\t<hr>\n\n\t\t\t\t\t<button\n\t\t\t\t\t\ttype="submit"\n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block"\n\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\tbackground: '+__e(defaults.styles.primary.backgroundColor)+"; \n\t\t\t\t\t\t\tcolor: "+__e(defaults.styles.primary.color)+"; \n\t\t\t\t\t\t\tborder: 1px solid "+__e(defaults.styles.primary.color)+';"\n\t\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="setCallback">\n\n\t\t\t\t\t\t'+__e(panels.CALLBACK.confirm_callback)+'\n\n\t\t\t\t\t</button>\n\n\t\t\t\t\t<a href="#chooseConnection" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block">'+__e(panels.CALLBACK.back)+'</a>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t\t\x3c!-- ***** Callback pane ends ***** --\x3e\n\n\t\t\x3c!-- ***** Callback sent pane ***** --\x3e\n\t\t<div class="'+__e(defaults.prefix)+'-wg-pane" data-'+__e(defaults.prefix)+'-pane="callbackSent">\n\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\t\t\t\t<div id="'+__e(defaults.prefix)+'-callback-sent">\n\t\t\t\t\t<h3 class="'+__e(defaults.prefix)+"-text-center "+__e(defaults.prefix)+"-icon-check "+__e(defaults.prefix)+'-text-success"></h3>\n\t\t\t\t\t',channels.callback&&!1!==channels.callback.time?__p+='\n\t\t\t\t\t\t<p class="'+__e(defaults.prefix)+'-text-center">'+__e(panels.CALLBACK.request_sent)+"</p>\n\t\t\t\t\t":__p+='\n\t\t\t\t\t\t<p class="'+__e(defaults.prefix)+'-text-center">'+__e(panels.CALLBACK.request_sent_asap)+"</p>\n\t\t\t\t\t",__p+='\n\t\t\t\t\t<form>\n\t\t\t\t\t\t<hr>\n\t\t\t\t\t\t<a href="#chooseConnection" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block">'+__e(panels.CALLBACK.back)+'</a>\n\t\t\t\t\t\t<a href="#" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block" data-'+__e(defaults.prefix)+'-handler="closeWidget">'+__e(panels.CALLBACK.close)+'</a>\n\t\t\t\t\t</form>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\x3c!-- ***** Callback sent pane ends ***** --\x3e\n\n\t</div>\n\t\x3c!-- ***** Panes container ends ***** --\x3e\n\n\t\x3c!-- ***** Floating button container ***** --\x3e\n\t<div id="'+__e(defaults.prefix)+'-btn-cont" class="'+__e(defaults.prefix)+'-btn-cont">\n\t\t<div class="'+__e(defaults.prefix)+'-wg-btn">\n\t\t\t<div class="'+__e(defaults.prefix)+'-lastmsg-cont">\n\t\t\t\t<span class="'+__e(defaults.prefix)+'-unnotify-btn" id="'+__e(defaults.prefix)+'-unnotify-btn"><span class="'+__e(defaults.prefix)+'-icon-close"></span></span>\n\t\t\t\t\x3c!-- <span class="'+__e(defaults.prefix)+'-unnotify-btn" id="'+__e(defaults.prefix)+'-unnotify-btn">'+__e(frases.FLOATING_BUTTON.close)+'</span> --\x3e\n\t\t\t\t<div id="'+__e(defaults.prefix)+'-lastmsg" class="'+__e(defaults.prefix)+'-lastmsg">\n\t\t\t\t</div>\t\n\t\t\t</div>\n\t\t\t<a href="#" class="'+__e(defaults.prefix)+'-btn-link">\n\t\t\t\t<span class="'+__e(defaults.prefix)+'-btn-icon"></span>\n\t\t\t</a>\n\t\t</div>\n\t</div>\n\t\x3c!-- ***** Floating button container ends ***** --\x3e\n\n</div>'}return __p}},{}],69:[function(t,e,n){(function(s){var a,i,r,o,l,c=t("./debug"),u={};e.exports={lib:a,init:function(t){c.log("Initiating WebRTC module:",t),a=s.JsSIP,i=t,c.log("JsSIP: ",s,a),void 0===i.sip.register&&(i.sip.register=!1);var e,n=new a.WebSocketInterface(i.sip.ws_servers);i.sip.sockets=[n],u.emit=t.emit,u.on=t.on,i.audioRemote=((e=document.createElement("audio")).setAttribute("autoplay","autoplay"),document.body.appendChild(e),e),(r=new a.UA(i.sip)).on("connected",function(t){c.log("sip connected event: ",t)}),r.on("disconnected",function(t){c.log("sip disconnected event: ",t)}),r.on("newMessage",function(t){c.log("sip newMessage event: ",t)}),r.on("newRTCSession",function(t){c.log("sip newRTCSession event: ",t),u.emit("webrtc/newRTCSession",t),o=t.session}),r.on("registered",function(t){c.log("sip registered event: ",t)}),r.on("unregistered",function(t){c.log("sip unregistered event: ",t)}),r.on("registrationFailed",function(t){c.log("sip registrationFailed event: ",t)}),l={progress:function(t){c.log("call progress event: ",t),u.emit("webrtc/progress",t)},failed:function(t){c.log("call failed event:",t),u.emit("webrtc/failed",t)},ended:function(t){c.log("call ended event: ",t),u.emit("webrtc/ended",t)},confirmed:function(t){c.log("call confirmed event: ",t),u.emit("webrtc/confirmed",t)}},r.start()},unregister:function(){r.stop()},audiocall:function(t){(o=r.call(t,{eventHandlers:l,mediaConstraints:{audio:!0,video:!1}})).connection.addEventListener("track",function(t){u.emit("webrtc/addstream",t),i.audioRemote.srcObject!==t.streams[0]&&(i.audioRemote.srcObject=t.streams[0])})},terminate:function(){o.terminate({status_code:200})},answer:function(){c.log("answer: ",r),o.answer()},hold:function(){c.log("hold: ",o.isOnHold()),o&&o.isOnHold().local?o.unhold():o.hold()},isInProgress:function(){return o.isInProgress()},isEstablished:function(){return o.isEstablished()},isEnded:function(){return o.isEnded()},isSupported:function(){var t=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia||navigator.mediaDevices.getUserMedia,n=window.mozRTCIceCandidate||window.RTCIceCandidate;return!!t&&!!e&&!!n}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./debug":63}],70:[function(Nt,Rt,t){(function(p){var d,m,i,_,r=Nt("domify"),n=Nt("./core"),g=Nt("./storage"),s=Nt("./request"),f=Nt("./debug"),h=Nt("./lodash-fns"),b=null,e=Nt("./cobrowsing"),a=Nt("./templates"),o=Nt("./webrtc"),x=Nt("./audio-control"),t="WchatSettings",l=!1,v=!1,c=1,y={prefix:"swc",autoStart:!0,intro:!1,introMessage:"",concentText:"",widget:!0,chat:!0,sounds:!0,channels:{webrtc:{},callback:{}},cobrowsing:!1,buttonSelector:"",reCreateSession:!0,title:"",lang:"",langFromUrl:!0,position:"right",hideOfflineButton:!1,offer:!1,themeColor:"",styles:{primary:{backgroundColor:"#74b9ff",color:"#FFFFFF"},intro:{},sendmail:{},closeChat:{}},buttonStyles:{online:{backgroundColor:"rgba(175,229,255)",color:""},offline:{backgroundColor:"rgba(241,241,241)",color:""},timeout:{backgroundColor:"rgba(241,241,241)",color:""},notified:{backgroundColor:"rgba(253,250,129)",color:""},color:"rgb(70,70,70)"},widgetWindowOptions:"left=10,top=10,width=350,height=550,resizable",path:"/ipcc/webchat/",clientPath:"https://cdn.smile-soft.com/wchat/v1/",stylesPath:"",translationsPath:"",host:window.location.host,webrtcEnabled:!1,maxFileSize:100,allowedFileExtensions:[]},w={initiated:!1,active:!1,state:"",share:!1,sounds:!0,dialog:[],messages:[],unreadMessages:!1,langs:[],chatTimeout:null,agentIsTypingTimeout:null,userIsTypingTimeout:null,timerUpdateInterval:null},u={initModule:E,initWidgetState:at,openWidget:Y,initChat:I,initCall:K,getWidgetElement:function(){return i},isWebrtcSupported:o.isSupported,getWidgetState:function(){return w},getEntity:function(){return g.getState("entity","session")},on:function(t,e){return m.on(t,e),this},emit:function(t,e){return m.emit(t,e),this},setDefaultCredentials:function(t){return y.credentials=t,this}};function k(t){return w.initiated||(h.merge(y,t||{}),m=new n(y).on("session/create",S).on("session/timeout",z).on("session/join",L).on("session/joined",O).on("session/disjoin",A).on("session/init",C),s.get("forms_json",y.clientPath+"forms.json",function(t,e){if(t)return m.emit("Error",t);d=JSON.parse(e).forms}),(e=document.createElement("link")).rel="stylesheet",e.href=y.stylesPath||y.clientPath+"main.css",document.head.appendChild(e)),u;var e}function E(){return m.init(),u}function S(){s.get("frases",(y.translationsPath||y.clientPath)+"translations.json",function(t,e){if(t)return m.emit("Error",t);b=JSON.parse(e)}),h.poll(function(){return f.log("poll: ",b),null!==b},function(){!function(){if(!y.chat&&!y.webrtcEnabled&&!y.channels.callback.task)return;m.session.properties&&h.merge(y,m.session.properties);y.sid=m.session.sid,y.isIpcc=void 0!==m.session.langs||void 0!==m.session.categories,f.log("initSession: ",m,y,b),b=y.lang&&b[y.lang]?b[y.lang]:b[m.detectLanguage(b)],y.widget&&m.on("chat/close",U).on("chat/timeout",W).on("message/new",M).on("message/new",F).on("message/typing",H).on("callback/create",J).on("form/submit",xt).on("form/reject",vt).on("widget/load",j);o.isSupported()&&y.channels.webrtc&&y.channels.webrtc.sip&&void 0!==y.channels.webrtc.sip.ws_servers&&("https:"===window.location.protocol?(y.webrtcEnabled=!0,m.on("webrtc/newRTCSession",function(){$("newRTCSession")}),m.on("webrtc/progress",function(t){180===t.response.status_code?$("ringing"):$("confirmed")}),m.on("webrtc/addstream",function(){$("connected")}),m.on("webrtc/ended",function(){$("ended")}),m.on("webrtc/failed",function(t){"Canceled"===t.cause?$("canceled"):$("failed")}),t={sip:y.channels.webrtc.sip,emit:u.emit,on:u.on},f.log("initWebrtcModule: ",t),o.init(t)):(f.warn("WebRTC feature is disabled"),f.warn("getUserMedia() no longer works on insecure origins. To use this feature, you should consider switching your application to a secure origin, such as HTTPS. See https://goo.gl/rStTGz for more details.")));var t;y.isIpcc&&m.getLanguages(function(t,e){var n;f.log("getLanguages: ",t,e),t||e&&((n=e).length,w.langs=n,m.emit("chat/languages",n))});y.buttonSelector&&(e=y.buttonSelector,n=y.widget?at:Y,[].slice.call(document.querySelectorAll(e)).map(function(t){return It(t,"click",n),t}));var e,n;y.themeColor&&(y.styles.primary.backgroundColor=y.themeColor,y.styles.primary.color=(y.themeColor,s=function(t){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(t,e,n,s){return e+e+n+n+s+s});var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}(y.themeColor),f.log("getThemeTextColor: ",s,Ot(s.r,s.g,s.b)),.5<Ot(s.r,s.g,s.b)?"#333":"#f1f1f1"));var s;f.log("initSession: ",y.widget,w.initiated,jt()),y.sounds=void 0!==g.getState("sounds")?g.getState("sounds","session"):y.sounds,x.init(y.clientPath+"sounds/"),y.widget&&!w.initiated&&jt()&&(a=y,compiled=wt("widget",{defaults:a,languages:w.langs,translations:b,credentials:g.getState("credentials","session")||{},_:h}),i=r(compiled),document.body.appendChild(i),m.emit("widget/load",i),f.log("loadWidget",a));var a;_t("timeout")&&gt("timeout");m.emit("session/init",{session:m.session,options:y,url:p.location.href})}(),y.external||m.updateUrl(window.location.href)},function(){if(!(c<2))return m.emit("Error","Module wasn't initiated due to network errors");c++,k(y)},6e4)}function C(t){g.saveState("init",!0,"session"),_&&!_.closed&&_.sessionStorage.setItem(y.prefix+".init",!0)}function L(t){f.log("onSessionJoinRequest",g.getState("shared","session")),g.getState("shared","session")?T(t):F({from:g.getState("aname","session"),time:Date.now(),content:"{request_browser_access}"})}function T(t){m.shareOpened(),O(t)}function O(t){!function(t){if(y.external||e.isInitiated())return;m.on("cobrowsing/init",function(){e.share()}),m.on("cobrowsing/update",function(t){e.updateEvents(t)}),m.on("cobrowsing/event",function(t){m.updateEvents(t.events)}),m.on("cobrowsing/shared",function(){g.saveState("shared",!0,"session")}),m.on("cobrowsing/unshared",function(t){g.saveState("shared",!1,"session")}),e.init({widget:t.widget,entity:t.entity,emit:u.emit,path:y.clientPath})}({url:t.url,entity:m.session.entity})}function A(){e.unshare()}function j(){var e,t,n="";w.initiated=!0,t=i.querySelector("."+y.prefix+"-wg-btn"),f.log("setStyles: ",t,y.buttonStyles),t.style.borderRadius=y.buttonStyles.borderRadius,t.style.boxShadow=y.buttonStyles.boxShadow,function(t){var e=document.getElementById(y.prefix+"-file-select"),n=document.getElementById(y.prefix+"-message-text"),s=[].slice.call(t.querySelectorAll("."+y.prefix+"-inputfile")),a=document.getElementById(y.prefix+"-btn-cont");[].slice.call(t.querySelectorAll("."+y.prefix+"-wg-pane")),document.getElementById(y.prefix+"-messages-cont");s.forEach(function(t){var n=t.nextElementSibling,s=n.textContent;It(t,"change",function(t){var e=t.target.value.split("\\").pop();n.textContent=e||s})}),It(a,"click",et),It(t,"click",tt),It(t,"submit",ct),It(e,"change",ut),It(n,"keypress",rt),It(n,"focus",ot),It(n,"blur",lt),It(p,"DOMMouseScroll",nt),It(p,"wheel",nt),It(t,"mouseenter",X),It(t,"mouseleave",V),It(window,"focus",Z),It(window,"blur",Q)}(i),function(t){if(f.log("changeWgState: ",t),!i||w.state===t.state)return;"offline"===t.state?(q(),gt("online"),dt("sendemail")):"online"===t.state&&gt("offline");var e=document.querySelector("."+y.prefix+"-wg-state");e&&(e.textContent=b.TOP_BAR.STATUS[t.state]);w.state=t.state,mt(t.state),pt(t.state),m.emit("widget/statechange",{state:t.state})}({state:ft()}),y.hideOfflineButton&&mt("no-button"),y.offer&&setTimeout(function(){var t;t={from:y.offer.from||b.TOP_BAR.title,time:Date.now(),content:y.offer.text||b.default_offer},"online"!==w.state||g.getState("interacted","session")||F(t)},y.offer.inSeconds?1e3*y.offer.inSeconds:3e4),!0===g.getState("chat","session")&&(N(g.getState("credentials","session")||{}),g.getState("opened","session")&&ht()),y.webrtcEnabled&&mt("webrtc-enabled"),i&&y.intro&&y.intro.length&&(w.langs.forEach(function(t){b&&b.lang&&(e=t===m.session.lang?"selected":"",n+='<option value="'+t+'" '+e+" >"+b.lang+"</option>")}),p[y.prefix+"IntroForm"].lang.innerHTML=n),m.emit("widget/init")}function I(){ht(),g.getState("chat","cache")||(st()?dt("sendemail"):y.intro&&y.intro.length?g.getState("chat","session")||g.getState("credentials","session")?N(g.getState("credentials","session")||{}):dt("credentials"):N({lang:m.session.lang}))}function N(t){var e,n,s=g.getState("chat","session"),a=g.getState("aid","session"),i=t.message,r={};a&&(t.agentid=a),t.lang||(t.lang=m.session.lang),delete(r=function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}({},t)).message,g.saveState("credentials",r,"session"),m.chatRequest(t),setTimeout(function(){f.log("requestChat: ",t.message,s),i&&!s&&R({message:t.message})},500),function(t){var e=t.answerTimeout;g.saveState("chat",!0,"session"),f.log("startChat timeout: ",e),e&&(w.chatTimeout=setTimeout(W,1e3*e));mt("chat")}(m.session),e=document.getElementById(y.prefix+"-messages-cont"),n=e.cloneNode(),e.parentNode.replaceChild(n,e),dt("messages")}function R(t){m.sendMessage(t),F({from:g.getState("credentials","session").uname||m.session.sid,time:Date.now(),content:t.message})}function F(t){f.log("new messages arrived!",t);var e,n,s,a,i,r,o,l,c=!1,u=null;if(sequence=t.sequence?t.sequence.split("/"):[1,1],credentials=g.getState("credentials","session")||{},aname=g.getState("aname","session"),uname=credentials.uname?credentials.uname:m.session.sid,messagesCont=document.getElementById(y.prefix+"-messages-cont"),t.entity=t.entity||(t.from===uname||void 0===t.from?"user":"agent"),t.from="user"===t.entity?"":t.from,t.time=t.time?kt(t.time):kt(Date.now()),s=t.content,a=t.file,i=t.entity,"form"===(e=a||Lt(s)?Ct(r=Lt(s)?s.substring(s.lastIndexOf("/")+1):s.substring(s.indexOf("_")+1))?{type:"image",content:'<a href="'+m.options.server+"/ipcc/"+s+'" download="'+r+'"><img src="'+m.options.server+"/ipcc/"+s+'" alt="file preview" /></a>'}:{type:"file",content:'<a href="'+s+'" download="'+r+'">'+s+"</a>"}:"agent"===i&&St(s)&&Ct(s)?(r=s.substring(s.indexOf("_")+1),{type:"image",content:'<a href="'+s+'" target="_blank"><img src="'+s+'" alt="'+r+'" /></a>'}):"agent"===i&&new RegExp("^{.+}$").test(s)?(d.forEach(function(t){t.name===s.substring(1,s.length-1)&&(o=t)}),{type:o?"form":"text",content:o||s}):{type:"text",content:s.replace(/\n/g," <br> ").split(" ").map(Et).join(" ").replace(" <br> ","<br>")}).type)n=wt("forms",{defaults:y,message:t,form:e.content,credentials:credentials,frases:b,_:h}),p[e.content.name]&&vt({formName:e.content.name}),messagesCont.insertAdjacentHTML("beforeend","<li>"+n+"</li>"),messagesCont.scrollTop=messagesCont.scrollHeight;else{if(!t.content)return;t.content=e.content,n=wt("message",{defaults:y,message:t}),messagesCont.insertAdjacentHTML("beforeend","<li "+(t.className?'class="'+t.className+'"':"")+">"+n+"</li>"),u=n,t.hidden||(w.dialog.push(n),w.messages.push(t))}"agent"===t.entity&&(aname!==t.from&&g.saveState("aname",t.from,"session"),t.agentid&&g.saveState("aid",t.agentid,"session"),t.from&&clearTimeout(w.chatTimeout)),"user"!==t.entity&&(c=!0),sequence&&sequence[0]==sequence[1]&&(u&&(l=u,w.active||(document.getElementById(y.prefix+"-lastmsg").innerHTML=l,mt("notified"),pt("notified"))),messagesCont.scrollTop=messagesCont.scrollHeight,c&&y.sounds&&x.play("new_message")),v||(w.unreadMessages=!0)}function M(){var t=[].slice.call(document.querySelectorAll("."+y.prefix+"-msg-undelivered"));t&&t.length&&t.forEach(function(t){t.classList.add(y.prefix+"-hidden")})}function P(t,e){var n=wt("email",{defaults:y,content:t,frases:b,_:h});if(e)return e(null,n)}function D(t,e){wt("message",{defaults:y,message:{from:b.EMAIL_SUBJECTS.request+" "+t.uname+" ("+t.email+")",content:t.text,entity:"",time:""}});m.sendEmail(t),e&&e()}function B(t,e){var n,s,a,i,r=e&&e.rating?parseInt(e.rating,10):null;if(e&&e.sendDialog){if(!e.email)return void alert(b.ERRORS.email);P((n={to:e.email,subject:b.EMAIL_SUBJECTS.dialog+" "+y.host,text:w.dialog}).text.join(""),function(t,e){t||(n.text=e,m.sendEmail(n))})}if(e&&e.text){if(!e.email)return void alert(b.ERRORS.email);s={email:e.email,subject:b.EMAIL_SUBJECTS.complain+" "+e.email,text:e.text},a=[],i=wt("message",{defaults:y,message:{from:b.EMAIL_SUBJECTS.complain+" "+s.email,content:s.text,entity:"",time:""}}),P(a=a.concat(i,'<br><p class="h1">'+b.EMAIL_SUBJECTS.dialog+" "+y.host+"</p><br>",w.dialog).reduce(function(t,e){return t.concat(e)}),function(t,e){t||(s.text=e,m.sendEmail(s))})}t&&t.reset(),q(r),bt()}function q(t){g.saveState("chat",!1,"session"),m.closeChat(t),gt("chat"),g.getState("shared","session")&&(m.shareClosed(p.location.href),e.unshare())}function U(){g.getState("shared","session")&&e.unshare()}function W(){f.log("chat timeout!"),F({from:"",time:Date.now(),content:"{queue_overload}"});var t=p.queue_overload;t&&(t.text.value=w.messages.reduce(function(t,e){return"user"===e.entity&&(t+=e.content+"\n"),t},""))}function H(){w.agentIsTypingTimeout||mt("agent-typing"),clearTimeout(w.agentIsTypingTimeout),w.agentIsTypingTimeout=setTimeout(function(){w.agentIsTypingTimeout=null,gt("agent-typing")},5e3)}function z(){f.log("Session timeout:"),!0===g.getState("chat","session")&&q(),dt("closechat")}function K(){dt("callAgent"),o.audiocall(y.channels.webrtc.hotline)}function J(){var t=document.getElementById(y.prefix+"-callback-settings");document.getElementById(y.prefix+"-callback-spinner").classList.add(y.prefix+"-hidden"),t.classList.remove(y.prefix+"-hidden"),err||dt("callbackSent")}function $(t){f.log("initCallState: ",t);var e=document.getElementById(y.prefix+"-call-spinner"),n=document.getElementById(y.prefix+"-call-info"),s=document.getElementById(y.prefix+"-call-state"),a=document.getElementById(y.prefix+"-call-timer"),i=document.getElementById(y.prefix+"-tryagain-btn");"newRTCSession"===t?$("oncall"):"confirmed"===t?(s.innerText=b.PANELS.AUDIO_CALL.calling_agent,n.classList.remove(y.prefix+"-hidden"),e.classList.add(y.prefix+"-hidden"),i.classList.add(y.prefix+"-hidden")):"ringing"===t?(G(a,"init",0),a.classList.remove(y.prefix+"-hidden")):"connected"===t?(s.innerText=b.PANELS.AUDIO_CALL.connected_with_agent,G(a,"start",0),x.stop()):"ended"===t?(s.innerText=b.PANELS.AUDIO_CALL.call_ended,G(a,"stop"),$("oncallend")):"failed"===t||"canceled"===t?(s.innerText="failed"===t?b.PANELS.AUDIO_CALL.call_failed:b.PANELS.AUDIO_CALL.call_canceled,n.classList.remove(y.prefix+"-hidden"),e.classList.add(y.prefix+"-hidden"),a.classList.add(y.prefix+"-hidden"),i.classList.remove(y.prefix+"-hidden"),$("oncallend"),x.play("busy")):"oncall"===t?(window.onbeforeunload=function(){return"Your connection is in progress. Do you realy want to close it?"},g.saveState("call",!0,"cache"),mt("webrtc-call")):"oncallend"===t?(window.onbeforeunload=null,g.saveState("call",!1,"cache"),gt("webrtc-call")):(n.classList.add(y.prefix+"-hidden"),e.classList.remove(y.prefix+"-hidden"),i.classList.add(y.prefix+"-hidden"))}function G(t,e,n){var s=n;"start"===e?w.timerUpdateInterval=setInterval(function(){s+=1,t.textContent=At(s)},1e3):"stop"===e?clearInterval(w.timerUpdateInterval):"init"===e&&(t.textContent=At(0))}function Y(t){t&&t.preventDefault();var e,n,s,a,i,r,o,l,c,u,d,f={};_&&!_.closed||((f=h.merge(f,y)).widget=!0,f.external=!0,_=window.open("","wchat",y.widgetWindowOptions),r=(e=_).document.createElement("div"),o=function(t,e){var n=t.document.createElement("style");n.type="text/css",e&&(n.id=e);return n.appendChild(t.document.createTextNode("")),n}(e,"swc-loader-styles"),l=e.document.getElementsByTagName("head")[0],c=e.document.getElementsByTagName("body")[0],r.className="swc-widget-loader",r.innerHTML="<span></span><span></span><span></span>",(a=e.document.createElement("meta")).name="viewport",a.content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0",(s=e.document.createElement("meta")).setAttribute("charset","utf-8"),(i=e.document.createElement("title")).textContent=b.TOP_BAR.title,(n=e.document.createElement("script")).src=y.clientPath+"wchat.min.js",n.charset="UTF-8",l.appendChild(a),l.appendChild(s),l.appendChild(i),l.appendChild(o),l.appendChild(n),c.id="swc-wg-window",c.appendChild(r),u=l.getElementsByTagName("style")[0],d=["body { margin:0; background-color: #eee; }","@keyframes preloading {","0 { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","50% { transform: translate(0,15px); -webkit-transform: translate(0,15px); -moz-transform: translate(0,15px); -ms-transform: translate(0,15px); -o-transform: translate(0,15px); }","100% { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","}","@-webkit-keyframes preloading {","0 { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","50% { transform: translate(0,15px); -webkit-transform: translate(0,15px); -moz-transform: translate(0,15px); -ms-transform: translate(0,15px); -o-transform: translate(0,15px); }","100% { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","}","@-moz-keyframes preloading {","0 { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","50% { transform: translate(0,15px); -webkit-transform: translate(0,15px); -moz-transform: translate(0,15px); -ms-transform: translate(0,15px); -o-transform: translate(0,15px); }","100% { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","}","@-ms-keyframes preloading {","0 { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","50% { transform: translate(0,15px); -webkit-transform: translate(0,15px); -moz-transform: translate(0,15px); -ms-transform: translate(0,15px); -o-transform: translate(0,15px); }","100% { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","}","@-o-keyframes preloading {","0 { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","50% { transform: translate(0,15px); -webkit-transform: translate(0,15px); -moz-transform: translate(0,15px); -ms-transform: translate(0,15px); -o-transform: translate(0,15px); }","100% { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","}",".swc-widget-loader {","position: absolute;","width: 100%;","top: 50%;","margin-top: -18px;","text-align: center;","}",".swc-widget-loader span {","display: inline-block;","width: 18px;","height: 18px;","border-radius: 50%;","background-color: #fff;","margin: 3px;","}",".swc-widget-loader span:nth-last-child(1) { -webkit-animation: preloading .8s .1s linear infinite; -moz-animation: preloading .8s .1s linear infinite; -ms-animation: preloading .8s .1s linear infinite; -o-animation: preloading .8s .1s linear infinite; animation: preloading .8s .1s linear infinite; }",".swc-widget-loader span:nth-last-child(2) { -webkit-animation: preloading .8s .3s linear infinite; -moz-animation: preloading .8s .3s linear infinite; -ms-animation: preloading .8s .3s linear infinite; -o-animation: preloading .8s .3s linear infinite; animation: preloading .8s .3s linear infinite; }",".swc-widget-loader span:nth-last-child(3) { -webkit-animation: preloading .8s .5s linear infinite; -moz-animation: preloading .8s .5s linear infinite; -ms-animation: preloading .8s .5s linear infinite; -o-animation: preloading .8s .5s linear infinite; animation: preloading .8s .5s linear infinite; }"].join(" "),u.innerHTML=d,_=e,h.poll(function(){return void 0!==_.Wchat},function(){_.Module=_.Wchat(f),_.Module.on("widget/init",function(){_.Module.initWidgetState()}),h.forEach(m._events,function(t,e,n){_.Module.on(e,function(t){t.url=p.location.href,m.emit("window/"+e,t)})})},function(){console.warn("Wchat module was not initiated due to network connection issues.")},12e4),_.onbeforeunload=function(){g.getState("chat","session")&&q()}),_.focus&&_.focus()}function X(){l=!0}function V(){l=!1}function Z(){v=!0,w.unreadMessages&&m.userReadMessages()}function Q(){v=!1}function tt(t){var e,n,s,a,i,r=t.target;"A"!==r.parentNode.tagName&&"BUTTON"!==r.parentNode.tagName||(r=r.parentNode),e=r.getAttribute("data-"+y.prefix+"-handler"),a=r.getAttribute("data-"+y.prefix+"-link"),"closeWidget"===e?bt():"finish"===e?y.isIpcc&&g.getState("chat","session")?dt("closechat"):(q(),bt()):"triggerSounds"===e?(i=document.querySelector("."+y.prefix+"-trigger-sounds-btn span"),y.sounds=!y.sounds,i.className=y.sounds?y.prefix+"-icon-bell":y.prefix+"-icon-bell-slash",g.saveState("sounds",y.sounds,"session")):"sendMessage"===e?it():"openWindow"===e?Y():"rejectForm"===e?m.emit("form/reject",{formName:h.findParent(r,"form").name}):"initCall"===e?K():"initFallbackCall"===e?dt("callAgentFallback"):"initCallback"===e?dt("callback"):"setCallback"===e?function(){var t=document.getElementById(y.prefix+"-callback-settings"),e=Tt(t);if(document.getElementById(y.prefix+"-callback-spinner"),document.getElementById(y.prefix+"-callback-sent"),e.phone=e.phone?e.phone.replace(/\D+/g,""):null,!e.phone||e.phone.length<10)return alert(b.ERRORS.tel);if(e.time){if(e.time=parseFloat(e.time),e.time<=0)return;e.time=Date.now()+60*e.time*1e3}e.task=y.channels.callback.task,f.log("setCallback data: ",e),m.requestCallback(e),dt("callbackSent"),t.reset()}():"initChat"===e?I():"endCall"===e&&(o.isEstablished()||o.isInProgress()?o.terminate():(bt(),$("init"))),"A"===r.tagName&&(s=r.href,a?m.linkFollowed(a):-1!==s.indexOf("#")&&(t.preventDefault(),(n=s.substring(r.href.indexOf("#")+1))&&dt(n)))}function et(t){t.preventDefault();var e=t.target,n=y.prefix+"-unnotify-btn";if(currTarg=t.currentTarget,e.id===n||e.parentNode.id===n)return gt("notified"),void pt(w.state);currTarg.id===y.prefix+"-btn-cont"&&at()}function nt(t){var e=document.getElementById(y.prefix+"-messages-cont"),n=function(t){var e;e=t.wheelDelta?t.wheelDelta:-1*t.deltaY;{if(e<0)return"down";if(0<e)return"up"}}(t);l&&(0===e.scrollTop&&"up"===n?(t.stopPropagation(),t.preventDefault()):e.scrollTop>=e.scrollHeight-e.clientHeight&&"down"===n&&(t.stopPropagation(),t.preventDefault()))}function st(){return"offline"===ft()}function at(t){t&&t.preventDefault();var e=g.getState("chat","session"),n=(g.getState("opened","session"),g.getState("call","cache"));f.log("initWidgetState"),g.getState("interacted","session")||g.saveState("interacted",!0,"session"),_t("timeout")?E():e?ht():st()?(dt("sendemail"),ht()):y.webrtcEnabled?(n||(y.chat||y.channels.callback.task?dt("chooseConnection"):K()),ht()):y.channels.callback.task?(y.chat||y.webrtcEnabled?dt("chooseConnection"):dt("callback"),ht()):I()}function it(){var t,e=document.getElementById(y.prefix+"-message-text");(t=e.value.trim())&&(g.getState("chat","session")||I(),R({message:t}),e.value="",gt("type-extend"))}function rt(t){var e=t.target,n=document.getElementById("swc-message-text-clone");10===t.keyCode||13===t.keyCode?(t.preventDefault(),it()):w.userIsTypingTimeout||(w.userIsTypingTimeout=setTimeout(function(){w.userIsTypingTimeout=null,m.userIsTyping()},1e3)),n.innerText=e.value,e.style.height=n.clientHeight+"px"}function ot(t){t.target.style.borderColor=y.styles.primary.backgroundColor}function lt(t){t.target.style.borderColor="#fff"}function ct(t){var e=t.target;t.preventDefault(),"FORM"===e.tagName&&m.emit("form/submit",{formElement:e,formData:Tt(e)})}function ut(t){yt(t.target,function(t,e){if(f.log("wgSendFile: ",t,e),t)return b.ERRORS[t]&&alert(b.ERRORS[t]),f.warn("File wasn't sent");R({message:e.filename,file:e.filedata})})}function dt(e){var n="data-"+y.prefix+"-pane";[].slice.call(i.querySelectorAll("."+y.prefix+"-wg-pane")).forEach(function(t){t.getAttribute(n)===e?t.classList.add("active"):t.classList.remove("active")})}function ft(){return y.isIpcc?w.state?w.state:w.langs.length?"online":"offline":w.state?w.state:m.session.state?"online":"offline"}function pt(t){if(i&&void 0!==y.buttonStyles[t]){var e=i.querySelector("."+y.prefix+"-wg-btn"),n=i.querySelector("."+y.prefix+"-btn-icon");e.style.background=y.buttonStyles[t].backgroundColor,n.style.color=y.buttonStyles[t].color||y.buttonStyles.color}}function mt(t){i&&i.classList.add(t)}function _t(t){return!!i&&i.classList.contains(t)}function gt(t){i&&i.classList.remove(t)}function ht(){var t=document.getElementById(y.prefix+"-messages-cont");w.active=!0,g.saveState("opened",!0,"session"),mt("active"),gt("notified"),pt(w.state),t.scrollTop=t.scrollHeight}function bt(){window.opener?window.close():(w.active=!1,g.saveState("opened",!1,"session"),gt("active"))}function xt(t){var e,n,s,a,i=t.formElement,r=t.formData;if((f.log("onFormSubmit: ",i,r),i.getAttribute("data-validate-form"))&&!(e=i,n=!0,[].slice.call(e.elements).every(function(t){return!t.hasAttribute("required")||""!==t.value&&null!==t.value||(alert(b.ERRORS[t.type]||b.ERRORS.required),n=!1)}),n))return;i.id===y.prefix+"-closechat-form"?B(i,r):i.id===y.prefix+"-sendmail-form"?(s=i,(a=r).email?(a.subject=b.EMAIL_SUBJECTS.request+" "+a.email,a.file?yt(s.file,function(t,e){if(t)return b.ERRORS[t]&&alert(b.ERRORS[t]),f.warn("File wasn't sent");a.filename=e.filename,a.filedata=e.filedata,delete a.file,D(a,function(){s.reset(),bt()})}):D(a,function(){s.reset(),bt()})):alert(b.ERRORS.email)):i.id===y.prefix+"-intro-form"?N(r):i.id===y.prefix+"-call-btn-form"?K():i.id===y.prefix+"-chat-btn-form"?I():i.id===y.prefix+"-queue_overload"?(D(r),vt({formName:i.name},!0)):i.id===y.prefix+"-request_browser_access"?(T({url:p.location.href}),vt({formName:i.name},!0),bt()):vt({formName:i.name},!0)}function vt(t,e){var n=p[t.formName];if(!n)return!1;n.outerHTML=e?'<p class="'+y.prefix+'-text-center"><i class="'+y.prefix+"-text-success "+y.prefix+'-icon-check"></i><span> '+b.FORMS.submitted+"</span></p>":'<p class="'+y.prefix+'-text-center"><i class="'+y.prefix+"-text-danger "+y.prefix+'-icon-remove"></i><span> '+b.FORMS.canceled+"</span></p>"}function yt(t,e){var n,s=t.files;if(s.length){if(p.FileReader){var a=function(t){f.log("checkFileParams: ",t,t.size,t.name,y.allowedFileExtensions,1e3*y.maxFileSize*1e3);var e=[],n=t.name.split(".")[t.name.split(".").length-1];n&&y.allowedFileExtensions&&y.allowedFileExtensions.length&&-1===y.allowedFileExtensions.indexOf(n.toLowerCase())&&e.push("file_type_error");y.maxFileSize&&1e3*y.maxFileSize*1e3<t.size&&e.push("file_size_error");return f.log("checkFileParams errors: ",e),e}(n=s[0]);return a.length?e(a[0]):e(null,{filedata:new Blob([n],{type:n.type}),filename:n.name})}e&&e("OBSOLETE_BROWSER")}}function wt(t,e){return(0,a[t])(e)}function kt(t){var e=new Date("string"==typeof t?parseInt(t,10):t),n=e.getHours(),s=e.getMinutes();return(n<10?"0"+n:n)+":"+(s<10?"0"+s:s)}function Et(t){var e=0,n=t;if(St(t)){for(;!n.charAt(n.length-1).match(/[a-z0-9\/]/i);)n=n.slice(0,-1),e+=1;return f.log("convertLinks: ",n),'<a href="'+(-1!==n.indexOf("www.")?"http://"+n:n)+'" target="_blank" data-'+y.prefix+'-link="'+n+'">'+n+"</a>"+t.substr(t.length-e)}return t}function St(t){return new RegExp("^http://|^https://|^www.[a-zA-z0-9-]*.[a-zA-Z0-9]").test(t)}function Ct(t){var e=new RegExp("png|PNG|jpg|JPG|JPEG|jpeg|gif|GIF"),n=t.substring(t.lastIndexOf(".")+1);return e.test(n)}function Lt(t){var e=new RegExp("pdf|PDF|txt|TXT"),n=t.substring(t.lastIndexOf(".")+1);return e.test(n)}function Tt(t){var e={};return[].slice.call(t.elements).forEach(function(t){"checkbox"===t.type?e[t.name]=t.checked:t.value&&(e[t.name]=t.value)}),e}function Ot(t,e,n){var s=t/255,a=e/255,i=n/255;return.2126*(s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4))+.7152*(a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4))+.0722*(i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4))}function At(t){var e=Math.floor(t/60),n=t%60;return(9<e?e:"0"+e)+":"+(9<n?n:"0"+n)}function jt(){return void 0!==document.body.classList}function It(t,e,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent&&t.attachEvent("on"+e,n)}Rt.exports={module:k,api:u},p[t]&&!1!==p[t].autoStart&&y.autoStart&&("complete"===document.readyState||"interactive"===document.readyState?k(p[t]):document.addEventListener("DOMContentLoaded",function(){k(p[t])},!1))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./audio-control":60,"./cobrowsing":61,"./core":62,"./debug":63,"./lodash-fns":64,"./request":66,"./storage":67,"./templates":68,"./webrtc":69,domify:1}]},{},[65])(65)});