!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Wchat=t()}}(function(){var define,module,exports;return function t(e,n,a){function r(i,o){if(!n[i]){if(!e[i]){var l="function"==typeof require&&require;if(!o&&l)return l(i,!0);if(s)return s(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[i]={exports:{}};e[i][0].call(u.exports,function(t){var n=e[i][1][t];return r(n?n:t)},u,u.exports,t,e,n,a)}return n[i].exports}for(var s="function"==typeof require&&require,i=0;i<a.length;i++)r(a[i]);return r}({1:[function(t,e,n){function a(t,e){if("string"!=typeof t)throw new TypeError("String expected");e||(e=document);var n=/<([\w:]+)/.exec(t);if(!n)return e.createTextNode(t);t=t.replace(/^\s+|\s+$/g,"");var a=n[1];if("body"==a){var r=e.createElement("html");return r.innerHTML=t,r.removeChild(r.lastChild)}var s=i[a]||i._default,o=s[0],l=s[1],c=s[2],r=e.createElement("div");for(r.innerHTML=l+t+c;o--;)r=r.lastChild;if(r.firstChild==r.lastChild)return r.removeChild(r.firstChild);for(var u=e.createDocumentFragment();r.firstChild;)u.appendChild(r.removeChild(r.firstChild));return u}e.exports=a;var r,s=!1;"undefined"!=typeof document&&(r=document.createElement("div"),r.innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>',s=!r.getElementsByTagName("link").length,r=void 0);var i={legend:[1,"<fieldset>","</fieldset>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],_default:s?[1,"X<div>","</div>"]:[0,"",""]};i.td=i.th=[3,"<table><tbody><tr>","</tr></tbody></table>"],i.option=i.optgroup=[1,'<select multiple="multiple">',"</select>"],i.thead=i.tbody=i.colgroup=i.caption=i.tfoot=[1,"<table>","</table>"],i.polyline=i.ellipse=i.polygon=i.circle=i.text=i.line=i.path=i.rect=i.g=[1,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1">',"</svg>"]},{}],2:[function(t,e,n){function a(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(t){return"function"==typeof t}function s(t){return"number"==typeof t}function i(t){return"object"==typeof t&&null!==t}function o(t){return void 0===t}e.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._maxListeners=void 0,a.defaultMaxListeners=10,a.prototype.setMaxListeners=function(t){if(!s(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},a.prototype.emit=function(t){var e,n,a,s,l,c;if(this._events||(this._events={}),"error"===t&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[t],o(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(i(n))for(s=Array.prototype.slice.call(arguments,1),c=n.slice(),a=c.length,l=0;l<a;l++)c[l].apply(this,s);return!0},a.prototype.addListener=function(t,e){var n;if(!r(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,r(e.listener)?e.listener:e),this._events[t]?i(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,i(this._events[t])&&!this._events[t].warned&&(n=o(this._maxListeners)?a.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())),this},a.prototype.on=a.prototype.addListener,a.prototype.once=function(t,e){function n(){this.removeListener(t,n),a||(a=!0,e.apply(this,arguments))}if(!r(e))throw TypeError("listener must be a function");var a=!1;return n.listener=e,this.on(t,n),this},a.prototype.removeListener=function(t,e){var n,a,s,o;if(!r(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],s=n.length,a=-1,n===e||r(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(i(n)){for(o=s;o-- >0;)if(n[o]===e||n[o].listener&&n[o].listener===e){a=o;break}if(a<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(a,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},a.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],r(n))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},a.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?r(this._events[t])?[this._events[t]]:this._events[t].slice():[]},a.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(r(e))return 1;if(e)return e.length}return 0},a.listenerCount=function(t,e){return t.listenerCount(e)}},{}],3:[function(t,e,n){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},{}],4:[function(t,e,n){var a=t("../internal/arrayEach"),r=t("../internal/baseEach"),s=t("../internal/createForEach"),i=s(a,r);e.exports=i},{"../internal/arrayEach":10,"../internal/baseEach":16,"../internal/createForEach":33}],5:[function(t,e,n){var a=t("../internal/getNative"),r=a(Date,"now"),s=r||function(){return(new Date).getTime()};e.exports=s},{"../internal/getNative":40}],6:[function(t,e,n){function a(t,e,n){function a(){h&&clearTimeout(h),p&&clearTimeout(p),v=0,p=h=b=void 0}function l(e,n){n&&clearTimeout(n),p=h=b=void 0,e&&(v=s(),m=t.apply(g,f),h||p||(f=g=void 0))}function c(){var t=e-(s()-_);t<=0||t>e?l(b,p):h=setTimeout(c,t)}function u(){l(x,h)}function d(){if(f=arguments,_=s(),g=this,b=x&&(h||!w),y===!1)var n=w&&!h;else{p||w||(v=_);var a=y-(_-v),r=a<=0||a>y;r?(p&&(p=clearTimeout(p)),v=_,m=t.apply(g,f)):p||(p=setTimeout(u,a))}return r&&h?h=clearTimeout(h):h||e===y||(h=setTimeout(c,e)),n&&(r=!0,m=t.apply(g,f)),!r||h||p||(f=g=void 0),m}var f,p,m,_,g,h,b,v=0,y=!1,x=!0;if("function"!=typeof t)throw new TypeError(i);if(e=e<0?0:+e||0,n===!0){var w=!0;x=!1}else r(n)&&(w=!!n.leading,y="maxWait"in n&&o(+n.maxWait||0,e),x="trailing"in n?!!n.trailing:x);return d.cancel=a,d}var r=t("../lang/isObject"),s=t("../date/now"),i="Expected a function",o=Math.max;e.exports=a},{"../date/now":5,"../lang/isObject":60}],7:[function(t,e,n){function a(t,e){if("function"!=typeof t)throw new TypeError(r);return e=s(void 0===e?t.length-1:+e||0,0),function(){for(var n=arguments,a=-1,r=s(n.length-e,0),i=Array(r);++a<r;)i[a]=n[e+a];switch(e){case 0:return t.call(this,i);case 1:return t.call(this,n[0],i);case 2:return t.call(this,n[0],n[1],i)}var o=Array(e+1);for(a=-1;++a<e;)o[a]=n[a];return o[e]=i,t.apply(this,o)}}var r="Expected a function",s=Math.max;e.exports=a},{}],8:[function(t,e,n){function a(t,e,n){var a=!0,o=!0;if("function"!=typeof t)throw new TypeError(i);return n===!1?a=!1:s(n)&&(a="leading"in n?!!n.leading:a,o="trailing"in n?!!n.trailing:o),r(t,e,{leading:a,maxWait:+e,trailing:o})}var r=t("./debounce"),s=t("../lang/isObject"),i="Expected a function";e.exports=a},{"../lang/isObject":60,"./debounce":6}],9:[function(t,e,n){function a(t,e){var n=-1,a=t.length;for(e||(e=Array(a));++n<a;)e[n]=t[n];return e}e.exports=a},{}],10:[function(t,e,n){function a(t,e){for(var n=-1,a=t.length;++n<a&&e(t[n],n,t)!==!1;);return t}e.exports=a},{}],11:[function(t,e,n){function a(t,e){for(var n=-1,a=t.length;++n<a;)if(e(t[n],n,t))return!0;return!1}e.exports=a},{}],12:[function(t,e,n){function a(t,e,n,a){return void 0!==t&&s.call(a,n)?t:e}var r=Object.prototype,s=r.hasOwnProperty;e.exports=a},{}],13:[function(t,e,n){function a(t,e,n){for(var a=-1,s=r(e),i=s.length;++a<i;){var o=s[a],l=t[o],c=n(l,e[o],o,t,e);(c===c?c===l:l!==l)&&(void 0!==l||o in t)||(t[o]=c)}return t}var r=t("../object/keys");e.exports=a},{"../object/keys":65}],14:[function(t,e,n){function a(t,e){return null==e?t:r(e,s(e),t)}var r=t("./baseCopy"),s=t("../object/keys");e.exports=a},{"../object/keys":65,"./baseCopy":15}],15:[function(t,e,n){function a(t,e,n){n||(n={});for(var a=-1,r=e.length;++a<r;){var s=e[a];n[s]=t[s]}return n}e.exports=a},{}],16:[function(t,e,n){var a=t("./baseForOwn"),r=t("./createBaseEach"),s=r(a);e.exports=s},{"./baseForOwn":19,"./createBaseEach":31}],17:[function(t,e,n){var a=t("./createBaseFor"),r=a();e.exports=r},{"./createBaseFor":32}],18:[function(t,e,n){function a(t,e){return r(t,e,s)}var r=t("./baseFor"),s=t("../object/keysIn");e.exports=a},{"../object/keysIn":66,"./baseFor":17}],19:[function(t,e,n){function a(t,e){return r(t,e,s)}var r=t("./baseFor"),s=t("../object/keys");e.exports=a},{"../object/keys":65,"./baseFor":17}],20:[function(t,e,n){function a(t,e,n,o,l,c){return t===e||(null==t||null==e||!s(t)&&!i(e)?t!==t&&e!==e:r(t,e,a,n,o,l,c))}var r=t("./baseIsEqualDeep"),s=t("../lang/isObject"),i=t("./isObjectLike");e.exports=a},{"../lang/isObject":60,"./baseIsEqualDeep":21,"./isObjectLike":45}],21:[function(t,e,n){function a(t,e,n,a,f,_,g){var h=o(t),b=o(e),v=u,y=u;h||(v=m.call(t),v==c?v=d:v!=d&&(h=l(t))),b||(y=m.call(e),y==c?y=d:y!=d&&(b=l(e)));var x=v==d,w=y==d,k=v==y;if(k&&!h&&!x)return s(t,e,v);if(!f){var E=x&&p.call(t,"__wrapped__"),S=w&&p.call(e,"__wrapped__");if(E||S)return n(E?t.value():t,S?e.value():e,a,f,_,g)}if(!k)return!1;_||(_=[]),g||(g=[]);for(var C=_.length;C--;)if(_[C]==t)return g[C]==e;_.push(t),g.push(e);var L=(h?r:i)(t,e,n,a,f,_,g);return _.pop(),g.pop(),L}var r=t("./equalArrays"),s=t("./equalByTag"),i=t("./equalObjects"),o=t("../lang/isArray"),l=t("../lang/isTypedArray"),c="[object Arguments]",u="[object Array]",d="[object Object]",f=Object.prototype,p=f.hasOwnProperty,m=f.toString;e.exports=a},{"../lang/isArray":55,"../lang/isTypedArray":62,"./equalArrays":34,"./equalByTag":35,"./equalObjects":36}],22:[function(t,e,n){function a(t,e,n,f,p){if(!l(t))return t;var m=o(e)&&(i(e)||u(e)),_=m?void 0:d(e);return r(_||e,function(r,i){if(_&&(i=r,r=e[i]),c(r))f||(f=[]),p||(p=[]),s(t,e,i,a,n,f,p);else{var o=t[i],l=n?n(o,r,i,t,e):void 0,u=void 0===l;u&&(l=r),void 0===l&&(!m||i in t)||!u&&(l===l?l===o:o!==o)||(t[i]=l)}}),t}var r=t("./arrayEach"),s=t("./baseMergeDeep"),i=t("../lang/isArray"),o=t("./isArrayLike"),l=t("../lang/isObject"),c=t("./isObjectLike"),u=t("../lang/isTypedArray"),d=t("../object/keys");e.exports=a},{"../lang/isArray":55,"../lang/isObject":60,"../lang/isTypedArray":62,"../object/keys":65,"./arrayEach":10,"./baseMergeDeep":23,"./isArrayLike":41,"./isObjectLike":45}],23:[function(t,e,n){function a(t,e,n,a,d,f,p){for(var m=f.length,_=e[n];m--;)if(f[m]==_)return void(t[n]=p[m]);var g=t[n],h=d?d(g,_,n,t,e):void 0,b=void 0===h;b&&(h=_,o(_)&&(i(_)||c(_))?h=i(g)?g:o(g)?r(g):[]:l(_)||s(_)?h=s(g)?u(g):l(g)?g:{}:b=!1),f.push(_),p.push(h),b?t[n]=a(h,_,d,f,p):(h===h?h!==g:g===g)&&(t[n]=h)}var r=t("./arrayCopy"),s=t("../lang/isArguments"),i=t("../lang/isArray"),o=t("./isArrayLike"),l=t("../lang/isPlainObject"),c=t("../lang/isTypedArray"),u=t("../lang/toPlainObject");e.exports=a},{"../lang/isArguments":54,"../lang/isArray":55,"../lang/isPlainObject":61,"../lang/isTypedArray":62,"../lang/toPlainObject":63,"./arrayCopy":9,"./isArrayLike":41}],24:[function(t,e,n){function a(t){return function(e){return null==e?void 0:e[t]}}e.exports=a},{}],25:[function(t,e,n){function a(t){return null==t?"":t+""}e.exports=a},{}],26:[function(t,e,n){function a(t,e){for(var n=-1,a=e.length,r=Array(a);++n<a;)r[n]=t[e[n]];return r}e.exports=a},{}],27:[function(t,e,n){function a(t,e,n){if("function"!=typeof t)return r;if(void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,a,r){return t.call(e,n,a,r)};case 4:return function(n,a,r,s){return t.call(e,n,a,r,s)};case 5:return function(n,a,r,s,i){return t.call(e,n,a,r,s,i)}}return function(){return t.apply(e,arguments)}}var r=t("../utility/identity");e.exports=a},{"../utility/identity":73}],28:[function(t,e,n){function a(t,e){for(var n=-1,a=t.length;++n<a&&e.indexOf(t.charAt(n))>-1;);return n}e.exports=a},{}],29:[function(t,e,n){function a(t,e){for(var n=t.length;n--&&e.indexOf(t.charAt(n))>-1;);return n}e.exports=a},{}],30:[function(t,e,n){function a(t){return i(function(e,n){var a=-1,i=null==e?0:n.length,o=i>2?n[i-2]:void 0,l=i>2?n[2]:void 0,c=i>1?n[i-1]:void 0;for("function"==typeof o?(o=r(o,c,5),i-=2):(o="function"==typeof c?c:void 0,i-=o?1:0),l&&s(n[0],n[1],l)&&(o=i<3?void 0:o,i=1);++a<i;){var u=n[a];u&&t(e,u,o)}return e})}var r=t("./bindCallback"),s=t("./isIterateeCall"),i=t("../function/restParam");e.exports=a},{"../function/restParam":7,"./bindCallback":27,"./isIterateeCall":43}],31:[function(t,e,n){function a(t,e){return function(n,a){var o=n?r(n):0;if(!s(o))return t(n,a);for(var l=e?o:-1,c=i(n);(e?l--:++l<o)&&a(c[l],l,c)!==!1;);return n}}var r=t("./getLength"),s=t("./isLength"),i=t("./toObject");e.exports=a},{"./getLength":39,"./isLength":44,"./toObject":51}],32:[function(t,e,n){function a(t){return function(e,n,a){for(var s=r(e),i=a(e),o=i.length,l=t?o:-1;t?l--:++l<o;){var c=i[l];if(n(s[c],c,s)===!1)break}return e}}var r=t("./toObject");e.exports=a},{"./toObject":51}],33:[function(t,e,n){function a(t,e){return function(n,a,i){return"function"==typeof a&&void 0===i&&s(n)?t(n,a):e(n,r(a,i,3))}}var r=t("./bindCallback"),s=t("../lang/isArray");e.exports=a},{"../lang/isArray":55,"./bindCallback":27}],34:[function(t,e,n){function a(t,e,n,a,s,i,o){var l=-1,c=t.length,u=e.length;if(c!=u&&!(s&&u>c))return!1;for(;++l<c;){var d=t[l],f=e[l],p=a?a(s?f:d,s?d:f,l):void 0;if(void 0!==p){if(p)continue;return!1}if(s){if(!r(e,function(t){return d===t||n(d,t,a,s,i,o)}))return!1}else if(d!==f&&!n(d,f,a,s,i,o))return!1}return!0}var r=t("./arraySome");e.exports=a},{"./arraySome":11}],35:[function(t,e,n){function a(t,e,n){switch(n){case r:case s:return+t==+e;case i:return t.name==e.name&&t.message==e.message;case o:return t!=+t?e!=+e:t==+e;case l:case c:return t==e+""}return!1}var r="[object Boolean]",s="[object Date]",i="[object Error]",o="[object Number]",l="[object RegExp]",c="[object String]";e.exports=a},{}],36:[function(t,e,n){function a(t,e,n,a,s,o,l){var c=r(t),u=c.length,d=r(e),f=d.length;if(u!=f&&!s)return!1;for(var p=u;p--;){var m=c[p];if(!(s?m in e:i.call(e,m)))return!1}for(var _=s;++p<u;){m=c[p];var g=t[m],h=e[m],b=a?a(s?h:g,s?g:h,m):void 0;if(!(void 0===b?n(g,h,a,s,o,l):b))return!1;_||(_="constructor"==m)}if(!_){var v=t.constructor,y=e.constructor;if(v!=y&&"constructor"in t&&"constructor"in e&&!("function"==typeof v&&v instanceof v&&"function"==typeof y&&y instanceof y))return!1}return!0}var r=t("../object/keys"),s=Object.prototype,i=s.hasOwnProperty;e.exports=a},{"../object/keys":65}],37:[function(t,e,n){function a(t){return r[t]}var r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"};e.exports=a},{}],38:[function(t,e,n){function a(t){return"\\"+r[t]}var r={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};e.exports=a},{}],39:[function(t,e,n){var a=t("./baseProperty"),r=a("length");e.exports=r},{"./baseProperty":24}],40:[function(t,e,n){function a(t,e){var n=null==t?void 0:t[e];return r(n)?n:void 0}var r=t("../lang/isNative");e.exports=a},{"../lang/isNative":59}],41:[function(t,e,n){function a(t){return null!=t&&s(r(t))}var r=t("./getLength"),s=t("./isLength");e.exports=a},{"./getLength":39,"./isLength":44}],42:[function(t,e,n){function a(t,e){return t="number"==typeof t||r.test(t)?+t:-1,e=null==e?s:e,t>-1&&t%1==0&&t<e}var r=/^\d+$/,s=9007199254740991;e.exports=a},{}],43:[function(t,e,n){function a(t,e,n){if(!i(n))return!1;var a=typeof e;if("number"==a?r(n)&&s(e,n.length):"string"==a&&e in n){var o=n[e];return t===t?t===o:o!==o}return!1}var r=t("./isArrayLike"),s=t("./isIndex"),i=t("../lang/isObject");e.exports=a},{"../lang/isObject":60,"./isArrayLike":41,"./isIndex":42}],44:[function(t,e,n){function a(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=r}var r=9007199254740991;e.exports=a},{}],45:[function(t,e,n){function a(t){return!!t&&"object"==typeof t}e.exports=a},{}],46:[function(t,e,n){function a(t){return t<=160&&t>=9&&t<=13||32==t||160==t||5760==t||6158==t||t>=8192&&(t<=8202||8232==t||8233==t||8239==t||8287==t||12288==t||65279==t)}e.exports=a},{}],47:[function(t,e,n){var a=/<%-([\s\S]+?)%>/g;e.exports=a},{}],48:[function(t,e,n){var a=/<%([\s\S]+?)%>/g;e.exports=a},{}],49:[function(t,e,n){var a=/<%=([\s\S]+?)%>/g;e.exports=a},{}],50:[function(t,e,n){function a(t){for(var e=l(t),n=e.length,a=n&&t.length,c=!!a&&o(a)&&(s(t)||r(t)),d=-1,f=[];++d<n;){var p=e[d];(c&&i(p,a)||u.call(t,p))&&f.push(p)}return f}var r=t("../lang/isArguments"),s=t("../lang/isArray"),i=t("./isIndex"),o=t("./isLength"),l=t("../object/keysIn"),c=Object.prototype,u=c.hasOwnProperty;e.exports=a},{"../lang/isArguments":54,"../lang/isArray":55,"../object/keysIn":66,"./isIndex":42,"./isLength":44}],51:[function(t,e,n){function a(t){return r(t)?t:Object(t)}var r=t("../lang/isObject");e.exports=a},{"../lang/isObject":60}],52:[function(t,e,n){function a(t){for(var e=-1,n=t.length;++e<n&&r(t.charCodeAt(e)););return e}var r=t("./isSpace");e.exports=a},{"./isSpace":46}],53:[function(t,e,n){function a(t){for(var e=t.length;e--&&r(t.charCodeAt(e)););return e}var r=t("./isSpace");e.exports=a},{"./isSpace":46}],54:[function(t,e,n){function a(t){return s(t)&&r(t)&&o.call(t,"callee")&&!l.call(t,"callee")}var r=t("../internal/isArrayLike"),s=t("../internal/isObjectLike"),i=Object.prototype,o=i.hasOwnProperty,l=i.propertyIsEnumerable;e.exports=a},{"../internal/isArrayLike":41,"../internal/isObjectLike":45}],55:[function(t,e,n){var a=t("../internal/getNative"),r=t("../internal/isLength"),s=t("../internal/isObjectLike"),i="[object Array]",o=Object.prototype,l=o.toString,c=a(Array,"isArray"),u=c||function(t){return s(t)&&r(t.length)&&l.call(t)==i};e.exports=u},{"../internal/getNative":40,"../internal/isLength":44,"../internal/isObjectLike":45}],56:[function(t,e,n){function a(t,e,n,a){n="function"==typeof n?s(n,a,3):void 0;var i=n?n(t,e):void 0;return void 0===i?r(t,e,n):!!i}var r=t("../internal/baseIsEqual"),s=t("../internal/bindCallback");e.exports=a},{"../internal/baseIsEqual":20,"../internal/bindCallback":27}],57:[function(t,e,n){function a(t){return r(t)&&"string"==typeof t.message&&o.call(t)==s}var r=t("../internal/isObjectLike"),s="[object Error]",i=Object.prototype,o=i.toString;e.exports=a},{"../internal/isObjectLike":45}],58:[function(t,e,n){function a(t){return r(t)&&o.call(t)==s}var r=t("./isObject"),s="[object Function]",i=Object.prototype,o=i.toString;e.exports=a},{"./isObject":60}],59:[function(t,e,n){function a(t){return null!=t&&(r(t)?u.test(l.call(t)):s(t)&&i.test(t))}var r=t("./isFunction"),s=t("../internal/isObjectLike"),i=/^\[object .+?Constructor\]$/,o=Object.prototype,l=Function.prototype.toString,c=o.hasOwnProperty,u=RegExp("^"+l.call(c).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=a},{"../internal/isObjectLike":45,"./isFunction":58}],60:[function(t,e,n){function a(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}e.exports=a},{}],61:[function(t,e,n){function a(t){var e;if(!i(t)||u.call(t)!=o||s(t)||!c.call(t,"constructor")&&(e=t.constructor,"function"==typeof e&&!(e instanceof e)))return!1;var n;return r(t,function(t,e){n=e}),void 0===n||c.call(t,n)}var r=t("../internal/baseForIn"),s=t("./isArguments"),i=t("../internal/isObjectLike"),o="[object Object]",l=Object.prototype,c=l.hasOwnProperty,u=l.toString;e.exports=a},{"../internal/baseForIn":18,"../internal/isObjectLike":45,"./isArguments":54}],62:[function(t,e,n){function a(t){return s(t)&&r(t.length)&&!!A[T.call(t)]}var r=t("../internal/isLength"),s=t("../internal/isObjectLike"),i="[object Arguments]",o="[object Array]",l="[object Boolean]",c="[object Date]",u="[object Error]",d="[object Function]",f="[object Map]",p="[object Number]",m="[object Object]",_="[object RegExp]",g="[object Set]",h="[object String]",b="[object WeakMap]",v="[object ArrayBuffer]",y="[object Float32Array]",x="[object Float64Array]",w="[object Int8Array]",k="[object Int16Array]",E="[object Int32Array]",S="[object Uint8Array]",C="[object Uint8ClampedArray]",L="[object Uint16Array]",O="[object Uint32Array]",A={};A[y]=A[x]=A[w]=A[k]=A[E]=A[S]=A[C]=A[L]=A[O]=!0,A[i]=A[o]=A[v]=A[l]=A[c]=A[u]=A[d]=A[f]=A[p]=A[m]=A[_]=A[g]=A[h]=A[b]=!1;var j=Object.prototype,T=j.toString;e.exports=a},{"../internal/isLength":44,"../internal/isObjectLike":45}],63:[function(t,e,n){function a(t){return r(t,s(t))}var r=t("../internal/baseCopy"),s=t("../object/keysIn");e.exports=a},{"../internal/baseCopy":15,"../object/keysIn":66}],64:[function(t,e,n){var a=t("../internal/assignWith"),r=t("../internal/baseAssign"),s=t("../internal/createAssigner"),i=s(function(t,e,n){return n?a(t,e,n):r(t,e)});e.exports=i},{"../internal/assignWith":13,"../internal/baseAssign":14,"../internal/createAssigner":30}],65:[function(t,e,n){var a=t("../internal/getNative"),r=t("../internal/isArrayLike"),s=t("../lang/isObject"),i=t("../internal/shimKeys"),o=a(Object,"keys"),l=o?function(t){var e=null==t?void 0:t.constructor;return"function"==typeof e&&e.prototype===t||"function"!=typeof t&&r(t)?i(t):s(t)?o(t):[]}:i;e.exports=l},{"../internal/getNative":40,"../internal/isArrayLike":41,"../internal/shimKeys":50,"../lang/isObject":60}],66:[function(t,e,n){function a(t){if(null==t)return[];l(t)||(t=Object(t));var e=t.length;e=e&&o(e)&&(s(t)||r(t))&&e||0;for(var n=t.constructor,a=-1,c="function"==typeof n&&n.prototype===t,d=Array(e),f=e>0;++a<e;)d[a]=a+"";for(var p in t)f&&i(p,e)||"constructor"==p&&(c||!u.call(t,p))||d.push(p);return d}var r=t("../lang/isArguments"),s=t("../lang/isArray"),i=t("../internal/isIndex"),o=t("../internal/isLength"),l=t("../lang/isObject"),c=Object.prototype,u=c.hasOwnProperty;e.exports=a},{"../internal/isIndex":42,"../internal/isLength":44,"../lang/isArguments":54,"../lang/isArray":55,"../lang/isObject":60}],67:[function(t,e,n){var a=t("../internal/baseMerge"),r=t("../internal/createAssigner"),s=r(a);e.exports=s},{"../internal/baseMerge":22,"../internal/createAssigner":30}],68:[function(t,e,n){function a(t){return t=r(t),t&&o.test(t)?t.replace(i,s):t}var r=t("../internal/baseToString"),s=t("../internal/escapeHtmlChar"),i=/[&<>"'`]/g,o=RegExp(i.source);e.exports=a},{"../internal/baseToString":25,"../internal/escapeHtmlChar":37}],69:[function(t,e,n){function a(t,e,n){var a=_.imports._.templateSettings||_;n&&f(t,e,n)&&(e=n=void 0),t=l(t),e=s(o({},n||e),a,r);var w,k,E=s(o({},e.imports),a.imports,r),S=p(E),C=c(E,S),L=0,O=e.interpolate||y,A="__p += '",j=RegExp((e.escape||y).source+"|"+O.source+"|"+(O===m?v:y).source+"|"+(e.evaluate||y).source+"|$","g"),T="sourceURL"in e?"//# sourceURL="+e.sourceURL+"\n":"";t.replace(j,function(e,n,a,r,s,i){return a||(a=r),A+=t.slice(L,i).replace(x,u),n&&(w=!0,A+="' +\n__e("+n+") +\n'"),s&&(k=!0,A+="';\n"+s+";\n__p += '"),a&&(A+="' +\n((__t = ("+a+")) == null ? '' : __t) +\n'"),L=i+e.length,e}),A+="';\n";var I=e.variable;I||(A="with (obj) {\n"+A+"\n}\n"),A=(k?A.replace(g,""):A).replace(h,"$1").replace(b,"$1;"),A="function("+(I||"obj")+") {\n"+(I?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(w?", __e = _.escape":"")+(k?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+A+"return __p\n}";var N=i(function(){return Function(S,T+"return "+A).apply(void 0,C)});if(N.source=A,d(N))throw N;return N}var r=t("../internal/assignOwnDefaults"),s=t("../internal/assignWith"),i=t("../utility/attempt"),o=t("../internal/baseAssign"),l=t("../internal/baseToString"),c=t("../internal/baseValues"),u=t("../internal/escapeStringChar"),d=t("../lang/isError"),f=t("../internal/isIterateeCall"),p=t("../object/keys"),m=t("../internal/reInterpolate"),_=t("./templateSettings"),g=/\b__p \+= '';/g,h=/\b(__p \+=) '' \+/g,b=/(__e\(.*?\)|\b__t\)) \+\n'';/g,v=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,y=/($^)/,x=/['\n\r\u2028\u2029\\]/g;e.exports=a},{"../internal/assignOwnDefaults":12,"../internal/assignWith":13,"../internal/baseAssign":14,"../internal/baseToString":25,"../internal/baseValues":26,"../internal/escapeStringChar":38,"../internal/isIterateeCall":43,"../internal/reInterpolate":49,"../lang/isError":57,"../object/keys":65,"../utility/attempt":72,"./templateSettings":70}],70:[function(t,e,n){var a=t("./escape"),r=t("../internal/reEscape"),s=t("../internal/reEvaluate"),i=t("../internal/reInterpolate"),o={escape:r,evaluate:s,interpolate:i,variable:"",imports:{_:{escape:a}}};e.exports=o},{"../internal/reEscape":47,"../internal/reEvaluate":48,"../internal/reInterpolate":49,"./escape":68}],71:[function(t,e,n){function a(t,e,n){var a=t;return(t=r(t))?(n?o(a,e,n):null==e)?t.slice(l(t),c(t)+1):(e+="",t.slice(s(t,e),i(t,e)+1)):t}var r=t("../internal/baseToString"),s=t("../internal/charsLeftIndex"),i=t("../internal/charsRightIndex"),o=t("../internal/isIterateeCall"),l=t("../internal/trimmedLeftIndex"),c=t("../internal/trimmedRightIndex");e.exports=a},{"../internal/baseToString":25,"../internal/charsLeftIndex":28,"../internal/charsRightIndex":29,"../internal/isIterateeCall":43,"../internal/trimmedLeftIndex":52,"../internal/trimmedRightIndex":53}],72:[function(t,e,n){var a=t("../lang/isError"),r=t("../function/restParam"),s=r(function(t,e){try{return t.apply(void 0,e)}catch(n){return a(n)?n:new Error(n)}});e.exports=s},{"../function/restParam":7,"../lang/isError":57}],73:[function(t,e,n){function a(t){return t}e.exports=a},{}],74:[function(t,e,n){var a,r="",s="wav",i=.5;e.exports={init:function(t){return a=document.createElement("audio"),a.setAttribute("autoplay",!0),t&&(r=t),this},play:function(t,e){t&&(a.src=r+t+"."+s),e?a.setAttribute("loop",!0):a.removeAttribute("loop"),a.volume=i,a.play()},stop:function(){a.pause(),a.currentTime=0}}},{}],75:[function(t,e,n){function a(){return C}function r(t){return C?E.info("Cobrowsing already initiated"):(b(document,"keyup",f),b(document,"keydown",f),b(document,"keypress",f),b(document,"mouseup",f),b(document,"click",f),b(document,"change",f),y="string"==typeof t.widget?document.querySelector(t.widget):t.widget,A=t.entity,x=t.emit,j=t.path,C=!0,E.log("cobrowsing module initiated with parameters: ",t),void x("cobrowsing/init"))}function s(){return L?E.info("Browser already shared"):(b(document,"scroll",f),b(document,"select",f),b(document,"mousemove",f),o(),L=!0,E.log("browser shared"),void x("cobrowsing/shared",{entity:A}))}function i(){return L?(v(document,"scroll",f),v(document,"select",f),v(document,"mousemove",f),c(),L=!1,x("cobrowsing/unshared",{entity:A}),void E.log("browser unshared")):E.info("Browser already unshared")}function o(){var t=document.body;O||(O=document.createElement("img"),O.className="wc-rmt-ptr",O.setAttribute("src",j+"images/pointer.png"),O.style.position="absolute",t.firstChild?t.insertBefore(O,t.firstChild):t.appendChild(O),l())}function l(){O.style.left=N,O.style.top=R,w=window.requestAnimationFrame(l)}function c(){O&&(cancelAnimationFrame(w),O.parentNode.removeChild(O),O=null)}function u(t){var e=0;if(document.selection){t.focus();var n=document.selection.createRange();n.moveStart("character",-t.value.length),e=n.text.length}else e=(!t.type||"email"!==t.type&&"number"!==t.type)&&(t.selectionStart||"0"==t.selectionStart)?t.selectionStart:null;return e}function d(t){x("cobrowsing/event",{entity:A,events:t})}function f(t){var e=t||window.event,n=e.type,a=e.target,r=a.nodeName,s=document.body,i={},o=null,l=document.getElementsByTagName(a.nodeName),c=document.documentElement.scrollTop||document.body.scrollTop,d=document.documentElement.scrollLeft||document.body.scrollLeft,f=0;if(3===a.nodeType&&(a=a.parentNode),"user"!==A||!h(y,a)){for(f=0;f<S.length;f++)if(S[f].event==n)return void S.splice(f,1);for(f=0;f<l.length;f++)l[f]==a&&(o=f);if(i.event=n,i.entity=A,i.tn=r,i.tni=o,i.w=s.offsetWidth,i.h=s.offsetHeight,i.sx=d,i.sy=c,"mousemove"===n||"mouseover"===n||"mouseout"===n){var p=e.pageX||e.clientX+c,m=e.pageY||e.clientY+d;i.x=p,i.y=m}else if("scroll"===n);else if("keyup"==n||"keydown"==n||"keypress"==n){var _=e.charCode||e.keyCode||e.which,g=u(a);if("INPUT"===r&&"password"===a.type)return;if("keyup"==n){if(null!==g&&(86!=_||!e.metaKey&&!e.ctrlKey))return;var b=a.value;b&&(b=b.replace(/\n/g,"<br>"),i.value=b)}else if("keydown"==n){if(null===g||8!=_&&46!=_&&190!=_)return;if(!a.value)return;i.pos=g,i.code=_}else if("keypress"===n){if(null===g||8==_||46==_)return;i.pos=g,i.code=_}}else if("change"===n){if("INPUT"===r&&"password"===a.type)return;i.value=a.value}else if("mouseup"==n||"select"==n){var v=window.getSelection()||document.selection.createRange().text,x=v.anchorOffset,w=v.focusOffset,k=0,E="",C=0,L="",O=0,j="",T=0,N="",R=!1;if(null!==v.anchorNode){for(L=v.anchorNode.parentNode,f=0;f<L.childNodes.length;f++)L.childNodes[f]==v.anchorNode&&(C=f);for(E=L.nodeName.toLowerCase(),l=document.getElementsByTagName(E),f=0;f<l.length;f++)l[f]===L&&(k=f);for(N=v.focusNode.parentNode,f=0;f<N.childNodes.length;f++)N.childNodes[f]==v.focusNode&&(T=f);for(j=N.nodeName.toLowerCase(),l=document.getElementsByTagName(j),f=0;f<l.length;f++)l[f]===N&&(O=f);E===j&&k===O&&C===T&&x>w&&(R=!0),i.sn=E,i.sni=k,i.schi=C,i.en=j,i.eni=O,i.echi=T,i.so=R?w:x,i.eo=R?x:w}}else"click"==n&&(i.scx=e.screenX,i.scy=e.screenY);I(i)}}function p(t){var e,n=document.documentElement,a={};if(t.events){if(a=t.events,a.timestamp<T)return;if(a.entity===A)return;if(a.url){var r=a.url,s=document.URL;s.indexOf("chatSessionId")!==-1&&(s=s.substr(0,s.indexOf("chatSessionId")-1)),r!=s&&g(r)}if(a.w&&"user"===a.entity){var i=document.body,o=i.offsetWidth;o!==a.w&&(document.body.style.width=a.w+"px")}if("mousemove"===a.event)O&&(N=a.x+"px",R=a.y+"px");else if("scroll"===a.event)void 0!==a.tn&&(e="#document"===a.tn?n:document.getElementsByTagName(a.tn)[a.tni],e&&(e.scrollTop=a.sy,e.scrollLeft=a.sx),console.log("scroll event: ",e,a.sy));else if("mouseup"===a.event||"select"===a.event){if(a.sn){var l=document.getElementsByTagName(a.sn)[a.sni],c=document.getElementsByTagName(a.en)[a.eni];if(document.createRange&&void 0!==l&&void 0!==c){var u=document.createRange();u.setStart(l.childNodes[a.schi],a.so),u.setEnd(c.childNodes[a.echi],a.eo);var d=window.getSelection();d.removeAllRanges(),d.addRange(u)}}}else if("keyup"===a.event||"keydown"===a.event||"keypress"===a.event){if(void 0!==a.tn&&void 0!==a.tni&&(e=document.getElementsByTagName(a.tn)[a.tni])){var f,p=e.value;if(8==a.code){if(a.pos==p.length-1)f=p.substr(0,a.pos-1);else{if(0===a.pos)return;f=p.substr(0,a.pos-1)+p.substr(a.pos)}e.value=f}else if(46==a.code)f=p.substr(0,a.pos)+p.substr(a.pos+1),e.value=f;else if(190==a.code)f=p.substr(0,a.pos)+"."+p.substr(a.pos),e.value=f;else if(void 0!==a.value){var h=a.value;h=h.replace(/<br>/g,"\n"),e.value=h}else{var b=String.fromCharCode(a.code);f=p?p.substr(0,a.pos)+b+p.substr(a.pos):b,e.value=f}}}else if("change"===a.event)e=document.getElementsByTagName(a.tn)[a.tni],e.value=a.value;else if("click"===a.event)e=document.getElementsByTagName(a.tn)[a.tni],e&&e.click();else if(e=document.getElementsByTagName(a.tn)[a.tni]){var v=m(a.event,a.x,a.y,a.x,a.y);_(e,v)}"click"!==a.event&&"scroll"!==a.event||S.push(a);
}t.timestamp&&(T=t.timestamp)}function m(t,e,n,a,r){var s,i={bubbles:!0,cancelable:"mousemove"!=t,view:window,detail:0,screenX:e,screenY:n,clientX:a,clientY:r,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:void 0};if("function"==typeof document.createEvent)s=document.createEvent("MouseEvents"),s.initMouseEvent(t,i.bubbles,i.cancelable,i.view,i.detail,i.screenX,i.screenY,i.clientX,i.clientY,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.button,document.body.parentNode);else if(document.createEventObject){s=document.createEventObject();for(var o in i)s[o]=i[o];s.button={0:1,1:4,2:2}[s.button]||s.button}return s}function _(t,e){return t.dispatchEvent?t.dispatchEvent(e):t.fireEvent&&t.fireEvent("on"+type,e),e}function g(t){var e=document.URL;e!==t&&(document.location.href=t)}function h(t,e){for(var n=e.parentNode;null!=n;){if(n==t)return!0;n=n.parentNode}return!1}function b(t,e,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent&&t.attachEvent("on"+e,n)}function v(t,e,n){t.removeEventListener?t.removeEventListener(e,n,!1):t.detachEvent&&t.detachEvent("on"+e,n)}var y,x,w,k=t("./lodash"),E=t("./debug"),S=[],C=!1,L=!1,O=null,A="",j="",T=0,I=k.throttle(d,100,{trailing:!0,leading:!0}),N=0,R=0;e.exports={init:r,isInitiated:a,share:s,unshare:i,emitEvents:d,updateEvents:p}},{"./debug":77,"./lodash":78}],76:[function(t,e,n){(function(n){function a(t){return this.options=t||{},this.options.serverUrl=this.options.server+"/ipcc/$$$",this.session={},this.options.wsServer||this.options.pageid?(g=(this.options.wsServer?this.options.wsServer:_)+this.options.pageid,this.on("session/create",this.onSessionCreate.bind(this)),this.on("Error",this.onError),this.createWebsocket(),this):console.error("Cannot initiate module: pageid is undefined")}function r(t){var e=1e3*(Math.pow(2,t)-1);return e>3e4&&(e=3e4),Math.random()*e}function s(t){var e=t;return"ua"===t?e="uk":"us"!==t&&"gb"!==t||(e="en"),e}function i(t){var e=new FormData;return Object.keys(t).map(function(n){if("file"===n)e.append(n,t[n],t.filename||"");else{if("filename"===n)return n;e.append(n,t[n])}return n}),u.log("toFormData: ",t,e.get("filename")),e}var o=t("events").EventEmitter,l=t("./storage"),c=t("./request"),u=t("./debug"),d=n.location,f=t("./lodash"),p=t("inherits"),m=1,_="main.ringotel.net/chatbot/WebChat/",g="",h=!1,b=null;p(a,o),e.exports=a,a.prototype.onError=function(t){u.log("Error: ",t)},a.prototype.onSessionCreate=function(t){this.session=f.merge(this.session,t),l.saveState("sid",t.sid)},a.prototype.setSessionTimeout=function(){var t=this.session.sessionTimeout;clearTimeout(b),t&&(b=setTimeout(this.onSessionTimeout.bind(this),1e3*t))},a.prototype.onSessionTimeout=function(){this.emit("session/timeout")},a.prototype.sendData=function(t){this.websocket&&this.websocket.send(JSON.stringify(t))},a.prototype.onWebsocketMessage=function(t){var e=JSON.parse(t.data);e.method;if(e.method)if("session"===e.method)this.emit("session/create",e.params);else if("messages"===e.method)e.params.list&&e.params.list.map(function(t){return this.emit("message/new",t),t}.bind(this));else if("message"===e.method)e.params.typing?this.emit("message/typing"):(this.emit("message/new",e.params),this.setSessionTimeout());else if("openShare"===e.method){if(this.session.sharedId===e.params.id)return;if(e.params.url&&d.href!==e.params.url)return window.location=e.params.url;e.params.id&&(this.session.sharedId=e.params.id,this.emit("session/joined",{url:d.href}),this.shareOpened(e.params.id,d.href))}else"shareOpened"===e.method?e.params.id&&(this.session.sharedId=e.params.id,this.emit("session/joined",{url:d.href})):"shareClosed"===e.method?(clearInterval(this.openShareInteval),this.session.sharedId="",this.emit("session/disjoin")):"events"===e.method&&this.emit("cobrowsing/update",e.params)},a.prototype.init=function(){h=!0;var t=l.getState("entity","session"),e=l.getState("sid");if(strIndex=d.href.indexOf("chatSessionId"),u.log("initModule: ",this.session,t,e),strIndex!==-1){e=this.getSidFromUrl(d.href),t="agent";var n=d.href.substr(0,strIndex);n="?"===n[n.length-1]?n.substr(0,n.length-1):n,l.saveState("sid",e),this.joinSession(n)}else"agent"===t?(e=l.getState("sid"),this.joinSession(d.href)):(t="user",this.createSession({sid:e,url:d.href}));this.session.sid=e,this.session.entity=t,l.saveState("entity",t,"session")},a.prototype.createSession=function(t){var e={method:"createSession",params:{url:t.url||d.href,lang:this.detectLanguage()}};return t.sid&&(e.params.sid=t.sid),this.websocket?this.sendData(e):void c.post(this.options.serverUrl,e,function(e,n){return e?void this.emit("Error",e,{method:"createSession",params:t}):void this.emit("session/create",n.result)}.bind(this))},a.prototype.joinSession=function(t){this.openShareInteval=setInterval(function(){this.openShare(t)}.bind(this),3e3),n.onclose=function(){this.shareClosed()}.bind(this)},a.prototype.updateEvents=function(t,e){if(this.session.sharedId)return data={method:"events",params:{sid:this.session.sid,id:this.session.sharedId,timestamp:l.getState("eventTimestamp","cache"),events:t}},this.websocket?this.sendData(data):void c.post(this.options.serverUrl,data,function(t,n){return t?(this.emit("Error",t,data),e(t)):void(n.result.timestamp>l.getState("eventTimestamp","cache")?(l.saveState("eventTimestamp",n.result.timestamp,"cache"),e&&e(null,n.result)):e&&e(null,{events:[]}))}.bind(this))},a.prototype.getLanguages=function(t){u.log("this.session: ",this.session),t(null,this.session.langs)},a.prototype.chatRequest=function(t,e){t.sid=this.session.sid,u.log("chatRequest params: ",t);var n={method:"chatRequest",params:t};return this.setSessionTimeout(),this.websocket?this.sendData(n):void c.post(this.options.serverUrl,n,function(n,a){return n?(this.emit("Error",n,{method:"chatRequest",params:t}),void(e&&e(n))):(t.url=d.href,this.emit("chat/start",f.merge(t,a.result)),void(e&&e(null,a)))}.bind(this))},a.prototype.getMessages=function(t){c.post(this.options.serverUrl,{method:"getMessages",params:{sid:this.session.sid,timestamp:l.getState("msgTimestamp")}},function(e,n){return e?(this.emit("Error",e,{method:"getMessages"}),t(e)):(n.result.timestamp>l.getState("msgTimestamp")&&(l.saveState("msgTimestamp",n.result.timestamp),n.result.messages&&this.emit("message/new",n.result)),n.result.typing&&this.emit("message/typing",n.result),void(t&&t(null,n.result)))}.bind(this))},a.prototype.closeChat=function(t){var e={method:"closeChat",params:{sid:this.session.sid}};return t&&(e.params.rating=t),this.websocket?this.sendData(e):void c.post(this.options.serverUrl,e,function(n,a){return n?void this.emit("Error",n,e):(l.saveState("chat",!1),void this.emit("chat/close",{rating:t,url:d.href}))}.bind(this))},a.prototype.sendMessage=function(t,e){var n={method:"message",params:{sid:this.session.sid,content:t.message}};if(this.setSessionTimeout(),this.websocket)return void(t.file?(n=i({file:t.file,filename:t.message,sid:this.session.sid}),c.upload("https://"+g,n,function(t,e){console.error("sendMessage: ",t,e)})):(n.params.content=t.message,this.sendData(n)))},a.prototype.sendEmail=function(t,e){t.sid=this.session.sid;var n={method:"sendMail",params:t};return this.websocket?this.sendData(n):void c.post(this.options.serverUrl,n,function(n,a){return n?(this.emit("Error",n,{method:"sendEmail",params:t}),void(e&&e(n))):(this.emit("chat/send",t),void(e&&e(null,a)))}.bind(this))},a.prototype.requestCallback=function(t,e){t.sid=this.session.sid;var n={method:"requestCallback",params:t};return this.websocket?this.sendData(n):void c.post(this.options.serverUrl,n,function(n,a){return n?(this.emit("Error",n,{method:"requestCallback",params:t}),e(n)):void(e&&e(null,a.result))}.bind(this))},a.prototype.disjoinSession=function(t){var e={method:"disjoinSession",params:{sid:t}};return this.websocket?this.sendData(e):void c.post(this.options.serverUrl,e,function(e,n){return e?void this.emit("Error",e,{method:"disjoinSession",params:{sid:t}}):void this.emit("session/disjoin",{url:d.href})}.bind(this))},a.prototype.shareOpened=function(){var t={method:"shareOpened",params:{id:this.session.sharedId,url:d.href}};if(this.websocket)return this.sendData(t)},a.prototype.shareClosed=function(){var t={method:"shareClosed",params:{id:this.session.sharedId,url:d.href}};if(this.websocket)return this.sendData(t)},a.prototype.openShare=function(t){var e={method:"openShare",params:{sid:this.session.sid,url:t}};return this.websocket?this.sendData(e):void c.post(this.options.serverUrl,e,function(t,e){if(t)return void this.emit("Error",t,{method:"openShare",params:{state:state}})}.bind(this))},a.prototype.setChatTimeout=function(t){return setTimeout(function(){this.emit("chat/timeout")}.bind(this),1e3*t)},a.prototype.userIsTyping=function(){var t={method:"typing",params:{sid:this.session.sid}};return this.websocket?this.sendData(t):void c.post(this.options.serverUrl,t,function(t){if(t)return void this.emit("Error",t,{method:"setChatTimeout"})}.bind(this))},a.prototype.updateUrl=function(t){var e={method:"updateUrl",params:{sid:this.session.sid,url:t}};return this.websocket?this.sendData(e):void c.post(this.options.serverUrl,e,function(e,n){if(e)return void this.emit("Error",e,{method:"updateUrl",params:{url:t}})}.bind(this))},a.prototype.linkFollowed=function(t){var e={method:"linkFollowed",params:{sid:this.session.sid,url:t}};return this.websocket?this.sendData(e):void c.post(this.options.serverUrl,e,function(e,n){if(e)return void this.emit("Error",e,{method:"linkFollowed",params:{url:t}})}.bind(this))},a.prototype.detectLanguage=function(t){var e,n=l.getState("lang","session"),a=[];for(var r in t)a.push(r);return n?e=n:this.options.lang?e=this.options.lang:this.options.langFromUrl&&d.pathname.split("/").map(function(t){return t=s(t),a.indexOf(t)!==-1&&(e=t),t}),e||(e=(navigator.language||navigator.userLanguage).split("-")[0]),a.indexOf(e)===-1&&(e="en"),u.log("detected lang: ",a,n,this.options.lang,this.options.langFromUrl,e),this.session.lang=e,e},a.prototype.getSidFromUrl=function(t){var e=t.substring(t.indexOf("chatSessionId="));return e=e.substring(e.indexOf("=")+1)},a.prototype.createWebsocket=function(t){var e="wss:",a=new WebSocket(e+"//"+g,"json.api.smile-soft.com");a.onopen=function(t){u.log("WebSocket opened: ",t),m=1,h||this.init()}.bind(this),a.onmessage=this.onWebsocketMessage.bind(this),a.onclose=this.onWebsocketClose.bind(this),a.onerror=this.onError,n.onbeforeunload=function(){a.onclose=function(){},a.close()},this.websocket=a},a.prototype.onWebsocketClose=function(t){u.log("WebSocket closed",t);var e=r(m);setTimeout(function(){m++,this.createWebsocket()}.bind(this),e)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./debug":77,"./lodash":78,"./request":80,"./storage":81,events:2,inherits:3}],77:[function(t,e,n){(function(t){function n(e,n){if(t.localStorage.getItem("swc.debug"))return void[].forEach.call(e,function(e){t.console[n]?t.console[n](e):t.console.log(e)})}e.exports={log:function(){n(arguments,"log")},info:function(){n(arguments,"info")},warn:function(){n(arguments,"warn")},error:function(){n(arguments,"error")}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],78:[function(t,e,n){function a(t,e,n){var a;return function(){var r=this,s=arguments,i=function(){a=null,n||t.apply(r,s)},o=n&&!a;clearTimeout(a),a=setTimeout(i,e),o&&t.apply(r,s)}}function r(t,e){for(var n=e.charAt(0);t&&t!==document;t=t.parentNode)if("."===n){if(t.classList.contains(e.substr(1)))return t}else if("#"===n){if(t.id===e.substr(1))return t}else if("["===n){if(t.hasAttribute(e.substr(1,e.length-2)))return t}else if(t.nodeName===e.toUpperCase())return t;return!1}function s(t,e,n,a,r){var s=Number(new Date)+(a||2e3);r=r||300,function i(){t()?e():Number(new Date)<s?setTimeout(i,r):n(new Error("timed out for "+t+": "+arguments))}()}var i=t("lodash/string/template"),o=t("lodash/collection/forEach"),l=t("lodash/object/assign"),c=t("lodash/object/merge"),u=t("lodash/lang/isEqual"),d=t("lodash/string/trim"),f=t("lodash/function/throttle");t("lodash/function/debounce");e.exports={template:i,forEach:o,assign:l,merge:c,isEqual:u,trim:d,throttle:f,debounce:a,poll:s,findParent:r}},{"lodash/collection/forEach":4,"lodash/function/debounce":6,"lodash/function/throttle":8,"lodash/lang/isEqual":56,"lodash/object/assign":64,"lodash/object/merge":67,"lodash/string/template":69,"lodash/string/trim":71}],79:[function(t,e,n){var a=t("./widget.js");t("./core.js");e.exports=a.module},{"./core.js":76,"./widget.js":84}],80:[function(t,e,n){function a(t,e,n){o("POST",t,e,function(t,e){return l.log("post respose: ",t,e),t?n(t):void n(null,e)})}function r(t,e,n){return t&&c[t]?n(null,c[t]):void o("GET",e,null,function(e,a){return e?n(e):(t&&(c[t]=a),void n(null,a))})}function s(t,e,n){o("PUT",t,e,function(t,e){return l.log("put respose: ",t,e),t?n(t):void n(null,e)})}function i(t,e,n){o("POST",t,e,function(t,e){return l.log("post respose: ",t,e),t?n(t):void n(null,e)})}function o(t,e,n,a){var r,s,i;r=new XMLHttpRequest,r.open(t,e,!0),i=setTimeout(function(){r.abort()},6e4),r.onreadystatechange=function(){if(4==r.readyState&&(clearTimeout(i),r.response)){if(s="POST"===t?JSON.parse(r.response):r.response,s.error)return a(s.error);a(null,s)}},l.log("XmlHttpRequest: ",n),"POST"===t&&("object"!=typeof n||n instanceof FormData||(n=JSON.stringify(n),r.setRequestHeader("Content-Type","application/json; charset=UTF-8"))),n?r.send(n):r.send()}var l=t("./debug"),c={};e.exports={post:a,get:r,put:s,upload:i}},{"./debug":77}],81:[function(t,e,n){(function(t){function n(t,e){return"session"===e?JSON.parse(c.getItem(u+d+t)):JSON.parse(l.getItem(u+d+t))}function a(t,e,n){return"session"===n?c.setItem(u+d+t,JSON.stringify(e)):l.setItem(u+d+t,JSON.stringify(e)),e}function r(t,e){"session"===e?c.removeItem(u+d+t):l.removeItem(u+d+t)}function s(t,e){return e?"cache"===e?f[t]:n(t,e):void 0!==f[t]&&null!==f[t]?f[t]:n(t)}function i(t,e,n){return f[t]=e,"cache"!==n&&a(t,e,n),e}function o(t,e){delete f[t],r(t)}var l=t.localStorage,c=t.sessionStorage,u="swc",d=".",f={sid:null,eventTimestamp:0,msgTimestamp:0,entity:null,chat:null};e.exports={get:n,set:a,remove:r,getState:s,saveState:i,removeState:o}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],82:[function(require,module,exports){var _={},escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},escapeRegexp=new RegExp("["+Object.keys(escapeMap).join("")+"]","g");_.escape=function(t){return t?String(t).replace(escapeRegexp,function(t){return escapeMap[t]}):""},exports.email=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){var prefix=defaults.prefix;__p+='\n<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">\n<html xmlns="http://www.w3.org/1999/xhtml">\n    <head>\n        <meta http-equiv="Content-Type" content="text/html; charset=windows-1251" />\n        <!--[if !mso]><!-->\n            <meta http-equiv="X-UA-Compatible" content="IE=edge" />\n        <!--<![endif]-->\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title></title>\n        <!--[if (gte mso 9)|(IE)]>\n        <style type="text/css">\n            table {border-collapse: collapse;}\n        </style>\n        <![endif]-->\n        <style type="text/css">\n            /* Basics */\n            body {\n            Margin: 0;\n                padding: 0;\n                min-width: 100%;\n                background-color: #ffffff;\n            }\n            table {\n                border-spacing: 0;\n                font-family: sans-serif;\n                color: #333333;\n            }\n            td {\n                padding: 0;\n            }\n            img {\n                border: 0;\n            }\n            .wrapper {\n                width: 100%;\n                table-layout: fixed;\n                -webkit-text-size-adjust: 100%;\n                -ms-text-size-adjust: 100%;\n                background-color: #F1F1F1;\n            }\n            .webkit {\n                max-width: 500px;\n            }\n            .outer {\n            Margin: 0 auto;\n                height: 100%;\n                width: 95%;\n                max-width: 500px;\n                padding: 10px;\n            }\n            p {\n                Margin: 0;\n            }\n            a {\n                color: #ee6a56;\n                text-decoration: underline;\n            }\n            .h1 {\n                font-size: 21px;\n                font-weight: bold;\n                Margin-bottom: 18px;\n            }\n            .h2 {\n                font-size: 18px;\n                font-weight: bold;\n                Margin-bottom: 12px;\n            }\n             \n            /* One column layout */\n            .one-column .contents {\n                text-align: left;\n                color:#505050;\n                font-family:Arial;\n                font-size:14px;\n                line-height:150%;\n            }\n            .one-column p {\n                font-size: 14px;\n                Margin-bottom: 10px;\n            }\n            .'+__e(prefix)+"-message {\n                display: block;\n                margin-bottom: 10px;\n                padding: 10px;\n                background-color: #FFFFFF;\n                border-bottom: 4px solid #CCCCCC;\n            }\n            ."+__e(prefix)+"-message img {\n                width: 100%;\n                max-width: 500px;\n                height: auto;\n            }\n            ."+__e(prefix)+"-message span {\n                font-weight: bold;\n                color: #999999;\n            }\n            ."+__e(prefix)+"-agent-msg ."+__e(prefix)+"-message-from {\n                color: #555555;\n            }\n            ."+__e(prefix)+"-user-msg ."+__e(prefix)+"-message-from {\n                color: #F75B5D;\n            }\n\n            ."+__e(prefix)+"-message ."+__e(prefix)+'-message-time {\n                position: relative;\n                float: right;\n            }\n            .copyright {\n                margin-top: 5px;\n                font-size: 12px;\n                font-style: italic;\n                color: #CCCCCC;\n                text-align: right;\n            }\n\n        </style>\n    </head>\n    <body>\n        <center class="wrapper">\n            <div class="webkit">\n                <!--[if (gte mso 9)|(IE)]>\n                <table width="500" align="center" cellpadding="0" cellspacing="0" border="0">\n                <tr>\n                <td>\n                <![endif]-->\n                <table class="outer" align="center" cellpadding="0" cellspacing="0" border="0">\n                    <tr>\n                        <td class="one-column">\n                            <table width="100%">\n                                <tr>\n                                    <td class="inner contents">\n                                        '+(null==(__t=content)?"":__t)+"\n                                    </td>\n                                </tr>\n                            </table>\n                        </td>\n                    </tr>\n                </table>\n                <!--[if (gte mso 9)|(IE)]>\n                </td>\n                </tr>\n                </table>\n                <![endif]-->\n            </div>\n        </center>\n    </body>\n</html>"}return __p};var _={},escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},escapeRegexp=new RegExp("["+Object.keys(escapeMap).join("")+"]","g");_.escape=function(t){return t?String(t).replace(escapeRegexp,function(t){return escapeMap[t]}):""},exports.forms=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="'+__e(defaults.prefix)+"-message "+__e(defaults.prefix)+"-"+__e(message.entity)+'-msg">\n\t<span class="'+__e(defaults.prefix)+'-message-from">'+__e(message.from)+'</span>\n\t<div class="'+__e(defaults.prefix)+'-message-content" ',"user"===message.entity&&(__p+=" style=\"border-color:'"+__e(defaults.styles.primary.backgroundColor)+'" '),__p+='>\n\t\t<form id="'+__e(defaults.prefix)+"-"+__e(form.name)+'" name="'+__e(form.name)+'" ',form.autocomplete&&(__p+='autocomplete="on"'),__p+=' data-validate-form="true">\n\t\t\t',form.description&&(__p+='\n\t\t\t\t<p style="margin: 10px 0">'+(null==(__t=frases.FORMS.DESCRIPTIONS[form.description]||form.description)?"":__t)+"</p>\n\t\t\t"),__p+="\n\t\t\t",_.forEach(form.fields,function(t){__p+="\n\t\t\t\t","select"===t.type?(__p+='\n\t\t\t\t\t<select name="'+__e(t.name)+'">\n\t\t\t\t\t\t',_.forEach(t.options,function(t){__p+='\n\t\t\t\t\t\t\t<option value="'+__e(t.value)+'" ',t.selected&&(__p+=" selected "),__p+=" >\n\t\t\t\t\t\t\t\t"+__e(frases.FORMS.PLACEHOLDERS[t.text]||t.text)+"\n\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t"}),__p+="\n\t\t\t\t\t</select>\n\t\t\t\t"):"textarea"===t.type?(__p+='\n\t\t\t\t\t<textarea \n\t\t\t\t\t\tname="'+__e(t.name)+'"\n\t\t\t\t\t\tplaceholder="'+(null==(__t=frases.FORMS.PLACEHOLDERS[t.placeholder]||frases.FORMS.PLACEHOLDERS[t.name])?"":__t)+" ",t.required&&(__p+="*"),__p+='"\n\t\t\t\t\t></textarea>\n\t\t\t\t'):(__p+='\n\t\t\t\t\t<input \n\t\t\t\t\t\ttype="'+(null==(__t=t.type||"text")?"":__t)+'"\n\t\t\t\t\t\tplaceholder="'+(null==(__t=frases.FORMS.PLACEHOLDERS[t.placeholder]||frases.FORMS.PLACEHOLDERS[t.name])?"":__t)+" ",t.required&&(__p+="*"),__p+='"\n\t\t\t\t\t\tname="'+__e(t.name)+'" ',t.value&&(__p+='\n\t\t\t\t\t\tvalue="'+__e(credentials[t.value])+'" '),__p+=" ",t.required&&(__p+="required"),__p+="\n\t\t\t\t\t/>\n\t\t\t\t"),__p+="\n\t\t\t"}),__p+='\n\t\t\t<button \n\t\t\t\ttype="submit"\n\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block"\n\t\t\t\tstyle="background-color: '+__e(defaults.styles.primary.backgroundColor)+"; color: "+__e(defaults.styles.primary.color)+"; border: 1px solid "+__e(defaults.styles.primary.backgroundColor)+';">'+__e(frases.FORMS.send)+'</button>\n\t\t\t<button\n\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block"\n\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="rejectForm">'+__e(frases.FORMS.cancel)+'</button>\n\t\t</form>\n\t</div>\n\t<span class="'+__e(defaults.prefix)+'-message-time"> '+__e(message.time)+"</span>\n</div>";return __p};var _={},escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},escapeRegexp=new RegExp("["+Object.keys(escapeMap).join("")+"]","g");_.escape=function(t){return t?String(t).replace(escapeRegexp,function(t){return escapeMap[t]}):""},exports.message=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="'+__e(defaults.prefix)+"-message "+__e(defaults.prefix)+"-"+__e(message.entity)+'-msg">\n\t<span class="'+__e(defaults.prefix)+'-message-from">'+__e(message.from)+'</span>\n\t<div class="'+__e(defaults.prefix)+'-message-content"\n\t\t',"user"!==message.entity&&(__p+=' \n\t\t\tstyle="border-color:'+(null==(__t=defaults.styles.primary.backgroundColor)?"":__t)+'" \n\t\t'),__p+=">\n\t\t<p>"+(null==(__t=message.content)?"":__t)+'</p>\n\t</div>\n\t<span class="'+__e(defaults.prefix)+'-message-time"> '+__e(message.time)+"</span>\n</div>";return __p};var _={},escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},escapeRegexp=new RegExp("["+Object.keys(escapeMap).join("")+"]","g");_.escape=function(t){return t?String(t).replace(escapeRegexp,function(t){return escapeMap[t]}):""},exports.widget=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){var frases=translations;__p+="\n";var panels=frases.PANELS;__p+="\n";var channels=defaults.channels;__p+="\n";var positionClass="right"===defaults.position?"position-right":"position-left";__p+='\n<div id="'+__e(defaults.prefix)+'-wg-cont" class="'+__e(defaults.prefix)+"-wg-cont "+__e(positionClass)+'">\n\n\t<!-- ***** Panes container ***** -->\n\t<div \n\t\tid="'+__e(defaults.prefix)+'-wg-panes" \n\t\tclass="'+__e(defaults.prefix)+'-wg-panes" \n\t\tstyle="',defaults.styles.width&&(__p+="width: "+__e(defaults.styles.width)+";"),__p+='">\n\n\t\t<!-- ***** Top bar ***** -->\n\t\t<div \n\t\t\tclass="'+__e(defaults.prefix)+'-top-bar" \n\t\t\tstyle="background: '+__e(defaults.styles.primary.backgroundColor)+"; color: "+__e(defaults.styles.primary.color)+';">\n\n\t\t\t<!-- Main title -->\n\t\t\t<h4 class="'+__e(defaults.prefix)+"-wg-title "+__e(defaults.prefix)+'-uppercase">\n\t\t\t\t'+__e(defaults.title||frases.TOP_BAR.title)+'\n\t\t\t</h4>\n\n\t\t\t<div class="'+__e(defaults.prefix)+'-wg-state-cont">\n\t\t\t\t<!-- <span class="'+__e(defaults.prefix)+'-wg-state-icon"> </span> -->\n\t\t\t\t<span class="'+__e(defaults.prefix)+'-wg-state"></span>\n\t\t\t</div>\n\n\t\t\t<!-- Action buttons (minimize, close) -->\n\t\t\t<div class="'+__e(defaults.prefix)+'-wg-minimize">\n\n\t\t\t\t<!--<a \n\t\t\t\t\thref="#" \n\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="closeWidget">\n\t\t\t\t\t\n\t\t\t\t\t<span style="font-weight: bold">_</span>\n\t\t\t\t\n\t\t\t\t</a>-->\n\t\t\t\t\n\t\t\t\t<a \n\t\t\t\t\thref="#" \n\t\t\t\t\tstyle="color: '+__e(defaults.styles.primary.color)+'"\n\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="closeWidget"\n\t\t\t\t\t<span class="'+__e(defaults.prefix)+'-icon-close"></span>\n\n\t\t\t\t</a>\n\n\t\t\t</div>\n\t\t</div>\n\t\t<!-- ***** Top bar ends ***** -->\n\n\t\t<!-- ***** Connection types pane ***** -->\n\t\t<div \n\t\t\tclass="'+__e(defaults.prefix)+'-wg-pane" \n\t\t\tdata-'+__e(defaults.prefix)+'-pane="chooseConnection">\n\t\t\t\n\t\t\t<!-- Panel\'s image container -->\n\t\t\t<div \n\t\t\t\tclass="'+__e(defaults.prefix)+"-pane-header "+__e(defaults.prefix)+'-dark" \n\t\t\t\t',defaults.styles.intro.backgroundImage&&(__p+=' \n\t\t\t\t\tstyle="background-image: url('+__e(defaults.clientPath)+__e(defaults.styles.intro.backgroundImage)+')" \n\t\t\t\t'),__p+='>\n\n\t\t\t\t<!-- The text displayed on image -->\n\t\t\t\t<div class="'+__e(defaults.prefix)+"-backdrop-cont "+__e(defaults.prefix)+'-white">\n\t\t\t\t\t<br>\n\t\t\t\t\t<p>'+__e(panels.CONNECTION_TYPES.choose_conn_type)+'</p>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\n\t\t\t\t<form \n\t\t\t\t\tid="'+__e(defaults.prefix)+'-init-form" \n\t\t\t\t\tname="'+__e(defaults.prefix)+'InitForm">\n\n\t\t\t\t\t',channels.webrtc&&(__p+=" \n\t\t\t\t\t\t<!-- Display call button if WebRTC is enabled and supported by the browser -->\n\t\t\t\t\t\t",defaults.webrtcEnabled?__p+=' \n\t\t\t\t\t\t\t<button \n\t\t\t\t\t\t\t\ttype="button" \n\t\t\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n\t\t\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\t\t\tbackground: '+__e(defaults.styles.primary.backgroundColor)+"; \n\t\t\t\t\t\t\t\t\tcolor: "+__e(defaults.styles.primary.color)+"; \n\t\t\t\t\t\t\t\t\tborder: 1px solid "+__e(defaults.styles.primary.color)+';"\n\t\t\t\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="initCall">\n\n\t\t\t\t\t\t\t\t'+__e(panels.CONNECTION_TYPES.call_agent_btn)+"\n\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<!-- If WebRTC is not supported and fallback is set -->\n\t\t\t\t\t\t":channels.webrtc.fallback&&channels.webrtc.fallback.sipCall&&(__p+='\n\t\t\t\t\t\t\t<button \n\t\t\t\t\t\t\t\ttype="button" \n\t\t\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n\t\t\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\t\t\tbackground: '+__e(defaults.styles.primary.backgroundColor)+"; \n\t\t\t\t\t\t\t\t\tcolor: "+__e(defaults.styles.primary.color)+"; \n\t\t\t\t\t\t\t\t\tborder: 1px solid "+__e(defaults.styles.primary.color)+';"\n\t\t\t\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="initFallbackCall">\n\n\t\t\t\t\t\t\t\t'+__e(panels.CONNECTION_TYPES.call_agent_btn)+"\n\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t"),__p+="\n\t\t\t\t\t"),__p+="\n\n\t\t\t\t\t<!-- Display callback button if callback task is configured in the settings -->\n\t\t\t\t\t",channels.callback&&channels.callback.task&&(__p+='\n\t\t\t\t\t\t<button \n\t\t\t\t\t\t\ttype="button" \n\t\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n\t\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\t\tbackground: '+__e(defaults.styles.primary.backgroundColor)+"; \n\t\t\t\t\t\t\t\tcolor: "+__e(defaults.styles.primary.color)+"; \n\t\t\t\t\t\t\t\tborder: 1px solid "+__e(defaults.styles.primary.color)+';"\n\t\t\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="initCallback">\n\n\t\t\t\t\t\t\t'+__e(panels.CONNECTION_TYPES.callback_btn)+"\n\n\t\t\t\t\t\t</button>\n\t\t\t\t\t"),__p+="\n\n\t\t\t\t\t<!-- Init chat button -->\n\t\t\t\t\t",defaults.chat&&(__p+='\n\t\t\t\t\t<button\n\t\t\t\t\t\ttype="button" \n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n\t\t\t\t\t\tstyle="background: '+__e(defaults.styles.primary.backgroundColor)+"; color: "+__e(defaults.styles.primary.color)+"; border: 1px solid "+__e(defaults.styles.primary.color)+';"\n\t\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="initChat">\n\t\t\t\t\t\t'+__e(panels.CONNECTION_TYPES.chat_agent_btn)+"\n\t\t\t\t\t</button>\n\t\t\t\t\t"),__p+='\n\n\t\t\t\t\t<!-- Close widget button -->\n\t\t\t\t\t<a href="#" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block" data-'+__e(defaults.prefix)+'-handler="closeWidget">'+__e(panels.CONNECTION_TYPES.cancel)+"</a>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t\t<!-- ***** Connection types pane ends ***** -->\n\n\t\t<!-- ***** Intro pane. Displayed if configured in the settings object. ***** -->\n\t\t",defaults.intro.length&&(__p+='\n\t\t\t<div \n\t\t\t\tclass="'+__e(defaults.prefix)+'-wg-pane" \n\t\t\t\tdata-'+__e(defaults.prefix)+'-pane="credentials">\n\n\t\t\t\t<!-- Panel\'s image container -->\n\t\t\t\t<div \n\t\t\t\t\tclass="'+__e(defaults.prefix)+"-pane-header "+__e(defaults.prefix)+'-dark" \n\t\t\t\t\t',defaults.styles.intro.backgroundImage&&(__p+=' \n\t\t\t\t\t\tstyle="background-image: url('+__e(defaults.clientPath)+__e(defaults.styles.intro.backgroundImage)+')" \n\t\t\t\t\t'),__p+='>\n\n\t\t\t\t\t<!-- The text displayed on image -->\n\t\t\t\t\t<div class="'+__e(defaults.prefix)+"-backdrop-cont "+__e(defaults.prefix)+'-white">\n\t\t\t\t\t\t<br>\n\t\t\t\t\t\t<p>'+__e(defaults.introMessage||panels.INTRO.intro_message)+'</p>\n\t\t\t\t\t</div>\n\n\t\t\t\t</div>\n\n\t\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\t\t\t\t\t<form \n\t\t\t\t\t\tid="'+__e(defaults.prefix)+'-intro-form" \n\t\t\t\t\t\tname="'+__e(defaults.prefix)+'IntroForm" \n\t\t\t\t\t\tdata-validate-form="true">\n\n\t\t\t\t\t\t<!-- Iterating over intro array, which is a list of objects -->\n\t\t\t\t\t\t',_.forEach(defaults.intro,function(t){__p+="\n\t\t\t\t\t\t\t","lang"===t.name?(__p+='\n\t\t\t\t\t\t\t\t<select name="lang">\n\t\t\t\t\t\t\t\t\t',_.forEach(languages,function(t){__p+='\n\t\t\t\t\t\t\t\t\t\t<option \n\t\t\t\t\t\t\t\t\t\t\tvalue="'+__e(t)+'" \n\t\t\t\t\t\t\t\t\t\t\t',t===currLang&&(__p+=" selected "),__p+=" >\n\t\t\t\t\t\t\t\t\t\t\t"+__e(translations[t].lang)+"\n\t\t\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t\t"}),__p+="\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t"):"message"===t.name?(__p+='\n\t\t\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\t\t\tname="message"\n\t\t\t\t\t\t\t\t\tplaceholder="'+(null==(__t=t.placeholder||panels.INTRO.PLACEHOLDERS[t.name])?"":__t)+" ",t.required&&(__p+=" * "),__p+='"\n\t\t\t\t\t\t\t\t></textarea>\n\t\t\t\t\t\t\t'):"checkbox"===t.type?(__p+='\n\t\t\t\t\t\t\t\t<label for="'+__e(defaults.sid)+"-"+__e(t.name)+'">\n\t\t\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\t\ttype="checkbox" \n\t\t\t\t\t\t\t\t\tid="'+__e(defaults.sid)+"-"+__e(t.name)+'"\n\t\t\t\t\t\t\t\t\tname="'+__e(t.name)+'" \n\t\t\t\t\t\t\t\t\t',
t.required&&(__p+=" required "),__p+=">\n\t\t\t\t\t\t\t\t\t"+__e(t.placeholder)+"\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t"):(__p+='\n\t\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\t\ttype="'+(null==(__t=t.type||"text")?"":__t)+'" \n\t\t\t\t\t\t\t\t\tplaceholder="'+(null==(__t=t.placeholder||panels.INTRO.PLACEHOLDERS[t.name])?"":__t)+" ",t.required&&(__p+=" * "),__p+='" \n\t\t\t\t\t\t\t\t\tname="'+__e(t.name)+'" \n\t\t\t\t\t\t\t\t\t',t.save&&(__p+=' value="'+__e(credentials[t.name])+'" '),__p+=" \n\t\t\t\t\t\t\t\t\t",t.required&&(__p+=" required "),__p+=">\n\t\t\t\t\t\t\t"),__p+="\n\n\t\t\t\t\t\t"}),__p+='\n\t\t\t\t\t\t<br><br>\n\t\t\t\t\t\t<!-- Init chat with intro properties -->\n\t\t\t\t\t\t<button \n\t\t\t\t\t\t\ttype="submit" \n\t\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n\t\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\t\tbackground: '+__e(defaults.styles.primary.backgroundColor)+"; \n\t\t\t\t\t\t\t\tcolor: "+__e(defaults.styles.primary.color)+"; \n\t\t\t\t\t\t\t\tborder: 1px solid "+__e(defaults.styles.primary.color)+';">\n\n\t\t\t\t\t\t\t'+__e(panels.INTRO.start_dialog_button)+'\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t<!-- Close widget button -->\n\t\t\t\t\t\t<a href="#" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block" data-'+__e(defaults.prefix)+'-handler="closeWidget">'+__e(panels.INTRO.cancel)+"</a>\n\t\t\t\t\t</form>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"),__p+='\n\t\t<!-- ***** Intro pane ends ***** -->\n\n\t\t<!-- ***** Messages pane ***** -->\n\t\t<div  class="'+__e(defaults.prefix)+'-wg-pane" data-'+__e(defaults.prefix)+'-pane="messages">\n\t\t\t\n\t\t\t<!-- Messages container -->\n\t\t\t<ul \n\t\t\t\tid="'+__e(defaults.prefix)+'-messages-cont" \n\t\t\t\tclass="'+__e(defaults.prefix)+'-messages-cont" \n\t\t\t\tstyle="\n\t\t\t\t\t',defaults.styles.height&&(__p+="\n\t\t\t\t\t\theight: "+__e(defaults.styles.height)+";\n\t\t\t\t\t"),__p+='">\n\t\t\t\t\t\n\t\t\t</ul>\n\n\t\t\t<div class="'+__e(defaults.prefix)+'-write-cont">\n\t\t\t\t\n\t\t\t\t<!-- End dialog button -->\n\t\t\t\t<div class="'+__e(defaults.prefix)+'-end-dialog-btn">\n\t\t\t\t\t<a href="#" data-'+__e(defaults.prefix)+'-handler="finish">'+__e(panels.MESSAGES.end_dialog)+'</a>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- "Agent is typing" indicator -->\n\t\t\t\t<div class="'+__e(defaults.prefix)+'-loader">\n\t\t\t\t\t<span></span>\n\t\t\t\t\t<span></span>\n\t\t\t\t\t<span></span>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- "Attach file" button -->\n\t\t\t\t<label \n\t\t\t\t\tclass="'+__e(defaults.prefix)+'-sendfile-cont" \n\t\t\t\t\tfor="'+__e(defaults.prefix)+'-file-select">\n\n\t\t\t\t\t<input \n\t\t\t\t\t\ttype="file" \n\t\t\t\t\t\tid="'+__e(defaults.prefix)+'-file-select">\n\t\t\t\t\t\n\t\t\t\t\t<span \n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+'-icon-upload" \n\t\t\t\t\t\tstyle="color: '+__e(defaults.styles.primary.backgroundColor)+'">\n\t\t\t\t\t<span>\n\n\t\t\t\t</label>\n\n\t\t\t\t<div id="'+__e(defaults.prefix)+'-message-text-clone"  class="'+__e(defaults.prefix)+'-msg-textarea-clone" ></div>\n\n\t\t\t\t<!-- Field for typing the user message -->\n\t\t\t\t<textarea \n\t\t\t\t\tid="'+__e(defaults.prefix)+'-message-text" \n\t\t\t\t\tclass="'+__e(defaults.prefix)+'-msg-textarea" \n\t\t\t\t\tplaceholder="'+__e(panels.MESSAGES.PLACEHOLDERS.message)+'" \n\t\t\t\t\tmaxlength="1000"></textarea>\n\t\t\t\t\n\t\t\t\t<!-- "Send a message" button -->\n\t\t\t\t<a \n\t\t\t\t\thref="#" \n\t\t\t\t\tclass="'+__e(defaults.prefix)+"-sendmsg-btn "+__e(defaults.prefix)+'-button" \n\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="sendMessage">\n\n\t\t\t\t\t<span \n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+'-icon-paper-plane" \n\t\t\t\t\t\tstyle="color: '+__e(defaults.styles.primary.backgroundColor)+'">\n\t\t\t\t\t</span>\n\t\t\t\t</a>\n\n\t\t\t</div>\n\t\t</div>\n\t\t<!-- ***** Messages pane ends ***** -->\n\n\t\t<!-- ***** Offline pane ***** -->\n\t\t<div \n\t\t\tclass="'+__e(defaults.prefix)+'-wg-pane" \n\t\t\tdata-'+__e(defaults.prefix)+'-pane="sendemail">\n\n\t\t\t<!-- Panel\'s image container -->\n\t\t\t<div \n\t\t\t\tclass="'+__e(defaults.prefix)+"-pane-header "+__e(defaults.prefix)+'-dark" \n\t\t\t\t',defaults.styles.sendmail.backgroundImage&&(__p+=' \n\t\t\t\t\tstyle="background-image: url('+__e(defaults.clientPath)+__e(defaults.styles.sendmail.backgroundImage)+')" \n\t\t\t\t'),__p+='>\n\n\t\t\t\t<!-- The text displayed on image -->\n\t\t\t\t<div class="'+__e(defaults.prefix)+"-backdrop-cont "+__e(defaults.prefix)+'-dark">\n\t\t\t\t\t<p>'+__e(panels.OFFLINE.offline_message)+'</p>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\n\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\t\t\t\t<h4 class="'+__e(defaults.prefix)+'-uppercase">'+__e(panels.OFFLINE.send_message_header)+'</h4>\n\t\t\t\t<form id="'+__e(defaults.prefix)+'-sendmail-form" data-validate-form="true">\n\t\t\t\t\t<input type="text" name="uname" placeholder="'+__e(panels.OFFLINE.PLACEHOLDERS.uname)+'">\n\t\t\t\t\t<input type="email" name="email" placeholder="'+__e(panels.OFFLINE.PLACEHOLDERS.email)+' *" required>\n\t\t\t\t\t<textarea name="text" placeholder="'+__e(panels.OFFLINE.PLACEHOLDERS.message)+'" maxlength="1500"></textarea>\n\n\t\t\t\t\t<input type="file" name="file" id="'+__e(defaults.prefix)+'-contactfile" class="'+__e(defaults.prefix)+'-inputfile" />\n\t\t\t\t\t<label for="'+__e(defaults.prefix)+'-contactfile">'+__e(panels.OFFLINE.choose_file)+'</label>\n\n\t\t\t\t\t<!-- "Send offline message" button -->\n\t\t\t\t\t<button \n\t\t\t\t\t\ttype="submit" \n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\tbackground: '+__e(defaults.styles.primary.backgroundColor)+"; \n\t\t\t\t\t\t\tcolor: "+__e(defaults.styles.primary.color)+"; \n\t\t\t\t\t\t\tborder: 1px solid "+__e(defaults.styles.primary.color)+';">\n\n\t\t\t\t\t\t'+__e(panels.OFFLINE.send_message_button)+'\n\t\t\t\t\t\t\t\n\t\t\t\t\t</button>\n\n\t\t\t\t\t<!-- Close widget button -->\n\t\t\t\t\t<a href="#" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block" data-'+__e(defaults.prefix)+'-handler="closeWidget">'+__e(panels.OFFLINE.close)+'</a>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t\t<!-- ***** Offline pane ends ***** -->\n\n\t\t<!-- ***** Close chat pane ***** -->\n\t\t<div \n\t\t\tclass="'+__e(defaults.prefix)+'-wg-pane" \n\t\t\tdata-'+__e(defaults.prefix)+'-pane="closechat">\n\n\t\t\t<!-- Panel\'s image container -->\n\t\t\t<div \n\t\t\t\tclass="'+__e(defaults.prefix)+"-pane-header "+__e(defaults.prefix)+'-white" \n\t\t\t\t',defaults.styles.closeChat.backgroundImage&&(__p+=' \n\t\t\t\t\tstyle="background-image: url('+__e(defaults.clientPath)+__e(defaults.styles.closeChat.backgroundImage)+')" \n\t\t\t\t'),__p+='>\n\n\t\t\t\t<!-- The text displayed on image -->\n\t\t\t\t<div class="'+__e(defaults.prefix)+"-backdrop-cont "+__e(defaults.prefix)+'-white">\n\t\t\t\t\t<br>\n\t\t\t\t\t<p>'+__e(panels.CLOSE_CHAT.close_chat_header)+'</p>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\n\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\t\t\t\t<form id="'+__e(defaults.prefix)+'-closechat-form" data-validate-form="true">\n\t\t\t\t\t<label for="'+__e(defaults.prefix)+'-send-dialog">\n\t\t\t\t\t\t<input type="checkbox" name="sendDialog" id="'+__e(defaults.prefix)+'-send-dialog" />\n\t\t\t\t\t\t<span>'+__e(panels.CLOSE_CHAT.send_dialog_label)+'</span>\n\t\t\t\t\t</label>\n\t\t\t\t\t<input type="email" name="email" placeholder="'+__e(panels.CLOSE_CHAT.PLACEHOLDERS.email)+'">\n\t\t\t\t\t<select name="rating">\n\t\t\t\t\t\t<option value="">--- '+__e(panels.CLOSE_CHAT.rate_agent)+' ---</option>\n\t\t\t\t\t\t<option value="5">'+__e(frases.AGENT_RATES.excellent)+'</option>\n\t\t\t\t\t\t<option value="4">'+__e(frases.AGENT_RATES.good)+'</option>\n\t\t\t\t\t\t<option value="3">'+__e(frases.AGENT_RATES.fair)+'</option>\n\t\t\t\t\t\t<option value="2">'+__e(frases.AGENT_RATES.bad)+'</option>\n\t\t\t\t\t</select>\n\t\t\t\t\t<textarea placeholder="'+__e(panels.CLOSE_CHAT.PLACEHOLDERS.comment)+'" name="text" maxlength="1500"></textarea>\n\n\t\t\t\t\t<!-- End chat and close widget button -->\n\t\t\t\t\t<button \n\t\t\t\t\t\ttype="submit" \n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\tbackground: '+__e(defaults.styles.primary.backgroundColor)+"; \n\t\t\t\t\t\t\tcolor: "+__e(defaults.styles.primary.color)+"; \n\t\t\t\t\t\t\tborder: 1px solid "+__e(defaults.styles.primary.color)+';">\n\n\t\t\t\t\t\t'+__e(panels.CLOSE_CHAT.finish_dialog_button)+'\n\t\t\t\t\t\t\t\n\t\t\t\t\t</button>\n\n\t\t\t\t\t<!-- "Back to the chat" button -->\n\t\t\t\t\t<a href="#messages" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block">'+__e(panels.CLOSE_CHAT.back)+'</a>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t\t<!-- ***** Close chat pane ends ***** -->\n\n\t\t<!-- ***** Audio call pane ***** -->\n\t\t<div class="'+__e(defaults.prefix)+'-wg-pane" data-'+__e(defaults.prefix)+'-pane="callAgent">\n\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\t\t\t\t<div id="'+__e(defaults.prefix)+'-call-spinner" class="'+__e(defaults.prefix)+'-spinner-pane">\n\t\t\t\t\t<h3 class="'+__e(defaults.prefix)+'-text-center">'+__e(panels.AUDIO_CALL.confirm_access)+'</h3>\n\t\t\t\t\t<h3 class="'+__e(defaults.prefix)+"-text-center "+__e(defaults.prefix)+"-loader "+__e(defaults.prefix)+'-shown" style="position: relative;">\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t</h3>\n\t\t\t\t</div>\n\t\t\t\t<div id="'+__e(defaults.prefix)+'-call-info" class="'+__e(defaults.prefix)+'-hidden">\n\t\t\t\t\t<h3 class="'+__e(defaults.prefix)+'-text-center" id="'+__e(defaults.prefix)+'-call-state">'+__e(panels.AUDIO_CALL.calling_agent)+'</h3>\n\t\t\t\t\t<h3 class="'+__e(defaults.prefix)+'-text-center" id="'+__e(defaults.prefix)+'-call-timer">00:00</h3>\n\t\t\t\t</div>\n\t\t\t\t<form id="'+__e(defaults.prefix)+'-call-control">\n\t\t\t\t\t<hr>\n\t\t\t\t\t<button\n\t\t\t\t\t\tid="'+__e(defaults.prefix)+'-tryagain-btn"\n\t\t\t\t\t\ttype="button"\n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+"-block "+__e(defaults.prefix)+'-hidden"\n\t\t\t\t\t\tstyle="background: '+__e(defaults.styles.primary.backgroundColor)+"; color: "+__e(defaults.styles.primary.color)+"; border: 1px solid "+__e(defaults.styles.primary.color)+';"\n\t\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="initCall">\n\t\t\t\t\t\t'+__e(panels.AUDIO_CALL.try_again)+'\n\t\t\t\t\t</button>\t\n\t\t\t\t\t<button \n\t\t\t\t\t\ttype="button"\n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-warn "+__e(defaults.prefix)+'-block"\n\t\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="endCall">\n\n\t\t\t\t\t\t'+__e(panels.AUDIO_CALL.end_call)+'\n\n\t\t\t\t\t</button>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t\t<!-- ***** Audio call pane ends ***** -->\n\n\t\t<!-- ***** Audio call fallback pane ***** -->\n\t\t<div class="'+__e(defaults.prefix)+'-wg-pane" data-'+__e(defaults.prefix)+'-pane="callAgentFallback">\n\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\t\t\t\t<div class="'+__e(defaults.prefix)+'-text-center">\n\t\t\t\t\t<h3>'+__e(panels.AUDIO_CALL_FALLBACK.DOWNLOAD_MSG)+"</h3>\n\t\t\t\t\t<br>\n\t\t\t\t\t",defaults.webrtc&&defaults.webrtc.fallback&&(__p+='\n\t\t\t\t\t\t<a href="'+__e(defaults.webrtc.fallback.sipCall)+'">call.jnlp</a>\n\t\t\t\t\t'),__p+='\n\t\t\t\t</div>\n\t\t\t\t<form>\n\t\t\t\t\t<hr>\n\t\t\t\t\t<a href="#chooseConnection" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block">'+__e(panels.CALLBACK.back)+'</a>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t\t<!-- ***** Audio call fallback pane ends ***** -->\n\n\t\t<!-- ***** Callback pane ***** -->\n\t\t<div \n\t\t\tclass="'+__e(defaults.prefix)+'-wg-pane" \n\t\t\tdata-'+__e(defaults.prefix)+'-pane="callback">\n\n\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\t\t\t\t<div id="'+__e(defaults.prefix)+'-callback-spinner" class="'+__e(defaults.prefix)+"-hidden "+__e(defaults.prefix)+'-spinner-pane">\n\t\t\t\t\t<h3 class="'+__e(defaults.prefix)+'-text-center">'+__e(panels.CALLBACK.sending_request)+'</h3>\n\t\t\t\t\t<h3 class="'+__e(defaults.prefix)+"-text-center "+__e(defaults.prefix)+"-loader "+__e(defaults.prefix)+'-shown" style="position: relative;">\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t</h3>\n\t\t\t\t</div>\n\t\t\t\t<form id="'+__e(defaults.prefix)+'-callback-settings">\n\t\t\t\t\t<p class="'+__e(defaults.prefix)+'-text-center">'+__e(panels.CALLBACK.title)+"</p>\n\t\t\t\t\t<hr>\n\t\t\t\t\t<label>"+__e(panels.CALLBACK.LABELS.phone)+'</label>\n\t\t\t\t\t<input type="tel" name="phone" placeholder="'+__e(panels.CALLBACK.PLACEHOLDERS.phone)+'" required>\n\t\t\t\t\t<label>'+__e(panels.CALLBACK.LABELS.time)+'</label>\n\t\t\t\t\t<select name="time">\n\t\t\t\t\t\t',_.forEach(panels.CALLBACK.TIME_POINTS,function(t){__p+='\n\t\t\t\t\t\t\t<option value="'+__e(t.minutes)+'">'+__e(t.label)+"</option>\n\t\t\t\t\t\t"}),__p+='\n\t\t\t\t\t</select>\n\t\t\t\t\t<hr>\n\n\t\t\t\t\t<button\n\t\t\t\t\t\ttype="submit"\n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block"\n\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\tbackground: '+__e(defaults.styles.primary.backgroundColor)+"; \n\t\t\t\t\t\t\tcolor: "+__e(defaults.styles.primary.color)+"; \n\t\t\t\t\t\t\tborder: 1px solid "+__e(defaults.styles.primary.color)+';"\n\t\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="setCallback">\n\n\t\t\t\t\t\t'+__e(panels.CALLBACK.confirm_callback)+'\n\n\t\t\t\t\t</button>\n\n\t\t\t\t\t<a href="#chooseConnection" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block">'+__e(panels.CALLBACK.back)+'</a>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t\t<!-- ***** Callback pane ends ***** -->\n\n\t\t<!-- ***** Callback sent pane ***** -->\n\t\t<div class="'+__e(defaults.prefix)+'-wg-pane" data-'+__e(defaults.prefix)+'-pane="callbackSent">\n\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\t\t\t\t<div id="'+__e(defaults.prefix)+'-callback-sent">\n\t\t\t\t\t<h3 class="'+__e(defaults.prefix)+"-text-center "+__e(defaults.prefix)+"-icon-check "+__e(defaults.prefix)+'-text-success"></h3>\n\t\t\t\t\t<p class="'+__e(defaults.prefix)+'-text-center">'+__e(panels.CALLBACK.request_sent)+'</p>\n\t\t\t\t\t<form>\n\t\t\t\t\t\t<hr>\n\t\t\t\t\t\t<a href="#chooseConnection" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block">'+__e(panels.CALLBACK.back)+'</a>\n\t\t\t\t\t\t<a href="#" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block" data-'+__e(defaults.prefix)+'-handler="closeWidget">'+__e(panels.CALLBACK.close)+'</a>\n\t\t\t\t\t</form>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<!-- ***** Callback sent pane ends ***** -->\n\n\t</div>\n\t<!-- ***** Panes container ends ***** -->\n\n\t<!-- ***** Floating button container ***** -->\n\t<div id="'+__e(defaults.prefix)+'-btn-cont" class="'+__e(defaults.prefix)+'-btn-cont">\n\t\t<div class="'+__e(defaults.prefix)+'-wg-btn">\n\t\t\t<div class="'+__e(defaults.prefix)+'-lastmsg-cont">\n\t\t\t\t<span class="'+__e(defaults.prefix)+'-unnotify-btn" id="'+__e(defaults.prefix)+'-unnotify-btn">'+__e(frases.FLOATING_BUTTON.close)+'</span>\n\t\t\t\t<div id="'+__e(defaults.prefix)+'-lastmsg" class="'+__e(defaults.prefix)+'-lastmsg">\n\t\t\t\t</div>\t\n\t\t\t</div>\n\t\t\t<a href="#" class="'+__e(defaults.prefix)+'-btn-link">\n\t\t\t\t<span class="'+__e(defaults.prefix)+'-btn-icon"></span>\n\t\t\t</a>\n\t\t</div>\n\t</div>\n\t<!-- ***** Floating button container ends ***** -->\n\n</div>'}return __p}},{}],83:[function(t,e,n){(function(n){function a(){var t=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia,n=window.mozRTCIceCandidate||window.RTCIceCandidate;return!!t&&!!e&&!!n}function r(){g.on("connected",function(t){v.log("sip connected event: ",t)}),g.on("disconnected",function(t){v.log("sip disconnected event: ",t)}),g.on("newMessage",function(t){v.log("sip newMessage event: ",t)}),g.on("newRTCSession",function(t){v.log("sip newRTCSession event: ",t),y.emit("webrtc/newRTCSession",t),h=t.session}),g.on("registered",function(t){v.log("sip registered event: ",t)}),g.on("unregistered",function(t){v.log("sip unregistered event: ",t)}),g.on("registrationFailed",function(t){v.log("sip registrationFailed event: ",t)}),b={progress:function(t){v.log("call progress event: ",t),y.emit("webrtc/progress",t)},failed:function(t){v.log("call failed event:",t),y.emit("webrtc/failed",t)},ended:function(t){v.log("call ended event: ",t),y.emit("webrtc/ended",t)},confirmed:function(t){v.log("call confirmed event: ",t),y.emit("webrtc/confirmed",t)},addstream:function(t){v.log("call addstream event: ",t),y.emit("webrtc/addstream",t);var e=t.stream;_.audioRemote=x.rtcninja.attachMediaStream(_.audioRemote,e)}}}function s(){return h.isEstablished()}function i(){return h.isInProgress()}function o(){return h.isEnded()}function l(){g.stop()}function c(t){h=g.call(t,{eventHandlers:b,mediaConstraints:{audio:!0,video:!1}})}function u(){h.terminate({status_code:200})}function d(){v.log("answer: ",g),h.answer()}function f(){v.log("hold: ",h.isOnHold()),h&&h.isOnHold().local?h.unhold():h.hold()}function p(){var t=document.createElement("audio");return t.setAttribute("autoplay","autoplay"),document.body.appendChild(t),t}function m(t){v.log("Initiating WebRTC module:",t),_=t,void 0===_.sip.register&&(_.sip.register=!1);var e=new x.WebSocketInterface(_.sip.ws_servers);_.sip.sockets=[e],y.emit=t.emit,y.on=t.on,_.audioRemote=p(),g=new x.UA(_.sip),r(),g.start()}var _,g,h,b,v=t("./debug"),y={},x=n.JsSIP;e.exports={lib:x,init:m,unregister:l,audiocall:c,terminate:u,answer:d,hold:f,isInProgress:i,isEstablished:s,isEnded:o,isSupported:a}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./debug":77}],84:[function(t,e,n){(function(n){function a(t){return pe.initiated?ve:(se.merge(de,t||{}),$t=new ee(de).on("session/create",i).on("session/timeout",U).on("session/join",u).on("session/joined",f).on("session/disjoin",p).on("session/init",l),ae.get("frases",(de.translationsPath||de.clientPath)+"translations.json",function(t,e){return t?$t.emit("Error",t):(ie=JSON.parse(e),void(ie=ie[$t.detectLanguage(ie)]))}),ae.get("forms_json",de.clientPath+"forms.json",function(t,e){return t?$t.emit("Error",t):void(Jt=JSON.parse(e).forms)}),Dt(),ue.init(de.clientPath+"sounds/"),ve)}function r(){return $t.init(),ve}function s(t){re.log("initWebrtcModule: ",t),ce.init(t)}function i(){se.poll(function(){return re.log("poll: ",ie),null!==ie},function(){o(),de.external||$t.updateUrl(window.location.href)},function(){return be<2?(be++,void a(de)):$t.emit("Error","Module wasn't initiated due to network errors")},6e4)}function o(){return!!(de.chat||de.webrtcEnabled||de.channels.callback.task)&&($t.session.properties&&se.merge(de,$t.session.properties),de.sid=$t.session.sid,re.log("initSession: ",$t,de),de.widget&&$t.on("chat/close",D).on("chat/timeout",B).on("message/new",A).on("message/new",O).on("message/typing",q).on("callback/create",J).on("form/submit",Ct).on("form/reject",Lt).on("widget/load",b),ce.isSupported()&&de.channels.webrtc&&de.channels.webrtc.sip&&void 0!==de.channels.webrtc.sip.ws_servers&&("https:"===window.location.protocol?(de.webrtcEnabled=!0,$t.on("webrtc/newRTCSession",function(){$("newRTCSession")}),$t.on("webrtc/progress",function(t){$(180===t.response.status_code?"ringing":"confirmed")}),$t.on("webrtc/addstream",function(){$("connected")}),$t.on("webrtc/ended",function(){$("ended")}),$t.on("webrtc/failed",function(t){$("Canceled"===t.cause?"canceled":"failed")}),s({sip:de.channels.webrtc.sip,emit:ve.emit,on:ve.on})):(re.warn("WebRTC feature is disabled"),re.warn("getUserMedia() no longer works on insecure origins. To use this feature, you should consider switching your application to a secure origin, such as HTTPS. See https://goo.gl/rStTGz for more details."))),g(),de.buttonSelector&&et(de.buttonSelector),de.themeColor&&(de.styles.primary.backgroundColor=de.themeColor,de.styles.primary.color=Bt(de.themeColor)),re.log("initSession: ",de.widget,pe.initiated,zt()),de.widget&&!pe.initiated&&zt()&&v(de),wt("timeout")&&kt("timeout"),void $t.emit("session/init",{session:$t.session,options:de,url:n.location.href}))}function l(t){ne.saveState("init",!0,"session"),Xt&&!Xt.closed&&Xt.sessionStorage.setItem(de.prefix+".init",!0)}function c(){O({from:ne.getState("aname","session"),time:Date.now(),content:"{request_browser_access}"})}function u(t){re.log("onSessionJoinRequest",ne.getState("shared","session")),ne.getState("shared","session")?d(t):c()}function d(t){$t.shareOpened(),f(t)}function f(t){m({url:t.url,entity:$t.session.entity})}function p(){oe.unshare()}function m(t){de.external||oe.isInitiated()||($t.on("cobrowsing/init",function(){oe.share()}),$t.on("cobrowsing/update",function(t){oe.updateEvents(t)}),$t.on("cobrowsing/event",function(t){$t.updateEvents(t.events)}),$t.on("cobrowsing/shared",function(){ne.saveState("shared",!0,"session")}),$t.on("cobrowsing/unshared",function(t){ne.saveState("shared",!1,"session")}),oe.init({widget:t.widget,entity:t.entity,emit:ve.emit,path:de.clientPath}))}function _(){return Yt}function g(){$t.getLanguages(function(t,e){re.log("getLanguages: ",t,e),t||e&&h(e)})}function h(t){var e=t.length?"online":"offline";ge=t,ht({state:e}),$t.emit("chat/languages",t)}function b(){var t,e="";pe.initiated=!0,vt(),tt(Yt),ht({state:bt()}),de.hideOfflineButton&&xt("no-button"),de.offer&&y(),ne.getState("chat","session")===!0&&(S(ne.getState("credentials","session")||{}),ne.getState("opened","session")&&Et()),de.webrtcEnabled&&xt("webrtc-enabled"),Yt&&de.intro.length&&(ge.forEach(function(n){ie&&ie.lang&&(t=n===$t.session.lang?"selected":"",e+='<option value="'+n+'" '+t+" >"+ie.lang+"</option>")}),n[de.prefix+"IntroForm"].lang.innerHTML=e),$t.emit("widget/init")}function v(t){compiled=At("widget",{defaults:t,languages:ge,translations:ie,credentials:ne.getState("credentials","session")||{},_:se}),Yt=te(compiled),document.body.appendChild(Yt),$t.emit("widget/load",Yt),re.log("loadWidget",t)}function y(){setTimeout(function(){x({from:de.offer.from||ie.TOP_BAR.title,time:Date.now(),content:de.offer.text||ie.default_offer})},de.offer.inSeconds?1e3*de.offer.inSeconds:3e4)}function x(t){"online"!==pe.state||k()||O(t)}function w(){ne.getState("interacted","session")||ne.saveState("interacted",!0,"session")}function k(){return ne.getState("interacted","session")}function E(){Et(),ne.getState("chat","cache")||(lt()?gt("sendemail"):de.intro.length?ne.getState("chat","session")||ne.getState("credentials","session")?S(ne.getState("credentials","session")||{}):gt("credentials"):S({lang:$t.session.lang}))}function S(t){var e=ne.getState("chat","session"),n=ne.getState("aid","session"),a=t.message;n&&(t.agentid=n),t.lang||(t.lang=$t.session.lang),ne.saveState("credentials",t,"session"),$t.chatRequest(t),setTimeout(function(){re.log("requestChat: ",t.message,e),a&&!e&&L({message:t.message})},500),C($t.session),jt(),gt("messages")}function C(t){var e=t.answerTimeout;ne.saveState("chat",!0,"session"),re.log("startChat timeout: ",e),e&&(Gt=setTimeout(B,1e3*e)),xt("chat")}function L(t){$t.sendMessage(t),O({from:ne.getState("credentials","session").uname||$t.session.sid,time:Date.now(),content:t.message})}function O(t){re.log("new messages arrived!",t);var e,a,r=!1,s=ne.getState("credentials","session")||{},i=ne.getState("aname","session"),o=s.uname?s.uname:$t.session.sid,l=document.getElementById(de.prefix+"-messages-cont");if(t.entity=t.entity||(t.from===o||void 0===t.from?"user":"agent"),t.from="user"===t.entity?"":t.from,t.time=Tt(t.time?t.time:Date.now()),e=It(t.content,t.file,t.entity),"form"===e.type)a=At("forms",{defaults:de,message:t,form:e.content,credentials:s,frases:ie,_:se}),n[e.content.name]&&Lt({formName:e.content.name}),l.insertAdjacentHTML("beforeend","<li>"+a+"</li>"),l.scrollTop=l.scrollHeight;else{if(!t.content)return;t.content=e.content,a=At("message",{defaults:de,message:t}),l.insertAdjacentHTML("beforeend","<li "+(t.className?'class="'+t.className+'"':"")+">"+a+"</li>"),j(a),t.hidden||(me.push(a),_e.push(t))}"agent"===t.entity&&(i!==t.from&&ne.saveState("aname",t.from,"session"),t.agentid&&ne.saveState("aid",t.agentid,"session"),t.from&&clearTimeout(Gt)),"user"!==t.entity&&(r=!0),l.scrollTop=l.scrollHeight}function A(){var t=[].slice.call(document.querySelectorAll("."+de.prefix+"-msg-undelivered"));t&&t.length&&t.forEach(function(t){t.classList.add(de.prefix+"-hidden")})}function j(t){var e;pe.active||(e=document.getElementById(de.prefix+"-lastmsg"),e.innerHTML=t,xt("notified"),yt("notified"))}function T(t,e){var n=At("email",{defaults:de,content:t,frases:ie,_:se});if(e)return e(null,n)}function I(t){var e=t.text.join("");T(e,function(e,n){e||(t.text=n,$t.sendEmail(t))})}function N(t){var e=[],n=At("message",{defaults:de,message:{from:ie.EMAIL_SUBJECTS.complain+" "+t.email,content:t.text,entity:"",time:""}});e=e.concat(n,'<br><p class="h1">'+ie.EMAIL_SUBJECTS.dialog+" "+de.host+"</p><br>",me).reduce(function(t,e){return t.concat(e)}),T(e,function(e,n){e||(t.text=n,$t.sendEmail(t))})}function R(t,e){var n=At("message",{defaults:de,message:{from:ie.EMAIL_SUBJECTS.request+" "+t.uname+" ("+t.email+")",content:t.text,entity:"",time:""}});T(n,function(n,a){n||(t.text=a,$t.sendEmail(t),e&&e())})}function M(t,e){var n;return e.email?(e.subject=ie.EMAIL_SUBJECTS.request+" "+e.email,void(e.file?n=Ot(t.file,function(n,a){n?re.warn("File wasn't sent"):(e.filename=a.filename,e.filedata=a.filedata),delete e.file,R(e,function(){t.reset(),St()})}):R(e,function(){t.reset(),St()}))):void alert(ie.ERRORS.email)}function F(t,e){var n=e&&e.rating?parseInt(e.rating,10):null;if(e&&e.sendDialog){if(!e.email)return void alert(ie.ERRORS.email);I({to:e.email,subject:ie.EMAIL_SUBJECTS.dialog+" "+de.host,text:me})}if(e&&e.text){if(!e.email)return void alert(ie.ERRORS.email);N({email:e.email,subject:ie.EMAIL_SUBJECTS.complain+" "+e.email,text:e.text})}t&&t.reset(),P(n),St()}function P(t){ne.saveState("chat",!1,"session"),$t.closeChat(t),kt("chat"),ne.getState("shared","session")&&($t.shareClosed(n.location.href),oe.unshare())}function D(){ne.getState("shared","session")&&oe.unshare()}function B(){re.log("chat timeout!"),O({from:"",time:Date.now(),content:"{queue_overload}"});var t=n.queue_overload;t&&(t.text.value=_e.reduce(function(t,e){return"user"===e.entity&&(t+=e.content+"\n"),t},""))}function q(){Vt||xt("agent-typing"),clearTimeout(Vt),Vt=setTimeout(function(){Vt=null,kt("agent-typing")},5e3)}function U(){re.log("Session timeout:"),ne.getState("chat","session")===!0&&P(),gt("closechat")}function W(){gt("callAgent"),ce.audiocall(de.channels.webrtc.hotline)}function H(){gt("callAgentFallback")}function z(){gt("callback")}function K(){var t=document.getElementById(de.prefix+"-callback-settings"),e=Ft(t),n=document.getElementById(de.prefix+"-callback-spinner");document.getElementById(de.prefix+"-callback-sent");return e.phone=e.phone?Ht(e.phone):null,!e.phone||e.phone.length<10?alert(ie.ERRORS.tel):(e.time=parseFloat(e.time),void(e.time<=0||(e.time=Date.now()+60*e.time*1e3,e.task=de.channels.callback.task,re.log("setCallback data: ",e),t.classList.add(de.prefix+"-hidden"),n.classList.remove(de.prefix+"-hidden"),$t.requestCallback(e),gt("callbackSent"),t.reset())))}function J(){var t=document.getElementById(de.prefix+"-callback-settings"),e=document.getElementById(de.prefix+"-callback-spinner");e.classList.add(de.prefix+"-hidden"),t.classList.remove(de.prefix+"-hidden"),err||gt("callbackSent")}function $(t){re.log("initCallState: ",t);var e=document.getElementById(de.prefix+"-call-spinner"),n=document.getElementById(de.prefix+"-call-info"),a=document.getElementById(de.prefix+"-call-state"),r=document.getElementById(de.prefix+"-call-timer"),s=document.getElementById(de.prefix+"-tryagain-btn");"newRTCSession"===t?$("oncall"):"confirmed"===t?(a.innerText=ie.PANELS.AUDIO_CALL.calling_agent,n.classList.remove(de.prefix+"-hidden"),e.classList.add(de.prefix+"-hidden"),s.classList.add(de.prefix+"-hidden")):"ringing"===t?(G(r,"init",0),r.classList.remove(de.prefix+"-hidden")):"connected"===t?(a.innerText=ie.PANELS.AUDIO_CALL.connected_with_agent,G(r,"start",0),ue.stop()):"ended"===t?(a.innerText=ie.PANELS.AUDIO_CALL.call_ended,G(r,"stop"),$("oncallend")):"failed"===t||"canceled"===t?("failed"===t?a.innerText=ie.PANELS.AUDIO_CALL.call_failed:a.innerText=ie.PANELS.AUDIO_CALL.call_canceled,n.classList.remove(de.prefix+"-hidden"),e.classList.add(de.prefix+"-hidden"),r.classList.add(de.prefix+"-hidden"),s.classList.remove(de.prefix+"-hidden"),$("oncallend"),ue.play("busy")):"oncall"===t?(window.onbeforeunload=function(){return"Your connection is in progress. Do you realy want to close it?"},ne.saveState("call",!0,"cache"),xt("webrtc-call")):"oncallend"===t?(window.onbeforeunload=null,ne.saveState("call",!1,"cache"),kt("webrtc-call")):(n.classList.add(de.prefix+"-hidden"),e.classList.remove(de.prefix+"-hidden"),s.classList.add(de.prefix+"-hidden"))}function G(t,e,n){var a=n;"start"===e?Zt=setInterval(function(){a+=1,t.textContent=Wt(a)},1e3):"stop"===e?clearInterval(Zt):"init"===e&&(t.textContent=Wt(0))}function Y(){ce.isEstablished()||ce.isInProgress()?ce.terminate():(St(),$("init"))}function X(t){t&&t.preventDefault();var e={};Xt&&!Xt.closed||(e=se.merge(e,de),e.widget=!0,e.external=!0,Xt=window.open("","wchat",de.widgetWindowOptions),Xt=V(Xt),se.poll(function(){return void 0!==Xt.Wchat},function(){Xt.Module=Xt.Wchat(e),Xt.Module.on("widget/init",function(){Xt.Module.initWidgetState()}),se.forEach($t._events,function(t,e,a){Xt.Module.on(e,function(t){t.url=n.location.href,$t.emit("window/"+e,t)})})},function(){console.warn("Wchat module was not initiated due to network connection issues.")},12e4),Xt.onbeforeunload=function(){ne.getState("chat","session")&&P()}),Xt.focus&&Xt.focus()}function V(t){var e,n,a,r,s=t.document.createElement("div"),i=Q(t,"swc-loader-styles"),o=t.document.getElementsByTagName("head")[0],l=t.document.getElementsByTagName("body")[0];return s.className="swc-widget-loader",s.innerHTML="<span></span><span></span><span></span>",a=t.document.createElement("meta"),a.name="viewport",a.content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0",n=t.document.createElement("meta"),n.setAttribute("charset","utf-8"),r=t.document.createElement("title"),r.textContent=ie.TOP_BAR.title,e=t.document.createElement("script"),e.src=de.clientPath+"wchat.min.js",e.charset="UTF-8",o.appendChild(a),o.appendChild(n),o.appendChild(r),o.appendChild(i),o.appendChild(e),l.id="swc-wg-window",l.appendChild(s),Z(o.getElementsByTagName("style")[0]),t}function Q(t,e){var n=t.document.createElement("style");return n.type="text/css",e&&(n.id=e),n.appendChild(t.document.createTextNode("")),n}function Z(t){var e=["body { margin:0; background-color: #eee; }","@keyframes preloading {","0 { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","50% { transform: translate(0,15px); -webkit-transform: translate(0,15px); -moz-transform: translate(0,15px); -ms-transform: translate(0,15px); -o-transform: translate(0,15px); }","100% { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","}","@-webkit-keyframes preloading {","0 { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","50% { transform: translate(0,15px); -webkit-transform: translate(0,15px); -moz-transform: translate(0,15px); -ms-transform: translate(0,15px); -o-transform: translate(0,15px); }","100% { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","}","@-moz-keyframes preloading {","0 { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","50% { transform: translate(0,15px); -webkit-transform: translate(0,15px); -moz-transform: translate(0,15px); -ms-transform: translate(0,15px); -o-transform: translate(0,15px); }","100% { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","}","@-ms-keyframes preloading {","0 { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","50% { transform: translate(0,15px); -webkit-transform: translate(0,15px); -moz-transform: translate(0,15px); -ms-transform: translate(0,15px); -o-transform: translate(0,15px); }","100% { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","}","@-o-keyframes preloading {","0 { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","50% { transform: translate(0,15px); -webkit-transform: translate(0,15px); -moz-transform: translate(0,15px); -ms-transform: translate(0,15px); -o-transform: translate(0,15px); }","100% { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","}",".swc-widget-loader {","position: absolute;","width: 100%;","top: 50%;","margin-top: -18px;","text-align: center;","}",".swc-widget-loader span {","display: inline-block;","width: 18px;","height: 18px;","border-radius: 50%;","background-color: #fff;","margin: 3px;","}",".swc-widget-loader span:nth-last-child(1) { -webkit-animation: preloading .8s .1s linear infinite; -moz-animation: preloading .8s .1s linear infinite; -ms-animation: preloading .8s .1s linear infinite; -o-animation: preloading .8s .1s linear infinite; animation: preloading .8s .1s linear infinite; }",".swc-widget-loader span:nth-last-child(2) { -webkit-animation: preloading .8s .3s linear infinite; -moz-animation: preloading .8s .3s linear infinite; -ms-animation: preloading .8s .3s linear infinite; -o-animation: preloading .8s .3s linear infinite; animation: preloading .8s .3s linear infinite; }",".swc-widget-loader span:nth-last-child(3) { -webkit-animation: preloading .8s .5s linear infinite; -moz-animation: preloading .8s .5s linear infinite; -ms-animation: preloading .8s .5s linear infinite; -o-animation: preloading .8s .5s linear infinite; animation: preloading .8s .5s linear infinite; }"].join(" ");
t.innerHTML=e}function tt(t){var e=document.getElementById(de.prefix+"-file-select"),a=document.getElementById(de.prefix+"-message-text"),r=[].slice.call(t.querySelectorAll("."+de.prefix+"-inputfile")),s=document.getElementById(de.prefix+"-btn-cont");[].slice.call(t.querySelectorAll("."+de.prefix+"-wg-pane")),document.getElementById(de.prefix+"-messages-cont");r.forEach(function(t){var e=t.nextElementSibling,n=e.textContent;Kt(t,"change",function(t){var a=t.target.value.split("\\").pop();a?e.textContent=a:e.textContent=n})}),Kt(s,"click",st),Kt(t,"click",rt),Kt(t,"submit",mt),Kt(e,"change",_t),Kt(a,"keypress",dt),Kt(a,"focus",ft),Kt(a,"blur",pt),Kt(n,"DOMMouseScroll",it),Kt(n,"wheel",it),Kt(t,"mouseenter",nt),Kt(t,"mouseleave",at)}function et(t){var e=de.widget?ct:X,n=[].slice.call(document.querySelectorAll(t));n.map(function(t){return Kt(t,"click",e),t})}function nt(){he=!0}function at(){he=!1}function rt(t){var e,n,a,r,s=t.target;"A"!==s.parentNode.tagName&&"BUTTON"!==s.parentNode.tagName||(s=s.parentNode),e=s.getAttribute("data-"+de.prefix+"-handler"),r=s.getAttribute("data-"+de.prefix+"-link"),"closeWidget"===e?St():"finish"===e?(P(),St()):"sendMessage"===e?ut():"openWindow"===e?X():"rejectForm"===e?$t.emit("form/reject",{formName:se.findParent(s,"form").name}):"initCall"===e?W():"initFallbackCall"===e?H():"initCallback"===e?z():"setCallback"===e?K():"initChat"===e?E():"endCall"===e&&Y(),"A"===s.tagName&&(a=s.href,r?$t.linkFollowed(r):a.indexOf("#")!==-1&&(t.preventDefault(),n=a.substring(s.href.indexOf("#")+1),n&&gt(n)))}function st(t){t.preventDefault();var e=t.target,n=t.currentTarget;return e.id===de.prefix+"-unnotify-btn"?(kt("notified"),void yt(pe.state)):void(n.id===de.prefix+"-btn-cont"&&ct())}function it(t){var e=document.getElementById(de.prefix+"-messages-cont"),n=ot(t);he&&(0===e.scrollTop&&"up"===n?(t.stopPropagation(),t.preventDefault()):e.scrollTop>=e.scrollHeight-e.clientHeight&&"down"===n&&(t.stopPropagation(),t.preventDefault()))}function ot(t){var e;return e=t.wheelDelta?t.wheelDelta:-1*t.deltaY,e<0?"down":e>0?"up":void 0}function lt(){return!(ge&&ge.length||0!==$t.session.state)}function ct(t){t&&t.preventDefault();var e=ne.getState("chat","session"),n=(ne.getState("opened","session"),ne.getState("call","cache"));re.log("initWidgetState"),w(),wt("timeout")?r():e?Et():lt()?(gt("sendemail"),Et()):de.webrtcEnabled?n?Et():(de.chat||de.channels.callback.task?gt("chooseConnection"):W(),Et()):de.channels.callback.task?de.chat||de.webrtcEnabled?(gt("chooseConnection"),Et()):(gt("callback"),Et()):E()}function ut(){var t,e=document.getElementById(de.prefix+"-message-text");t=se.trim(e.value),t&&(ne.getState("chat","session")||E(),L({message:t}),e.value="",kt("type-extend"))}function dt(t){var e=t.target,n=document.getElementById("swc-message-text-clone");10===t.keyCode||13===t.keyCode?(t.preventDefault(),ut()):Qt||(Qt=setTimeout(function(){Qt=null,$t.userIsTyping()},1e3)),n.innerText=e.value,e.style.height=n.clientHeight+"px"}function ft(t){var e=t.target;e.style.borderColor=de.styles.primary.backgroundColor}function pt(t){var e=t.target;e.style.borderColor="#fff"}function mt(t){var e=t.target;t.preventDefault(),"FORM"===e.tagName&&$t.emit("form/submit",{formElement:e,formData:Ft(e)})}function _t(t){var e=t.target;Ot(e,function(t,e){re.log("wgSendFile: ",t,e),t?alert("File was not sent"):L({message:e.filename,file:e.filedata})})}function gt(t){var e="data-"+de.prefix+"-pane",n=[].slice.call(Yt.querySelectorAll("."+de.prefix+"-wg-pane"));n.forEach(function(n){n.getAttribute(e)===t?n.classList.add("active"):n.classList.remove("active")})}function ht(t){if(re.log("changeWgState: ",t),Yt&&pe.state!==t.state){"offline"===t.state?(P(),kt("online"),gt("sendemail")):"online"===t.state&&kt("offline");var e=document.querySelector("."+de.prefix+"-wg-state");e&&(e.textContent=ie.TOP_BAR.STATUS[t.state]),pe.state=t.state,xt(t.state),yt(t.state),$t.emit("widget/statechange",{state:t.state})}}function bt(){var t=pe.state?pe.state:ge&&ge.length||!ge.length&&1===$t.session.state?"online":"offline";return t}function vt(){var t=Yt.querySelector("."+de.prefix+"-wg-btn");re.log("setStyles: ",t,de.buttonStyles),t.style.borderRadius=de.buttonStyles.borderRadius,t.style.boxShadow=de.buttonStyles.boxShadow}function yt(t){if(Yt&&void 0!==de.buttonStyles[t]){var e=Yt.querySelector("."+de.prefix+"-wg-btn"),n=Yt.querySelector("."+de.prefix+"-btn-icon");e.style.background=de.buttonStyles[t].backgroundColor,n.style.color=de.buttonStyles[t].color||de.buttonStyles.color}}function xt(t){Yt&&Yt.classList.add(t)}function wt(t){return!!Yt&&Yt.classList.contains(t)}function kt(t){Yt&&Yt.classList.remove(t)}function Et(){var t=document.getElementById(de.prefix+"-messages-cont");pe.active=!0,ne.saveState("opened",!0,"session"),xt("active"),kt("notified"),yt(pe.state),t.scrollTop=t.scrollHeight}function St(){window.opener?window.close():(pe.active=!1,ne.saveState("opened",!1,"session"),kt("active"))}function Ct(t){var e=t.formElement,a=t.formData;if(re.log("onFormSubmit: ",e,a),e.getAttribute("data-validate-form")){var r=Pt(e);if(!r)return}e.id===de.prefix+"-closechat-form"?F(e,a):e.id===de.prefix+"-sendmail-form"?M(e,a):e.id===de.prefix+"-intro-form"?S(a):e.id===de.prefix+"-call-btn-form"?W():e.id===de.prefix+"-chat-btn-form"?E():e.id===de.prefix+"-queue_overload"?(R(a),Lt({formName:e.name},!0)):e.id===de.prefix+"-request_browser_access"?(d({url:n.location.href}),Lt({formName:e.name},!0),St()):Lt({formName:e.name},!0)}function Lt(t,e){var a=n[t.formName];return!!a&&void(e?a.outerHTML='<p class="'+de.prefix+'-text-center"><i class="'+de.prefix+"-text-success "+de.prefix+'-icon-check"></i><span> '+ie.FORMS.submitted+"</span></p>":a.outerHTML='<p class="'+de.prefix+'-text-center"><i class="'+de.prefix+"-text-danger "+de.prefix+'-icon-remove"></i><span> '+ie.FORMS.canceled+"</span></p>")}function Ot(t,e){var a,r=t.files;if(r.length){if(!n.FileReader)return void(e&&e("OBSOLETE_BROWSER"));a=r[0];var s=new Blob([a],{type:a.type});return e(null,{filedata:s,filename:a.name})}}function At(t,e){var n=le[t];return n(e)}function jt(){var t=document.getElementById(de.prefix+"-messages-cont"),e=t.cloneNode();t.parentNode.replaceChild(e,t)}function Tt(t){var e=new Date("string"==typeof t?parseInt(t,10):t),n=e.getHours(),a=e.getMinutes(),r=(n<10?"0"+n:n)+":"+(a<10?"0"+a:a);return r}function It(t,e,n){var a,r;return e?(a=t.substring(t.indexOf("_")+1),Mt(e)?{type:"image",content:'<a href="'+$t.options.server+"/ipcc/"+t+'" download="'+a+'"><img src="'+$t.options.server+"/ipcc/"+t+'" alt="file preview" /></a>'}:{type:"file",content:'<a href="'+$t.options.server+"/ipcc/"+t+'" download="'+a+'">'+a+"</a>"}):"agent"===n&&Rt(t)&&Mt(t)?(a=t.substring(t.indexOf("_")+1),{type:"image",content:'<a href="'+t+'" target="_blank"><img src="'+t+'" alt="'+a+'" /></a>'}):"agent"===n&&new RegExp("^{.+}$").test(t)?(Jt.forEach(function(e){e.name===t.substring(1,t.length-1)&&(r=e)}),{type:r?"form":"text",content:r?r:t}):{type:"text",content:t.replace(/\n/g," <br> ").split(" ").map(Nt).join(" ").replace(" <br> ","<br>")}}function Nt(t){var e=0,n=t;if(Rt(t)){for(;!n.charAt(n.length-1).match(/[a-z0-9\/]/i);)n=n.slice(0,-1),e+=1;return'<a href="'+n+'" target="_blank" data-'+de.prefix+'-link="'+n+'">'+n+"</a>"+t.substr(t.length-e)}return t}function Rt(t){var e=new RegExp("^http://|^https://");return e.test(t)}function Mt(t){var e=new RegExp("png|PNG|jpg|JPG|JPEG|jpeg|gif|GIF"),n=t.substring(t.lastIndexOf(".")+1);return e.test(n)}function Ft(t){var e={};return[].slice.call(t.elements).forEach(function(t){"checkbox"===t.type?e[t.name]=t.checked:t.value&&(e[t.name]=t.value)}),e}function Pt(t){var e=!0;return[].slice.call(t.elements).every(function(t){return!t.hasAttribute("required")||""!==t.value&&null!==t.value||(alert(ie.ERRORS[t.type]||ie.ERRORS.required),e=!1,!1)}),e}function Dt(){var t=document.createElement("link");t.rel="stylesheet",t.href=de.stylesPath||de.clientPath+"main.css",document.head.appendChild(t)}function Bt(t){var e=Ut(de.themeColor);return re.log("getThemeTextColor: ",e,qt(e.r,e.g,e.b)),qt(e.r,e.g,e.b)>.5?"#333":"#f1f1f1"}function qt(t,e,n){var a=t/255,r=e/255,s=n/255,i=a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4),o=r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4),l=s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4),c=.2126*i+.7152*o+.0722*l;return c}function Ut(t){var e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;t=t.replace(e,function(t,e,n,a){return e+e+n+n+a+a});var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null}function Wt(t){var e=Math.floor(t/60),n=t%60,a=(e>9?e:"0"+e)+":"+(n>9?n:"0"+n);return a}function Ht(t){return t.replace(/\D+/g,"")}function zt(){return void 0!==document.body.classList}function Kt(t,e,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent&&t.attachEvent("on"+e,n)}var Jt,$t,Gt,Yt,Xt,Vt,Qt,Zt,te=t("domify"),ee=t("./core"),ne=t("./storage"),ae=t("./request"),re=t("./debug"),se=t("./lodash"),ie=null,oe=t("./cobrowsing"),le=t("./templates"),ce=t("./webrtc"),ue=t("./audio-control"),de={prefix:"swc",autoStart:!0,intro:!1,introMessage:"",widget:!0,chat:!0,channels:{webrtc:{},callback:{}},cobrowsing:!1,buttonSelector:"",reCreateSession:!0,title:"",lang:"",langFromUrl:!0,position:"right",hideOfflineButton:!1,offer:!1,themeColor:"",styles:{primary:{backgroundColor:"#74b9ff",color:"#FFFFFF"},intro:{},sendmail:{},closeChat:{}},buttonStyles:{online:{backgroundColor:"rgba(175,229,255)",color:""},offline:{backgroundColor:"rgba(241,241,241)",color:""},timeout:{backgroundColor:"rgba(241,241,241)",color:""},notified:{backgroundColor:"rgba(253,250,129)",color:""},color:"rgb(70,70,70)"},widgetWindowOptions:"left=10,top=10,width=350,height=550,resizable",path:"/ipcc/webchat/",clientPath:"https://cdn.smile-soft.com/wchat/v1/",stylesPath:"",translationsPath:"",host:window.location.host,webrtcEnabled:!1},fe="WchatSettings",pe={initiated:!1,active:!1,state:"",share:!1,sounds:!0},me=[],_e=[],ge=[],he=!1,be=1,ve={initModule:r,initWidgetState:ct,openWidget:X,initChat:E,initCall:W,getWidgetElement:_,isWebrtcSupported:ce.isSupported,getWidgetState:function(){return pe},getEntity:function(){return ne.getState("entity","session")},on:function(t,e){return $t.on(t,e),this},emit:function(t,e){return $t.emit(t,e),this},setDefaultCredentials:function(t){return de.credentials=t,this}};e.exports={module:a,api:ve},n[fe]&&n[fe].autoStart!==!1&&de.autoStart&&("complete"===document.readyState||"interactive"===document.readyState?a(n[fe]):document.addEventListener("DOMContentLoaded",function(){a(n[fe])},!1))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./audio-control":74,"./cobrowsing":75,"./core":76,"./debug":77,"./lodash":78,"./request":80,"./storage":81,"./templates":82,"./webrtc":83,domify:1}]},{},[79])(79)});