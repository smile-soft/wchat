!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Wchat=t()}}(function(){var define,module,exports;return function t(e,n,s){function a(i,o){if(!n[i]){if(!e[i]){var l="function"==typeof require&&require;if(!o&&l)return l(i,!0);if(r)return r(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[i]={exports:{}};e[i][0].call(u.exports,function(t){var n=e[i][1][t];return a(n?n:t)},u,u.exports,t,e,n,s)}return n[i].exports}for(var r="function"==typeof require&&require,i=0;i<s.length;i++)a(s[i]);return a}({1:[function(t,e,n){function s(t,e){if("string"!=typeof t)throw new TypeError("String expected");e||(e=document);var n=/<([\w:]+)/.exec(t);if(!n)return e.createTextNode(t);t=t.replace(/^\s+|\s+$/g,"");var s=n[1];if("body"==s){var a=e.createElement("html");return a.innerHTML=t,a.removeChild(a.lastChild)}var r=i[s]||i._default,o=r[0],l=r[1],c=r[2],a=e.createElement("div");for(a.innerHTML=l+t+c;o--;)a=a.lastChild;if(a.firstChild==a.lastChild)return a.removeChild(a.firstChild);for(var u=e.createDocumentFragment();a.firstChild;)u.appendChild(a.removeChild(a.firstChild));return u}e.exports=s;var a,r=!1;"undefined"!=typeof document&&(a=document.createElement("div"),a.innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>',r=!a.getElementsByTagName("link").length,a=void 0);var i={legend:[1,"<fieldset>","</fieldset>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],_default:r?[1,"X<div>","</div>"]:[0,"",""]};i.td=i.th=[3,"<table><tbody><tr>","</tr></tbody></table>"],i.option=i.optgroup=[1,'<select multiple="multiple">',"</select>"],i.thead=i.tbody=i.colgroup=i.caption=i.tfoot=[1,"<table>","</table>"],i.polyline=i.ellipse=i.polygon=i.circle=i.text=i.line=i.path=i.rect=i.g=[1,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1">',"</svg>"]},{}],2:[function(t,e,n){function s(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function a(t){return"function"==typeof t}function r(t){return"number"==typeof t}function i(t){return"object"==typeof t&&null!==t}function o(t){return void 0===t}e.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._maxListeners=void 0,s.defaultMaxListeners=10,s.prototype.setMaxListeners=function(t){if(!r(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},s.prototype.emit=function(t){var e,n,s,r,l,c;if(this._events||(this._events={}),"error"===t&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[t],o(n))return!1;if(a(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:r=Array.prototype.slice.call(arguments,1),n.apply(this,r)}else if(i(n))for(r=Array.prototype.slice.call(arguments,1),c=n.slice(),s=c.length,l=0;l<s;l++)c[l].apply(this,r);return!0},s.prototype.addListener=function(t,e){var n;if(!a(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,a(e.listener)?e.listener:e),this._events[t]?i(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,i(this._events[t])&&!this._events[t].warned&&(n=o(this._maxListeners)?s.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())),this},s.prototype.on=s.prototype.addListener,s.prototype.once=function(t,e){function n(){this.removeListener(t,n),s||(s=!0,e.apply(this,arguments))}if(!a(e))throw TypeError("listener must be a function");var s=!1;return n.listener=e,this.on(t,n),this},s.prototype.removeListener=function(t,e){var n,s,r,o;if(!a(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],r=n.length,s=-1,n===e||a(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(i(n)){for(o=r;o-- >0;)if(n[o]===e||n[o].listener&&n[o].listener===e){s=o;break}if(s<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(s,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},s.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],a(n))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},s.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?a(this._events[t])?[this._events[t]]:this._events[t].slice():[]},s.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(a(e))return 1;if(e)return e.length}return 0},s.listenerCount=function(t,e){return t.listenerCount(e)}},{}],3:[function(t,e,n){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},{}],4:[function(t,e,n){var s=t("../internal/arrayEach"),a=t("../internal/baseEach"),r=t("../internal/createForEach"),i=r(s,a);e.exports=i},{"../internal/arrayEach":10,"../internal/baseEach":16,"../internal/createForEach":33}],5:[function(t,e,n){var s=t("../internal/getNative"),a=s(Date,"now"),r=a||function(){return(new Date).getTime()};e.exports=r},{"../internal/getNative":40}],6:[function(t,e,n){function s(t,e,n){function s(){h&&clearTimeout(h),p&&clearTimeout(p),v=0,p=h=b=void 0}function l(e,n){n&&clearTimeout(n),p=h=b=void 0,e&&(v=r(),m=t.apply(g,f),h||p||(f=g=void 0))}function c(){var t=e-(r()-_);t<=0||t>e?l(b,p):h=setTimeout(c,t)}function u(){l(x,h)}function d(){if(f=arguments,_=r(),g=this,b=x&&(h||!w),y===!1)var n=w&&!h;else{p||w||(v=_);var s=y-(_-v),a=s<=0||s>y;a?(p&&(p=clearTimeout(p)),v=_,m=t.apply(g,f)):p||(p=setTimeout(u,s))}return a&&h?h=clearTimeout(h):h||e===y||(h=setTimeout(c,e)),n&&(a=!0,m=t.apply(g,f)),!a||h||p||(f=g=void 0),m}var f,p,m,_,g,h,b,v=0,y=!1,x=!0;if("function"!=typeof t)throw new TypeError(i);if(e=e<0?0:+e||0,n===!0){var w=!0;x=!1}else a(n)&&(w=!!n.leading,y="maxWait"in n&&o(+n.maxWait||0,e),x="trailing"in n?!!n.trailing:x);return d.cancel=s,d}var a=t("../lang/isObject"),r=t("../date/now"),i="Expected a function",o=Math.max;e.exports=s},{"../date/now":5,"../lang/isObject":60}],7:[function(t,e,n){function s(t,e){if("function"!=typeof t)throw new TypeError(a);return e=r(void 0===e?t.length-1:+e||0,0),function(){for(var n=arguments,s=-1,a=r(n.length-e,0),i=Array(a);++s<a;)i[s]=n[e+s];switch(e){case 0:return t.call(this,i);case 1:return t.call(this,n[0],i);case 2:return t.call(this,n[0],n[1],i)}var o=Array(e+1);for(s=-1;++s<e;)o[s]=n[s];return o[e]=i,t.apply(this,o)}}var a="Expected a function",r=Math.max;e.exports=s},{}],8:[function(t,e,n){function s(t,e,n){var s=!0,o=!0;if("function"!=typeof t)throw new TypeError(i);return n===!1?s=!1:r(n)&&(s="leading"in n?!!n.leading:s,o="trailing"in n?!!n.trailing:o),a(t,e,{leading:s,maxWait:+e,trailing:o})}var a=t("./debounce"),r=t("../lang/isObject"),i="Expected a function";e.exports=s},{"../lang/isObject":60,"./debounce":6}],9:[function(t,e,n){function s(t,e){var n=-1,s=t.length;for(e||(e=Array(s));++n<s;)e[n]=t[n];return e}e.exports=s},{}],10:[function(t,e,n){function s(t,e){for(var n=-1,s=t.length;++n<s&&e(t[n],n,t)!==!1;);return t}e.exports=s},{}],11:[function(t,e,n){function s(t,e){for(var n=-1,s=t.length;++n<s;)if(e(t[n],n,t))return!0;return!1}e.exports=s},{}],12:[function(t,e,n){function s(t,e,n,s){return void 0!==t&&r.call(s,n)?t:e}var a=Object.prototype,r=a.hasOwnProperty;e.exports=s},{}],13:[function(t,e,n){function s(t,e,n){for(var s=-1,r=a(e),i=r.length;++s<i;){var o=r[s],l=t[o],c=n(l,e[o],o,t,e);(c===c?c===l:l!==l)&&(void 0!==l||o in t)||(t[o]=c)}return t}var a=t("../object/keys");e.exports=s},{"../object/keys":65}],14:[function(t,e,n){function s(t,e){return null==e?t:a(e,r(e),t)}var a=t("./baseCopy"),r=t("../object/keys");e.exports=s},{"../object/keys":65,"./baseCopy":15}],15:[function(t,e,n){function s(t,e,n){n||(n={});for(var s=-1,a=e.length;++s<a;){var r=e[s];n[r]=t[r]}return n}e.exports=s},{}],16:[function(t,e,n){var s=t("./baseForOwn"),a=t("./createBaseEach"),r=a(s);e.exports=r},{"./baseForOwn":19,"./createBaseEach":31}],17:[function(t,e,n){var s=t("./createBaseFor"),a=s();e.exports=a},{"./createBaseFor":32}],18:[function(t,e,n){function s(t,e){return a(t,e,r)}var a=t("./baseFor"),r=t("../object/keysIn");e.exports=s},{"../object/keysIn":66,"./baseFor":17}],19:[function(t,e,n){function s(t,e){return a(t,e,r)}var a=t("./baseFor"),r=t("../object/keys");e.exports=s},{"../object/keys":65,"./baseFor":17}],20:[function(t,e,n){function s(t,e,n,o,l,c){return t===e||(null==t||null==e||!r(t)&&!i(e)?t!==t&&e!==e:a(t,e,s,n,o,l,c))}var a=t("./baseIsEqualDeep"),r=t("../lang/isObject"),i=t("./isObjectLike");e.exports=s},{"../lang/isObject":60,"./baseIsEqualDeep":21,"./isObjectLike":45}],21:[function(t,e,n){function s(t,e,n,s,f,_,g){var h=o(t),b=o(e),v=u,y=u;h||(v=m.call(t),v==c?v=d:v!=d&&(h=l(t))),b||(y=m.call(e),y==c?y=d:y!=d&&(b=l(e)));var x=v==d,w=y==d,k=v==y;if(k&&!h&&!x)return r(t,e,v);if(!f){var E=x&&p.call(t,"__wrapped__"),S=w&&p.call(e,"__wrapped__");if(E||S)return n(E?t.value():t,S?e.value():e,s,f,_,g)}if(!k)return!1;_||(_=[]),g||(g=[]);for(var C=_.length;C--;)if(_[C]==t)return g[C]==e;_.push(t),g.push(e);var L=(h?a:i)(t,e,n,s,f,_,g);return _.pop(),g.pop(),L}var a=t("./equalArrays"),r=t("./equalByTag"),i=t("./equalObjects"),o=t("../lang/isArray"),l=t("../lang/isTypedArray"),c="[object Arguments]",u="[object Array]",d="[object Object]",f=Object.prototype,p=f.hasOwnProperty,m=f.toString;e.exports=s},{"../lang/isArray":55,"../lang/isTypedArray":62,"./equalArrays":34,"./equalByTag":35,"./equalObjects":36}],22:[function(t,e,n){function s(t,e,n,f,p){if(!l(t))return t;var m=o(e)&&(i(e)||u(e)),_=m?void 0:d(e);return a(_||e,function(a,i){if(_&&(i=a,a=e[i]),c(a))f||(f=[]),p||(p=[]),r(t,e,i,s,n,f,p);else{var o=t[i],l=n?n(o,a,i,t,e):void 0,u=void 0===l;u&&(l=a),void 0===l&&(!m||i in t)||!u&&(l===l?l===o:o!==o)||(t[i]=l)}}),t}var a=t("./arrayEach"),r=t("./baseMergeDeep"),i=t("../lang/isArray"),o=t("./isArrayLike"),l=t("../lang/isObject"),c=t("./isObjectLike"),u=t("../lang/isTypedArray"),d=t("../object/keys");e.exports=s},{"../lang/isArray":55,"../lang/isObject":60,"../lang/isTypedArray":62,"../object/keys":65,"./arrayEach":10,"./baseMergeDeep":23,"./isArrayLike":41,"./isObjectLike":45}],23:[function(t,e,n){function s(t,e,n,s,d,f,p){for(var m=f.length,_=e[n];m--;)if(f[m]==_)return void(t[n]=p[m]);var g=t[n],h=d?d(g,_,n,t,e):void 0,b=void 0===h;b&&(h=_,o(_)&&(i(_)||c(_))?h=i(g)?g:o(g)?a(g):[]:l(_)||r(_)?h=r(g)?u(g):l(g)?g:{}:b=!1),f.push(_),p.push(h),b?t[n]=s(h,_,d,f,p):(h===h?h!==g:g===g)&&(t[n]=h)}var a=t("./arrayCopy"),r=t("../lang/isArguments"),i=t("../lang/isArray"),o=t("./isArrayLike"),l=t("../lang/isPlainObject"),c=t("../lang/isTypedArray"),u=t("../lang/toPlainObject");e.exports=s},{"../lang/isArguments":54,"../lang/isArray":55,"../lang/isPlainObject":61,"../lang/isTypedArray":62,"../lang/toPlainObject":63,"./arrayCopy":9,"./isArrayLike":41}],24:[function(t,e,n){function s(t){return function(e){return null==e?void 0:e[t]}}e.exports=s},{}],25:[function(t,e,n){function s(t){return null==t?"":t+""}e.exports=s},{}],26:[function(t,e,n){function s(t,e){for(var n=-1,s=e.length,a=Array(s);++n<s;)a[n]=t[e[n]];return a}e.exports=s},{}],27:[function(t,e,n){function s(t,e,n){if("function"!=typeof t)return a;if(void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,s,a){return t.call(e,n,s,a)};case 4:return function(n,s,a,r){return t.call(e,n,s,a,r)};case 5:return function(n,s,a,r,i){return t.call(e,n,s,a,r,i)}}return function(){return t.apply(e,arguments)}}var a=t("../utility/identity");e.exports=s},{"../utility/identity":73}],28:[function(t,e,n){function s(t,e){for(var n=-1,s=t.length;++n<s&&e.indexOf(t.charAt(n))>-1;);return n}e.exports=s},{}],29:[function(t,e,n){function s(t,e){for(var n=t.length;n--&&e.indexOf(t.charAt(n))>-1;);return n}e.exports=s},{}],30:[function(t,e,n){function s(t){return i(function(e,n){var s=-1,i=null==e?0:n.length,o=i>2?n[i-2]:void 0,l=i>2?n[2]:void 0,c=i>1?n[i-1]:void 0;for("function"==typeof o?(o=a(o,c,5),i-=2):(o="function"==typeof c?c:void 0,i-=o?1:0),l&&r(n[0],n[1],l)&&(o=i<3?void 0:o,i=1);++s<i;){var u=n[s];u&&t(e,u,o)}return e})}var a=t("./bindCallback"),r=t("./isIterateeCall"),i=t("../function/restParam");e.exports=s},{"../function/restParam":7,"./bindCallback":27,"./isIterateeCall":43}],31:[function(t,e,n){function s(t,e){return function(n,s){var o=n?a(n):0;if(!r(o))return t(n,s);for(var l=e?o:-1,c=i(n);(e?l--:++l<o)&&s(c[l],l,c)!==!1;);return n}}var a=t("./getLength"),r=t("./isLength"),i=t("./toObject");e.exports=s},{"./getLength":39,"./isLength":44,"./toObject":51}],32:[function(t,e,n){function s(t){return function(e,n,s){for(var r=a(e),i=s(e),o=i.length,l=t?o:-1;t?l--:++l<o;){var c=i[l];if(n(r[c],c,r)===!1)break}return e}}var a=t("./toObject");e.exports=s},{"./toObject":51}],33:[function(t,e,n){function s(t,e){return function(n,s,i){return"function"==typeof s&&void 0===i&&r(n)?t(n,s):e(n,a(s,i,3))}}var a=t("./bindCallback"),r=t("../lang/isArray");e.exports=s},{"../lang/isArray":55,"./bindCallback":27}],34:[function(t,e,n){function s(t,e,n,s,r,i,o){var l=-1,c=t.length,u=e.length;if(c!=u&&!(r&&u>c))return!1;for(;++l<c;){var d=t[l],f=e[l],p=s?s(r?f:d,r?d:f,l):void 0;if(void 0!==p){if(p)continue;return!1}if(r){if(!a(e,function(t){return d===t||n(d,t,s,r,i,o)}))return!1}else if(d!==f&&!n(d,f,s,r,i,o))return!1}return!0}var a=t("./arraySome");e.exports=s},{"./arraySome":11}],35:[function(t,e,n){function s(t,e,n){switch(n){case a:case r:return+t==+e;case i:return t.name==e.name&&t.message==e.message;case o:return t!=+t?e!=+e:t==+e;case l:case c:return t==e+""}return!1}var a="[object Boolean]",r="[object Date]",i="[object Error]",o="[object Number]",l="[object RegExp]",c="[object String]";e.exports=s},{}],36:[function(t,e,n){function s(t,e,n,s,r,o,l){var c=a(t),u=c.length,d=a(e),f=d.length;if(u!=f&&!r)return!1;for(var p=u;p--;){var m=c[p];if(!(r?m in e:i.call(e,m)))return!1}for(var _=r;++p<u;){m=c[p];var g=t[m],h=e[m],b=s?s(r?h:g,r?g:h,m):void 0;if(!(void 0===b?n(g,h,s,r,o,l):b))return!1;_||(_="constructor"==m)}if(!_){var v=t.constructor,y=e.constructor;if(v!=y&&"constructor"in t&&"constructor"in e&&!("function"==typeof v&&v instanceof v&&"function"==typeof y&&y instanceof y))return!1}return!0}var a=t("../object/keys"),r=Object.prototype,i=r.hasOwnProperty;e.exports=s},{"../object/keys":65}],37:[function(t,e,n){function s(t){return a[t]}var a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"};e.exports=s},{}],38:[function(t,e,n){function s(t){return"\\"+a[t]}var a={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};e.exports=s},{}],39:[function(t,e,n){var s=t("./baseProperty"),a=s("length");e.exports=a},{"./baseProperty":24}],40:[function(t,e,n){function s(t,e){var n=null==t?void 0:t[e];return a(n)?n:void 0}var a=t("../lang/isNative");e.exports=s},{"../lang/isNative":59}],41:[function(t,e,n){function s(t){return null!=t&&r(a(t))}var a=t("./getLength"),r=t("./isLength");e.exports=s},{"./getLength":39,"./isLength":44}],42:[function(t,e,n){function s(t,e){return t="number"==typeof t||a.test(t)?+t:-1,e=null==e?r:e,t>-1&&t%1==0&&t<e}var a=/^\d+$/,r=9007199254740991;e.exports=s},{}],43:[function(t,e,n){function s(t,e,n){if(!i(n))return!1;var s=typeof e;if("number"==s?a(n)&&r(e,n.length):"string"==s&&e in n){var o=n[e];return t===t?t===o:o!==o}return!1}var a=t("./isArrayLike"),r=t("./isIndex"),i=t("../lang/isObject");e.exports=s},{"../lang/isObject":60,"./isArrayLike":41,"./isIndex":42}],44:[function(t,e,n){function s(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=a}var a=9007199254740991;e.exports=s},{}],45:[function(t,e,n){function s(t){return!!t&&"object"==typeof t}e.exports=s},{}],46:[function(t,e,n){function s(t){return t<=160&&t>=9&&t<=13||32==t||160==t||5760==t||6158==t||t>=8192&&(t<=8202||8232==t||8233==t||8239==t||8287==t||12288==t||65279==t)}e.exports=s},{}],47:[function(t,e,n){var s=/<%-([\s\S]+?)%>/g;e.exports=s},{}],48:[function(t,e,n){var s=/<%([\s\S]+?)%>/g;e.exports=s},{}],49:[function(t,e,n){var s=/<%=([\s\S]+?)%>/g;e.exports=s},{}],50:[function(t,e,n){function s(t){for(var e=l(t),n=e.length,s=n&&t.length,c=!!s&&o(s)&&(r(t)||a(t)),d=-1,f=[];++d<n;){var p=e[d];(c&&i(p,s)||u.call(t,p))&&f.push(p)}return f}var a=t("../lang/isArguments"),r=t("../lang/isArray"),i=t("./isIndex"),o=t("./isLength"),l=t("../object/keysIn"),c=Object.prototype,u=c.hasOwnProperty;e.exports=s},{"../lang/isArguments":54,"../lang/isArray":55,"../object/keysIn":66,"./isIndex":42,"./isLength":44}],51:[function(t,e,n){function s(t){return a(t)?t:Object(t)}var a=t("../lang/isObject");e.exports=s},{"../lang/isObject":60}],52:[function(t,e,n){function s(t){for(var e=-1,n=t.length;++e<n&&a(t.charCodeAt(e)););return e}var a=t("./isSpace");e.exports=s},{"./isSpace":46}],53:[function(t,e,n){function s(t){for(var e=t.length;e--&&a(t.charCodeAt(e)););return e}var a=t("./isSpace");e.exports=s},{"./isSpace":46}],54:[function(t,e,n){function s(t){return r(t)&&a(t)&&o.call(t,"callee")&&!l.call(t,"callee")}var a=t("../internal/isArrayLike"),r=t("../internal/isObjectLike"),i=Object.prototype,o=i.hasOwnProperty,l=i.propertyIsEnumerable;e.exports=s},{"../internal/isArrayLike":41,"../internal/isObjectLike":45}],55:[function(t,e,n){var s=t("../internal/getNative"),a=t("../internal/isLength"),r=t("../internal/isObjectLike"),i="[object Array]",o=Object.prototype,l=o.toString,c=s(Array,"isArray"),u=c||function(t){return r(t)&&a(t.length)&&l.call(t)==i};e.exports=u},{"../internal/getNative":40,"../internal/isLength":44,"../internal/isObjectLike":45}],56:[function(t,e,n){function s(t,e,n,s){n="function"==typeof n?r(n,s,3):void 0;var i=n?n(t,e):void 0;return void 0===i?a(t,e,n):!!i}var a=t("../internal/baseIsEqual"),r=t("../internal/bindCallback");e.exports=s},{"../internal/baseIsEqual":20,"../internal/bindCallback":27}],57:[function(t,e,n){function s(t){return a(t)&&"string"==typeof t.message&&o.call(t)==r}var a=t("../internal/isObjectLike"),r="[object Error]",i=Object.prototype,o=i.toString;e.exports=s},{"../internal/isObjectLike":45}],58:[function(t,e,n){function s(t){return a(t)&&o.call(t)==r}var a=t("./isObject"),r="[object Function]",i=Object.prototype,o=i.toString;e.exports=s},{"./isObject":60}],59:[function(t,e,n){function s(t){return null!=t&&(a(t)?u.test(l.call(t)):r(t)&&i.test(t))}var a=t("./isFunction"),r=t("../internal/isObjectLike"),i=/^\[object .+?Constructor\]$/,o=Object.prototype,l=Function.prototype.toString,c=o.hasOwnProperty,u=RegExp("^"+l.call(c).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=s},{"../internal/isObjectLike":45,"./isFunction":58}],60:[function(t,e,n){function s(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}e.exports=s},{}],61:[function(t,e,n){function s(t){var e;if(!i(t)||u.call(t)!=o||r(t)||!c.call(t,"constructor")&&(e=t.constructor,"function"==typeof e&&!(e instanceof e)))return!1;var n;return a(t,function(t,e){n=e}),void 0===n||c.call(t,n)}var a=t("../internal/baseForIn"),r=t("./isArguments"),i=t("../internal/isObjectLike"),o="[object Object]",l=Object.prototype,c=l.hasOwnProperty,u=l.toString;e.exports=s},{"../internal/baseForIn":18,"../internal/isObjectLike":45,"./isArguments":54}],62:[function(t,e,n){function s(t){return r(t)&&a(t.length)&&!!O[T.call(t)]}var a=t("../internal/isLength"),r=t("../internal/isObjectLike"),i="[object Arguments]",o="[object Array]",l="[object Boolean]",c="[object Date]",u="[object Error]",d="[object Function]",f="[object Map]",p="[object Number]",m="[object Object]",_="[object RegExp]",g="[object Set]",h="[object String]",b="[object WeakMap]",v="[object ArrayBuffer]",y="[object Float32Array]",x="[object Float64Array]",w="[object Int8Array]",k="[object Int16Array]",E="[object Int32Array]",S="[object Uint8Array]",C="[object Uint8ClampedArray]",L="[object Uint16Array]",A="[object Uint32Array]",O={};O[y]=O[x]=O[w]=O[k]=O[E]=O[S]=O[C]=O[L]=O[A]=!0,O[i]=O[o]=O[v]=O[l]=O[c]=O[u]=O[d]=O[f]=O[p]=O[m]=O[_]=O[g]=O[h]=O[b]=!1;var j=Object.prototype,T=j.toString;e.exports=s},{"../internal/isLength":44,"../internal/isObjectLike":45}],63:[function(t,e,n){function s(t){return a(t,r(t))}var a=t("../internal/baseCopy"),r=t("../object/keysIn");e.exports=s},{"../internal/baseCopy":15,"../object/keysIn":66}],64:[function(t,e,n){var s=t("../internal/assignWith"),a=t("../internal/baseAssign"),r=t("../internal/createAssigner"),i=r(function(t,e,n){return n?s(t,e,n):a(t,e)});e.exports=i},{"../internal/assignWith":13,"../internal/baseAssign":14,"../internal/createAssigner":30}],65:[function(t,e,n){var s=t("../internal/getNative"),a=t("../internal/isArrayLike"),r=t("../lang/isObject"),i=t("../internal/shimKeys"),o=s(Object,"keys"),l=o?function(t){var e=null==t?void 0:t.constructor;return"function"==typeof e&&e.prototype===t||"function"!=typeof t&&a(t)?i(t):r(t)?o(t):[]}:i;e.exports=l},{"../internal/getNative":40,"../internal/isArrayLike":41,"../internal/shimKeys":50,"../lang/isObject":60}],66:[function(t,e,n){function s(t){if(null==t)return[];l(t)||(t=Object(t));var e=t.length;e=e&&o(e)&&(r(t)||a(t))&&e||0;for(var n=t.constructor,s=-1,c="function"==typeof n&&n.prototype===t,d=Array(e),f=e>0;++s<e;)d[s]=s+"";for(var p in t)f&&i(p,e)||"constructor"==p&&(c||!u.call(t,p))||d.push(p);return d}var a=t("../lang/isArguments"),r=t("../lang/isArray"),i=t("../internal/isIndex"),o=t("../internal/isLength"),l=t("../lang/isObject"),c=Object.prototype,u=c.hasOwnProperty;e.exports=s},{"../internal/isIndex":42,"../internal/isLength":44,"../lang/isArguments":54,"../lang/isArray":55,"../lang/isObject":60}],67:[function(t,e,n){var s=t("../internal/baseMerge"),a=t("../internal/createAssigner"),r=a(s);e.exports=r},{"../internal/baseMerge":22,"../internal/createAssigner":30}],68:[function(t,e,n){function s(t){return t=a(t),t&&o.test(t)?t.replace(i,r):t}var a=t("../internal/baseToString"),r=t("../internal/escapeHtmlChar"),i=/[&<>"'`]/g,o=RegExp(i.source);e.exports=s},{"../internal/baseToString":25,"../internal/escapeHtmlChar":37}],69:[function(t,e,n){function s(t,e,n){var s=_.imports._.templateSettings||_;n&&f(t,e,n)&&(e=n=void 0),t=l(t),e=r(o({},n||e),s,a);var w,k,E=r(o({},e.imports),s.imports,a),S=p(E),C=c(E,S),L=0,A=e.interpolate||y,O="__p += '",j=RegExp((e.escape||y).source+"|"+A.source+"|"+(A===m?v:y).source+"|"+(e.evaluate||y).source+"|$","g"),T="sourceURL"in e?"//# sourceURL="+e.sourceURL+"\n":"";t.replace(j,function(e,n,s,a,r,i){return s||(s=a),O+=t.slice(L,i).replace(x,u),n&&(w=!0,O+="' +\n__e("+n+") +\n'"),r&&(k=!0,O+="';\n"+r+";\n__p += '"),s&&(O+="' +\n((__t = ("+s+")) == null ? '' : __t) +\n'"),L=i+e.length,e}),O+="';\n";var I=e.variable;I||(O="with (obj) {\n"+O+"\n}\n"),O=(k?O.replace(g,""):O).replace(h,"$1").replace(b,"$1;"),O="function("+(I||"obj")+") {\n"+(I?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(w?", __e = _.escape":"")+(k?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+O+"return __p\n}";var N=i(function(){return Function(S,T+"return "+O).apply(void 0,C)});if(N.source=O,d(N))throw N;return N}var a=t("../internal/assignOwnDefaults"),r=t("../internal/assignWith"),i=t("../utility/attempt"),o=t("../internal/baseAssign"),l=t("../internal/baseToString"),c=t("../internal/baseValues"),u=t("../internal/escapeStringChar"),d=t("../lang/isError"),f=t("../internal/isIterateeCall"),p=t("../object/keys"),m=t("../internal/reInterpolate"),_=t("./templateSettings"),g=/\b__p \+= '';/g,h=/\b(__p \+=) '' \+/g,b=/(__e\(.*?\)|\b__t\)) \+\n'';/g,v=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,y=/($^)/,x=/['\n\r\u2028\u2029\\]/g;e.exports=s},{"../internal/assignOwnDefaults":12,"../internal/assignWith":13,"../internal/baseAssign":14,"../internal/baseToString":25,"../internal/baseValues":26,"../internal/escapeStringChar":38,"../internal/isIterateeCall":43,"../internal/reInterpolate":49,"../lang/isError":57,"../object/keys":65,"../utility/attempt":72,"./templateSettings":70}],70:[function(t,e,n){var s=t("./escape"),a=t("../internal/reEscape"),r=t("../internal/reEvaluate"),i=t("../internal/reInterpolate"),o={escape:a,evaluate:r,interpolate:i,variable:"",imports:{_:{escape:s}}};e.exports=o},{"../internal/reEscape":47,"../internal/reEvaluate":48,"../internal/reInterpolate":49,"./escape":68}],71:[function(t,e,n){function s(t,e,n){var s=t;return(t=a(t))?(n?o(s,e,n):null==e)?t.slice(l(t),c(t)+1):(e+="",t.slice(r(t,e),i(t,e)+1)):t}var a=t("../internal/baseToString"),r=t("../internal/charsLeftIndex"),i=t("../internal/charsRightIndex"),o=t("../internal/isIterateeCall"),l=t("../internal/trimmedLeftIndex"),c=t("../internal/trimmedRightIndex");e.exports=s},{"../internal/baseToString":25,"../internal/charsLeftIndex":28,"../internal/charsRightIndex":29,"../internal/isIterateeCall":43,"../internal/trimmedLeftIndex":52,"../internal/trimmedRightIndex":53}],72:[function(t,e,n){var s=t("../lang/isError"),a=t("../function/restParam"),r=a(function(t,e){try{return t.apply(void 0,e)}catch(n){return s(n)?n:new Error(n)}});e.exports=r},{"../function/restParam":7,"../lang/isError":57}],73:[function(t,e,n){function s(t){return t}e.exports=s},{}],74:[function(t,e,n){var s,a="",r="wav",i=.5;e.exports={init:function(t){return s=document.createElement("audio"),s.setAttribute("autoplay",!0),t&&(a=t),this},play:function(t,e){t&&(s.src=a+t+"."+r),e?s.setAttribute("loop",!0):s.removeAttribute("loop"),s.volume=i,s.play()},stop:function(){s.pause(),s.currentTime=0}}},{}],75:[function(t,e,n){function s(){return C}function a(t){return C?E.info("Cobrowsing already initiated"):(b(document,"keyup",f),b(document,"keydown",f),b(document,"keypress",f),b(document,"mouseup",f),b(document,"click",f),b(document,"change",f),y="string"==typeof t.widget?document.querySelector(t.widget):t.widget,O=t.entity,x=t.emit,j=t.path,C=!0,E.log("cobrowsing module initiated with parameters: ",t),void x("cobrowsing/init"))}function r(){return L?E.info("Browser already shared"):(b(document,"scroll",f),b(document,"select",f),b(document,"mousemove",f),o(),L=!0,E.log("browser shared"),void x("cobrowsing/shared",{entity:O}))}function i(){return L?(v(document,"scroll",f),v(document,"select",f),v(document,"mousemove",f),c(),L=!1,x("cobrowsing/unshared",{entity:O}),void E.log("browser unshared")):E.info("Browser already unshared")}function o(){var t=document.body;A||(A=document.createElement("img"),A.className="wc-rmt-ptr",A.setAttribute("src",j+"images/pointer.png"),A.style.position="absolute",t.firstChild?t.insertBefore(A,t.firstChild):t.appendChild(A),l())}function l(){A.style.left=N,A.style.top=R,w=window.requestAnimationFrame(l)}function c(){A&&(cancelAnimationFrame(w),A.parentNode.removeChild(A),A=null)}function u(t){var e=0;if(document.selection){t.focus();var n=document.selection.createRange();n.moveStart("character",-t.value.length),e=n.text.length}else e=(!t.type||"email"!==t.type&&"number"!==t.type)&&(t.selectionStart||"0"==t.selectionStart)?t.selectionStart:null;return e}function d(t){x("cobrowsing/event",{entity:O,events:t})}function f(t){var e=t||window.event,n=e.type,s=e.target,a=s.nodeName,r=document.body,i={},o=null,l=document.getElementsByTagName(s.nodeName),c=document.documentElement.scrollTop||document.body.scrollTop,d=document.documentElement.scrollLeft||document.body.scrollLeft,f=0;if(3===s.nodeType&&(s=s.parentNode),"user"!==O||!h(y,s)){for(f=0;f<S.length;f++)if(S[f].event==n)return void S.splice(f,1);for(f=0;f<l.length;f++)l[f]==s&&(o=f);if(i.event=n,i.entity=O,i.tn=a,i.tni=o,i.w=r.offsetWidth,i.h=r.offsetHeight,i.sx=d,i.sy=c,"mousemove"===n||"mouseover"===n||"mouseout"===n){var p=e.pageX||e.clientX+c,m=e.pageY||e.clientY+d;i.x=p,i.y=m}else if("scroll"===n);else if("keyup"==n||"keydown"==n||"keypress"==n){var _=e.charCode||e.keyCode||e.which,g=u(s);if("INPUT"===a&&"password"===s.type)return;if("keyup"==n){if(null!==g&&(86!=_||!e.metaKey&&!e.ctrlKey))return;var b=s.value;b&&(b=b.replace(/\n/g,"<br>"),i.value=b)}else if("keydown"==n){if(null===g||8!=_&&46!=_&&190!=_)return;if(!s.value)return;i.pos=g,i.code=_}else if("keypress"===n){if(null===g||8==_||46==_)return;i.pos=g,i.code=_}}else if("change"===n){if("INPUT"===a&&"password"===s.type)return;i.value=s.value}else if("mouseup"==n||"select"==n){var v=window.getSelection()||document.selection.createRange().text,x=v.anchorOffset,w=v.focusOffset,k=0,E="",C=0,L="",A=0,j="",T=0,N="",R=!1;if(null!==v.anchorNode){for(L=v.anchorNode.parentNode,f=0;f<L.childNodes.length;f++)L.childNodes[f]==v.anchorNode&&(C=f);for(E=L.nodeName.toLowerCase(),l=document.getElementsByTagName(E),f=0;f<l.length;f++)l[f]===L&&(k=f);for(N=v.focusNode.parentNode,f=0;f<N.childNodes.length;f++)N.childNodes[f]==v.focusNode&&(T=f);for(j=N.nodeName.toLowerCase(),l=document.getElementsByTagName(j),f=0;f<l.length;f++)l[f]===N&&(A=f);E===j&&k===A&&C===T&&x>w&&(R=!0),i.sn=E,i.sni=k,i.schi=C,i.en=j,i.eni=A,i.echi=T,i.so=R?w:x,i.eo=R?x:w}}else"click"==n&&(i.scx=e.screenX,i.scy=e.screenY);I(i)}}function p(t){var e,n=document.documentElement,s={};if(t.events){if(s=t.events,s.timestamp<T)return;if(s.entity===O)return;if(s.url){var a=s.url,r=document.URL;r.indexOf("chatSessionId")!==-1&&(r=r.substr(0,r.indexOf("chatSessionId")-1)),a!=r&&g(a)}if(s.w&&"user"===s.entity){var i=document.body,o=i.offsetWidth;o!==s.w&&(document.body.style.width=s.w+"px")}if("mousemove"===s.event)A&&(N=s.x+"px",R=s.y+"px");else if("scroll"===s.event)void 0!==s.tn&&(e="#document"===s.tn?n:document.getElementsByTagName(s.tn)[s.tni],e&&(e.scrollTop=s.sy,e.scrollLeft=s.sx),console.log("scroll event: ",e,s.sy));else if("mouseup"===s.event||"select"===s.event){if(s.sn){var l=document.getElementsByTagName(s.sn)[s.sni],c=document.getElementsByTagName(s.en)[s.eni];if(document.createRange&&void 0!==l&&void 0!==c){var u=document.createRange();u.setStart(l.childNodes[s.schi],s.so),u.setEnd(c.childNodes[s.echi],s.eo);var d=window.getSelection();d.removeAllRanges(),d.addRange(u)}}}else if("keyup"===s.event||"keydown"===s.event||"keypress"===s.event){if(void 0!==s.tn&&void 0!==s.tni&&(e=document.getElementsByTagName(s.tn)[s.tni])){var f,p=e.value;if(8==s.code){if(s.pos==p.length-1)f=p.substr(0,s.pos-1);else{if(0===s.pos)return;f=p.substr(0,s.pos-1)+p.substr(s.pos)}e.value=f}else if(46==s.code)f=p.substr(0,s.pos)+p.substr(s.pos+1),e.value=f;else if(190==s.code)f=p.substr(0,s.pos)+"."+p.substr(s.pos),e.value=f;else if(void 0!==s.value){var h=s.value;h=h.replace(/<br>/g,"\n"),e.value=h}else{var b=String.fromCharCode(s.code);f=p?p.substr(0,s.pos)+b+p.substr(s.pos):b,e.value=f}}}else if("change"===s.event)e=document.getElementsByTagName(s.tn)[s.tni],e.value=s.value;else if("click"===s.event)e=document.getElementsByTagName(s.tn)[s.tni],e&&e.click();else if(e=document.getElementsByTagName(s.tn)[s.tni]){var v=m(s.event,s.x,s.y,s.x,s.y);_(e,v)}"click"!==s.event&&"scroll"!==s.event||S.push(s);
}t.timestamp&&(T=t.timestamp)}function m(t,e,n,s,a){var r,i={bubbles:!0,cancelable:"mousemove"!=t,view:window,detail:0,screenX:e,screenY:n,clientX:s,clientY:a,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:void 0};if("function"==typeof document.createEvent)r=document.createEvent("MouseEvents"),r.initMouseEvent(t,i.bubbles,i.cancelable,i.view,i.detail,i.screenX,i.screenY,i.clientX,i.clientY,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.button,document.body.parentNode);else if(document.createEventObject){r=document.createEventObject();for(var o in i)r[o]=i[o];r.button={0:1,1:4,2:2}[r.button]||r.button}return r}function _(t,e){return t.dispatchEvent?t.dispatchEvent(e):t.fireEvent&&t.fireEvent("on"+type,e),e}function g(t){var e=document.URL;e!==t&&(document.location.href=t)}function h(t,e){for(var n=e.parentNode;null!=n;){if(n==t)return!0;n=n.parentNode}return!1}function b(t,e,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent&&t.attachEvent("on"+e,n)}function v(t,e,n){t.removeEventListener?t.removeEventListener(e,n,!1):t.detachEvent&&t.detachEvent("on"+e,n)}var y,x,w,k=t("./lodash"),E=t("./debug"),S=[],C=!1,L=!1,A=null,O="",j="",T=0,I=k.throttle(d,100,{trailing:!0,leading:!0}),N=0,R=0;e.exports={init:a,isInitiated:s,share:r,unshare:i,emitEvents:d,updateEvents:p}},{"./debug":77,"./lodash":78}],76:[function(t,e,n){(function(n){function s(t){return this.options=t||{},this.options.serverUrl=this.options.server+"/ipcc/$$$",this.session={},this.options.wsServer||this.options.pageid?(g=(this.options.wsServer?this.options.wsServer:_)+this.options.pageid,this.on("session/create",this.onSessionCreate.bind(this)),this.on("Error",this.onError),this.createWebsocket(),this):console.error("Cannot initiate module: pageid is undefined")}function a(t){var e=1e3*(Math.pow(2,t)-1);return e>3e4&&(e=3e4),Math.random()*e}function r(t){var e=t;return"ua"===t?e="uk":"us"!==t&&"gb"!==t||(e="en"),e}function i(t){var e=new FormData;return Object.keys(t).map(function(n){if("file"===n)e.append(n,t[n],t.filename||"");else{if("filename"===n)return n;e.append(n,t[n])}return n}),u.log("toFormData: ",t,e.get("filename")),e}var o=t("events").EventEmitter,l=t("./storage"),c=t("./request"),u=t("./debug"),d=n.location,f=t("./lodash"),p=t("inherits"),m=1,_="main.ringotel.net/chatbot/WebChat/",g="",h=!1,b=null;p(s,o),e.exports=s,s.prototype.onError=function(t){u.log("Error: ",t)},s.prototype.onSessionCreate=function(t){this.session=f.merge(this.session,t),l.saveState("sid",t.sid)},s.prototype.setSessionTimeout=function(){var t=this.session.sessionTimeout;clearTimeout(b),t&&(b=setTimeout(this.onSessionTimeout.bind(this),1e3*t))},s.prototype.onSessionTimeout=function(){this.emit("session/timeout")},s.prototype.sendData=function(t){this.websocket&&this.websocket.send(JSON.stringify(t))},s.prototype.onWebsocketMessage=function(t){var e=JSON.parse(t.data);e.method;if(e.method)if("session"===e.method)this.emit("session/create",e.params);else if("messages"===e.method)e.params.list&&e.params.list.map(function(t){return this.emit("message/new",t),t}.bind(this));else if("message"===e.method)e.params.typing?this.emit("message/typing"):(this.emit("message/new",e.params),this.setSessionTimeout());else if("openShare"===e.method){if(this.session.sharedId===e.params.id)return;if(e.params.url&&d.href!==e.params.url)return window.location=e.params.url;e.params.id&&(this.session.sharedId=e.params.id,this.emit("session/joined",{url:d.href}),this.shareOpened(e.params.id,d.href))}else"shareOpened"===e.method?e.params.id&&(this.session.sharedId=e.params.id,this.emit("session/joined",{url:d.href})):"shareClosed"===e.method?(clearInterval(this.openShareInteval),this.session.sharedId="",this.emit("session/disjoin")):"events"===e.method&&this.emit("cobrowsing/update",e.params)},s.prototype.init=function(){h=!0;var t=l.getState("entity","session"),e=l.getState("sid");if(strIndex=d.href.indexOf("chatSessionId"),u.log("initModule: ",this.session,t,e),strIndex!==-1){e=this.getSidFromUrl(d.href),t="agent";var n=d.href.substr(0,strIndex);n="?"===n[n.length-1]?n.substr(0,n.length-1):n,l.saveState("sid",e),this.joinSession(n)}else"agent"===t?(e=l.getState("sid"),this.joinSession(d.href)):(t="user",this.createSession({sid:e,url:d.href}));this.session.sid=e,this.session.entity=t,l.saveState("entity",t,"session")},s.prototype.createSession=function(t){var e={method:"createSession",params:{url:t.url||d.href,lang:this.detectLanguage()}};return t.sid&&(e.params.sid=t.sid),this.websocket?this.sendData(e):void c.post(this.options.serverUrl,e,function(e,n){return e?void this.emit("Error",e,{method:"createSession",params:t}):void this.emit("session/create",n.result)}.bind(this))},s.prototype.joinSession=function(t){this.openShareInteval=setInterval(function(){this.openShare(t)}.bind(this),3e3),n.onclose=function(){this.shareClosed()}.bind(this)},s.prototype.updateEvents=function(t,e){if(this.session.sharedId)return data={method:"events",params:{sid:this.session.sid,id:this.session.sharedId,timestamp:l.getState("eventTimestamp","cache"),events:t}},this.websocket?this.sendData(data):void c.post(this.options.serverUrl,data,function(t,n){return t?(this.emit("Error",t,data),e(t)):void(n.result.timestamp>l.getState("eventTimestamp","cache")?(l.saveState("eventTimestamp",n.result.timestamp,"cache"),e&&e(null,n.result)):e&&e(null,{events:[]}))}.bind(this))},s.prototype.getLanguages=function(t){u.log("this.session: ",this.session),t(null,this.session.langs)},s.prototype.chatRequest=function(t,e){t.sid=this.session.sid,u.log("chatRequest params: ",t);var n={method:"chatRequest",params:t};return this.setSessionTimeout(),this.websocket?this.sendData(n):void c.post(this.options.serverUrl,n,function(n,s){return n?(this.emit("Error",n,{method:"chatRequest",params:t}),void(e&&e(n))):(t.url=d.href,this.emit("chat/start",f.merge(t,s.result)),void(e&&e(null,s)))}.bind(this))},s.prototype.getMessages=function(t){c.post(this.options.serverUrl,{method:"getMessages",params:{sid:this.session.sid,timestamp:l.getState("msgTimestamp")}},function(e,n){return e?(this.emit("Error",e,{method:"getMessages"}),t(e)):(n.result.timestamp>l.getState("msgTimestamp")&&(l.saveState("msgTimestamp",n.result.timestamp),n.result.messages&&this.emit("message/new",n.result)),n.result.typing&&this.emit("message/typing",n.result),void(t&&t(null,n.result)))}.bind(this))},s.prototype.closeChat=function(t){var e={method:"closeChat",params:{sid:this.session.sid}};return t&&(e.params.rating=t),this.websocket?this.sendData(e):void c.post(this.options.serverUrl,e,function(n,s){return n?void this.emit("Error",n,e):(l.saveState("chat",!1),void this.emit("chat/close",{rating:t,url:d.href}))}.bind(this))},s.prototype.sendMessage=function(t,e){var n={method:"message",params:{sid:this.session.sid,content:t.message}};if(this.setSessionTimeout(),this.websocket)return void(t.file?(n=i({file:t.file,filename:t.message,sid:this.session.sid}),c.upload("https://"+g,n,function(t,e){console.error("sendMessage: ",t,e)})):(n.params.content=t.message,this.sendData(n)))},s.prototype.sendEmail=function(t,e){t.sid=this.session.sid;var n={method:"sendMail",params:t};return this.websocket?this.sendData(n):void c.post(this.options.serverUrl,n,function(n,s){return n?(this.emit("Error",n,{method:"sendEmail",params:t}),void(e&&e(n))):(this.emit("chat/send",t),void(e&&e(null,s)))}.bind(this))},s.prototype.requestCallback=function(t,e){t.sid=this.session.sid;var n={method:"requestCallback",params:t};return this.websocket?this.sendData(n):void c.post(this.options.serverUrl,n,function(n,s){return n?(this.emit("Error",n,{method:"requestCallback",params:t}),e(n)):void(e&&e(null,s.result))}.bind(this))},s.prototype.disjoinSession=function(t){var e={method:"disjoinSession",params:{sid:t}};return this.websocket?this.sendData(e):void c.post(this.options.serverUrl,e,function(e,n){return e?void this.emit("Error",e,{method:"disjoinSession",params:{sid:t}}):void this.emit("session/disjoin",{url:d.href})}.bind(this))},s.prototype.shareOpened=function(){var t={method:"shareOpened",params:{id:this.session.sharedId,url:d.href}};if(this.websocket)return this.sendData(t)},s.prototype.shareClosed=function(){var t={method:"shareClosed",params:{id:this.session.sharedId,url:d.href}};if(this.websocket)return this.sendData(t)},s.prototype.openShare=function(t){var e={method:"openShare",params:{sid:this.session.sid,url:t}};return this.websocket?this.sendData(e):void c.post(this.options.serverUrl,e,function(t,e){if(t)return void this.emit("Error",t,{method:"openShare",params:{state:state}})}.bind(this))},s.prototype.setChatTimeout=function(t){return setTimeout(function(){this.emit("chat/timeout")}.bind(this),1e3*t)},s.prototype.userIsTyping=function(){var t={method:"typing",params:{sid:this.session.sid}};return this.websocket?this.sendData(t):void c.post(this.options.serverUrl,t,function(t){if(t)return void this.emit("Error",t,{method:"setChatTimeout"})}.bind(this))},s.prototype.updateUrl=function(t){var e={method:"updateUrl",params:{sid:this.session.sid,url:t}};return this.websocket?this.sendData(e):void c.post(this.options.serverUrl,e,function(e,n){if(e)return void this.emit("Error",e,{method:"updateUrl",params:{url:t}})}.bind(this))},s.prototype.linkFollowed=function(t){var e={method:"linkFollowed",params:{sid:this.session.sid,url:t}};return this.websocket?this.sendData(e):void c.post(this.options.serverUrl,e,function(e,n){if(e)return void this.emit("Error",e,{method:"linkFollowed",params:{url:t}})}.bind(this))},s.prototype.detectLanguage=function(t){var e,n=l.getState("lang","session"),s=[];for(var a in t)s.push(a);return n?e=n:this.session.lang?e=this.session.lang:this.session.properties&&this.session.properties.lang?e=this.session.properties.lang:(this.session.langFromUrl||this.session.properties&&this.session.properties.langFromUrl)&&d.pathname.split("/").map(function(t){return t=r(t),s.indexOf(t)!==-1&&(e=t),t}),e||(e=(navigator.language||navigator.userLanguage).split("-")[0]),s.indexOf(e)===-1&&(e="en"),u.log("detected lang: ",s,n,this.session.lang,this.session.langFromUrl,e),this.session.lang=e,e},s.prototype.getSidFromUrl=function(t){var e=t.substring(t.indexOf("chatSessionId="));return e=e.substring(e.indexOf("=")+1)},s.prototype.createWebsocket=function(t){var e="wss:",s=new WebSocket(e+"//"+g,"json.api.smile-soft.com");s.onopen=function(t){u.log("WebSocket opened: ",t),m=1,h||this.init()}.bind(this),s.onmessage=this.onWebsocketMessage.bind(this),s.onclose=this.onWebsocketClose.bind(this),s.onerror=this.onError,n.onbeforeunload=function(){s.onclose=function(){},s.close()},this.websocket=s},s.prototype.onWebsocketClose=function(t){u.log("WebSocket closed",t);var e=a(m);setTimeout(function(){m++,this.createWebsocket()}.bind(this),e)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./debug":77,"./lodash":78,"./request":80,"./storage":81,events:2,inherits:3}],77:[function(t,e,n){(function(t){function n(e,n){if(t.localStorage.getItem("swc.debug"))return void[].forEach.call(e,function(e){t.console[n]?t.console[n](e):t.console.log(e)})}e.exports={log:function(){n(arguments,"log")},info:function(){n(arguments,"info")},warn:function(){n(arguments,"warn")},error:function(){n(arguments,"error")}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],78:[function(t,e,n){function s(t,e,n){var s;return function(){var a=this,r=arguments,i=function(){s=null,n||t.apply(a,r)},o=n&&!s;clearTimeout(s),s=setTimeout(i,e),o&&t.apply(a,r)}}function a(t,e){for(var n=e.charAt(0);t&&t!==document;t=t.parentNode)if("."===n){if(t.classList.contains(e.substr(1)))return t}else if("#"===n){if(t.id===e.substr(1))return t}else if("["===n){if(t.hasAttribute(e.substr(1,e.length-2)))return t}else if(t.nodeName===e.toUpperCase())return t;return!1}function r(t,e,n,s,a){var r=Number(new Date)+(s||2e3);a=a||300,function i(){t()?e():Number(new Date)<r?setTimeout(i,a):n(new Error("timed out for "+t+": "+arguments))}()}var i=t("lodash/string/template"),o=t("lodash/collection/forEach"),l=t("lodash/object/assign"),c=t("lodash/object/merge"),u=t("lodash/lang/isEqual"),d=t("lodash/string/trim"),f=t("lodash/function/throttle");t("lodash/function/debounce");e.exports={template:i,forEach:o,assign:l,merge:c,isEqual:u,trim:d,throttle:f,debounce:s,poll:r,findParent:a}},{"lodash/collection/forEach":4,"lodash/function/debounce":6,"lodash/function/throttle":8,"lodash/lang/isEqual":56,"lodash/object/assign":64,"lodash/object/merge":67,"lodash/string/template":69,"lodash/string/trim":71}],79:[function(t,e,n){var s=t("./widget.js");t("./core.js");e.exports=s.module},{"./core.js":76,"./widget.js":84}],80:[function(t,e,n){function s(t,e,n){o("POST",t,e,function(t,e){return l.log("post respose: ",t,e),t?n(t):void n(null,e)})}function a(t,e,n){return t&&c[t]?n(null,c[t]):void o("GET",e,null,function(e,s){return e?n(e):(t&&(c[t]=s),void n(null,s))})}function r(t,e,n){o("PUT",t,e,function(t,e){return l.log("put respose: ",t,e),t?n(t):void n(null,e)})}function i(t,e,n){o("POST",t,e,function(t,e){return l.log("post respose: ",t,e),t?n(t):void n(null,e)})}function o(t,e,n,s){var a,r,i;a=new XMLHttpRequest,a.open(t,e,!0),i=setTimeout(function(){a.abort()},6e4),a.onreadystatechange=function(){if(4==a.readyState&&(clearTimeout(i),a.response)){if(r="POST"===t?JSON.parse(a.response):a.response,r.error)return s(r.error);s(null,r)}},l.log("XmlHttpRequest: ",n),"POST"===t&&("object"!=typeof n||n instanceof FormData||(n=JSON.stringify(n),a.setRequestHeader("Content-Type","application/json; charset=UTF-8"))),n?a.send(n):a.send()}var l=t("./debug"),c={};e.exports={post:s,get:a,put:r,upload:i}},{"./debug":77}],81:[function(t,e,n){(function(t){function n(t,e){return"session"===e?JSON.parse(c.getItem(u+d+t)):JSON.parse(l.getItem(u+d+t))}function s(t,e,n){return"session"===n?c.setItem(u+d+t,JSON.stringify(e)):l.setItem(u+d+t,JSON.stringify(e)),e}function a(t,e){"session"===e?c.removeItem(u+d+t):l.removeItem(u+d+t)}function r(t,e){return e?"cache"===e?f[t]:n(t,e):void 0!==f[t]&&null!==f[t]?f[t]:n(t)}function i(t,e,n){return f[t]=e,"cache"!==n&&s(t,e,n),e}function o(t,e){delete f[t],a(t)}var l=t.localStorage,c=t.sessionStorage,u="swc",d=".",f={sid:null,eventTimestamp:0,msgTimestamp:0,entity:null,chat:null};e.exports={get:n,set:s,remove:a,getState:r,saveState:i,removeState:o}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],82:[function(require,module,exports){var _={},escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},escapeRegexp=new RegExp("["+Object.keys(escapeMap).join("")+"]","g");_.escape=function(t){return t?String(t).replace(escapeRegexp,function(t){return escapeMap[t]}):""},exports.email=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){var prefix=defaults.prefix;__p+='\n<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">\n<html xmlns="http://www.w3.org/1999/xhtml">\n    <head>\n        <meta http-equiv="Content-Type" content="text/html; charset=windows-1251" />\n        <!--[if !mso]><!-->\n            <meta http-equiv="X-UA-Compatible" content="IE=edge" />\n        <!--<![endif]-->\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title></title>\n        <!--[if (gte mso 9)|(IE)]>\n        <style type="text/css">\n            table {border-collapse: collapse;}\n        </style>\n        <![endif]-->\n        <style type="text/css">\n            /* Basics */\n            body {\n            Margin: 0;\n                padding: 0;\n                min-width: 100%;\n                background-color: #ffffff;\n            }\n            table {\n                border-spacing: 0;\n                font-family: sans-serif;\n                color: #333333;\n            }\n            td {\n                padding: 0;\n            }\n            img {\n                border: 0;\n            }\n            .wrapper {\n                width: 100%;\n                table-layout: fixed;\n                -webkit-text-size-adjust: 100%;\n                -ms-text-size-adjust: 100%;\n                background-color: #F1F1F1;\n            }\n            .webkit {\n                max-width: 500px;\n            }\n            .outer {\n            Margin: 0 auto;\n                height: 100%;\n                width: 95%;\n                max-width: 500px;\n                padding: 10px;\n            }\n            p {\n                Margin: 0;\n            }\n            a {\n                color: #ee6a56;\n                text-decoration: underline;\n            }\n            .h1 {\n                font-size: 21px;\n                font-weight: bold;\n                Margin-bottom: 18px;\n            }\n            .h2 {\n                font-size: 18px;\n                font-weight: bold;\n                Margin-bottom: 12px;\n            }\n             \n            /* One column layout */\n            .one-column .contents {\n                text-align: left;\n                color:#505050;\n                font-family:Arial;\n                font-size:14px;\n                line-height:150%;\n            }\n            .one-column p {\n                font-size: 14px;\n                Margin-bottom: 10px;\n            }\n            .'+__e(prefix)+"-message {\n                display: block;\n                margin-bottom: 10px;\n                padding: 10px;\n                background-color: #FFFFFF;\n                border-bottom: 4px solid #CCCCCC;\n            }\n            ."+__e(prefix)+"-message img {\n                width: 100%;\n                max-width: 500px;\n                height: auto;\n            }\n            ."+__e(prefix)+"-message span {\n                font-weight: bold;\n                color: #999999;\n            }\n            ."+__e(prefix)+"-agent-msg ."+__e(prefix)+"-message-from {\n                color: #555555;\n            }\n            ."+__e(prefix)+"-user-msg ."+__e(prefix)+"-message-from {\n                color: #F75B5D;\n            }\n\n            ."+__e(prefix)+"-message ."+__e(prefix)+'-message-time {\n                position: relative;\n                float: right;\n            }\n            .copyright {\n                margin-top: 5px;\n                font-size: 12px;\n                font-style: italic;\n                color: #CCCCCC;\n                text-align: right;\n            }\n\n        </style>\n    </head>\n    <body>\n        <center class="wrapper">\n            <div class="webkit">\n                <!--[if (gte mso 9)|(IE)]>\n                <table width="500" align="center" cellpadding="0" cellspacing="0" border="0">\n                <tr>\n                <td>\n                <![endif]-->\n                <table class="outer" align="center" cellpadding="0" cellspacing="0" border="0">\n                    <tr>\n                        <td class="one-column">\n                            <table width="100%">\n                                <tr>\n                                    <td class="inner contents">\n                                        '+(null==(__t=content)?"":__t)+"\n                                    </td>\n                                </tr>\n                            </table>\n                        </td>\n                    </tr>\n                </table>\n                <!--[if (gte mso 9)|(IE)]>\n                </td>\n                </tr>\n                </table>\n                <![endif]-->\n            </div>\n        </center>\n    </body>\n</html>"}return __p};var _={},escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},escapeRegexp=new RegExp("["+Object.keys(escapeMap).join("")+"]","g");_.escape=function(t){return t?String(t).replace(escapeRegexp,function(t){return escapeMap[t]}):""},exports.forms=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="'+__e(defaults.prefix)+"-message "+__e(defaults.prefix)+"-"+__e(message.entity)+'-msg">\n\t<span class="'+__e(defaults.prefix)+'-message-from">'+__e(message.from)+'</span>\n\t<div class="'+__e(defaults.prefix)+'-message-content" ',"user"===message.entity&&(__p+=" style=\"border-color:'"+__e(defaults.styles.primary.backgroundColor)+'" '),__p+='>\n\t\t<form id="'+__e(defaults.prefix)+"-"+__e(form.name)+'" name="'+__e(form.name)+'" ',form.autocomplete&&(__p+='autocomplete="on"'),__p+=' data-validate-form="true">\n\t\t\t',form.description&&(__p+='\n\t\t\t\t<p style="margin: 10px 0">'+(null==(__t=frases.FORMS.DESCRIPTIONS[form.description]||form.description)?"":__t)+"</p>\n\t\t\t"),__p+="\n\t\t\t",_.forEach(form.fields,function(t){__p+="\n\t\t\t\t","select"===t.type?(__p+='\n\t\t\t\t\t<select name="'+__e(t.name)+'">\n\t\t\t\t\t\t',_.forEach(t.options,function(t){__p+='\n\t\t\t\t\t\t\t<option value="'+__e(t.value)+'" ',t.selected&&(__p+=" selected "),__p+=" >\n\t\t\t\t\t\t\t\t"+__e(frases.FORMS.PLACEHOLDERS[t.text]||t.text)+"\n\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t"}),__p+="\n\t\t\t\t\t</select>\n\t\t\t\t"):"textarea"===t.type?(__p+='\n\t\t\t\t\t<textarea \n\t\t\t\t\t\tname="'+__e(t.name)+'"\n\t\t\t\t\t\tplaceholder="'+(null==(__t=frases.FORMS.PLACEHOLDERS[t.placeholder]||frases.FORMS.PLACEHOLDERS[t.name])?"":__t)+" ",t.required&&(__p+="*"),__p+='"\n\t\t\t\t\t></textarea>\n\t\t\t\t'):(__p+='\n\t\t\t\t\t<input \n\t\t\t\t\t\ttype="'+(null==(__t=t.type||"text")?"":__t)+'"\n\t\t\t\t\t\tplaceholder="'+(null==(__t=frases.FORMS.PLACEHOLDERS[t.placeholder]||frases.FORMS.PLACEHOLDERS[t.name])?"":__t)+" ",t.required&&(__p+="*"),__p+='"\n\t\t\t\t\t\tname="'+__e(t.name)+'" ',t.value&&(__p+='\n\t\t\t\t\t\tvalue="'+__e(credentials[t.value])+'" '),__p+=" ",t.required&&(__p+="required"),__p+="\n\t\t\t\t\t/>\n\t\t\t\t"),__p+="\n\t\t\t"}),__p+='\n\t\t\t<button \n\t\t\t\ttype="submit"\n\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block"\n\t\t\t\tstyle="background-color: '+__e(defaults.styles.primary.backgroundColor)+"; color: "+__e(defaults.styles.primary.color)+"; border: 1px solid "+__e(defaults.styles.primary.backgroundColor)+';">'+__e(frases.FORMS.send)+'</button>\n\t\t\t<button\n\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block"\n\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="rejectForm">'+__e(frases.FORMS.cancel)+'</button>\n\t\t</form>\n\t</div>\n\t<span class="'+__e(defaults.prefix)+'-message-time"> '+__e(message.time)+"</span>\n</div>";return __p};var _={},escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},escapeRegexp=new RegExp("["+Object.keys(escapeMap).join("")+"]","g");_.escape=function(t){return t?String(t).replace(escapeRegexp,function(t){return escapeMap[t]}):""},exports.message=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="'+__e(defaults.prefix)+"-message "+__e(defaults.prefix)+"-"+__e(message.entity)+'-msg">\n\t<span class="'+__e(defaults.prefix)+'-message-from">'+__e(message.from)+'</span>\n\t<div class="'+__e(defaults.prefix)+'-message-content"\n\t\t',"user"!==message.entity&&(__p+=' \n\t\t\tstyle="border-color:'+(null==(__t=defaults.styles.primary.backgroundColor)?"":__t)+'" \n\t\t'),__p+=">\n\t\t<p>"+(null==(__t=message.content)?"":__t)+'</p>\n\t</div>\n\t<span class="'+__e(defaults.prefix)+'-message-time"> '+__e(message.time)+"</span>\n</div>";return __p};var _={},escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},escapeRegexp=new RegExp("["+Object.keys(escapeMap).join("")+"]","g");_.escape=function(t){return t?String(t).replace(escapeRegexp,function(t){return escapeMap[t]}):""},exports.widget=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){var frases=translations;__p+="\n";var panels=frases.PANELS;__p+="\n";var channels=defaults.channels;__p+="\n";var positionClass="right"===defaults.position?"position-right":"position-left";__p+='\n<div id="'+__e(defaults.prefix)+'-wg-cont" class="'+__e(defaults.prefix)+"-wg-cont "+__e(positionClass)+'">\n\n\t<!-- ***** Panes container ***** -->\n\t<div \n\t\tid="'+__e(defaults.prefix)+'-wg-panes" \n\t\tclass="'+__e(defaults.prefix)+'-wg-panes" \n\t\tstyle="',defaults.styles.width&&(__p+="width: "+__e(defaults.styles.width)+";"),__p+='">\n\n\t\t<!-- ***** Top bar ***** -->\n\t\t<div \n\t\t\tclass="'+__e(defaults.prefix)+'-top-bar" \n\t\t\tstyle="background: '+__e(defaults.styles.primary.backgroundColor)+"; color: "+__e(defaults.styles.primary.color)+';">\n\n\t\t\t<!-- Main title -->\n\t\t\t<h4 class="'+__e(defaults.prefix)+"-wg-title "+__e(defaults.prefix)+'-uppercase">\n\t\t\t\t'+__e(defaults.title||frases.TOP_BAR.title)+'\n\t\t\t</h4>\n\n\t\t\t<div class="'+__e(defaults.prefix)+'-wg-state-cont">\n\t\t\t\t<!-- <span class="'+__e(defaults.prefix)+'-wg-state-icon"> </span> -->\n\t\t\t\t<span class="'+__e(defaults.prefix)+'-wg-state"></span>\n\t\t\t</div>\n\n\t\t\t<!-- Action buttons (minimize, close) -->\n\t\t\t<div class="'+__e(defaults.prefix)+'-wg-minimize">\n\n\t\t\t\t<!--<a \n\t\t\t\t\thref="#" \n\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="closeWidget">\n\t\t\t\t\t\n\t\t\t\t\t<span style="font-weight: bold">_</span>\n\t\t\t\t\n\t\t\t\t</a>-->\n\t\t\t\t\n\t\t\t\t<a \n\t\t\t\t\thref="#" \n\t\t\t\t\tstyle="color: '+__e(defaults.styles.primary.color)+'"\n\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="closeWidget"\n\t\t\t\t\t<span class="'+__e(defaults.prefix)+'-icon-close"></span>\n\n\t\t\t\t</a>\n\n\t\t\t</div>\n\t\t</div>\n\t\t<!-- ***** Top bar ends ***** -->\n\n\t\t<!-- ***** Connection types pane ***** -->\n\t\t<div \n\t\t\tclass="'+__e(defaults.prefix)+'-wg-pane" \n\t\t\tdata-'+__e(defaults.prefix)+'-pane="chooseConnection">\n\t\t\t\n\t\t\t<!-- Panel\'s image container -->\n\t\t\t<div \n\t\t\t\tclass="'+__e(defaults.prefix)+"-pane-header "+__e(defaults.prefix)+'-dark" \n\t\t\t\t',defaults.styles.intro.backgroundImage&&(__p+=' \n\t\t\t\t\tstyle="background-image: url('+__e(defaults.clientPath)+__e(defaults.styles.intro.backgroundImage)+')" \n\t\t\t\t'),__p+='>\n\n\t\t\t\t<!-- The text displayed on image -->\n\t\t\t\t<div class="'+__e(defaults.prefix)+"-backdrop-cont "+__e(defaults.prefix)+'-white">\n\t\t\t\t\t<br>\n\t\t\t\t\t<p>'+__e(panels.CONNECTION_TYPES.choose_conn_type)+'</p>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\n\t\t\t\t<form \n\t\t\t\t\tid="'+__e(defaults.prefix)+'-init-form" \n\t\t\t\t\tname="'+__e(defaults.prefix)+'InitForm">\n\n\t\t\t\t\t',channels.webrtc&&(__p+=" \n\t\t\t\t\t\t<!-- Display call button if WebRTC is enabled and supported by the browser -->\n\t\t\t\t\t\t",defaults.webrtcEnabled?__p+=' \n\t\t\t\t\t\t\t<button \n\t\t\t\t\t\t\t\ttype="button" \n\t\t\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n\t\t\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\t\t\tbackground: '+__e(defaults.styles.primary.backgroundColor)+"; \n\t\t\t\t\t\t\t\t\tcolor: "+__e(defaults.styles.primary.color)+"; \n\t\t\t\t\t\t\t\t\tborder: 1px solid "+__e(defaults.styles.primary.color)+';"\n\t\t\t\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="initCall">\n\n\t\t\t\t\t\t\t\t'+__e(panels.CONNECTION_TYPES.call_agent_btn)+"\n\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<!-- If WebRTC is not supported and fallback is set -->\n\t\t\t\t\t\t":channels.webrtc.fallback&&channels.webrtc.fallback.sipCall&&(__p+='\n\t\t\t\t\t\t\t<button \n\t\t\t\t\t\t\t\ttype="button" \n\t\t\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n\t\t\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\t\t\tbackground: '+__e(defaults.styles.primary.backgroundColor)+"; \n\t\t\t\t\t\t\t\t\tcolor: "+__e(defaults.styles.primary.color)+"; \n\t\t\t\t\t\t\t\t\tborder: 1px solid "+__e(defaults.styles.primary.color)+';"\n\t\t\t\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="initFallbackCall">\n\n\t\t\t\t\t\t\t\t'+__e(panels.CONNECTION_TYPES.call_agent_btn)+"\n\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t"),__p+="\n\t\t\t\t\t"),__p+="\n\n\t\t\t\t\t<!-- Display callback button if callback task is configured in the settings -->\n\t\t\t\t\t",channels.callback&&channels.callback.task&&(__p+='\n\t\t\t\t\t\t<button \n\t\t\t\t\t\t\ttype="button" \n\t\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n\t\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\t\tbackground: '+__e(defaults.styles.primary.backgroundColor)+"; \n\t\t\t\t\t\t\t\tcolor: "+__e(defaults.styles.primary.color)+"; \n\t\t\t\t\t\t\t\tborder: 1px solid "+__e(defaults.styles.primary.color)+';"\n\t\t\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="initCallback">\n\n\t\t\t\t\t\t\t'+__e(panels.CONNECTION_TYPES.callback_btn)+"\n\n\t\t\t\t\t\t</button>\n\t\t\t\t\t"),__p+="\n\n\t\t\t\t\t<!-- Init chat button -->\n\t\t\t\t\t",defaults.chat&&(__p+='\n\t\t\t\t\t<button\n\t\t\t\t\t\ttype="button" \n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n\t\t\t\t\t\tstyle="background: '+__e(defaults.styles.primary.backgroundColor)+"; color: "+__e(defaults.styles.primary.color)+"; border: 1px solid "+__e(defaults.styles.primary.color)+';"\n\t\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="initChat">\n\t\t\t\t\t\t'+__e(panels.CONNECTION_TYPES.chat_agent_btn)+"\n\t\t\t\t\t</button>\n\t\t\t\t\t"),__p+='\n\n\t\t\t\t\t<!-- Close widget button -->\n\t\t\t\t\t<a href="#" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block" data-'+__e(defaults.prefix)+'-handler="closeWidget">'+__e(panels.CONNECTION_TYPES.cancel)+"</a>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t\t<!-- ***** Connection types pane ends ***** -->\n\n\t\t<!-- ***** Intro pane. Displayed if configured in the settings object. ***** -->\n\t\t",defaults.intro&&defaults.intro.length&&(__p+='\n\t\t\t<div \n\t\t\t\tclass="'+__e(defaults.prefix)+'-wg-pane" \n\t\t\t\tdata-'+__e(defaults.prefix)+'-pane="credentials">\n\n\t\t\t\t<!-- Panel\'s image container -->\n\t\t\t\t<div \n\t\t\t\t\tclass="'+__e(defaults.prefix)+"-pane-header "+__e(defaults.prefix)+'-dark" \n\t\t\t\t\t',defaults.styles.intro.backgroundImage&&(__p+=' \n\t\t\t\t\t\tstyle="background-image: url('+__e(defaults.clientPath)+__e(defaults.styles.intro.backgroundImage)+')" \n\t\t\t\t\t'),__p+='>\n\n\t\t\t\t\t<!-- The text displayed on image -->\n\t\t\t\t\t<div class="'+__e(defaults.prefix)+"-backdrop-cont "+__e(defaults.prefix)+'-white">\n\t\t\t\t\t\t<br>\n\t\t\t\t\t\t<p>'+__e(defaults.introMessage||panels.INTRO.intro_message)+'</p>\n\t\t\t\t\t</div>\n\n\t\t\t\t</div>\n\n\t\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\t\t\t\t\t<form \n\t\t\t\t\t\tid="'+__e(defaults.prefix)+'-intro-form" \n\t\t\t\t\t\tname="'+__e(defaults.prefix)+'IntroForm" \n\t\t\t\t\t\tdata-validate-form="true">\n\n\t\t\t\t\t\t<!-- Iterating over intro array, which is a list of objects -->\n\t\t\t\t\t\t',_.forEach(defaults.intro,function(t){__p+="\n\t\t\t\t\t\t\t","lang"===t.name?(__p+='\n\t\t\t\t\t\t\t\t<select name="lang">\n\t\t\t\t\t\t\t\t\t',_.forEach(languages,function(t){__p+='\n\t\t\t\t\t\t\t\t\t\t<option \n\t\t\t\t\t\t\t\t\t\t\tvalue="'+__e(t)+'" \n\t\t\t\t\t\t\t\t\t\t\t',t===currLang&&(__p+=" selected "),__p+=" >\n\t\t\t\t\t\t\t\t\t\t\t"+__e(translations[t].lang)+"\n\t\t\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t\t"}),__p+="\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t"):"message"===t.name?(__p+='\n\t\t\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\t\t\tname="message"\n\t\t\t\t\t\t\t\t\tplaceholder="'+(null==(__t=t.placeholder||panels.INTRO.PLACEHOLDERS[t.name])?"":__t)+" ",
t.required&&(__p+=" * "),__p+='"\n\t\t\t\t\t\t\t\t></textarea>\n\t\t\t\t\t\t\t'):"checkbox"===t.type?(__p+='\n\t\t\t\t\t\t\t\t<label for="'+__e(defaults.sid)+"-"+__e(t.name)+'">\n\t\t\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\t\ttype="checkbox" \n\t\t\t\t\t\t\t\t\tid="'+__e(defaults.sid)+"-"+__e(t.name)+'"\n\t\t\t\t\t\t\t\t\tname="'+__e(t.name)+'" \n\t\t\t\t\t\t\t\t\t',t.required&&(__p+=" required "),__p+=">\n\t\t\t\t\t\t\t\t\t"+__e(t.placeholder)+"\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t"):(__p+='\n\t\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\t\ttype="'+(null==(__t=t.type||"text")?"":__t)+'" \n\t\t\t\t\t\t\t\t\tplaceholder="'+(null==(__t=t.placeholder||panels.INTRO.PLACEHOLDERS[t.name])?"":__t)+" ",t.required&&(__p+=" * "),__p+='" \n\t\t\t\t\t\t\t\t\tname="'+__e(t.name)+'" \n\t\t\t\t\t\t\t\t\t',t.save&&(__p+=' value="'+__e(credentials[t.name])+'" '),__p+=" \n\t\t\t\t\t\t\t\t\t",t.required&&(__p+=" required "),__p+=">\n\t\t\t\t\t\t\t"),__p+="\n\n\t\t\t\t\t\t"}),__p+='\n\t\t\t\t\t\t<br><br>\n\t\t\t\t\t\t<!-- Init chat with intro properties -->\n\t\t\t\t\t\t<button \n\t\t\t\t\t\t\ttype="submit" \n\t\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n\t\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\t\tbackground: '+__e(defaults.styles.primary.backgroundColor)+"; \n\t\t\t\t\t\t\t\tcolor: "+__e(defaults.styles.primary.color)+"; \n\t\t\t\t\t\t\t\tborder: 1px solid "+__e(defaults.styles.primary.color)+';">\n\n\t\t\t\t\t\t\t'+__e(panels.INTRO.start_dialog_button)+'\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t<!-- Close widget button -->\n\t\t\t\t\t\t<a href="#" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block" data-'+__e(defaults.prefix)+'-handler="closeWidget">'+__e(panels.INTRO.cancel)+"</a>\n\t\t\t\t\t</form>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"),__p+='\n\t\t<!-- ***** Intro pane ends ***** -->\n\n\t\t<!-- ***** Messages pane ***** -->\n\t\t<div  class="'+__e(defaults.prefix)+'-wg-pane" data-'+__e(defaults.prefix)+'-pane="messages">\n\t\t\t\n\t\t\t<!-- Messages container -->\n\t\t\t<ul \n\t\t\t\tid="'+__e(defaults.prefix)+'-messages-cont" \n\t\t\t\tclass="'+__e(defaults.prefix)+'-messages-cont" \n\t\t\t\tstyle="\n\t\t\t\t\t',defaults.styles.height&&(__p+="\n\t\t\t\t\t\theight: "+__e(defaults.styles.height)+";\n\t\t\t\t\t"),__p+='">\n\t\t\t\t\t\n\t\t\t</ul>\n\n\t\t\t<div class="'+__e(defaults.prefix)+'-write-cont">\n\t\t\t\t\n\t\t\t\t<!-- End dialog button -->\n\t\t\t\t<div class="'+__e(defaults.prefix)+'-end-dialog-btn">\n\t\t\t\t\t<a href="#" data-'+__e(defaults.prefix)+'-handler="finish">'+__e(panels.MESSAGES.end_dialog)+'</a>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- "Agent is typing" indicator -->\n\t\t\t\t<div class="'+__e(defaults.prefix)+'-loader">\n\t\t\t\t\t<span></span>\n\t\t\t\t\t<span></span>\n\t\t\t\t\t<span></span>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- "Attach file" button -->\n\t\t\t\t<label \n\t\t\t\t\tclass="'+__e(defaults.prefix)+'-sendfile-cont" \n\t\t\t\t\tfor="'+__e(defaults.prefix)+'-file-select">\n\n\t\t\t\t\t<input \n\t\t\t\t\t\ttype="file" \n\t\t\t\t\t\tid="'+__e(defaults.prefix)+'-file-select">\n\t\t\t\t\t\n\t\t\t\t\t<span \n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+'-icon-upload" \n\t\t\t\t\t\tstyle="color: '+__e(defaults.styles.primary.backgroundColor)+'">\n\t\t\t\t\t<span>\n\n\t\t\t\t</label>\n\n\t\t\t\t<div id="'+__e(defaults.prefix)+'-message-text-clone"  class="'+__e(defaults.prefix)+'-msg-textarea-clone" ></div>\n\n\t\t\t\t<!-- Field for typing the user message -->\n\t\t\t\t<textarea \n\t\t\t\t\tid="'+__e(defaults.prefix)+'-message-text" \n\t\t\t\t\tclass="'+__e(defaults.prefix)+'-msg-textarea" \n\t\t\t\t\tplaceholder="'+__e(panels.MESSAGES.PLACEHOLDERS.message)+'" \n\t\t\t\t\tmaxlength="1000"></textarea>\n\t\t\t\t\n\t\t\t\t<!-- "Send a message" button -->\n\t\t\t\t<a \n\t\t\t\t\thref="#" \n\t\t\t\t\tclass="'+__e(defaults.prefix)+"-sendmsg-btn "+__e(defaults.prefix)+'-button" \n\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="sendMessage">\n\n\t\t\t\t\t<span \n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+'-icon-paper-plane" \n\t\t\t\t\t\tstyle="color: '+__e(defaults.styles.primary.backgroundColor)+'">\n\t\t\t\t\t</span>\n\t\t\t\t</a>\n\n\t\t\t</div>\n\t\t</div>\n\t\t<!-- ***** Messages pane ends ***** -->\n\n\t\t<!-- ***** Offline pane ***** -->\n\t\t<div \n\t\t\tclass="'+__e(defaults.prefix)+'-wg-pane" \n\t\t\tdata-'+__e(defaults.prefix)+'-pane="sendemail">\n\n\t\t\t<!-- Panel\'s image container -->\n\t\t\t<div \n\t\t\t\tclass="'+__e(defaults.prefix)+"-pane-header "+__e(defaults.prefix)+'-dark" \n\t\t\t\t',defaults.styles.sendmail.backgroundImage&&(__p+=' \n\t\t\t\t\tstyle="background-image: url('+__e(defaults.clientPath)+__e(defaults.styles.sendmail.backgroundImage)+')" \n\t\t\t\t'),__p+='>\n\n\t\t\t\t<!-- The text displayed on image -->\n\t\t\t\t<div class="'+__e(defaults.prefix)+"-backdrop-cont "+__e(defaults.prefix)+'-dark">\n\t\t\t\t\t<p>'+__e(panels.OFFLINE.offline_message)+'</p>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\n\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\t\t\t\t<h4 class="'+__e(defaults.prefix)+'-uppercase">'+__e(panels.OFFLINE.send_message_header)+'</h4>\n\t\t\t\t<form id="'+__e(defaults.prefix)+'-sendmail-form" data-validate-form="true">\n\t\t\t\t\t<input type="text" name="uname" placeholder="'+__e(panels.OFFLINE.PLACEHOLDERS.uname)+'">\n\t\t\t\t\t<input type="email" name="email" placeholder="'+__e(panels.OFFLINE.PLACEHOLDERS.email)+' *" required>\n\t\t\t\t\t<textarea name="text" placeholder="'+__e(panels.OFFLINE.PLACEHOLDERS.message)+'" maxlength="1500"></textarea>\n\n\t\t\t\t\t<!--<input type="file" name="file" id="'+__e(defaults.prefix)+'-contactfile" class="'+__e(defaults.prefix)+'-inputfile" />\n\t\t\t\t\t<label for="'+__e(defaults.prefix)+'-contactfile">'+__e(panels.OFFLINE.choose_file)+'</label> -->\n\n\t\t\t\t\t<!-- "Send offline message" button -->\n\t\t\t\t\t<button \n\t\t\t\t\t\ttype="submit" \n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\tbackground: '+__e(defaults.styles.primary.backgroundColor)+"; \n\t\t\t\t\t\t\tcolor: "+__e(defaults.styles.primary.color)+"; \n\t\t\t\t\t\t\tborder: 1px solid "+__e(defaults.styles.primary.color)+';">\n\n\t\t\t\t\t\t'+__e(panels.OFFLINE.send_message_button)+'\n\t\t\t\t\t\t\t\n\t\t\t\t\t</button>\n\n\t\t\t\t\t<!-- Close widget button -->\n\t\t\t\t\t<a href="#" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block" data-'+__e(defaults.prefix)+'-handler="closeWidget">'+__e(panels.OFFLINE.close)+'</a>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t\t<!-- ***** Offline pane ends ***** -->\n\n\t\t<!-- ***** Close chat pane ***** -->\n\t\t<div \n\t\t\tclass="'+__e(defaults.prefix)+'-wg-pane" \n\t\t\tdata-'+__e(defaults.prefix)+'-pane="closechat">\n\n\t\t\t<!-- Panel\'s image container -->\n\t\t\t<div \n\t\t\t\tclass="'+__e(defaults.prefix)+"-pane-header "+__e(defaults.prefix)+'-white" \n\t\t\t\t',defaults.styles.closeChat.backgroundImage&&(__p+=' \n\t\t\t\t\tstyle="background-image: url('+__e(defaults.clientPath)+__e(defaults.styles.closeChat.backgroundImage)+')" \n\t\t\t\t'),__p+='>\n\n\t\t\t\t<!-- The text displayed on image -->\n\t\t\t\t<div class="'+__e(defaults.prefix)+"-backdrop-cont "+__e(defaults.prefix)+'-white">\n\t\t\t\t\t<br>\n\t\t\t\t\t<p>'+__e(panels.CLOSE_CHAT.close_chat_header)+'</p>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\n\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\t\t\t\t<form id="'+__e(defaults.prefix)+'-closechat-form" data-validate-form="true">\n\t\t\t\t\t<label for="'+__e(defaults.prefix)+'-send-dialog">\n\t\t\t\t\t\t<input type="checkbox" name="sendDialog" id="'+__e(defaults.prefix)+'-send-dialog" />\n\t\t\t\t\t\t<span>'+__e(panels.CLOSE_CHAT.send_dialog_label)+'</span>\n\t\t\t\t\t</label>\n\t\t\t\t\t<input type="email" name="email" placeholder="'+__e(panels.CLOSE_CHAT.PLACEHOLDERS.email)+'">\n\t\t\t\t\t<select name="rating">\n\t\t\t\t\t\t<option value="">--- '+__e(panels.CLOSE_CHAT.rate_agent)+' ---</option>\n\t\t\t\t\t\t<option value="5">'+__e(frases.AGENT_RATES.excellent)+'</option>\n\t\t\t\t\t\t<option value="4">'+__e(frases.AGENT_RATES.good)+'</option>\n\t\t\t\t\t\t<option value="3">'+__e(frases.AGENT_RATES.fair)+'</option>\n\t\t\t\t\t\t<option value="2">'+__e(frases.AGENT_RATES.bad)+'</option>\n\t\t\t\t\t</select>\n\t\t\t\t\t<textarea placeholder="'+__e(panels.CLOSE_CHAT.PLACEHOLDERS.comment)+'" name="text" maxlength="1500"></textarea>\n\n\t\t\t\t\t<!-- End chat and close widget button -->\n\t\t\t\t\t<button \n\t\t\t\t\t\ttype="submit" \n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\tbackground: '+__e(defaults.styles.primary.backgroundColor)+"; \n\t\t\t\t\t\t\tcolor: "+__e(defaults.styles.primary.color)+"; \n\t\t\t\t\t\t\tborder: 1px solid "+__e(defaults.styles.primary.color)+';">\n\n\t\t\t\t\t\t'+__e(panels.CLOSE_CHAT.finish_dialog_button)+'\n\t\t\t\t\t\t\t\n\t\t\t\t\t</button>\n\n\t\t\t\t\t<!-- "Back to the chat" button -->\n\t\t\t\t\t<a href="#messages" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block">'+__e(panels.CLOSE_CHAT.back)+'</a>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t\t<!-- ***** Close chat pane ends ***** -->\n\n\t\t<!-- ***** Audio call pane ***** -->\n\t\t<div class="'+__e(defaults.prefix)+'-wg-pane" data-'+__e(defaults.prefix)+'-pane="callAgent">\n\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\t\t\t\t<div id="'+__e(defaults.prefix)+'-call-spinner" class="'+__e(defaults.prefix)+'-spinner-pane">\n\t\t\t\t\t<h3 class="'+__e(defaults.prefix)+'-text-center">'+__e(panels.AUDIO_CALL.confirm_access)+'</h3>\n\t\t\t\t\t<h3 class="'+__e(defaults.prefix)+"-text-center "+__e(defaults.prefix)+"-loader "+__e(defaults.prefix)+'-shown" style="position: relative;">\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t</h3>\n\t\t\t\t</div>\n\t\t\t\t<div id="'+__e(defaults.prefix)+'-call-info" class="'+__e(defaults.prefix)+'-hidden">\n\t\t\t\t\t<h3 class="'+__e(defaults.prefix)+'-text-center" id="'+__e(defaults.prefix)+'-call-state">'+__e(panels.AUDIO_CALL.calling_agent)+'</h3>\n\t\t\t\t\t<h3 class="'+__e(defaults.prefix)+'-text-center" id="'+__e(defaults.prefix)+'-call-timer">00:00</h3>\n\t\t\t\t</div>\n\t\t\t\t<form id="'+__e(defaults.prefix)+'-call-control">\n\t\t\t\t\t<hr>\n\t\t\t\t\t<button\n\t\t\t\t\t\tid="'+__e(defaults.prefix)+'-tryagain-btn"\n\t\t\t\t\t\ttype="button"\n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+"-block "+__e(defaults.prefix)+'-hidden"\n\t\t\t\t\t\tstyle="background: '+__e(defaults.styles.primary.backgroundColor)+"; color: "+__e(defaults.styles.primary.color)+"; border: 1px solid "+__e(defaults.styles.primary.color)+';"\n\t\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="initCall">\n\t\t\t\t\t\t'+__e(panels.AUDIO_CALL.try_again)+'\n\t\t\t\t\t</button>\t\n\t\t\t\t\t<button \n\t\t\t\t\t\ttype="button"\n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-warn "+__e(defaults.prefix)+'-block"\n\t\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="endCall">\n\n\t\t\t\t\t\t'+__e(panels.AUDIO_CALL.end_call)+'\n\n\t\t\t\t\t</button>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t\t<!-- ***** Audio call pane ends ***** -->\n\n\t\t<!-- ***** Audio call fallback pane ***** -->\n\t\t<div class="'+__e(defaults.prefix)+'-wg-pane" data-'+__e(defaults.prefix)+'-pane="callAgentFallback">\n\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\t\t\t\t<div class="'+__e(defaults.prefix)+'-text-center">\n\t\t\t\t\t<h3>'+__e(panels.AUDIO_CALL_FALLBACK.DOWNLOAD_MSG)+"</h3>\n\t\t\t\t\t<br>\n\t\t\t\t\t",channels.webrtc&&channels.webrtc.fallback&&(__p+='\n\t\t\t\t\t\t<a href="'+__e(channels.webrtc.fallback.sipCall)+'">call.jnlp</a>\n\t\t\t\t\t'),__p+='\n\t\t\t\t</div>\n\t\t\t\t<form>\n\t\t\t\t\t<hr>\n\t\t\t\t\t<a href="#chooseConnection" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block">'+__e(panels.CALLBACK.back)+'</a>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t\t<!-- ***** Audio call fallback pane ends ***** -->\n\n\t\t<!-- ***** Callback pane ***** -->\n\t\t<div \n\t\t\tclass="'+__e(defaults.prefix)+'-wg-pane" \n\t\t\tdata-'+__e(defaults.prefix)+'-pane="callback">\n\n\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\t\t\t\t<div id="'+__e(defaults.prefix)+'-callback-spinner" class="'+__e(defaults.prefix)+"-hidden "+__e(defaults.prefix)+'-spinner-pane">\n\t\t\t\t\t<h3 class="'+__e(defaults.prefix)+'-text-center">'+__e(panels.CALLBACK.sending_request)+'</h3>\n\t\t\t\t\t<h3 class="'+__e(defaults.prefix)+"-text-center "+__e(defaults.prefix)+"-loader "+__e(defaults.prefix)+'-shown" style="position: relative;">\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t</h3>\n\t\t\t\t</div>\n\t\t\t\t<form id="'+__e(defaults.prefix)+'-callback-settings">\n\t\t\t\t\t',__p+=channels.callback&&channels.callback.time!==!1?'\n\t\t\t\t\t\t<p class="'+__e(defaults.prefix)+'-text-center">'+__e(panels.CALLBACK.title)+"</p>\n\t\t\t\t\t":'\n\t\t\t\t\t\t<p class="'+__e(defaults.prefix)+'-text-center">'+__e(panels.CALLBACK.title_asap)+"</p>\n\t\t\t\t\t",__p+="\n\t\t\t\t\t<hr>\n\t\t\t\t\t<label>"+__e(panels.CALLBACK.LABELS.phone)+'</label>\n\t\t\t\t\t<input type="tel" name="phone" placeholder="'+__e(panels.CALLBACK.PLACEHOLDERS.phone)+'" required>\n\t\t\t\t\t',channels.callback&&channels.callback.time!==!1&&(__p+="\n\t\t\t\t\t\t<label>"+__e(panels.CALLBACK.LABELS.time)+'</label>\n\t\t\t\t\t\t<select name="time">\n\t\t\t\t\t\t\t',_.forEach(panels.CALLBACK.TIME_POINTS,function(t){__p+='\n\t\t\t\t\t\t\t\t<option value="'+__e(t.minutes)+'">'+__e(t.label)+"</option>\n\t\t\t\t\t\t\t"}),__p+="\n\t\t\t\t\t\t</select>\n\t\t\t\t\t"),__p+="\n\t\t\t\t\t",channels.callback&&channels.callback.message!==undefined&&(__p+="\n\t\t\t\t\t\t<label>"+__e(panels.CALLBACK.LABELS.message)+'</label>\n\t\t\t\t\t\t<textarea name="message" placeholder="'+__e(panels.CALLBACK.PLACEHOLDERS.message)+'" maxlength="1500"></textarea>\n\t\t\t\t\t'),__p+='\n\t\t\t\t\t<hr>\n\n\t\t\t\t\t<button\n\t\t\t\t\t\ttype="submit"\n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block"\n\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\tbackground: '+__e(defaults.styles.primary.backgroundColor)+"; \n\t\t\t\t\t\t\tcolor: "+__e(defaults.styles.primary.color)+"; \n\t\t\t\t\t\t\tborder: 1px solid "+__e(defaults.styles.primary.color)+';"\n\t\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="setCallback">\n\n\t\t\t\t\t\t'+__e(panels.CALLBACK.confirm_callback)+'\n\n\t\t\t\t\t</button>\n\n\t\t\t\t\t<a href="#chooseConnection" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block">'+__e(panels.CALLBACK.back)+'</a>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t\t<!-- ***** Callback pane ends ***** -->\n\n\t\t<!-- ***** Callback sent pane ***** -->\n\t\t<div class="'+__e(defaults.prefix)+'-wg-pane" data-'+__e(defaults.prefix)+'-pane="callbackSent">\n\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\t\t\t\t<div id="'+__e(defaults.prefix)+'-callback-sent">\n\t\t\t\t\t<h3 class="'+__e(defaults.prefix)+"-text-center "+__e(defaults.prefix)+"-icon-check "+__e(defaults.prefix)+'-text-success"></h3>\n\t\t\t\t\t',__p+=channels.callback&&channels.callback.time!==!1?'\n\t\t\t\t\t\t<p class="'+__e(defaults.prefix)+'-text-center">'+__e(panels.CALLBACK.request_sent)+"</p>\n\t\t\t\t\t":'\n\t\t\t\t\t\t<p class="'+__e(defaults.prefix)+'-text-center">'+__e(panels.CALLBACK.request_sent_asap)+"</p>\n\t\t\t\t\t",__p+='\n\t\t\t\t\t<form>\n\t\t\t\t\t\t<hr>\n\t\t\t\t\t\t<a href="#chooseConnection" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block">'+__e(panels.CALLBACK.back)+'</a>\n\t\t\t\t\t\t<a href="#" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block" data-'+__e(defaults.prefix)+'-handler="closeWidget">'+__e(panels.CALLBACK.close)+'</a>\n\t\t\t\t\t</form>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<!-- ***** Callback sent pane ends ***** -->\n\n\t</div>\n\t<!-- ***** Panes container ends ***** -->\n\n\t<!-- ***** Floating button container ***** -->\n\t<div id="'+__e(defaults.prefix)+'-btn-cont" class="'+__e(defaults.prefix)+'-btn-cont">\n\t\t<div class="'+__e(defaults.prefix)+'-wg-btn">\n\t\t\t<div class="'+__e(defaults.prefix)+'-lastmsg-cont">\n\t\t\t\t<span class="'+__e(defaults.prefix)+'-unnotify-btn" id="'+__e(defaults.prefix)+'-unnotify-btn"><span class="'+__e(defaults.prefix)+'-icon-close"></span></span>\n\t\t\t\t<!-- <span class="'+__e(defaults.prefix)+'-unnotify-btn" id="'+__e(defaults.prefix)+'-unnotify-btn">'+__e(frases.FLOATING_BUTTON.close)+'</span> -->\n\t\t\t\t<div id="'+__e(defaults.prefix)+'-lastmsg" class="'+__e(defaults.prefix)+'-lastmsg">\n\t\t\t\t</div>\t\n\t\t\t</div>\n\t\t\t<a href="#" class="'+__e(defaults.prefix)+'-btn-link">\n\t\t\t\t<span class="'+__e(defaults.prefix)+'-btn-icon"></span>\n\t\t\t</a>\n\t\t</div>\n\t</div>\n\t<!-- ***** Floating button container ends ***** -->\n\n</div>'}return __p}},{}],83:[function(t,e,n){(function(n){function s(){var t=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia,n=window.mozRTCIceCandidate||window.RTCIceCandidate;return!!t&&!!e&&!!n}function a(){g.on("connected",function(t){v.log("sip connected event: ",t)}),g.on("disconnected",function(t){v.log("sip disconnected event: ",t)}),g.on("newMessage",function(t){v.log("sip newMessage event: ",t)}),g.on("newRTCSession",function(t){v.log("sip newRTCSession event: ",t),y.emit("webrtc/newRTCSession",t),h=t.session}),g.on("registered",function(t){v.log("sip registered event: ",t)}),g.on("unregistered",function(t){v.log("sip unregistered event: ",t)}),g.on("registrationFailed",function(t){v.log("sip registrationFailed event: ",t)}),b={progress:function(t){v.log("call progress event: ",t),y.emit("webrtc/progress",t)},failed:function(t){v.log("call failed event:",t),y.emit("webrtc/failed",t)},ended:function(t){v.log("call ended event: ",t),y.emit("webrtc/ended",t)},confirmed:function(t){v.log("call confirmed event: ",t),y.emit("webrtc/confirmed",t)},addstream:function(t){v.log("call addstream event: ",t),y.emit("webrtc/addstream",t);var e=t.stream;_.audioRemote=x.rtcninja.attachMediaStream(_.audioRemote,e)}}}function r(){return h.isEstablished()}function i(){return h.isInProgress()}function o(){return h.isEnded()}function l(){g.stop()}function c(t){h=g.call(t,{eventHandlers:b,mediaConstraints:{audio:!0,video:!1}})}function u(){h.terminate({status_code:200})}function d(){v.log("answer: ",g),h.answer()}function f(){v.log("hold: ",h.isOnHold()),h&&h.isOnHold().local?h.unhold():h.hold()}function p(){var t=document.createElement("audio");return t.setAttribute("autoplay","autoplay"),document.body.appendChild(t),t}function m(t){v.log("Initiating WebRTC module:",t),_=t,void 0===_.sip.register&&(_.sip.register=!1);var e=new x.WebSocketInterface(_.sip.ws_servers);_.sip.sockets=[e],y.emit=t.emit,y.on=t.on,_.audioRemote=p(),g=new x.UA(_.sip),a(),g.start()}var _,g,h,b,v=t("./debug"),y={},x=n.JsSIP;e.exports={lib:x,init:m,unregister:l,audiocall:c,terminate:u,answer:d,hold:f,isInProgress:i,isEstablished:r,isEnded:o,isSupported:s}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./debug":77}],84:[function(t,e,n){(function(n){function s(t){return _e.initiated?xe:(oe.merge(pe,t||{}),Yt=new se(pe).on("session/create",i).on("session/timeout",W).on("session/join",u).on("session/joined",f).on("session/disjoin",p).on("session/init",l),re.get("forms_json",pe.clientPath+"forms.json",function(t,e){return t?Yt.emit("Error",t):void(Gt=JSON.parse(e).forms)}),Bt(),fe.init(pe.clientPath+"sounds/"),xe)}function a(){return Yt.init(),xe}function r(t){ie.log("initWebrtcModule: ",t),de.init(t)}function i(){h(),oe.poll(function(){return ie.log("poll: ",le),null!==le},function(){o(),pe.external||Yt.updateUrl(window.location.href)},function(){return ye<2?(ye++,void s(pe)):Yt.emit("Error","Module wasn't initiated due to network errors")},6e4)}function o(){return!!(pe.chat||pe.webrtcEnabled||pe.channels.callback.task)&&(Yt.session.properties&&oe.merge(pe,Yt.session.properties),pe.sid=Yt.session.sid,pe.isIpcc=void 0!==Yt.session.langs||void 0!==Yt.session.categories,ie.log("initSession: ",Yt,pe),pe.widget&&Yt.on("chat/close",B).on("chat/timeout",q).on("message/new",j).on("message/new",O).on("message/typing",U).on("callback/create",$).on("form/submit",Lt).on("form/reject",At).on("widget/load",v),de.isSupported()&&pe.channels.webrtc&&pe.channels.webrtc.sip&&void 0!==pe.channels.webrtc.sip.ws_servers&&("https:"===window.location.protocol?(pe.webrtcEnabled=!0,Yt.on("webrtc/newRTCSession",function(){G("newRTCSession")}),Yt.on("webrtc/progress",function(t){G(180===t.response.status_code?"ringing":"confirmed")}),Yt.on("webrtc/addstream",function(){G("connected")}),Yt.on("webrtc/ended",function(){G("ended")}),Yt.on("webrtc/failed",function(t){G("Canceled"===t.cause?"canceled":"failed")}),r({sip:pe.channels.webrtc.sip,emit:xe.emit,on:xe.on})):(ie.warn("WebRTC feature is disabled"),ie.warn("getUserMedia() no longer works on insecure origins. To use this feature, you should consider switching your application to a secure origin, such as HTTPS. See https://goo.gl/rStTGz for more details."))),g(),pe.buttonSelector&&nt(pe.buttonSelector),pe.themeColor&&(pe.styles.primary.backgroundColor=pe.themeColor,pe.styles.primary.color=qt(pe.themeColor)),ie.log("initSession: ",pe.widget,_e.initiated,Jt()),pe.widget&&!_e.initiated&&Jt()&&y(pe),kt("timeout")&&Et("timeout"),void Yt.emit("session/init",{session:Yt.session,options:pe,url:n.location.href}))}function l(t){ae.saveState("init",!0,"session"),Qt&&!Qt.closed&&Qt.sessionStorage.setItem(pe.prefix+".init",!0)}function c(){O({from:ae.getState("aname","session"),time:Date.now(),content:"{request_browser_access}"})}function u(t){ie.log("onSessionJoinRequest",ae.getState("shared","session")),ae.getState("shared","session")?d(t):c()}function d(t){Yt.shareOpened(),f(t)}function f(t){m({url:t.url,entity:Yt.session.entity})}function p(){ce.unshare()}function m(t){pe.external||ce.isInitiated()||(Yt.on("cobrowsing/init",function(){ce.share()}),Yt.on("cobrowsing/update",function(t){ce.updateEvents(t)}),Yt.on("cobrowsing/event",function(t){Yt.updateEvents(t.events)}),Yt.on("cobrowsing/shared",function(){ae.saveState("shared",!0,"session")}),Yt.on("cobrowsing/unshared",function(t){ae.saveState("shared",!1,"session")}),ce.init({widget:t.widget,entity:t.entity,emit:xe.emit,path:pe.clientPath}))}function _(){return Vt}function g(){Yt.getLanguages(function(t,e){ie.log("getLanguages: ",t,e),t||e&&b(e)})}function h(){re.get("frases",(pe.translationsPath||pe.clientPath)+"translations.json",function(t,e){return t?Yt.emit("Error",t):(le=JSON.parse(e),void(le=le[Yt.detectLanguage(le)]))})}function b(t){t.length?"online":"offline";be=t,Yt.emit("chat/languages",t)}function v(){var t,e="";_e.initiated=!0,yt(),et(Vt),bt({state:vt()}),pe.hideOfflineButton&&wt("no-button"),pe.offer&&x(),ae.getState("chat","session")===!0&&(C(ae.getState("credentials","session")||{}),ae.getState("opened","session")&&St()),pe.webrtcEnabled&&wt("webrtc-enabled"),Vt&&pe.intro&&pe.intro.length&&(be.forEach(function(n){le&&le.lang&&(t=n===Yt.session.lang?"selected":"",e+='<option value="'+n+'" '+t+" >"+le.lang+"</option>")}),n[pe.prefix+"IntroForm"].lang.innerHTML=e),Yt.emit("widget/init")}function y(t){compiled=jt("widget",{defaults:t,languages:be,translations:le,credentials:ae.getState("credentials","session")||{},_:oe}),Vt=ne(compiled),document.body.appendChild(Vt),Yt.emit("widget/load",Vt),ie.log("loadWidget",t)}function x(){setTimeout(function(){w({from:pe.offer.from||le.TOP_BAR.title,time:Date.now(),content:pe.offer.text||le.default_offer})},pe.offer.inSeconds?1e3*pe.offer.inSeconds:3e4)}function w(t){"online"!==_e.state||E()||O(t)}function k(){ae.getState("interacted","session")||ae.saveState("interacted",!0,"session")}function E(){return ae.getState("interacted","session")}function S(){St(),ae.getState("chat","cache")||(ct()?ht("sendemail"):pe.intro&&pe.intro.length?ae.getState("chat","session")||ae.getState("credentials","session")?C(ae.getState("credentials","session")||{}):ht("credentials"):C({lang:Yt.session.lang}))}function C(t){var e=ae.getState("chat","session"),n=ae.getState("aid","session"),s=t.message,a={};n&&(t.agentid=n),t.lang||(t.lang=Yt.session.lang),a=Ht({},t),delete a.message,ae.saveState("credentials",a,"session"),Yt.chatRequest(t),setTimeout(function(){ie.log("requestChat: ",t.message,e),s&&!e&&A({message:t.message})},500),L(Yt.session),Tt(),ht("messages")}function L(t){var e=t.answerTimeout;ae.saveState("chat",!0,"session"),ie.log("startChat timeout: ",e),e&&(Xt=setTimeout(q,1e3*e)),wt("chat")}function A(t){Yt.sendMessage(t),O({from:ae.getState("credentials","session").uname||Yt.session.sid,time:Date.now(),content:t.message})}function O(t){ie.log("new messages arrived!",t);var e,s,a=!1,r=ae.getState("credentials","session")||{},i=ae.getState("aname","session"),o=r.uname?r.uname:Yt.session.sid,l=document.getElementById(pe.prefix+"-messages-cont");if(t.entity=t.entity||(t.from===o||void 0===t.from?"user":"agent"),t.from="user"===t.entity?"":t.from,t.time=It(t.time?t.time:Date.now()),e=Nt(t.content,t.file,t.entity),"form"===e.type)s=jt("forms",{defaults:pe,message:t,form:e.content,credentials:r,frases:le,_:oe}),n[e.content.name]&&At({formName:e.content.name}),l.insertAdjacentHTML("beforeend","<li>"+s+"</li>"),l.scrollTop=l.scrollHeight;else{if(!t.content)return;t.content=e.content,s=jt("message",{defaults:pe,message:t}),l.insertAdjacentHTML("beforeend","<li "+(t.className?'class="'+t.className+'"':"")+">"+s+"</li>"),T(s),t.hidden||(ge.push(s),he.push(t))}"agent"===t.entity&&(i!==t.from&&ae.saveState("aname",t.from,"session"),t.agentid&&ae.saveState("aid",t.agentid,"session"),t.from&&clearTimeout(Xt)),"user"!==t.entity&&(a=!0),l.scrollTop=l.scrollHeight}function j(){var t=[].slice.call(document.querySelectorAll("."+pe.prefix+"-msg-undelivered"));t&&t.length&&t.forEach(function(t){t.classList.add(pe.prefix+"-hidden")})}function T(t){var e;_e.active||(e=document.getElementById(pe.prefix+"-lastmsg"),e.innerHTML=t,wt("notified"),xt("notified"))}function I(t,e){var n=jt("email",{defaults:pe,content:t,frases:le,_:oe});if(e)return e(null,n)}function N(t){var e=t.text.join("");I(e,function(e,n){e||(t.text=n,Yt.sendEmail(t))})}function R(t){var e=[],n=jt("message",{defaults:pe,message:{from:le.EMAIL_SUBJECTS.complain+" "+t.email,content:t.text,entity:"",time:""}});e=e.concat(n,'<br><p class="h1">'+le.EMAIL_SUBJECTS.dialog+" "+pe.host+"</p><br>",ge).reduce(function(t,e){return t.concat(e)}),I(e,function(e,n){e||(t.text=n,Yt.sendEmail(t))})}function M(t,e){jt("message",{defaults:pe,message:{from:le.EMAIL_SUBJECTS.request+" "+t.uname+" ("+t.email+")",content:t.text,entity:"",time:""}});Yt.sendEmail(t),e&&e()}function F(t,e){var n;return e.email?(e.subject=le.EMAIL_SUBJECTS.request+" "+e.email,void(e.file?n=Ot(t.file,function(n,s){n?ie.warn("File wasn't sent"):(e.filename=s.filename,e.filedata=s.filedata),delete e.file,M(e,function(){t.reset(),Ct()})}):M(e,function(){t.reset(),Ct()}))):void alert(le.ERRORS.email)}function P(t,e){var n=e&&e.rating?parseInt(e.rating,10):null;if(e&&e.sendDialog){if(!e.email)return void alert(le.ERRORS.email);N({to:e.email,subject:le.EMAIL_SUBJECTS.dialog+" "+pe.host,text:ge})}if(e&&e.text){if(!e.email)return void alert(le.ERRORS.email);R({email:e.email,subject:le.EMAIL_SUBJECTS.complain+" "+e.email,text:e.text})}t&&t.reset(),D(n),Ct()}function D(t){ae.saveState("chat",!1,"session"),Yt.closeChat(t),Et("chat"),ae.getState("shared","session")&&(Yt.shareClosed(n.location.href),ce.unshare())}function B(){ae.getState("shared","session")&&ce.unshare()}function q(){ie.log("chat timeout!"),O({from:"",time:Date.now(),content:"{queue_overload}"});var t=n.queue_overload;t&&(t.text.value=he.reduce(function(t,e){return"user"===e.entity&&(t+=e.content+"\n"),t},""))}function U(){Zt||wt("agent-typing"),clearTimeout(Zt),Zt=setTimeout(function(){Zt=null,Et("agent-typing")},5e3)}function W(){ie.log("Session timeout:"),ae.getState("chat","session")===!0&&D(),ht("closechat")}function H(){ht("callAgent"),de.audiocall(pe.channels.webrtc.hotline)}function z(){ht("callAgentFallback")}function K(){ht("callback")}function J(){var t=document.getElementById(pe.prefix+"-callback-settings"),e=Pt(t);document.getElementById(pe.prefix+"-callback-spinner"),document.getElementById(pe.prefix+"-callback-sent");if(e.phone=e.phone?Kt(e.phone):null,!e.phone||e.phone.length<10)return alert(le.ERRORS.tel);if(e.time){if(e.time=parseFloat(e.time),e.time<=0)return;e.time=Date.now()+60*e.time*1e3}e.task=pe.channels.callback.task,ie.log("setCallback data: ",e),Yt.requestCallback(e),ht("callbackSent"),t.reset()}function $(){var t=document.getElementById(pe.prefix+"-callback-settings"),e=document.getElementById(pe.prefix+"-callback-spinner");e.classList.add(pe.prefix+"-hidden"),t.classList.remove(pe.prefix+"-hidden"),err||ht("callbackSent")}function G(t){ie.log("initCallState: ",t);var e=document.getElementById(pe.prefix+"-call-spinner"),n=document.getElementById(pe.prefix+"-call-info"),s=document.getElementById(pe.prefix+"-call-state"),a=document.getElementById(pe.prefix+"-call-timer"),r=document.getElementById(pe.prefix+"-tryagain-btn");"newRTCSession"===t?G("oncall"):"confirmed"===t?(s.innerText=le.PANELS.AUDIO_CALL.calling_agent,n.classList.remove(pe.prefix+"-hidden"),e.classList.add(pe.prefix+"-hidden"),r.classList.add(pe.prefix+"-hidden")):"ringing"===t?(Y(a,"init",0),a.classList.remove(pe.prefix+"-hidden")):"connected"===t?(s.innerText=le.PANELS.AUDIO_CALL.connected_with_agent,Y(a,"start",0),fe.stop()):"ended"===t?(s.innerText=le.PANELS.AUDIO_CALL.call_ended,Y(a,"stop"),G("oncallend")):"failed"===t||"canceled"===t?("failed"===t?s.innerText=le.PANELS.AUDIO_CALL.call_failed:s.innerText=le.PANELS.AUDIO_CALL.call_canceled,n.classList.remove(pe.prefix+"-hidden"),e.classList.add(pe.prefix+"-hidden"),a.classList.add(pe.prefix+"-hidden"),r.classList.remove(pe.prefix+"-hidden"),G("oncallend"),fe.play("busy")):"oncall"===t?(window.onbeforeunload=function(){return"Your connection is in progress. Do you realy want to close it?"},ae.saveState("call",!0,"cache"),wt("webrtc-call")):"oncallend"===t?(window.onbeforeunload=null,ae.saveState("call",!1,"cache"),Et("webrtc-call")):(n.classList.add(pe.prefix+"-hidden"),e.classList.remove(pe.prefix+"-hidden"),r.classList.add(pe.prefix+"-hidden"))}function Y(t,e,n){var s=n;"start"===e?ee=setInterval(function(){s+=1,t.textContent=zt(s)},1e3):"stop"===e?clearInterval(ee):"init"===e&&(t.textContent=zt(0))}function X(){de.isEstablished()||de.isInProgress()?de.terminate():(Ct(),G("init"))}function V(t){t&&t.preventDefault();var e={};Qt&&!Qt.closed||(e=oe.merge(e,pe),e.widget=!0,e.external=!0,Qt=window.open("","wchat",pe.widgetWindowOptions),Qt=Q(Qt),oe.poll(function(){return void 0!==Qt.Wchat},function(){Qt.Module=Qt.Wchat(e),Qt.Module.on("widget/init",function(){Qt.Module.initWidgetState()}),oe.forEach(Yt._events,function(t,e,s){Qt.Module.on(e,function(t){t.url=n.location.href,Yt.emit("window/"+e,t)})})},function(){console.warn("Wchat module was not initiated due to network connection issues.")},12e4),Qt.onbeforeunload=function(){ae.getState("chat","session")&&D()}),Qt.focus&&Qt.focus()}function Q(t){var e,n,s,a,r=t.document.createElement("div"),i=Z(t,"swc-loader-styles"),o=t.document.getElementsByTagName("head")[0],l=t.document.getElementsByTagName("body")[0];return r.className="swc-widget-loader",r.innerHTML="<span></span><span></span><span></span>",
s=t.document.createElement("meta"),s.name="viewport",s.content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0",n=t.document.createElement("meta"),n.setAttribute("charset","utf-8"),a=t.document.createElement("title"),a.textContent=le.TOP_BAR.title,e=t.document.createElement("script"),e.src=pe.clientPath+"wchat.min.js",e.charset="UTF-8",o.appendChild(s),o.appendChild(n),o.appendChild(a),o.appendChild(i),o.appendChild(e),l.id="swc-wg-window",l.appendChild(r),tt(o.getElementsByTagName("style")[0]),t}function Z(t,e){var n=t.document.createElement("style");return n.type="text/css",e&&(n.id=e),n.appendChild(t.document.createTextNode("")),n}function tt(t){var e=["body { margin:0; background-color: #eee; }","@keyframes preloading {","0 { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","50% { transform: translate(0,15px); -webkit-transform: translate(0,15px); -moz-transform: translate(0,15px); -ms-transform: translate(0,15px); -o-transform: translate(0,15px); }","100% { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","}","@-webkit-keyframes preloading {","0 { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","50% { transform: translate(0,15px); -webkit-transform: translate(0,15px); -moz-transform: translate(0,15px); -ms-transform: translate(0,15px); -o-transform: translate(0,15px); }","100% { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","}","@-moz-keyframes preloading {","0 { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","50% { transform: translate(0,15px); -webkit-transform: translate(0,15px); -moz-transform: translate(0,15px); -ms-transform: translate(0,15px); -o-transform: translate(0,15px); }","100% { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","}","@-ms-keyframes preloading {","0 { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","50% { transform: translate(0,15px); -webkit-transform: translate(0,15px); -moz-transform: translate(0,15px); -ms-transform: translate(0,15px); -o-transform: translate(0,15px); }","100% { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","}","@-o-keyframes preloading {","0 { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","50% { transform: translate(0,15px); -webkit-transform: translate(0,15px); -moz-transform: translate(0,15px); -ms-transform: translate(0,15px); -o-transform: translate(0,15px); }","100% { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","}",".swc-widget-loader {","position: absolute;","width: 100%;","top: 50%;","margin-top: -18px;","text-align: center;","}",".swc-widget-loader span {","display: inline-block;","width: 18px;","height: 18px;","border-radius: 50%;","background-color: #fff;","margin: 3px;","}",".swc-widget-loader span:nth-last-child(1) { -webkit-animation: preloading .8s .1s linear infinite; -moz-animation: preloading .8s .1s linear infinite; -ms-animation: preloading .8s .1s linear infinite; -o-animation: preloading .8s .1s linear infinite; animation: preloading .8s .1s linear infinite; }",".swc-widget-loader span:nth-last-child(2) { -webkit-animation: preloading .8s .3s linear infinite; -moz-animation: preloading .8s .3s linear infinite; -ms-animation: preloading .8s .3s linear infinite; -o-animation: preloading .8s .3s linear infinite; animation: preloading .8s .3s linear infinite; }",".swc-widget-loader span:nth-last-child(3) { -webkit-animation: preloading .8s .5s linear infinite; -moz-animation: preloading .8s .5s linear infinite; -ms-animation: preloading .8s .5s linear infinite; -o-animation: preloading .8s .5s linear infinite; animation: preloading .8s .5s linear infinite; }"].join(" ");t.innerHTML=e}function et(t){var e=document.getElementById(pe.prefix+"-file-select"),s=document.getElementById(pe.prefix+"-message-text"),a=[].slice.call(t.querySelectorAll("."+pe.prefix+"-inputfile")),r=document.getElementById(pe.prefix+"-btn-cont");[].slice.call(t.querySelectorAll("."+pe.prefix+"-wg-pane")),document.getElementById(pe.prefix+"-messages-cont");a.forEach(function(t){var e=t.nextElementSibling,n=e.textContent;$t(t,"change",function(t){var s=t.target.value.split("\\").pop();s?e.textContent=s:e.textContent=n})}),$t(r,"click",it),$t(t,"click",rt),$t(t,"submit",_t),$t(e,"change",gt),$t(s,"keypress",ft),$t(s,"focus",pt),$t(s,"blur",mt),$t(n,"DOMMouseScroll",ot),$t(n,"wheel",ot),$t(t,"mouseenter",st),$t(t,"mouseleave",at)}function nt(t){var e=pe.widget?ut:V,n=[].slice.call(document.querySelectorAll(t));n.map(function(t){return $t(t,"click",e),t})}function st(){ve=!0}function at(){ve=!1}function rt(t){var e,n,s,a,r=t.target;"A"!==r.parentNode.tagName&&"BUTTON"!==r.parentNode.tagName||(r=r.parentNode),e=r.getAttribute("data-"+pe.prefix+"-handler"),a=r.getAttribute("data-"+pe.prefix+"-link"),"closeWidget"===e?Ct():"finish"===e?(D(),Ct()):"sendMessage"===e?dt():"openWindow"===e?V():"rejectForm"===e?Yt.emit("form/reject",{formName:oe.findParent(r,"form").name}):"initCall"===e?H():"initFallbackCall"===e?z():"initCallback"===e?K():"setCallback"===e?J():"initChat"===e?S():"endCall"===e&&X(),"A"===r.tagName&&(s=r.href,a?Yt.linkFollowed(a):s.indexOf("#")!==-1&&(t.preventDefault(),n=s.substring(r.href.indexOf("#")+1),n&&ht(n)))}function it(t){t.preventDefault();var e=t.target,n=pe.prefix+"-unnotify-btn";return currTarg=t.currentTarget,e.id===n||e.parentNode.id===n?(Et("notified"),void xt(_e.state)):void(currTarg.id===pe.prefix+"-btn-cont"&&ut())}function ot(t){var e=document.getElementById(pe.prefix+"-messages-cont"),n=lt(t);ve&&(0===e.scrollTop&&"up"===n?(t.stopPropagation(),t.preventDefault()):e.scrollTop>=e.scrollHeight-e.clientHeight&&"down"===n&&(t.stopPropagation(),t.preventDefault()))}function lt(t){var e;return e=t.wheelDelta?t.wheelDelta:-1*t.deltaY,e<0?"down":e>0?"up":void 0}function ct(){var t=vt();return"offline"===t}function ut(t){t&&t.preventDefault();var e=ae.getState("chat","session"),n=(ae.getState("opened","session"),ae.getState("call","cache"));ie.log("initWidgetState"),k(),kt("timeout")?a():e?St():ct()?(ht("sendemail"),St()):pe.webrtcEnabled?n?St():(pe.chat||pe.channels.callback.task?ht("chooseConnection"):H(),St()):pe.channels.callback.task?pe.chat||pe.webrtcEnabled?(ht("chooseConnection"),St()):(ht("callback"),St()):S()}function dt(){var t,e=document.getElementById(pe.prefix+"-message-text");t=oe.trim(e.value),t&&(ae.getState("chat","session")||S(),A({message:t}),e.value="",Et("type-extend"))}function ft(t){var e=t.target,n=document.getElementById("swc-message-text-clone");10===t.keyCode||13===t.keyCode?(t.preventDefault(),dt()):te||(te=setTimeout(function(){te=null,Yt.userIsTyping()},1e3)),n.innerText=e.value,e.style.height=n.clientHeight+"px"}function pt(t){var e=t.target;e.style.borderColor=pe.styles.primary.backgroundColor}function mt(t){var e=t.target;e.style.borderColor="#fff"}function _t(t){var e=t.target;t.preventDefault(),"FORM"===e.tagName&&Yt.emit("form/submit",{formElement:e,formData:Pt(e)})}function gt(t){var e=t.target;Ot(e,function(t,e){ie.log("wgSendFile: ",t,e),t?alert("File was not sent"):A({message:e.filename,file:e.filedata})})}function ht(t){var e="data-"+pe.prefix+"-pane",n=[].slice.call(Vt.querySelectorAll("."+pe.prefix+"-wg-pane"));n.forEach(function(n){n.getAttribute(e)===t?n.classList.add("active"):n.classList.remove("active")})}function bt(t){if(ie.log("changeWgState: ",t),Vt&&_e.state!==t.state){"offline"===t.state?(D(),Et("online"),ht("sendemail")):"online"===t.state&&Et("offline");var e=document.querySelector("."+pe.prefix+"-wg-state");e&&(e.textContent=le.TOP_BAR.STATUS[t.state]),_e.state=t.state,wt(t.state),xt(t.state),Yt.emit("widget/statechange",{state:t.state})}}function vt(){var t="";return t=pe.isIpcc?_e.state?_e.state:be.length?"online":"offline":_e.state?_e.state:Yt.session.state?"online":"offline"}function yt(){var t=Vt.querySelector("."+pe.prefix+"-wg-btn");ie.log("setStyles: ",t,pe.buttonStyles),t.style.borderRadius=pe.buttonStyles.borderRadius,t.style.boxShadow=pe.buttonStyles.boxShadow}function xt(t){if(Vt&&void 0!==pe.buttonStyles[t]){var e=Vt.querySelector("."+pe.prefix+"-wg-btn"),n=Vt.querySelector("."+pe.prefix+"-btn-icon");e.style.background=pe.buttonStyles[t].backgroundColor,n.style.color=pe.buttonStyles[t].color||pe.buttonStyles.color}}function wt(t){Vt&&Vt.classList.add(t)}function kt(t){return!!Vt&&Vt.classList.contains(t)}function Et(t){Vt&&Vt.classList.remove(t)}function St(){var t=document.getElementById(pe.prefix+"-messages-cont");_e.active=!0,ae.saveState("opened",!0,"session"),wt("active"),Et("notified"),xt(_e.state),t.scrollTop=t.scrollHeight}function Ct(){window.opener?window.close():(_e.active=!1,ae.saveState("opened",!1,"session"),Et("active"))}function Lt(t){var e=t.formElement,s=t.formData;if(ie.log("onFormSubmit: ",e,s),e.getAttribute("data-validate-form")){var a=Dt(e);if(!a)return}e.id===pe.prefix+"-closechat-form"?P(e,s):e.id===pe.prefix+"-sendmail-form"?F(e,s):e.id===pe.prefix+"-intro-form"?C(s):e.id===pe.prefix+"-call-btn-form"?H():e.id===pe.prefix+"-chat-btn-form"?S():e.id===pe.prefix+"-queue_overload"?(M(s),At({formName:e.name},!0)):e.id===pe.prefix+"-request_browser_access"?(d({url:n.location.href}),At({formName:e.name},!0),Ct()):At({formName:e.name},!0)}function At(t,e){var s=n[t.formName];return!!s&&void(e?s.outerHTML='<p class="'+pe.prefix+'-text-center"><i class="'+pe.prefix+"-text-success "+pe.prefix+'-icon-check"></i><span> '+le.FORMS.submitted+"</span></p>":s.outerHTML='<p class="'+pe.prefix+'-text-center"><i class="'+pe.prefix+"-text-danger "+pe.prefix+'-icon-remove"></i><span> '+le.FORMS.canceled+"</span></p>")}function Ot(t,e){var s,a=t.files;if(a.length){if(!n.FileReader)return void(e&&e("OBSOLETE_BROWSER"));s=a[0];var r=new Blob([s],{type:s.type});return e(null,{filedata:r,filename:s.name})}}function jt(t,e){var n=ue[t];return n(e)}function Tt(){var t=document.getElementById(pe.prefix+"-messages-cont"),e=t.cloneNode();t.parentNode.replaceChild(e,t)}function It(t){var e=new Date("string"==typeof t?parseInt(t,10):t),n=e.getHours(),s=e.getMinutes(),a=(n<10?"0"+n:n)+":"+(s<10?"0"+s:s);return a}function Nt(t,e,n){var s,a;return e?(s=t.substring(t.indexOf("_")+1),Ft(e)?{type:"image",content:'<a href="'+Yt.options.server+"/ipcc/"+t+'" download="'+s+'"><img src="'+Yt.options.server+"/ipcc/"+t+'" alt="file preview" /></a>'}:{type:"file",content:'<a href="'+Yt.options.server+"/ipcc/"+t+'" download="'+s+'">'+s+"</a>"}):"agent"===n&&Mt(t)&&Ft(t)?(s=t.substring(t.indexOf("_")+1),{type:"image",content:'<a href="'+t+'" target="_blank"><img src="'+t+'" alt="'+s+'" /></a>'}):"agent"===n&&new RegExp("^{.+}$").test(t)?(Gt.forEach(function(e){e.name===t.substring(1,t.length-1)&&(a=e)}),{type:a?"form":"text",content:a?a:t}):{type:"text",content:t.replace(/\n/g," <br> ").split(" ").map(Rt).join(" ").replace(" <br> ","<br>")}}function Rt(t){var e=0,n=t;if(Mt(t)){for(;!n.charAt(n.length-1).match(/[a-z0-9\/]/i);)n=n.slice(0,-1),e+=1;return'<a href="'+n+'" target="_blank" data-'+pe.prefix+'-link="'+n+'">'+n+"</a>"+t.substr(t.length-e)}return t}function Mt(t){var e=new RegExp("^http://|^https://");return e.test(t)}function Ft(t){var e=new RegExp("png|PNG|jpg|JPG|JPEG|jpeg|gif|GIF"),n=t.substring(t.lastIndexOf(".")+1);return e.test(n)}function Pt(t){var e={};return[].slice.call(t.elements).forEach(function(t){"checkbox"===t.type?e[t.name]=t.checked:t.value&&(e[t.name]=t.value)}),e}function Dt(t){var e=!0;return[].slice.call(t.elements).every(function(t){return!t.hasAttribute("required")||""!==t.value&&null!==t.value||(alert(le.ERRORS[t.type]||le.ERRORS.required),e=!1,!1)}),e}function Bt(){var t=document.createElement("link");t.rel="stylesheet",t.href=pe.stylesPath||pe.clientPath+"main.css",document.head.appendChild(t)}function qt(t){var e=Wt(pe.themeColor);return ie.log("getThemeTextColor: ",e,Ut(e.r,e.g,e.b)),Ut(e.r,e.g,e.b)>.5?"#333":"#f1f1f1"}function Ut(t,e,n){var s=t/255,a=e/255,r=n/255,i=s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4),o=a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4),l=r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4),c=.2126*i+.7152*o+.0722*l;return c}function Wt(t){var e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;t=t.replace(e,function(t,e,n,s){return e+e+n+n+s+s});var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null}function Ht(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function zt(t){var e=Math.floor(t/60),n=t%60,s=(e>9?e:"0"+e)+":"+(n>9?n:"0"+n);return s}function Kt(t){return t.replace(/\D+/g,"")}function Jt(){return void 0!==document.body.classList}function $t(t,e,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent&&t.attachEvent("on"+e,n)}var Gt,Yt,Xt,Vt,Qt,Zt,te,ee,ne=t("domify"),se=t("./core"),ae=t("./storage"),re=t("./request"),ie=t("./debug"),oe=t("./lodash"),le=null,ce=t("./cobrowsing"),ue=t("./templates"),de=t("./webrtc"),fe=t("./audio-control"),pe={prefix:"swc",autoStart:!0,intro:!1,introMessage:"",widget:!0,chat:!0,channels:{webrtc:{},callback:{}},cobrowsing:!1,buttonSelector:"",reCreateSession:!0,title:"",lang:"",langFromUrl:!0,position:"right",hideOfflineButton:!1,offer:!1,themeColor:"",styles:{primary:{backgroundColor:"#74b9ff",color:"#FFFFFF"},intro:{},sendmail:{},closeChat:{}},buttonStyles:{online:{backgroundColor:"rgba(175,229,255)",color:""},offline:{backgroundColor:"rgba(241,241,241)",color:""},timeout:{backgroundColor:"rgba(241,241,241)",color:""},notified:{backgroundColor:"rgba(253,250,129)",color:""},color:"rgb(70,70,70)"},widgetWindowOptions:"left=10,top=10,width=350,height=550,resizable",path:"/ipcc/webchat/",clientPath:"https://cdn.smile-soft.com/wchat/v1/",stylesPath:"",translationsPath:"",host:window.location.host,webrtcEnabled:!1},me="WchatSettings",_e={initiated:!1,active:!1,state:"",share:!1,sounds:!0},ge=[],he=[],be=[],ve=!1,ye=1,xe={initModule:a,initWidgetState:ut,openWidget:V,initChat:S,initCall:H,getWidgetElement:_,isWebrtcSupported:de.isSupported,getWidgetState:function(){return _e},getEntity:function(){return ae.getState("entity","session")},on:function(t,e){return Yt.on(t,e),this},emit:function(t,e){return Yt.emit(t,e),this},setDefaultCredentials:function(t){return pe.credentials=t,this}};e.exports={module:s,api:xe},n[me]&&n[me].autoStart!==!1&&pe.autoStart&&("complete"===document.readyState||"interactive"===document.readyState?s(n[me]):document.addEventListener("DOMContentLoaded",function(){s(n[me])},!1))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./audio-control":74,"./cobrowsing":75,"./core":76,"./debug":77,"./lodash":78,"./request":80,"./storage":81,"./templates":82,"./webrtc":83,domify:1}]},{},[79])(79)});