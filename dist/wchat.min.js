!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Wchat=e()}}(function(){return function e(t,n,a){function r(s,o){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){var n=t[s][1][e];return r(n?n:e)},u,u.exports,e,t,n,a)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<a.length;s++)r(a[s]);return r}({1:[function(e,t,n){function a(e,t){if("string"!=typeof e)throw new TypeError("String expected");t||(t=document);var n=/<([\w:]+)/.exec(e);if(!n)return t.createTextNode(e);e=e.replace(/^\s+|\s+$/g,"");var a=n[1];if("body"==a){var r=t.createElement("html");return r.innerHTML=e,r.removeChild(r.lastChild)}var i=s[a]||s._default,o=i[0],l=i[1],c=i[2],r=t.createElement("div");for(r.innerHTML=l+e+c;o--;)r=r.lastChild;if(r.firstChild==r.lastChild)return r.removeChild(r.firstChild);for(var u=t.createDocumentFragment();r.firstChild;)u.appendChild(r.removeChild(r.firstChild));return u}t.exports=a;var r,i=!1;"undefined"!=typeof document&&(r=document.createElement("div"),r.innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>',i=!r.getElementsByTagName("link").length,r=void 0);var s={legend:[1,"<fieldset>","</fieldset>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],_default:i?[1,"X<div>","</div>"]:[0,"",""]};s.td=s.th=[3,"<table><tbody><tr>","</tr></tbody></table>"],s.option=s.optgroup=[1,'<select multiple="multiple">',"</select>"],s.thead=s.tbody=s.colgroup=s.caption=s.tfoot=[1,"<table>","</table>"],s.polyline=s.ellipse=s.polygon=s.circle=s.text=s.line=s.path=s.rect=s.g=[1,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1">',"</svg>"]},{}],2:[function(e,t,n){function a(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"number"==typeof e}function s(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}t.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._maxListeners=void 0,a.defaultMaxListeners=10,a.prototype.setMaxListeners=function(e){if(!i(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},a.prototype.emit=function(e){var t,n,a,i,l,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],o(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:i=Array.prototype.slice.call(arguments,1),n.apply(this,i)}else if(s(n))for(i=Array.prototype.slice.call(arguments,1),c=n.slice(),a=c.length,l=0;a>l;l++)c[l].apply(this,i);return!0},a.prototype.addListener=function(e,t){var n;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned&&(n=o(this._maxListeners)?a.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},a.prototype.on=a.prototype.addListener,a.prototype.once=function(e,t){function n(){this.removeListener(e,n),a||(a=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var a=!1;return n.listener=t,this.on(e,n),this},a.prototype.removeListener=function(e,t){var n,a,i,o;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],i=n.length,a=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(n)){for(o=i;o-- >0;)if(n[o]===t||n[o].listener&&n[o].listener===t){a=o;break}if(0>a)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(a,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},a.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},a.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},a.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},a.listenerCount=function(e,t){return e.listenerCount(t)}},{}],3:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],4:[function(e,t,n){var a=e("../internal/arrayEach"),r=e("../internal/baseEach"),i=e("../internal/createForEach"),s=i(a,r);t.exports=s},{"../internal/arrayEach":10,"../internal/baseEach":16,"../internal/createForEach":33}],5:[function(e,t,n){var a=e("../internal/getNative"),r=a(Date,"now"),i=r||function(){return(new Date).getTime()};t.exports=i},{"../internal/getNative":40}],6:[function(e,t,n){function a(e,t,n){function a(){h&&clearTimeout(h),p&&clearTimeout(p),v=0,p=h=b=void 0}function l(t,n){n&&clearTimeout(n),p=h=b=void 0,t&&(v=i(),m=e.apply(_,f),h||p||(f=_=void 0))}function c(){var e=t-(i()-g);0>=e||e>t?l(b,p):h=setTimeout(c,e)}function u(){l(x,h)}function d(){if(f=arguments,g=i(),_=this,b=x&&(h||!w),y===!1)var n=w&&!h;else{p||w||(v=g);var a=y-(g-v),r=0>=a||a>y;r?(p&&(p=clearTimeout(p)),v=g,m=e.apply(_,f)):p||(p=setTimeout(u,a))}return r&&h?h=clearTimeout(h):h||t===y||(h=setTimeout(c,t)),n&&(r=!0,m=e.apply(_,f)),!r||h||p||(f=_=void 0),m}var f,p,m,g,_,h,b,v=0,y=!1,x=!0;if("function"!=typeof e)throw new TypeError(s);if(t=0>t?0:+t||0,n===!0){var w=!0;x=!1}else r(n)&&(w=!!n.leading,y="maxWait"in n&&o(+n.maxWait||0,t),x="trailing"in n?!!n.trailing:x);return d.cancel=a,d}var r=e("../lang/isObject"),i=e("../date/now"),s="Expected a function",o=Math.max;t.exports=a},{"../date/now":5,"../lang/isObject":60}],7:[function(e,t,n){function a(e,t){if("function"!=typeof e)throw new TypeError(r);return t=i(void 0===t?e.length-1:+t||0,0),function(){for(var n=arguments,a=-1,r=i(n.length-t,0),s=Array(r);++a<r;)s[a]=n[t+a];switch(t){case 0:return e.call(this,s);case 1:return e.call(this,n[0],s);case 2:return e.call(this,n[0],n[1],s)}var o=Array(t+1);for(a=-1;++a<t;)o[a]=n[a];return o[t]=s,e.apply(this,o)}}var r="Expected a function",i=Math.max;t.exports=a},{}],8:[function(e,t,n){function a(e,t,n){var a=!0,o=!0;if("function"!=typeof e)throw new TypeError(s);return n===!1?a=!1:i(n)&&(a="leading"in n?!!n.leading:a,o="trailing"in n?!!n.trailing:o),r(e,t,{leading:a,maxWait:+t,trailing:o})}var r=e("./debounce"),i=e("../lang/isObject"),s="Expected a function";t.exports=a},{"../lang/isObject":60,"./debounce":6}],9:[function(e,t,n){function a(e,t){var n=-1,a=e.length;for(t||(t=Array(a));++n<a;)t[n]=e[n];return t}t.exports=a},{}],10:[function(e,t,n){function a(e,t){for(var n=-1,a=e.length;++n<a&&t(e[n],n,e)!==!1;);return e}t.exports=a},{}],11:[function(e,t,n){function a(e,t){for(var n=-1,a=e.length;++n<a;)if(t(e[n],n,e))return!0;return!1}t.exports=a},{}],12:[function(e,t,n){function a(e,t,n,a){return void 0!==e&&i.call(a,n)?e:t}var r=Object.prototype,i=r.hasOwnProperty;t.exports=a},{}],13:[function(e,t,n){function a(e,t,n){for(var a=-1,i=r(t),s=i.length;++a<s;){var o=i[a],l=e[o],c=n(l,t[o],o,e,t);(c===c?c===l:l!==l)&&(void 0!==l||o in e)||(e[o]=c)}return e}var r=e("../object/keys");t.exports=a},{"../object/keys":65}],14:[function(e,t,n){function a(e,t){return null==t?e:r(t,i(t),e)}var r=e("./baseCopy"),i=e("../object/keys");t.exports=a},{"../object/keys":65,"./baseCopy":15}],15:[function(e,t,n){function a(e,t,n){n||(n={});for(var a=-1,r=t.length;++a<r;){var i=t[a];n[i]=e[i]}return n}t.exports=a},{}],16:[function(e,t,n){var a=e("./baseForOwn"),r=e("./createBaseEach"),i=r(a);t.exports=i},{"./baseForOwn":19,"./createBaseEach":31}],17:[function(e,t,n){var a=e("./createBaseFor"),r=a();t.exports=r},{"./createBaseFor":32}],18:[function(e,t,n){function a(e,t){return r(e,t,i)}var r=e("./baseFor"),i=e("../object/keysIn");t.exports=a},{"../object/keysIn":66,"./baseFor":17}],19:[function(e,t,n){function a(e,t){return r(e,t,i)}var r=e("./baseFor"),i=e("../object/keys");t.exports=a},{"../object/keys":65,"./baseFor":17}],20:[function(e,t,n){function a(e,t,n,o,l,c){return e===t?!0:null==e||null==t||!i(e)&&!s(t)?e!==e&&t!==t:r(e,t,a,n,o,l,c)}var r=e("./baseIsEqualDeep"),i=e("../lang/isObject"),s=e("./isObjectLike");t.exports=a},{"../lang/isObject":60,"./baseIsEqualDeep":21,"./isObjectLike":45}],21:[function(e,t,n){function a(e,t,n,a,f,g,_){var h=o(e),b=o(t),v=u,y=u;h||(v=m.call(e),v==c?v=d:v!=d&&(h=l(e))),b||(y=m.call(t),y==c?y=d:y!=d&&(b=l(t)));var x=v==d,w=y==d,E=v==y;if(E&&!h&&!x)return i(e,t,v);if(!f){var k=x&&p.call(e,"__wrapped__"),S=w&&p.call(t,"__wrapped__");if(k||S)return n(k?e.value():e,S?t.value():t,a,f,g,_)}if(!E)return!1;g||(g=[]),_||(_=[]);for(var C=g.length;C--;)if(g[C]==e)return _[C]==t;g.push(e),_.push(t);var L=(h?r:s)(e,t,n,a,f,g,_);return g.pop(),_.pop(),L}var r=e("./equalArrays"),i=e("./equalByTag"),s=e("./equalObjects"),o=e("../lang/isArray"),l=e("../lang/isTypedArray"),c="[object Arguments]",u="[object Array]",d="[object Object]",f=Object.prototype,p=f.hasOwnProperty,m=f.toString;t.exports=a},{"../lang/isArray":55,"../lang/isTypedArray":62,"./equalArrays":34,"./equalByTag":35,"./equalObjects":36}],22:[function(e,t,n){function a(e,t,n,f,p){if(!l(e))return e;var m=o(t)&&(s(t)||u(t)),g=m?void 0:d(t);return r(g||t,function(r,s){if(g&&(s=r,r=t[s]),c(r))f||(f=[]),p||(p=[]),i(e,t,s,a,n,f,p);else{var o=e[s],l=n?n(o,r,s,e,t):void 0,u=void 0===l;u&&(l=r),void 0===l&&(!m||s in e)||!u&&(l===l?l===o:o!==o)||(e[s]=l)}}),e}var r=e("./arrayEach"),i=e("./baseMergeDeep"),s=e("../lang/isArray"),o=e("./isArrayLike"),l=e("../lang/isObject"),c=e("./isObjectLike"),u=e("../lang/isTypedArray"),d=e("../object/keys");t.exports=a},{"../lang/isArray":55,"../lang/isObject":60,"../lang/isTypedArray":62,"../object/keys":65,"./arrayEach":10,"./baseMergeDeep":23,"./isArrayLike":41,"./isObjectLike":45}],23:[function(e,t,n){function a(e,t,n,a,d,f,p){for(var m=f.length,g=t[n];m--;)if(f[m]==g)return void(e[n]=p[m]);var _=e[n],h=d?d(_,g,n,e,t):void 0,b=void 0===h;b&&(h=g,o(g)&&(s(g)||c(g))?h=s(_)?_:o(_)?r(_):[]:l(g)||i(g)?h=i(_)?u(_):l(_)?_:{}:b=!1),f.push(g),p.push(h),b?e[n]=a(h,g,d,f,p):(h===h?h!==_:_===_)&&(e[n]=h)}var r=e("./arrayCopy"),i=e("../lang/isArguments"),s=e("../lang/isArray"),o=e("./isArrayLike"),l=e("../lang/isPlainObject"),c=e("../lang/isTypedArray"),u=e("../lang/toPlainObject");t.exports=a},{"../lang/isArguments":54,"../lang/isArray":55,"../lang/isPlainObject":61,"../lang/isTypedArray":62,"../lang/toPlainObject":63,"./arrayCopy":9,"./isArrayLike":41}],24:[function(e,t,n){function a(e){return function(t){return null==t?void 0:t[e]}}t.exports=a},{}],25:[function(e,t,n){function a(e){return null==e?"":e+""}t.exports=a},{}],26:[function(e,t,n){function a(e,t){for(var n=-1,a=t.length,r=Array(a);++n<a;)r[n]=e[t[n]];return r}t.exports=a},{}],27:[function(e,t,n){function a(e,t,n){if("function"!=typeof e)return r;if(void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 3:return function(n,a,r){return e.call(t,n,a,r)};case 4:return function(n,a,r,i){return e.call(t,n,a,r,i)};case 5:return function(n,a,r,i,s){return e.call(t,n,a,r,i,s)}}return function(){return e.apply(t,arguments)}}var r=e("../utility/identity");t.exports=a},{"../utility/identity":73}],28:[function(e,t,n){function a(e,t){for(var n=-1,a=e.length;++n<a&&t.indexOf(e.charAt(n))>-1;);return n}t.exports=a},{}],29:[function(e,t,n){function a(e,t){for(var n=e.length;n--&&t.indexOf(e.charAt(n))>-1;);return n}t.exports=a},{}],30:[function(e,t,n){function a(e){return s(function(t,n){var a=-1,s=null==t?0:n.length,o=s>2?n[s-2]:void 0,l=s>2?n[2]:void 0,c=s>1?n[s-1]:void 0;for("function"==typeof o?(o=r(o,c,5),s-=2):(o="function"==typeof c?c:void 0,s-=o?1:0),l&&i(n[0],n[1],l)&&(o=3>s?void 0:o,s=1);++a<s;){var u=n[a];u&&e(t,u,o)}return t})}var r=e("./bindCallback"),i=e("./isIterateeCall"),s=e("../function/restParam");t.exports=a},{"../function/restParam":7,"./bindCallback":27,"./isIterateeCall":43}],31:[function(e,t,n){function a(e,t){return function(n,a){var o=n?r(n):0;if(!i(o))return e(n,a);for(var l=t?o:-1,c=s(n);(t?l--:++l<o)&&a(c[l],l,c)!==!1;);return n}}var r=e("./getLength"),i=e("./isLength"),s=e("./toObject");t.exports=a},{"./getLength":39,"./isLength":44,"./toObject":51}],32:[function(e,t,n){function a(e){return function(t,n,a){for(var i=r(t),s=a(t),o=s.length,l=e?o:-1;e?l--:++l<o;){var c=s[l];if(n(i[c],c,i)===!1)break}return t}}var r=e("./toObject");t.exports=a},{"./toObject":51}],33:[function(e,t,n){function a(e,t){return function(n,a,s){return"function"==typeof a&&void 0===s&&i(n)?e(n,a):t(n,r(a,s,3))}}var r=e("./bindCallback"),i=e("../lang/isArray");t.exports=a},{"../lang/isArray":55,"./bindCallback":27}],34:[function(e,t,n){function a(e,t,n,a,i,s,o){var l=-1,c=e.length,u=t.length;if(c!=u&&!(i&&u>c))return!1;for(;++l<c;){var d=e[l],f=t[l],p=a?a(i?f:d,i?d:f,l):void 0;if(void 0!==p){if(p)continue;return!1}if(i){if(!r(t,function(e){return d===e||n(d,e,a,i,s,o)}))return!1}else if(d!==f&&!n(d,f,a,i,s,o))return!1}return!0}var r=e("./arraySome");t.exports=a},{"./arraySome":11}],35:[function(e,t,n){function a(e,t,n){switch(n){case r:case i:return+e==+t;case s:return e.name==t.name&&e.message==t.message;case o:return e!=+e?t!=+t:e==+t;case l:case c:return e==t+""}return!1}var r="[object Boolean]",i="[object Date]",s="[object Error]",o="[object Number]",l="[object RegExp]",c="[object String]";t.exports=a},{}],36:[function(e,t,n){function a(e,t,n,a,i,o,l){var c=r(e),u=c.length,d=r(t),f=d.length;if(u!=f&&!i)return!1;for(var p=u;p--;){var m=c[p];if(!(i?m in t:s.call(t,m)))return!1}for(var g=i;++p<u;){m=c[p];var _=e[m],h=t[m],b=a?a(i?h:_,i?_:h,m):void 0;if(!(void 0===b?n(_,h,a,i,o,l):b))return!1;g||(g="constructor"==m)}if(!g){var v=e.constructor,y=t.constructor;if(v!=y&&"constructor"in e&&"constructor"in t&&!("function"==typeof v&&v instanceof v&&"function"==typeof y&&y instanceof y))return!1}return!0}var r=e("../object/keys"),i=Object.prototype,s=i.hasOwnProperty;t.exports=a},{"../object/keys":65}],37:[function(e,t,n){function a(e){return r[e]}var r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"};t.exports=a},{}],38:[function(e,t,n){function a(e){return"\\"+r[e]}var r={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};t.exports=a},{}],39:[function(e,t,n){var a=e("./baseProperty"),r=a("length");t.exports=r},{"./baseProperty":24}],40:[function(e,t,n){function a(e,t){var n=null==e?void 0:e[t];return r(n)?n:void 0}var r=e("../lang/isNative");t.exports=a},{"../lang/isNative":59}],41:[function(e,t,n){function a(e){return null!=e&&i(r(e))}var r=e("./getLength"),i=e("./isLength");t.exports=a},{"./getLength":39,"./isLength":44}],42:[function(e,t,n){function a(e,t){return e="number"==typeof e||r.test(e)?+e:-1,t=null==t?i:t,e>-1&&e%1==0&&t>e}var r=/^\d+$/,i=9007199254740991;t.exports=a},{}],43:[function(e,t,n){function a(e,t,n){if(!s(n))return!1;var a=typeof t;if("number"==a?r(n)&&i(t,n.length):"string"==a&&t in n){var o=n[t];return e===e?e===o:o!==o}return!1}var r=e("./isArrayLike"),i=e("./isIndex"),s=e("../lang/isObject");t.exports=a},{"../lang/isObject":60,"./isArrayLike":41,"./isIndex":42}],44:[function(e,t,n){function a(e){return"number"==typeof e&&e>-1&&e%1==0&&r>=e}var r=9007199254740991;t.exports=a},{}],45:[function(e,t,n){function a(e){return!!e&&"object"==typeof e}t.exports=a},{}],46:[function(e,t,n){function a(e){return 160>=e&&e>=9&&13>=e||32==e||160==e||5760==e||6158==e||e>=8192&&(8202>=e||8232==e||8233==e||8239==e||8287==e||12288==e||65279==e)}t.exports=a},{}],47:[function(e,t,n){var a=/<%-([\s\S]+?)%>/g;t.exports=a},{}],48:[function(e,t,n){var a=/<%([\s\S]+?)%>/g;t.exports=a},{}],49:[function(e,t,n){var a=/<%=([\s\S]+?)%>/g;t.exports=a},{}],50:[function(e,t,n){function a(e){for(var t=l(e),n=t.length,a=n&&e.length,c=!!a&&o(a)&&(i(e)||r(e)),d=-1,f=[];++d<n;){var p=t[d];(c&&s(p,a)||u.call(e,p))&&f.push(p)}return f}var r=e("../lang/isArguments"),i=e("../lang/isArray"),s=e("./isIndex"),o=e("./isLength"),l=e("../object/keysIn"),c=Object.prototype,u=c.hasOwnProperty;t.exports=a},{"../lang/isArguments":54,"../lang/isArray":55,"../object/keysIn":66,"./isIndex":42,"./isLength":44}],51:[function(e,t,n){function a(e){return r(e)?e:Object(e)}var r=e("../lang/isObject");t.exports=a},{"../lang/isObject":60}],52:[function(e,t,n){function a(e){for(var t=-1,n=e.length;++t<n&&r(e.charCodeAt(t)););return t}var r=e("./isSpace");t.exports=a},{"./isSpace":46}],53:[function(e,t,n){function a(e){for(var t=e.length;t--&&r(e.charCodeAt(t)););return t}var r=e("./isSpace");t.exports=a},{"./isSpace":46}],54:[function(e,t,n){function a(e){return i(e)&&r(e)&&o.call(e,"callee")&&!l.call(e,"callee")}var r=e("../internal/isArrayLike"),i=e("../internal/isObjectLike"),s=Object.prototype,o=s.hasOwnProperty,l=s.propertyIsEnumerable;t.exports=a},{"../internal/isArrayLike":41,"../internal/isObjectLike":45}],55:[function(e,t,n){var a=e("../internal/getNative"),r=e("../internal/isLength"),i=e("../internal/isObjectLike"),s="[object Array]",o=Object.prototype,l=o.toString,c=a(Array,"isArray"),u=c||function(e){return i(e)&&r(e.length)&&l.call(e)==s};t.exports=u},{"../internal/getNative":40,"../internal/isLength":44,"../internal/isObjectLike":45}],56:[function(e,t,n){function a(e,t,n,a){n="function"==typeof n?i(n,a,3):void 0;var s=n?n(e,t):void 0;return void 0===s?r(e,t,n):!!s}var r=e("../internal/baseIsEqual"),i=e("../internal/bindCallback");t.exports=a},{"../internal/baseIsEqual":20,"../internal/bindCallback":27}],57:[function(e,t,n){function a(e){return r(e)&&"string"==typeof e.message&&o.call(e)==i}var r=e("../internal/isObjectLike"),i="[object Error]",s=Object.prototype,o=s.toString;t.exports=a},{"../internal/isObjectLike":45}],58:[function(e,t,n){function a(e){return r(e)&&o.call(e)==i}var r=e("./isObject"),i="[object Function]",s=Object.prototype,o=s.toString;t.exports=a},{"./isObject":60}],59:[function(e,t,n){function a(e){return null==e?!1:r(e)?u.test(l.call(e)):i(e)&&s.test(e)}var r=e("./isFunction"),i=e("../internal/isObjectLike"),s=/^\[object .+?Constructor\]$/,o=Object.prototype,l=Function.prototype.toString,c=o.hasOwnProperty,u=RegExp("^"+l.call(c).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=a},{"../internal/isObjectLike":45,"./isFunction":58}],60:[function(e,t,n){function a(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}t.exports=a},{}],61:[function(e,t,n){function a(e){var t;if(!s(e)||u.call(e)!=o||i(e)||!c.call(e,"constructor")&&(t=e.constructor,"function"==typeof t&&!(t instanceof t)))return!1;var n;return r(e,function(e,t){n=t}),void 0===n||c.call(e,n)}var r=e("../internal/baseForIn"),i=e("./isArguments"),s=e("../internal/isObjectLike"),o="[object Object]",l=Object.prototype,c=l.hasOwnProperty,u=l.toString;t.exports=a},{"../internal/baseForIn":18,"../internal/isObjectLike":45,"./isArguments":54}],62:[function(e,t,n){function a(e){return i(e)&&r(e.length)&&!!O[T.call(e)]}var r=e("../internal/isLength"),i=e("../internal/isObjectLike"),s="[object Arguments]",o="[object Array]",l="[object Boolean]",c="[object Date]",u="[object Error]",d="[object Function]",f="[object Map]",p="[object Number]",m="[object Object]",g="[object RegExp]",_="[object Set]",h="[object String]",b="[object WeakMap]",v="[object ArrayBuffer]",y="[object Float32Array]",x="[object Float64Array]",w="[object Int8Array]",E="[object Int16Array]",k="[object Int32Array]",S="[object Uint8Array]",C="[object Uint8ClampedArray]",L="[object Uint16Array]",A="[object Uint32Array]",O={};O[y]=O[x]=O[w]=O[E]=O[k]=O[S]=O[C]=O[L]=O[A]=!0,O[s]=O[o]=O[v]=O[l]=O[c]=O[u]=O[d]=O[f]=O[p]=O[m]=O[g]=O[_]=O[h]=O[b]=!1;var j=Object.prototype,T=j.toString;t.exports=a},{"../internal/isLength":44,"../internal/isObjectLike":45}],63:[function(e,t,n){function a(e){return r(e,i(e))}var r=e("../internal/baseCopy"),i=e("../object/keysIn");t.exports=a},{"../internal/baseCopy":15,"../object/keysIn":66}],64:[function(e,t,n){var a=e("../internal/assignWith"),r=e("../internal/baseAssign"),i=e("../internal/createAssigner"),s=i(function(e,t,n){return n?a(e,t,n):r(e,t)});t.exports=s},{"../internal/assignWith":13,"../internal/baseAssign":14,"../internal/createAssigner":30}],65:[function(e,t,n){var a=e("../internal/getNative"),r=e("../internal/isArrayLike"),i=e("../lang/isObject"),s=e("../internal/shimKeys"),o=a(Object,"keys"),l=o?function(e){var t=null==e?void 0:e.constructor;return"function"==typeof t&&t.prototype===e||"function"!=typeof e&&r(e)?s(e):i(e)?o(e):[]}:s;t.exports=l},{"../internal/getNative":40,"../internal/isArrayLike":41,"../internal/shimKeys":50,"../lang/isObject":60}],66:[function(e,t,n){function a(e){if(null==e)return[];l(e)||(e=Object(e));var t=e.length;t=t&&o(t)&&(i(e)||r(e))&&t||0;for(var n=e.constructor,a=-1,c="function"==typeof n&&n.prototype===e,d=Array(t),f=t>0;++a<t;)d[a]=a+"";for(var p in e)f&&s(p,t)||"constructor"==p&&(c||!u.call(e,p))||d.push(p);return d}var r=e("../lang/isArguments"),i=e("../lang/isArray"),s=e("../internal/isIndex"),o=e("../internal/isLength"),l=e("../lang/isObject"),c=Object.prototype,u=c.hasOwnProperty;t.exports=a},{"../internal/isIndex":42,"../internal/isLength":44,"../lang/isArguments":54,"../lang/isArray":55,"../lang/isObject":60}],67:[function(e,t,n){var a=e("../internal/baseMerge"),r=e("../internal/createAssigner"),i=r(a);t.exports=i},{"../internal/baseMerge":22,"../internal/createAssigner":30}],68:[function(e,t,n){function a(e){return e=r(e),e&&o.test(e)?e.replace(s,i):e}var r=e("../internal/baseToString"),i=e("../internal/escapeHtmlChar"),s=/[&<>"'`]/g,o=RegExp(s.source);t.exports=a},{"../internal/baseToString":25,"../internal/escapeHtmlChar":37}],69:[function(e,t,n){function a(e,t,n){var a=g.imports._.templateSettings||g;n&&f(e,t,n)&&(t=n=void 0),e=l(e),t=i(o({},n||t),a,r);var w,E,k=i(o({},t.imports),a.imports,r),S=p(k),C=c(k,S),L=0,A=t.interpolate||y,O="__p += '",j=RegExp((t.escape||y).source+"|"+A.source+"|"+(A===m?v:y).source+"|"+(t.evaluate||y).source+"|$","g"),T="sourceURL"in t?"//# sourceURL="+t.sourceURL+"\n":"";e.replace(j,function(t,n,a,r,i,s){return a||(a=r),O+=e.slice(L,s).replace(x,u),n&&(w=!0,O+="' +\n__e("+n+") +\n'"),i&&(E=!0,O+="';\n"+i+";\n__p += '"),a&&(O+="' +\n((__t = ("+a+")) == null ? '' : __t) +\n'"),L=s+t.length,t}),O+="';\n";var I=t.variable;I||(O="with (obj) {\n"+O+"\n}\n"),O=(E?O.replace(_,""):O).replace(h,"$1").replace(b,"$1;"),O="function("+(I||"obj")+") {\n"+(I?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(w?", __e = _.escape":"")+(E?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+O+"return __p\n}";var N=s(function(){return Function(S,T+"return "+O).apply(void 0,C)});if(N.source=O,d(N))throw N;return N}var r=e("../internal/assignOwnDefaults"),i=e("../internal/assignWith"),s=e("../utility/attempt"),o=e("../internal/baseAssign"),l=e("../internal/baseToString"),c=e("../internal/baseValues"),u=e("../internal/escapeStringChar"),d=e("../lang/isError"),f=e("../internal/isIterateeCall"),p=e("../object/keys"),m=e("../internal/reInterpolate"),g=e("./templateSettings"),_=/\b__p \+= '';/g,h=/\b(__p \+=) '' \+/g,b=/(__e\(.*?\)|\b__t\)) \+\n'';/g,v=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,y=/($^)/,x=/['\n\r\u2028\u2029\\]/g;t.exports=a},{"../internal/assignOwnDefaults":12,"../internal/assignWith":13,"../internal/baseAssign":14,"../internal/baseToString":25,"../internal/baseValues":26,"../internal/escapeStringChar":38,"../internal/isIterateeCall":43,"../internal/reInterpolate":49,"../lang/isError":57,"../object/keys":65,"../utility/attempt":72,"./templateSettings":70}],70:[function(e,t,n){var a=e("./escape"),r=e("../internal/reEscape"),i=e("../internal/reEvaluate"),s=e("../internal/reInterpolate"),o={escape:r,evaluate:i,interpolate:s,variable:"",imports:{_:{escape:a}}};t.exports=o},{"../internal/reEscape":47,"../internal/reEvaluate":48,"../internal/reInterpolate":49,"./escape":68}],71:[function(e,t,n){function a(e,t,n){var a=e;return(e=r(e))?(n?o(a,t,n):null==t)?e.slice(l(e),c(e)+1):(t+="",e.slice(i(e,t),s(e,t)+1)):e}var r=e("../internal/baseToString"),i=e("../internal/charsLeftIndex"),s=e("../internal/charsRightIndex"),o=e("../internal/isIterateeCall"),l=e("../internal/trimmedLeftIndex"),c=e("../internal/trimmedRightIndex");t.exports=a},{"../internal/baseToString":25,"../internal/charsLeftIndex":28,"../internal/charsRightIndex":29,"../internal/isIterateeCall":43,"../internal/trimmedLeftIndex":52,"../internal/trimmedRightIndex":53}],72:[function(e,t,n){var a=e("../lang/isError"),r=e("../function/restParam"),i=r(function(e,t){try{return e.apply(void 0,t)}catch(n){return a(n)?n:new Error(n)}});t.exports=i},{"../function/restParam":7,"../lang/isError":57}],73:[function(e,t,n){function a(e){return e}t.exports=a},{}],74:[function(e,t,n){var a,r="",i="wav",s=.5;t.exports={init:function(e){return a=document.createElement("audio"),a.setAttribute("autoplay",!0),e&&(r=e),this},play:function(e,t){e&&(a.src=r+e+"."+i),t?a.setAttribute("loop",!0):a.removeAttribute("loop"),a.volume=s,a.play()},stop:function(){a.pause(),a.currentTime=0}}},{}],75:[function(e,t,n){function a(){return O}function r(e){return O?C.info("Cobrowsing already initiated"):(y(document,"keyup",m),y(document,"keydown",m),y(document,"keypress",m),y(document,"mouseup",m),y(document,"click",m),y(document,"change",m),w="string"==typeof e.widget?document.querySelector(e.widget):e.widget,I=e.entity,E=e.emit,N=e.path,O=!0,M=setInterval(f,F),C.log("cobrowsing module initiated with parameters: ",e),void E("cobrowsing/init"))}function i(){return j?C.info("Browser already shared"):(y(document,"scroll",m),y(document,"select",m),y(document,"mousemove",m),l(),j=!0,P=setInterval(p,F),clearInterval(M),C.log("browser shared"),void E("cobrowsing/shared",{entity:I}))}function s(){return j?(x(document,"scroll",m),x(document,"select",m),x(document,"mousemove",m),u(),j=!1,M=setInterval(f,F),clearInterval(P),E("cobrowsing/unshared",{entity:I}),void C.log("browser unshared")):C.info("Browser already unshared")}function o(){clearInterval(M)}function l(){var e=document.body;T||(T=document.createElement("img"),T.className="wc-rmt-ptr",T.setAttribute("src",N+"images/pointer.png"),T.style.position="absolute",e.firstChild?e.insertBefore(T,e.firstChild):e.appendChild(T),c())}function c(){T.style.left=B,T.style.top=U,k=window.requestAnimationFrame(c)}function u(){T&&(cancelAnimationFrame(k),T.parentNode.removeChild(T),T=null)}function d(e){var t=0;if(document.selection){e.focus();var n=document.selection.createRange();n.moveStart("character",-e.value.length),t=n.text.length}else t=(!e.type||"email"!==e.type&&"number"!==e.type)&&(e.selectionStart||"0"==e.selectionStart)?e.selectionStart:null;return t}function f(){E("cobrowsing/event",{entity:I,events:A}),A=[]}function p(){A.push({shared:!0,entity:I})}function m(e){var t=e||window.event,n=t.type,a=t.target,r=a.nodeName,i=document.body,s={},o=null,l=document.getElementsByTagName(a.nodeName),c=document.documentElement.scrollTop||document.body.scrollTop,u=document.documentElement.scrollLeft||document.body.scrollLeft,f=0;if(3===a.nodeType&&(a=a.parentNode),"user"!==I||!v(w,a)){for(f=0;f<L.length;f++)if(L[f].event==n)return void L.splice(f,1);for(f=0;f<l.length;f++)l[f]==a&&(o=f);if(s.event=n,s.entity=I,s.tn=r,s.tni=o,s.w=i.offsetWidth,s.h=i.offsetHeight,s.sx=u,s.sy=c,"mousemove"===n||"mouseover"===n||"mouseout"===n){var p=t.pageX||t.clientX+c,m=t.pageY||t.clientY+u;s.x=p,s.y=m}else if("scroll"===n);else if("keyup"==n||"keydown"==n||"keypress"==n){var g=t.charCode||t.keyCode||t.which,_=d(a);if("INPUT"===r&&"password"===a.type)return;if("keyup"==n){if(null!==_&&(86!=g||!t.metaKey&&!t.ctrlKey))return;var h=a.value;h&&(h=h.replace(/\n/g,"<br>"),s.value=h)}else if("keydown"==n){if(null===_||8!=g&&46!=g&&190!=g)return;if(!a.value)return;s.pos=_,s.code=g}else if("keypress"===n){if(null===_||8==g||46==g)return;s.pos=_,s.code=g}}else if("change"===n){if("INPUT"===r&&"password"===a.type)return;s.value=a.value}else if("mouseup"==n||"select"==n){var b=window.getSelection()||document.selection.createRange().text,y=b.anchorOffset,x=b.focusOffset,E=0,k="",S=0,C="",O=0,j="",T=0,N="",R=!1;if(null!==b.anchorNode){for(C=b.anchorNode.parentNode,f=0;f<C.childNodes.length;f++)C.childNodes[f]==b.anchorNode&&(S=f);for(k=C.nodeName.toLowerCase(),l=document.getElementsByTagName(k),f=0;f<l.length;f++)l[f]===C&&(E=f);for(N=b.focusNode.parentNode,f=0;f<N.childNodes.length;f++)N.childNodes[f]==b.focusNode&&(T=f);for(j=N.nodeName.toLowerCase(),l=document.getElementsByTagName(j),f=0;f<l.length;f++)l[f]===N&&(O=f);k===j&&E===O&&S===T&&y>x&&(R=!0),s.sn=k,s.sni=E,s.schi=S,s.en=j,s.eni=O,s.echi=T,s.so=R?x:y,s.eo=R?y:x}}else"click"==n&&(s.scx=t.screenX,s.scy=t.screenY);A.push(s)}}function g(e){var t,n=document.documentElement,a={};if(e.events&&e.events.length){n="ActiveXObject"in window||"undefined"!=typeof InstallTrigger?document.documentElement:document.body;for(var r=0;r<e.events.length;r++)if(a=e.events[r],!(a.timestamp<R)&&a.entity!==I){if(void 0!==a.shared&&(a.shared?(D(),i()):e.historyEvents||s()),a.url&&!e.historyEvents){var o=a.url,l=document.URL;-1!==l.indexOf("chatSessionId")&&(l=l.substr(0,l.indexOf("chatSessionId")-1)),o!=l&&b(o)}if(a.w&&"user"===a.entity){var c=document.body,u=c.offsetWidth;u!==a.w&&(document.body.style.width=a.w+"px")}if("mousemove"===a.event)T&&(B=a.x+"px",U=a.y+"px");else if("scroll"===a.event)void 0!==a.tn&&(t="#document"===a.tn?n:document.getElementsByTagName(a.tn)[a.tni],t&&(t.scrollTop=a.sy,t.scrollLeft=a.sx));else if("mouseup"===a.event||"select"===a.event){if(a.sn){var d=document.getElementsByTagName(a.sn)[a.sni],p=document.getElementsByTagName(a.en)[a.eni];if(document.createRange&&void 0!==d&&void 0!==p){var m=document.createRange();m.setStart(d.childNodes[a.schi],a.so),m.setEnd(p.childNodes[a.echi],a.eo);var g=window.getSelection();g.removeAllRanges(),g.addRange(m)}}}else if("keyup"===a.event||"keydown"===a.event||"keypress"===a.event){if(void 0!==a.tn&&void 0!==a.tni&&(t=document.getElementsByTagName(a.tn)[a.tni])){var v,y=t.value;if(8==a.code){if(a.pos==y.length-1)v=y.substr(0,a.pos-1);else{if(0===a.pos)return;v=y.substr(0,a.pos-1)+y.substr(a.pos)}t.value=v}else if(46==a.code)v=y.substr(0,a.pos)+y.substr(a.pos+1),t.value=v;else if(190==a.code)v=y.substr(0,a.pos)+"."+y.substr(a.pos),t.value=v;else if(void 0!==a.value){var x=a.value;x=x.replace(/<br>/g,"\n"),t.value=x}else{var w=String.fromCharCode(a.code);v=y?y.substr(0,a.pos)+w+y.substr(a.pos):w,
t.value=v}}}else if("change"===a.event)t=document.getElementsByTagName(a.tn)[a.tni],t.value=a.value;else if("click"===a.event)t=document.getElementsByTagName(a.tn)[a.tni],t&&t.click();else if(t=document.getElementsByTagName(a.tn)[a.tni]){var E=_(a.event,a.x,a.y,a.x,a.y);h(t,E)}"click"!==a.event&&"scroll"!==a.event||L.push(a)}}e.timestamp&&(R=e.timestamp),j&&f()}function _(e,t,n,a,r){var i,s={bubbles:!0,cancelable:"mousemove"!=e,view:window,detail:0,screenX:t,screenY:n,clientX:a,clientY:r,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:void 0};if("function"==typeof document.createEvent)i=document.createEvent("MouseEvents"),i.initMouseEvent(e,s.bubbles,s.cancelable,s.view,s.detail,s.screenX,s.screenY,s.clientX,s.clientY,s.ctrlKey,s.altKey,s.shiftKey,s.metaKey,s.button,document.body.parentNode);else if(document.createEventObject){i=document.createEventObject();for(var o in s)i[o]=s[o];i.button={0:1,1:4,2:2}[i.button]||i.button}return i}function h(e,t){return e.dispatchEvent?e.dispatchEvent(t):e.fireEvent&&e.fireEvent("on"+type,t),t}function b(e){var t=document.URL;t!==e&&(document.location.href=e)}function v(e,t){for(var n=t.parentNode;null!=n;){if(n==e)return!0;n=n.parentNode}return!1}function y(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)}function x(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)}var w,E,k,S=e("./lodash"),C=e("./debug"),L=[],A=[],O=!1,j=!1,T=null,I="",N="",R=0,M=null,F=5e3,P=null,D=S.debounce(s,3e4),B=0,U=0;t.exports={init:r,isInitiated:a,share:i,unshare:s,unshareAll:o,emitEvents:f,updateEvents:g}},{"./debug":77,"./lodash":78}],76:[function(e,t,n){(function(n){function a(e){return this.options=u.assign(h,e||{}),this.options.serverUrl=this.options.server+"/ipcc/$$$",this.session={},this.options.pageid?(g=p+this.options.pageid,this.createWebsocket(),this.on("session/create",function(e){this.session=e,s.saveState("sid",e.sid)}.bind(this)),this.on("chat/close",function(e){s.saveState("chat",!1)}),this.on("Error",this.onError),this):console.error("Cannot initiate module: pageid is undefined")}function r(e){var t=1e3*(Math.pow(2,e)-1);return t>3e4&&(t=3e4),Math.random()*t}var i=e("events").EventEmitter,s=e("./storage"),o=e("./request"),l=e("./debug"),c=n.location,u=e("./lodash"),d=e("inherits"),f=1,p="main.ringotel.net/chatbot/WebChat/",m="https://main.ringotel.net/public/",g="",_=!1,h={server:""};d(a,i),t.exports=a,a.prototype.onError=function(e){l.error(e),404===e.code&&this.emit("session/timeout")},a.prototype.sendData=function(e){this.websocket&&this.websocket.send(JSON.stringify(e))},a.prototype.onWebsocketMessage=function(e){var t=JSON.parse(e.data);t.method;l.log("onWebsocketMessage: ",t),t.method&&("session"===t.method?this.emit("session/create",t.params):"messages"===t.method?t.params.list&&t.params.list.map(function(e){return this.emit("message/new",e),e}.bind(this)):"message"===t.method&&(t.params.typing?this.emit("message/typing"):this.emit("message/new",t.params)))},a.prototype.init=function(){_=!0;var e=s.getState("entity","session"),t=s.getState("sid");l.log("initModule: ",e,t),-1!==c.href.indexOf("chatSessionId")?(t=this.getSidFromUrl(c.href),s.saveState("entity","agent","session"),s.saveState("sid",t),this.joinSession(t)):"agent"===e&&t?this.joinSession(t,c.href):t?(s.saveState("sid",t),this.createSession({sid:t,url:c.href})):(s.saveState("entity","user","session"),this.createSession({url:c.href}))},a.prototype.createSession=function(e){var t={method:"createSession",params:{url:e.url||c.href}};return e.sid&&(t.params.sid=e.sid),this.websocket?this.sendData(t):void o.post(this.options.serverUrl,t,function(t,n){return t?void this.emit("Error",t,{method:"createSession",params:e}):(n.result.url=c.href,s.saveState("sid",n.result.sid),void this.emit("session/create",n.result))}.bind(this))},a.prototype.joinSession=function(e,t){this.emit("session/join",{sid:e,url:t})},a.prototype.updateEvents=function(e,t){var n,a=s.getState("sid");return a?(n={method:"updateEvents",params:{sid:a,timestamp:s.getState("eventTimestamp","cache"),events:e}},void o.post(this.options.serverUrl,n,function(e,a){return e?(this.emit("Error",e,n),t(e)):void(a.result.timestamp>s.getState("eventTimestamp","cache")?(s.saveState("eventTimestamp",a.result.timestamp,"cache"),t&&t(null,a.result)):t&&t(null,{events:[]}))}.bind(this))):t()},a.prototype.getLanguages=function(e){l.log("this.session: ",this.session),e(null,this.session.langs)},a.prototype.chatRequest=function(e,t){e.sid=s.getState("sid"),l.log("chatRequest params: ",e);var n={method:"chatRequest",params:e};return this.websocket?this.sendData(n):void o.post(this.options.serverUrl,n,function(n,a){return n?(this.emit("Error",n,{method:"chatRequest",params:e}),void(t&&t(n))):(e.url=c.href,this.emit("chat/start",u.merge(e,a.result)),void(t&&t(null,a)))}.bind(this))},a.prototype.getMessages=function(e){o.post(this.options.serverUrl,{method:"getMessages",params:{sid:s.getState("sid"),timestamp:s.getState("msgTimestamp")}},function(t,n){return t?(this.emit("Error",t,{method:"getMessages"}),e(t)):(n.result.timestamp>s.getState("msgTimestamp")&&(s.saveState("msgTimestamp",n.result.timestamp),n.result.messages&&this.emit("message/new",n.result)),n.result.typing&&this.emit("message/typing",n.result),void(e&&e(null,n.result)))}.bind(this))},a.prototype.closeChat=function(e){var t={method:"closeChat",params:{sid:s.getState("sid")}};return e&&(t.params.rating=e),this.websocket?this.sendData(t):void o.post(this.options.serverUrl,t,function(n,a){return n?void this.emit("Error",n,t):(s.saveState("chat",!1),void this.emit("chat/close",{rating:e,url:c.href}))}.bind(this))},a.prototype.sendMessage=function(e,t){var n={method:"message",params:{sid:s.getState("sid"),content:e.message}};if(this.websocket)if(e.file){var a=m+Date.now()+"_"+this.options.pageid+"_"+e.message;n.params.content=a,o.put(a,e.file,function(e,t){return e?console.error("sendMessage error: ",e):void this.sendData(n)})}else this.sendData(n);else o.post(this.options.serverUrl,n,function(e,a){return e?(this.emit("Error",e,{method:"sendMessage",params:n}),void(t&&t(e))):void(t&&t())})},a.prototype.sendEmail=function(e,t){e.sid=s.getState("sid");var n={method:"sendMail",params:e};return this.websocket?this.sendData(n):void o.post(this.options.serverUrl,n,function(n,a){return n?(this.emit("Error",n,{method:"sendEmail",params:e}),void(t&&t(n))):(this.emit("chat/send",e),void(t&&t(null,a)))}.bind(this))},a.prototype.requestCallback=function(e,t){e.sid=s.getState("sid");var n={method:"requestCallback",params:e};return this.websocket?this.sendData(n):void o.post(this.options.serverUrl,n,function(n,a){return n?(this.emit("Error",n,{method:"requestCallback",params:e}),t(n)):void(t&&t(null,a.result))}.bind(this))},a.prototype.disjoinSession=function(e){var t={method:"disjoinSession",params:{sid:e}};return this.websocket?this.sendData(t):void o.post(this.options.serverUrl,t,function(t,n){return t?void this.emit("Error",t,{method:"disjoinSession",params:{sid:e}}):void this.emit("session/disjoin",{url:c.href})}.bind(this))},a.prototype.switchShareState=function(e,t){var n=e?"shareOpened":"shareClosed";o.post(this.options.serverUrl,{method:n,params:{sid:s.getState("sid"),url:t}},function(t,n){return t?void this.emit("Error",t,{method:"switchShareState",params:{state:e}}):void 0}.bind(this))},a.prototype.setChatTimeout=function(e){return setTimeout(function(){this.emit("chat/timeout")}.bind(this),1e3*e)},a.prototype.userIsTyping=function(){var e={method:"typing",params:{sid:s.getState("sid")}};return this.websocket?this.sendData(e):void o.post(this.options.serverUrl,e,function(e){return e?void this.emit("Error",e,{method:"setChatTimeout"}):void 0}.bind(this))},a.prototype.updateUrl=function(e){var t={method:"updateUrl",params:{sid:s.getState("sid"),url:e}};return this.websocket?this.sendData(t):void o.post(this.options.serverUrl,t,function(t,n){return t?void this.emit("Error",t,{method:"updateUrl",params:{url:e}}):void 0}.bind(this))},a.prototype.linkFollowed=function(e){var t={method:"linkFollowed",params:{sid:s.getState("sid"),url:e}};return this.websocket?this.sendData(t):void o.post(this.options.serverUrl,t,function(t,n){return t?void this.emit("Error",t,{method:"linkFollowed",params:{url:e}}):void 0}.bind(this))},a.prototype.getSidFromUrl=function(e){var t=e.substring(e.indexOf("chatSessionId="));return t=t.substring(t.indexOf("=")+1)},a.prototype.createWebsocket=function(e){var t="wss:",a=new WebSocket(t+"//"+g,"json.api.smile-soft.com");a.onopen=function(e){console.log("WebSocket opened: ",e),f=1,_||this.init()}.bind(this),a.onmessage=this.onWebsocketMessage.bind(this),a.onclose=this.onWebsocketClose.bind(this),a.onerror=this.onError,n.onbeforeunload=function(){a.onclose=function(){},a.close()},this.websocket=a},a.prototype.onWebsocketClose=function(e){console.log("WebSocket closed",e);var t=r(f);setTimeout(function(){f++,this.createWebsocket()}.bind(this),t)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./debug":77,"./lodash":78,"./request":80,"./storage":81,events:2,inherits:3}],77:[function(e,t,n){(function(e){function n(t,n){return e.localStorage.getItem("swc.debug")?void[].forEach.call(t,function(t){e.console[n]?e.console[n](t):e.console.log(t)}):void 0}t.exports={log:function(){n(arguments,"log")},info:function(){n(arguments,"info")},warn:function(){n(arguments,"warn")},error:function(){n(arguments,"error")}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],78:[function(e,t,n){function a(e,t,n){var a;return function(){var r=this,i=arguments,s=function(){a=null,n||e.apply(r,i)},o=n&&!a;clearTimeout(a),a=setTimeout(s,t),o&&e.apply(r,i)}}function r(e,t){for(var n=t.charAt(0);e&&e!==document;e=e.parentNode)if("."===n){if(e.classList.contains(t.substr(1)))return e}else if("#"===n){if(e.id===t.substr(1))return e}else if("["===n){if(e.hasAttribute(t.substr(1,t.length-2)))return e}else if(e.nodeName===t.toUpperCase())return e;return!1}function i(e,t,n,a,r){var i=Number(new Date)+(a||2e3);r=r||300,function s(){e()?t():Number(new Date)<i?setTimeout(s,r):n(new Error("timed out for "+e+": "+arguments))}()}var s=e("lodash/string/template"),o=e("lodash/collection/forEach"),l=e("lodash/object/assign"),c=e("lodash/object/merge"),u=e("lodash/lang/isEqual"),d=e("lodash/string/trim"),f=e("lodash/function/throttle");e("lodash/function/debounce");t.exports={template:s,forEach:o,assign:l,merge:c,isEqual:u,trim:d,throttle:f,debounce:a,poll:i,findParent:r}},{"lodash/collection/forEach":4,"lodash/function/debounce":6,"lodash/function/throttle":8,"lodash/lang/isEqual":56,"lodash/object/assign":64,"lodash/object/merge":67,"lodash/string/template":69,"lodash/string/trim":71}],79:[function(e,t,n){var a=e("./widget.js");e("./core.js");t.exports=a.module},{"./core.js":76,"./widget.js":84}],80:[function(e,t,n){function a(e,t,n){var t=JSON.stringify(t);s("POST",e,t,function(e,t){return o.log("post respose: ",e,t),e?n(e):void n(null,t)})}function r(e,t,n){return e&&l[e]?n(null,l[e]):void s("GET",t,null,function(t,a){return t?n(t):(e&&(l[e]=a),void n(null,a))})}function i(e,t,n){s("PUT",e,t,function(e,t){return o.log("put respose: ",e,t),e?n(e):void n(null,t)})}function s(e,t,n,a){var r,i,s;r=new XMLHttpRequest,r.open(e,t,!0),s=setTimeout(function(){r.abort()},6e4),r.onreadystatechange=function(){if(4==r.readyState&&(clearTimeout(s),r.response)){if(i="POST"===e?JSON.parse(r.response):r.response,i.error)return a(i.error);a(null,i)}},"POST"===e&&r.setRequestHeader("Content-Type","application/json; charset=UTF-8"),n?r.send(n):r.send()}var o=e("./debug"),l={};t.exports={post:a,get:r,put:i}},{"./debug":77}],81:[function(e,t,n){(function(e){function n(e,t){return"session"===t?JSON.parse(c.getItem(u+d+e)):JSON.parse(l.getItem(u+d+e))}function a(e,t,n){return"session"===n?c.setItem(u+d+e,JSON.stringify(t)):l.setItem(u+d+e,JSON.stringify(t)),t}function r(e,t){"session"===t?c.removeItem(u+d+e):l.removeItem(u+d+e)}function i(e,t){return t?"cache"===t?f[e]:n(e,t):void 0!==f[e]&&null!==f[e]?f[e]:n(e)}function s(e,t,n){return f[e]=t,"cache"!==n&&a(e,t,n),t}function o(e,t){delete f[e],r(e)}var l=e.localStorage,c=e.sessionStorage,u="swc",d=".",f={sid:null,eventTimestamp:0,msgTimestamp:0,entity:void 0,chat:null};t.exports={get:n,set:a,remove:r,getState:i,saveState:s,removeState:o}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],82:[function(require,module,exports){var _={},escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},escapeRegexp=new RegExp("["+Object.keys(escapeMap).join("")+"]","g");_.escape=function(e){return e?String(e).replace(escapeRegexp,function(e){return escapeMap[e]}):""},exports.email=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;Array.prototype.join;with(obj){var prefix=defaults.prefix;__p+='\n<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">\n<html xmlns="http://www.w3.org/1999/xhtml">\n    <head>\n        <meta http-equiv="Content-Type" content="text/html; charset=windows-1251" />\n        <!--[if !mso]><!-->\n            <meta http-equiv="X-UA-Compatible" content="IE=edge" />\n        <!--<![endif]-->\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title></title>\n        <!--[if (gte mso 9)|(IE)]>\n        <style type="text/css">\n            table {border-collapse: collapse;}\n        </style>\n        <![endif]-->\n        <style type="text/css">\n            /* Basics */\n            body {\n            Margin: 0;\n                padding: 0;\n                min-width: 100%;\n                background-color: #ffffff;\n            }\n            table {\n                border-spacing: 0;\n                font-family: sans-serif;\n                color: #333333;\n            }\n            td {\n                padding: 0;\n            }\n            img {\n                border: 0;\n            }\n            .wrapper {\n                width: 100%;\n                table-layout: fixed;\n                -webkit-text-size-adjust: 100%;\n                -ms-text-size-adjust: 100%;\n                background-color: #F1F1F1;\n            }\n            .webkit {\n                max-width: 500px;\n            }\n            .outer {\n            Margin: 0 auto;\n                height: 100%;\n                width: 95%;\n                max-width: 500px;\n                padding: 10px;\n            }\n            p {\n                Margin: 0;\n            }\n            a {\n                color: #ee6a56;\n                text-decoration: underline;\n            }\n            .h1 {\n                font-size: 21px;\n                font-weight: bold;\n                Margin-bottom: 18px;\n            }\n            .h2 {\n                font-size: 18px;\n                font-weight: bold;\n                Margin-bottom: 12px;\n            }\n             \n            /* One column layout */\n            .one-column .contents {\n                text-align: left;\n                color:#505050;\n                font-family:Arial;\n                font-size:14px;\n                line-height:150%;\n            }\n            .one-column p {\n                font-size: 14px;\n                Margin-bottom: 10px;\n            }\n            .'+__e(prefix)+"-message {\n                display: block;\n                margin-bottom: 10px;\n                padding: 10px;\n                background-color: #FFFFFF;\n                border-bottom: 4px solid #CCCCCC;\n            }\n            ."+__e(prefix)+"-message img {\n                width: 100%;\n                max-width: 500px;\n                height: auto;\n            }\n            ."+__e(prefix)+"-message span {\n                font-weight: bold;\n                color: #999999;\n            }\n            ."+__e(prefix)+"-agent-msg ."+__e(prefix)+"-message-from {\n                color: #555555;\n            }\n            ."+__e(prefix)+"-user-msg ."+__e(prefix)+"-message-from {\n                color: #F75B5D;\n            }\n\n            ."+__e(prefix)+"-message ."+__e(prefix)+'-message-time {\n                position: relative;\n                float: right;\n            }\n            .copyright {\n                margin-top: 5px;\n                font-size: 12px;\n                font-style: italic;\n                color: #CCCCCC;\n                text-align: right;\n            }\n\n        </style>\n    </head>\n    <body>\n        <center class="wrapper">\n            <div class="webkit">\n                <!--[if (gte mso 9)|(IE)]>\n                <table width="500" align="center" cellpadding="0" cellspacing="0" border="0">\n                <tr>\n                <td>\n                <![endif]-->\n                <table class="outer" align="center" cellpadding="0" cellspacing="0" border="0">\n                    <tr>\n                        <td class="one-column">\n                            <table width="100%">\n                                <tr>\n                                    <td class="inner contents">\n                                        '+(null==(__t=content)?"":__t)+"\n                                    </td>\n                                </tr>\n                            </table>\n                        </td>\n                    </tr>\n                </table>\n                <!--[if (gte mso 9)|(IE)]>\n                </td>\n                </tr>\n                </table>\n                <![endif]-->\n            </div>\n        </center>\n    </body>\n</html>"}return __p};var _={},escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},escapeRegexp=new RegExp("["+Object.keys(escapeMap).join("")+"]","g");_.escape=function(e){return e?String(e).replace(escapeRegexp,function(e){return escapeMap[e]}):""},exports.forms=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;Array.prototype.join;with(obj)__p+='<div class="'+__e(defaults.prefix)+"-message "+__e(defaults.prefix)+"-"+__e(message.entity)+'-msg">\n	<span class="'+__e(defaults.prefix)+'-message-from">'+__e(message.from)+'</span>\n	<div class="'+__e(defaults.prefix)+'-message-content" ',"user"===message.entity&&(__p+=" style=\"border-color:'"+__e(defaults.styles.primary.backgroundColor)+'" '),__p+=">\n		",form.description&&(__p+="\n			<p>"+(null==(__t=frases.FORMS.DESCRIPTIONS[form.description]||form.description)?"":__t)+"</p>\n		"),__p+='\n		<form name="'+__e(form.name)+'" ',form.autocomplete&&(__p+='autocomplete="on"'),__p+=' data-validate-form="true">\n			',_.forEach(form.fields,function(e){__p+="\n				","select"!==e.type&&(__p+='\n					<input \n						type="'+(null==(__t=e.type||"text")?"":__t)+'"\n						placeholder="'+(null==(__t=frases.FORMS.PLACEHOLDERS[e.placeholder]||frases.FORMS.PLACEHOLDERS[e.name])?"":__t)+" ",e.required&&(__p+="*"),__p+='"\n						name="'+__e(e.name)+'" ',e.value&&(__p+='\n						value="'+__e(credentials[e.value])+'" '),__p+=" ",e.required&&(__p+="required"),__p+=">\n				"),__p+="\n				","select"===e.type&&(__p+='\n					<select name="'+__e(e.name)+'">\n						',_.forEach(e.options,function(e){__p+='\n							<option value="'+__e(e.value)+'" ',e.selected&&(__p+=" selected "),__p+=" >\n								"+__e(frases.FORMS.PLACEHOLDERS[e.text]||e.text)+"\n							</option>\n						"}),__p+="\n					</select>\n				"),__p+="\n			"}),__p+='\n			<button \n				type="submit"\n				class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block"\n				style="background-color: '+__e(defaults.styles.primary.backgroundColor)+"; color: "+__e(defaults.styles.primary.color)+"; border: 1px solid "+__e(defaults.styles.primary.backgroundColor)+';">'+__e(frases.FORMS.send)+'</button>\n			<button\n				class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block"\n				data-'+__e(defaults.prefix)+'-handler="rejectForm">'+__e(frases.FORMS.cancel)+'</button>\n		</form>\n	</div>\n	<span class="'+__e(defaults.prefix)+'-message-time"> '+__e(message.time)+"</span>\n</div>";return __p};var _={},escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},escapeRegexp=new RegExp("["+Object.keys(escapeMap).join("")+"]","g");_.escape=function(e){return e?String(e).replace(escapeRegexp,function(e){return escapeMap[e]}):""},exports.message=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;Array.prototype.join;with(obj)__p+='<div class="'+__e(defaults.prefix)+"-message "+__e(defaults.prefix)+"-"+__e(message.entity)+'-msg">\n	<span class="'+__e(defaults.prefix)+'-message-from">'+__e(message.from)+'</span>\n	<div class="'+__e(defaults.prefix)+'-message-content" \n		',"user"===message.entity&&(__p+=' \n			style="border-color:',defaults.styles.primary.backgroundColor,__p+='" \n		'),__p+=">\n		<p>"+(null==(__t=message.content)?"":__t)+'</p>\n	</div>\n	<span class="'+__e(defaults.prefix)+'-message-time"> '+__e(message.time)+"</span>\n</div>";return __p};var _={},escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},escapeRegexp=new RegExp("["+Object.keys(escapeMap).join("")+"]","g");_.escape=function(e){return e?String(e).replace(escapeRegexp,function(e){return escapeMap[e]}):""},exports.widget=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;Array.prototype.join;with(obj){var frases=translations[currLang];__p+="\n";var panels=frases.PANELS;__p+="\n";var channels=defaults.channels;__p+="\n";var positionClass="right"===defaults.position?"position-right":"position-left";__p+='\n<div id="'+__e(defaults.prefix)+'-wg-cont" class="'+__e(defaults.prefix)+"-wg-cont "+__e(positionClass)+'">\n\n	<!-- ***** Panes container ***** -->\n	<div \n		id="'+__e(defaults.prefix)+'-wg-panes" \n		class="'+__e(defaults.prefix)+'-wg-panes" \n		style="',defaults.styles.width&&(__p+="width: "+__e(defaults.styles.width)+";"),__p+='">\n\n		<!-- ***** Top bar ***** -->\n		<div \n			class="'+__e(defaults.prefix)+'-top-bar" \n			style="background: '+__e(defaults.styles.primary.backgroundColor)+"; color: "+__e(defaults.styles.primary.color)+';">\n\n			<!-- Main title -->\n			<h4 class="'+__e(defaults.prefix)+"-wg-title "+__e(defaults.prefix)+'-uppercase">\n				'+__e(defaults.title||frases.TOP_BAR.title)+'\n			</h4>\n\n			<div class="'+__e(defaults.prefix)+'-wg-state-cont">\n				<span class="'+__e(defaults.prefix)+'-wg-state-icon"> </span>\n				<span class="'+__e(defaults.prefix)+'-wg-state"></span>\n			</div>\n\n			<!-- Action buttons (minimize, close) -->\n			<div class="'+__e(defaults.prefix)+'-wg-minimize">\n\n				<!--<a \n					href="#" \n					data-'+__e(defaults.prefix)+'-handler="closeWidget">\n					\n					<span style="font-weight: bold">_</span>\n				\n				</a>-->\n				\n				<a \n					href="#" \n					style="color: '+__e(defaults.styles.primary.color)+'"\n					data-'+__e(defaults.prefix)+'-handler="closeWidget"\n					<span class="'+__e(defaults.prefix)+'-icon-remove"></span>\n\n				</a>\n\n			</div>\n		</div>\n		<!-- ***** Top bar ends ***** -->\n\n		<!-- ***** Connection types pane ***** -->\n		<div \n			class="'+__e(defaults.prefix)+'-wg-pane" \n			data-'+__e(defaults.prefix)+'-pane="chooseConnection">\n			\n			<!-- Panel\'s image container -->\n			<div \n				class="'+__e(defaults.prefix)+"-pane-header "+__e(defaults.prefix)+'-dark" \n				',defaults.styles.intro.backgroundImage&&(__p+=' \n					style="background-image: url('+__e(defaults.clientPath)+__e(defaults.styles.intro.backgroundImage)+')" \n				'),__p+='>\n\n				<!-- The text displayed on image -->\n				<div class="'+__e(defaults.prefix)+"-backdrop-cont "+__e(defaults.prefix)+'-white">\n					<br>\n					<p>'+__e(panels.CONNECTION_TYPES.choose_conn_type)+'</p>\n				</div>\n\n			</div>\n			<div class="'+__e(defaults.prefix)+'-pane-body">\n\n				<form \n					id="'+__e(defaults.prefix)+'-init-form" \n					name="'+__e(defaults.prefix)+'InitForm">\n\n					',channels.webrtc&&(__p+=" \n						<!-- Display call button if WebRTC is enabled and supported by the browser -->\n						",defaults.webrtcEnabled?__p+=' \n							<button \n								type="button" \n								class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n								style="\n									background: '+__e(defaults.styles.primary.backgroundColor)+"; \n									color: "+__e(defaults.styles.primary.color)+"; \n									border: 1px solid "+__e(defaults.styles.primary.color)+';"\n								data-'+__e(defaults.prefix)+'-handler="initCall">\n\n								'+__e(panels.CONNECTION_TYPES.call_agent_btn)+"\n\n							</button>\n							<!-- If WebRTC is not supported and fallback is set -->\n						":channels.webrtc.fallback&&channels.webrtc.fallback.sipCall&&(__p+='\n							<button \n								type="button" \n								class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n								style="\n									background: '+__e(defaults.styles.primary.backgroundColor)+"; \n									color: "+__e(defaults.styles.primary.color)+"; \n									border: 1px solid "+__e(defaults.styles.primary.color)+';"\n								data-'+__e(defaults.prefix)+'-handler="initFallbackCall">\n\n								'+__e(panels.CONNECTION_TYPES.call_agent_btn)+"\n\n							</button>\n						"),__p+="\n					"),__p+="\n\n					<!-- Display callback button if callback task is configured in the settings -->\n					",channels.callback&&channels.callback.task&&(__p+='\n						<button \n							type="button" \n							class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n							style="\n								background: '+__e(defaults.styles.primary.backgroundColor)+"; \n								color: "+__e(defaults.styles.primary.color)+"; \n								border: 1px solid "+__e(defaults.styles.primary.color)+';"\n							data-'+__e(defaults.prefix)+'-handler="initCallback">\n\n							'+__e(panels.CONNECTION_TYPES.callback_btn)+"\n\n						</button>\n					"),__p+="\n\n					<!-- Init chat button -->\n					",defaults.chat&&(__p+='\n					<button\n						type="button" \n						class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n						style="background: '+__e(defaults.styles.primary.backgroundColor)+"; color: "+__e(defaults.styles.primary.color)+"; border: 1px solid "+__e(defaults.styles.primary.color)+';"\n						data-'+__e(defaults.prefix)+'-handler="initChat">\n						'+__e(panels.CONNECTION_TYPES.chat_agent_btn)+"\n					</button>\n					"),__p+='\n\n					<!-- Close widget button -->\n					<a href="#" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block" data-'+__e(defaults.prefix)+'-handler="closeWidget">'+__e(panels.CONNECTION_TYPES.cancel)+"</a>\n				</form>\n			</div>\n		</div>\n		<!-- ***** Connection types pane ends ***** -->\n\n		<!-- ***** Intro pane. Displayed if configured in the settings object. ***** -->\n		",defaults.intro.length&&(__p+='\n			<div \n				class="'+__e(defaults.prefix)+'-wg-pane" \n				data-'+__e(defaults.prefix)+'-pane="credentials">\n\n				<!-- Panel\'s image container -->\n				<div \n					class="'+__e(defaults.prefix)+"-pane-header "+__e(defaults.prefix)+'-dark" \n					',defaults.styles.intro.backgroundImage&&(__p+=' \n						style="background-image: url('+__e(defaults.clientPath)+__e(defaults.styles.intro.backgroundImage)+')" \n					'),__p+='>\n\n					<!-- The text displayed on image -->\n					<div class="'+__e(defaults.prefix)+"-backdrop-cont "+__e(defaults.prefix)+'-white">\n						<br>\n						<p>'+__e(panels.INTRO.intro_message)+'</p>\n					</div>\n\n				</div>\n\n				<div class="'+__e(defaults.prefix)+'-pane-body">\n					<form \n						id="'+__e(defaults.prefix)+'-intro-form" \n						name="'+__e(defaults.prefix)+'IntroForm" \n						data-validate-form="true">\n\n						<!-- Iterating over intro array, which is a list of fields and their properties -->\n						',_.forEach(defaults.intro,function(e){__p+="\n							","lang"!==e.name&&(__p+='\n								<input \n									type="'+(null==(__t=e.type||"text")?"":__t)+'" \n									placeholder="'+(null==(__t=e.placeholder||panels.INTRO.PLACEHOLDERS[e.name])?"":__t)+" ",e.required&&(__p+=" * "),__p+='" \n									name="'+__e(e.name)+'" \n									',e.save&&(__p+=' value="'+__e(credentials[e.name])+'" '),__p+=" \n									",e.required&&(__p+=" required "),__p+=">\n							"),__p+="\n\n							","lang"===e.name&&(__p+='\n								<select name="lang">\n									',_.forEach(languages,function(e){__p+='\n										<option \n											value="'+__e(e)+'" \n											',e===currLang&&(__p+=" selected "),__p+=" >\n											"+__e(translations[e].lang)+"\n										</option>\n									"}),__p+="\n								</select>\n							"),__p+="\n\n						"}),__p+='\n\n						<!-- Init chat with intro properties -->\n						<button \n							type="submit" \n							class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n							style="\n								background: '+__e(defaults.styles.primary.backgroundColor)+"; \n								color: "+__e(defaults.styles.primary.color)+"; \n								border: 1px solid "+__e(defaults.styles.primary.color)+';">\n\n							'+__e(panels.INTRO.start_dialog_button)+'\n									\n						</button>\n\n						<!-- Close widget button -->\n						<a href="#" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block" data-'+__e(defaults.prefix)+'-handler="closeWidget">'+__e(panels.INTRO.cancel)+"</a>\n					</form>\n				</div>\n			</div>\n		"),__p+='\n		<!-- ***** Intro pane ends ***** -->\n\n		<!-- ***** Messages pane ***** -->\n		<div  class="'+__e(defaults.prefix)+'-wg-pane" data-'+__e(defaults.prefix)+'-pane="messages">\n			\n			<!-- Messages container -->\n			<ul \n				id="'+__e(defaults.prefix)+'-messages-cont" \n				class="'+__e(defaults.prefix)+'-messages-cont" \n				style="\n					',defaults.styles.height&&(__p+="\n						height: "+__e(defaults.styles.height)+";\n					"),__p+='">\n					\n			</ul>\n\n			<div class="'+__e(defaults.prefix)+'-write-cont">\n				\n				<!-- End dialog button -->\n				<div class="'+__e(defaults.prefix)+'-end-dialog-btn">\n					<a href="#" data-'+__e(defaults.prefix)+'-handler="finish">'+__e(panels.MESSAGES.end_dialog)+'</a>\n				</div>\n\n				<!-- "Agent is typing" indicator -->\n				<div class="'+__e(defaults.prefix)+'-loader">\n					<span></span>\n					<span></span>\n					<span></span>\n				</div>\n\n				<!-- "Attach file" button -->\n				<label \n					class="'+__e(defaults.prefix)+'-sendfile-cont" \n					for="'+__e(defaults.prefix)+'-file-select">\n\n					<input \n						type="file" \n						id="'+__e(defaults.prefix)+'-file-select">\n					\n					<span \n						class="'+__e(defaults.prefix)+'-icon-upload" \n						style="color: '+__e(defaults.styles.primary.backgroundColor)+'">\n					<span>\n\n				</label>\n\n				<div id="'+__e(defaults.prefix)+'-message-text-clone"  class="'+__e(defaults.prefix)+'-msg-textarea-clone" ></div>\n\n				<!-- Field for typing the user message -->\n				<textarea \n					id="'+__e(defaults.prefix)+'-message-text" \n					class="'+__e(defaults.prefix)+'-msg-textarea" \n					placeholder="'+__e(panels.MESSAGES.PLACEHOLDERS.message)+'" \n					maxlength="1000"></textarea>\n				\n				<!-- "Send a message" button -->\n				<a \n					href="#" \n					class="'+__e(defaults.prefix)+"-sendmsg-btn "+__e(defaults.prefix)+'-button" \n					data-'+__e(defaults.prefix)+'-handler="sendMessage">\n\n					<span \n						class="'+__e(defaults.prefix)+'-icon-paper-plane" \n						style="color: '+__e(defaults.styles.primary.backgroundColor)+'">\n					</span>\n				</a>\n\n			</div>\n		</div>\n		<!-- ***** Messages pane ends ***** -->\n\n		<!-- ***** Offline pane ***** -->\n		<div \n			class="'+__e(defaults.prefix)+'-wg-pane" \n			data-'+__e(defaults.prefix)+'-pane="sendemail">\n\n			<!-- Panel\'s image container -->\n			<div \n				class="'+__e(defaults.prefix)+"-pane-header "+__e(defaults.prefix)+'-dark" \n				',
defaults.styles.sendmail.backgroundImage&&(__p+=' \n					style="background-image: url('+__e(defaults.clientPath)+__e(defaults.styles.sendmail.backgroundImage)+')" \n				'),__p+='>\n\n				<!-- The text displayed on image -->\n				<div class="'+__e(defaults.prefix)+"-backdrop-cont "+__e(defaults.prefix)+'-dark">\n					<p>'+__e(panels.OFFLINE.offline_message)+'</p>\n				</div>\n\n			</div>\n\n			<div class="'+__e(defaults.prefix)+'-pane-body">\n				<h4 class="'+__e(defaults.prefix)+'-uppercase">'+__e(panels.OFFLINE.send_message_header)+'</h4>\n				<form id="'+__e(defaults.prefix)+'-sendmail-form" data-validate-form="true">\n					<input type="text" name="uname" placeholder="'+__e(panels.OFFLINE.PLACEHOLDERS.uname)+'">\n					<input type="email" name="email" placeholder="'+__e(panels.OFFLINE.PLACEHOLDERS.email)+' *" required>\n					<textarea name="text" placeholder="'+__e(panels.OFFLINE.PLACEHOLDERS.message)+'" maxlength="1500"></textarea>\n\n					<input type="file" name="file" id="'+__e(defaults.prefix)+'-contactfile" class="'+__e(defaults.prefix)+'-inputfile" />\n					<label for="'+__e(defaults.prefix)+'-contactfile">'+__e(panels.OFFLINE.choose_file)+'</label>\n\n					<!-- "Send offline message" button -->\n					<button \n						type="submit" \n						class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n						style="\n							background: '+__e(defaults.styles.primary.backgroundColor)+"; \n							color: "+__e(defaults.styles.primary.color)+"; \n							border: 1px solid "+__e(defaults.styles.primary.color)+';">\n\n						'+__e(panels.OFFLINE.send_message_button)+'\n							\n					</button>\n\n					<!-- Close widget button -->\n					<a href="#" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block" data-'+__e(defaults.prefix)+'-handler="closeWidget">'+__e(panels.OFFLINE.close)+'</a>\n				</form>\n			</div>\n		</div>\n		<!-- ***** Offline pane ends ***** -->\n\n		<!-- ***** Close chat pane ***** -->\n		<div \n			class="'+__e(defaults.prefix)+'-wg-pane" \n			data-'+__e(defaults.prefix)+'-pane="closechat">\n\n			<!-- Panel\'s image container -->\n			<div \n				class="'+__e(defaults.prefix)+"-pane-header "+__e(defaults.prefix)+'-white" \n				',defaults.styles.closeChat.backgroundImage&&(__p+=' \n					style="background-image: url('+__e(defaults.clientPath)+__e(defaults.styles.closeChat.backgroundImage)+')" \n				'),__p+='>\n\n				<!-- The text displayed on image -->\n				<div class="'+__e(defaults.prefix)+"-backdrop-cont "+__e(defaults.prefix)+'-white">\n					<br>\n					<p>'+__e(panels.CLOSE_CHAT.close_chat_header)+'</p>\n				</div>\n\n			</div>\n\n			<div class="'+__e(defaults.prefix)+'-pane-body">\n				<form id="'+__e(defaults.prefix)+'-closechat-form" data-validate-form="true">\n					<label for="'+__e(defaults.prefix)+'-send-dialog">\n						<input type="checkbox" name="sendDialog" id="'+__e(defaults.prefix)+'-send-dialog" />\n						<span>'+__e(panels.CLOSE_CHAT.send_dialog_label)+'</span>\n					</label>\n					<input type="email" name="email" placeholder="'+__e(panels.CLOSE_CHAT.PLACEHOLDERS.email)+'">\n					<select name="rating">\n						<option value="">--- '+__e(panels.CLOSE_CHAT.rate_agent)+' ---</option>\n						<option value="5">'+__e(frases.AGENT_RATES.excellent)+'</option>\n						<option value="4">'+__e(frases.AGENT_RATES.good)+'</option>\n						<option value="3">'+__e(frases.AGENT_RATES.fair)+'</option>\n						<option value="2">'+__e(frases.AGENT_RATES.bad)+'</option>\n					</select>\n					<textarea placeholder="'+__e(panels.CLOSE_CHAT.PLACEHOLDERS.comment)+'" name="text" maxlength="1500"></textarea>\n\n					<!-- End chat and close widget button -->\n					<button \n						type="submit" \n						class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n						style="\n							background: '+__e(defaults.styles.primary.backgroundColor)+"; \n							color: "+__e(defaults.styles.primary.color)+"; \n							border: 1px solid "+__e(defaults.styles.primary.color)+';">\n\n						'+__e(panels.CLOSE_CHAT.finish_dialog_button)+'\n							\n					</button>\n\n					<!-- "Back to the chat" button -->\n					<a href="#messages" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block">'+__e(panels.CLOSE_CHAT.back)+'</a>\n				</form>\n			</div>\n		</div>\n		<!-- ***** Close chat pane ends ***** -->\n\n		<!-- ***** Audio call pane ***** -->\n		<div class="'+__e(defaults.prefix)+'-wg-pane" data-'+__e(defaults.prefix)+'-pane="callAgent">\n			<div class="'+__e(defaults.prefix)+'-pane-body">\n				<div id="'+__e(defaults.prefix)+'-call-spinner" class="'+__e(defaults.prefix)+'-spinner-pane">\n					<h3 class="'+__e(defaults.prefix)+'-text-center">'+__e(panels.AUDIO_CALL.confirm_access)+'</h3>\n					<h3 class="'+__e(defaults.prefix)+"-text-center "+__e(defaults.prefix)+"-loader "+__e(defaults.prefix)+'-shown" style="position: relative;">\n						<span></span>\n						<span></span>\n						<span></span>\n					</h3>\n				</div>\n				<div id="'+__e(defaults.prefix)+'-call-info" class="'+__e(defaults.prefix)+'-hidden">\n					<h3 class="'+__e(defaults.prefix)+'-text-center" id="'+__e(defaults.prefix)+'-call-state">'+__e(panels.AUDIO_CALL.calling_agent)+'</h3>\n					<h3 class="'+__e(defaults.prefix)+'-text-center" id="'+__e(defaults.prefix)+'-call-timer">00:00</h3>\n				</div>\n				<form id="'+__e(defaults.prefix)+'-call-control">\n					<hr>\n					<button\n						id="'+__e(defaults.prefix)+'-tryagain-btn"\n						type="button"\n						class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+"-block "+__e(defaults.prefix)+'-hidden"\n						style="background: '+__e(defaults.styles.primary.backgroundColor)+"; color: "+__e(defaults.styles.primary.color)+"; border: 1px solid "+__e(defaults.styles.primary.color)+';"\n						data-'+__e(defaults.prefix)+'-handler="initCall">\n						'+__e(panels.AUDIO_CALL.try_again)+'\n					</button>	\n					<button \n						type="button"\n						class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-warn "+__e(defaults.prefix)+'-block"\n						data-'+__e(defaults.prefix)+'-handler="endCall">\n\n						'+__e(panels.AUDIO_CALL.end_call)+'\n\n					</button>\n				</form>\n			</div>\n		</div>\n		<!-- ***** Audio call pane ends ***** -->\n\n		<!-- ***** Audio call fallback pane ***** -->\n		<div class="'+__e(defaults.prefix)+'-wg-pane" data-'+__e(defaults.prefix)+'-pane="callAgentFallback">\n			<div class="'+__e(defaults.prefix)+'-pane-body">\n				<div class="'+__e(defaults.prefix)+'-text-center">\n					<h3>'+__e(panels.AUDIO_CALL_FALLBACK.DOWNLOAD_MSG)+"</h3>\n					<br>\n					",defaults.webrtc&&defaults.webrtc.fallback&&(__p+='\n						<a href="'+__e(defaults.webrtc.fallback.sipCall)+'">call.jnlp</a>\n					'),__p+='\n				</div>\n				<form>\n					<hr>\n					<a href="#chooseConnection" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block">'+__e(panels.CALLBACK.back)+'</a>\n				</form>\n			</div>\n		</div>\n		<!-- ***** Audio call fallback pane ends ***** -->\n\n		<!-- ***** Callback pane ***** -->\n		<div \n			class="'+__e(defaults.prefix)+'-wg-pane" \n			data-'+__e(defaults.prefix)+'-pane="callback">\n\n			<div class="'+__e(defaults.prefix)+'-pane-body">\n				<div id="'+__e(defaults.prefix)+'-callback-spinner" class="'+__e(defaults.prefix)+"-hidden "+__e(defaults.prefix)+'-spinner-pane">\n					<h3 class="'+__e(defaults.prefix)+'-text-center">'+__e(panels.CALLBACK.sending_request)+'</h3>\n					<h3 class="'+__e(defaults.prefix)+"-text-center "+__e(defaults.prefix)+"-loader "+__e(defaults.prefix)+'-shown" style="position: relative;">\n						<span></span>\n						<span></span>\n						<span></span>\n					</h3>\n				</div>\n				<form id="'+__e(defaults.prefix)+'-callback-settings">\n					<p class="'+__e(defaults.prefix)+'-text-center">'+__e(panels.CALLBACK.title)+"</p>\n					<hr>\n					<label>"+__e(panels.CALLBACK.LABELS.phone)+'</label>\n					<input type="tel" name="phone" placeholder="'+__e(panels.CALLBACK.PLACEHOLDERS.phone)+'" required>\n					<label>'+__e(panels.CALLBACK.LABELS.time)+'</label>\n					<select name="time">\n						',_.forEach(panels.CALLBACK.TIME_POINTS,function(e){__p+='\n							<option value="'+__e(e.minutes)+'">'+__e(e.label)+"</option>\n						"}),__p+='\n					</select>\n					<hr>\n\n					<button\n						type="submit"\n						class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block"\n						style="\n							background: '+__e(defaults.styles.primary.backgroundColor)+"; \n							color: "+__e(defaults.styles.primary.color)+"; \n							border: 1px solid "+__e(defaults.styles.primary.color)+';"\n						data-'+__e(defaults.prefix)+'-handler="setCallback">\n\n						'+__e(panels.CALLBACK.confirm_callback)+'\n\n					</button>\n\n					<a href="#chooseConnection" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block">'+__e(panels.CALLBACK.back)+'</a>\n				</form>\n			</div>\n		</div>\n		<!-- ***** Callback pane ends ***** -->\n\n		<!-- ***** Callback sent pane ***** -->\n		<div class="'+__e(defaults.prefix)+'-wg-pane" data-'+__e(defaults.prefix)+'-pane="callbackSent">\n			<div class="'+__e(defaults.prefix)+'-pane-body">\n				<div id="'+__e(defaults.prefix)+'-callback-sent">\n					<h3 class="'+__e(defaults.prefix)+"-text-center "+__e(defaults.prefix)+"-icon-check "+__e(defaults.prefix)+'-text-success"></h3>\n					<p class="'+__e(defaults.prefix)+'-text-center">'+__e(panels.CALLBACK.request_sent)+'</p>\n					<form>\n						<hr>\n						<a href="#chooseConnection" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block">'+__e(panels.CALLBACK.back)+'</a>\n						<a href="#" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block" data-'+__e(defaults.prefix)+'-handler="closeWidget">'+__e(panels.CALLBACK.close)+'</a>\n					</form>\n				</div>\n			</div>\n		</div>\n		<!-- ***** Callback sent pane ends ***** -->\n\n	</div>\n	<!-- ***** Panes container ends ***** -->\n\n	<!-- ***** Floating button container ***** -->\n	<div id="'+__e(defaults.prefix)+'-btn-cont" class="'+__e(defaults.prefix)+'-btn-cont">\n		<div class="'+__e(defaults.prefix)+'-wg-btn">\n			<div class="'+__e(defaults.prefix)+'-lastmsg-cont">\n				<span class="'+__e(defaults.prefix)+'-unnotify-btn" id="'+__e(defaults.prefix)+'-unnotify-btn">'+__e(frases.FLOATING_BUTTON.close)+'</span>\n				<div id="'+__e(defaults.prefix)+'-lastmsg" class="'+__e(defaults.prefix)+'-lastmsg">\n				</div>	\n			</div>\n			<a href="#" class="'+__e(defaults.prefix)+'-btn-link">\n				<span class="'+__e(defaults.prefix)+'-btn-icon"></span>\n			</a>\n		</div>\n	</div>\n	<!-- ***** Floating button container ends ***** -->\n\n</div>'}return __p}},{}],83:[function(e,t,n){(function(n){function a(){var e=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia,n=window.mozRTCIceCandidate||window.RTCIceCandidate;return!!e&&!!t&&!!n}function r(){_.on("connected",function(e){v.log("sip connected event: ",e)}),_.on("disconnected",function(e){v.log("sip disconnected event: ",e)}),_.on("newMessage",function(e){v.log("sip newMessage event: ",e)}),_.on("newRTCSession",function(e){v.log("sip newRTCSession event: ",e),y.emit("webrtc/newRTCSession",e),h=e.session}),_.on("registered",function(e){v.log("sip registered event: ",e)}),_.on("unregistered",function(e){v.log("sip unregistered event: ",e)}),_.on("registrationFailed",function(e){v.log("sip registrationFailed event: ",e)}),b={progress:function(e){v.log("call progress event: ",e),y.emit("webrtc/progress",e)},failed:function(e){v.log("call failed event:",e),y.emit("webrtc/failed",e)},ended:function(e){v.log("call ended event: ",e),y.emit("webrtc/ended",e)},confirmed:function(e){v.log("call confirmed event: ",e),y.emit("webrtc/confirmed",e)},addstream:function(e){v.log("call addstream event: ",e),y.emit("webrtc/addstream",e);var t=e.stream;g.audioRemote=x.rtcninja.attachMediaStream(g.audioRemote,t)}}}function i(){return h.isEstablished()}function s(){return h.isInProgress()}function o(){return h.isEnded()}function l(){_.stop()}function c(e){h=_.call(e,{eventHandlers:b,mediaConstraints:{audio:!0,video:!1}})}function u(){h.terminate({status_code:200})}function d(){v.log("answer: ",_),h.answer()}function f(){v.log("hold: ",h.isOnHold()),h&&h.isOnHold().local?h.unhold():h.hold()}function p(){var e=document.createElement("audio");return e.setAttribute("autoplay","autoplay"),document.body.appendChild(e),e}function m(e){v.log("Initiating WebRTC module:",e),g=e,void 0===g.sip.register&&(g.sip.register=!1),y.emit=e.emit,y.on=e.on,g.audioRemote=p(),_=new x.UA(g.sip),r(),_.start()}var g,_,h,b,v=e("./debug"),y={},x=n.JsSIP;t.exports={lib:x,init:m,unregister:l,audiocall:c,terminate:u,answer:d,hold:f,isInProgress:s,isEstablished:i,isEnded:o,isSupported:a}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./debug":77}],84:[function(e,t,n){(function(n){function a(e){return st.initiated?ft:(Qe.merge(rt,e||{}),Ve.log("Widget: ",e),rt.clientPath=e.clientPath?e.clientPath:rt.clientPath||rt.server+rt.path,Re(),rt.buttonSelector&&V(rt.buttonSelector),at.init(rt.clientPath+"sounds/"),Ue=new Ye(e).on("session/create",o).on("session/continue",o).on("session/join",c).on("session/init",l),rt.widget&&Ue.on("chat/start",w).on("chat/close",R).on("chat/timeout",M).on("message/new",S).on("message/new",k).on("message/typing",F).on("callback/create",W).on("form/submit",xe).on("form/reject",we).on("widget/load",g),nt.isSupported()&&rt.channels.webrtc&&rt.channels.webrtc.sip&&void 0!==rt.channels.webrtc.sip.ws_servers&&("https:"===window.location.protocol?(rt.webrtcEnabled=!0,Ue.on("webrtc/newRTCSession",function(){H("newRTCSession")}),Ue.on("webrtc/progress",function(e){H(180===e.response.status_code?"ringing":"confirmed")}),Ue.on("webrtc/addstream",function(){H("connected")}),Ue.on("webrtc/ended",function(){H("ended")}),Ue.on("webrtc/failed",function(e){H("Canceled"===e.cause?"canceled":"failed")}),i({sip:rt.channels.webrtc.sip,emit:ft.emit,on:ft.on})):(Ve.warn("WebRTC feature is disabled"),Ve.warn("getUserMedia() no longer works on insecure origins. To use this feature, you should consider switching your application to a secure origin, such as HTTPS. See https://goo.gl/rStTGz for more details."))),P(),Xe.get("frases",(rt.translationsPath||rt.clientPath)+"translations.json",function(e,t){return e?Ue.emit("Error",e):void(Ze=JSON.parse(t))}),Xe.get("forms_json",rt.clientPath+"forms.json",function(e,t){return e?Ue.emit("Error",e):void(Be=JSON.parse(t).forms)}),ft)}function r(){return Ue.init(),ft}function i(e){Ve.log("initWebrtcModule: ",e),nt.init(e)}function s(){return rt.chat||rt.webrtcEnabled||rt.channels.callback.task?(Ve.log("session initiated"),ct=ct||Ce(),P(),p(),rt.widget&&!st.initiated&&Pe()&&u(),he("timeout")&&be("timeout"),rt.external||rt.cobrowsing&&d({url:window.location.href,entity:$e.getState("entity","session"),widget:"#"+rt.prefix+"-wg-cont"}),void Ue.emit("session/init",{options:rt,url:n.location.href})):!1}function o(){Qe.poll(function(){return Ve.log("poll: ",Ze),null!==Ze},function(){s(),rt.external||Ue.updateUrl(window.location.href)},function(){return 2>dt?(dt++,void a(rt)):Ue.emit("Error","Module wasn't initiated due to network errors")},6e4)}function l(){$e.saveState("init",!0,"session"),He&&!He.closed&&He.sessionStorage.setItem(rt.prefix+".init",!0)}function c(e){d({url:e.url,entity:$e.getState("entity","session")})}function u(e){compiled=ke("widget",{defaults:rt,languages:lt,translations:Ze,currLang:ct||rt.lang,credentials:$e.getState("credentials","session")||{},_:Qe}),We=Ge(compiled),document.body.appendChild(We),Ue.emit("widget/load",We)}function d(e){rt.external||et.isInitiated()||(Ue.on("cobrowsing/init",function(){($e.getState("shared","session")||"agent"===e.entity)&&et.share()}),Ue.on("cobrowsing/event",function(e){Ue.updateEvents(e.events,function(e,t){e||t&&et.updateEvents(t)})}),Ue.on("cobrowsing/shared",function(){$e.getState("shared","session")||"user"!==e.entity||($e.saveState("shared",!0,"session"),Ue.switchShareState(!0,e.url)),Ue.updateEvents([{entity:e.entity,url:e.url,shared:!0}],function(e,t){t.historyEvents=!0,et.updateEvents(t)})}),Ue.on("cobrowsing/unshared",function(e){$e.saveState("shared",!1,"session"),Ue.updateEvents([{entity:e.entity,url:e.url,shared:!1}],function(t){"user"===e.entity?Ue.switchShareState(!1,window.location.href):et.unshareAll()})}),et.init({widget:e.widget,entity:e.entity,emit:ft.emit,path:rt.clientPath}))}function f(){return We}function p(){Ue.getLanguages(function(e,t){Ve.log("getLanguages: ",e,t),e||t&&m(t)})}function m(e){var t=e.length?"online":"offline";lt=e,fe({state:t}),Ue.emit("chat/languages",e)}function g(){var e,t="";st.initiated=!0,me(),X(We),fe({state:pe()}),rt.hideOfflineButton&&_e("no-button"),rt.offer&&_(),$e.getState("chat")===!0&&(x($e.getState("credentials","session")||{}),$e.getState("opened","session")&&ve()),rt.webrtcEnabled&&_e("webrtc-enabled"),We&&rt.intro.length&&(lt.forEach(function(n){Ze[n]&&Ze[n].lang&&(e=n===ct?"selected":"",t+='<option value="'+n+'" '+e+" >"+Ze[n].lang+"</option>")}),n[rt.prefix+"IntroForm"].lang.innerHTML=t),Ue.emit("widget/init")}function _(){setTimeout(function(){h({from:rt.offer.from||Ze[ct].TOP_BAR.title,time:Date.now(),content:rt.offer.text||Ze[ct].default_offer})},rt.offer.inSeconds?1e3*rt.offer.inSeconds:3e4)}function h(e){"online"!==st.state||v()||k(e)}function b(){$e.getState("interacted","session")||$e.saveState("interacted",!0,"session")}function v(){return $e.getState("interacted","session")}function y(){ve(),$e.getState("chat","cache")||(lt.length?rt.intro.length?$e.getState("chat")?x($e.getState("credentials","session")):de("credentials"):x({lang:ct}):de("sendemail"))}function x(e){e.uname||(e.uname=$e.getState("sid").split("_")[0]),e.lang&&e.lang!==ct&&$e.saveState("lang",e.lang),e.lang||(e.lang=ct),$e.saveState("credentials",e,"session"),w({}),Se(),de("messages"),Ue.chatRequest(e)}function w(e){$e.saveState("chat",!0),e.timeout&&(qe=Ue.setChatTimeout(e.timeout)),_e("chat")}function E(e){Ue.sendMessage(e),k({from:$e.getState("credentials","session").uname,time:Date.now(),content:e.message}),qe&&clearTimeout(qe)}function k(e){var t,a,r=!1,i=!1,s=$e.getState("credentials","session")||{},o=$e.getState("aname","session"),l=s.uname?s.uname:"";if(messagesCont=document.getElementById(rt.prefix+"-messages-cont"),l===$e.getState("sid").split("_")[0]&&(i=!0),e.entity=e.from===l?"user":"agent",e.from="user"===e.entity&&i?"":e.from,e.time=Le(e.time?e.time:Date.now()),t=Ae(e.content,e.file,e.entity),"form"===t.type)a=ke("forms",{defaults:rt,message:e,form:t.content,credentials:s,frases:Ze[ct||rt.lang],_:Qe}),n[t.content.name]&&we({formName:t.content.name}),messagesCont.insertAdjacentHTML("beforeend","<li>"+a+"</li>"),messagesCont.scrollTop=messagesCont.scrollHeight;else{if(!e.content)return;e.content=t.content,a=ke("message",{defaults:rt,message:e}),messagesCont.insertAdjacentHTML("beforeend","<li "+(e.className?'class="'+e.className+'"':"")+">"+a+"</li>"),C(a),e.hidden||ot.push(a)}"agent"===e.entity&&o!==e.from&&$e.saveState("aname",e.from,"session"),"user"!==e.entity&&(r=!0),messagesCont.scrollTop=messagesCont.scrollHeight}function S(){var e=[].slice.call(document.querySelectorAll("."+rt.prefix+"-msg-undelivered"));e&&e.length&&e.forEach(function(e){e.classList.add(rt.prefix+"-hidden")})}function C(e){var t;st.active||(t=document.getElementById(rt.prefix+"-lastmsg"),t.innerHTML=e,_e("notified"),ge("notified"))}function L(e,t){var n=ke("email",{defaults:rt,content:e,frases:Ze[ct||rt.lang],_:Qe});return t?t(null,n):void 0}function A(e){var t=e.text.join("");L(t,function(t,n){t||(e.text=n,Ue.sendEmail(e))})}function O(e){var t=[],n=ke("message",{defaults:rt,message:{from:Ze[ct].EMAIL_SUBJECTS.complain+" "+e.email,content:e.text,entity:"",time:""}});t=t.concat(n,'<br><p class="h1">'+Ze[ct].EMAIL_SUBJECTS.dialog+" "+rt.host+"</p><br>",ot).reduce(function(e,t){return e.concat(t)}),L(t,function(t,n){t||(e.text=n,Ue.sendEmail(e))})}function j(e,t){var n=ke("message",{defaults:rt,message:{from:Ze[ct].EMAIL_SUBJECTS.request+" "+e.uname+" ("+e.email+")",content:e.text,entity:"",time:""}});L(n,function(n,a){n||(e.text=a,Ue.sendEmail(e),t&&t())})}function T(e,t){var n;return t.email?(t.subject=Ze[ct].EMAIL_SUBJECTS.request+" "+t.email,void(t.file?n=Ee(e.file,function(n,a){n?Ve.warn("File wasn't sent"):(t.filename=a.filename,t.filedata=a.filedata),delete t.file,j(t,function(){e.reset(),ye()})}):j(t,function(){e.reset(),ye()}))):void alert(Ze[ct].ERRORS.email)}function I(e,t){var n=t&&t.rating?parseInt(t.rating,10):null;if(t&&t.sendDialog){if(!t.email)return void alert(Ze[ct].ERRORS.email);A({to:t.email,subject:Ze[ct].EMAIL_SUBJECTS.dialog+" "+rt.host,text:ot})}if(t&&t.text){if(!t.email)return void alert(Ze[ct].ERRORS.email);O({email:t.email,subject:Ze[ct].EMAIL_SUBJECTS.complain+" "+t.email,text:t.text})}qe&&clearTimeout(qe),e&&e.reset(),N(n),ye()}function N(e){$e.saveState("chat",!1),Ue.closeChat(e),be("chat")}function R(){$e.getState("shared","session")&&et.unshare()}function M(){de("closechat"),N()}function F(){ze||_e("agent-typing"),clearTimeout(ze),ze=setTimeout(function(){ze=null,be("agent-typing")},5e3)}function P(){Ue.listenerCount("session/timeout")>=1||Ue.once("session/timeout",function(){Ve.log("Session timeout:",rt),$e.getState("chat")===!0&&N(),We&&(_e("timeout"),ye()),fe({state:"timeout"}),ge("timeout"),$e.removeState("sid"),getLanguagesInterval&&clearInterval(getLanguagesInterval),messagesTimeout&&clearTimeout(messagesTimeout),rt.reCreateSession&&r()})}function D(){de("callAgent"),nt.audiocall(rt.channels.webrtc.hotline)}function B(){de("callAgentFallback")}function U(){de("callback")}function q(){var e=document.getElementById(rt.prefix+"-callback-settings"),t=Ie(e),n=document.getElementById(rt.prefix+"-callback-spinner");document.getElementById(rt.prefix+"-callback-sent");return t.phone=t.phone?Fe(t.phone):null,!t.phone||t.phone.length<10?alert(Ze[ct].ERRORS.tel):(t.time=parseFloat(t.time),void(t.time<=0||(t.time=Date.now()+60*t.time*1e3,t.task=rt.channels.callback.task,Ve.log("setCallback data: ",t),e.classList.add(rt.prefix+"-hidden"),n.classList.remove(rt.prefix+"-hidden"),Ue.requestCallback(t),e.reset())))}function W(){var e=document.getElementById(rt.prefix+"-callback-settings"),t=document.getElementById(rt.prefix+"-callback-spinner");t.classList.add(rt.prefix+"-hidden"),e.classList.remove(rt.prefix+"-hidden"),err||de("callbackSent")}function H(e){Ve.log("initCallState: ",e);var t=document.getElementById(rt.prefix+"-call-spinner"),n=document.getElementById(rt.prefix+"-call-info"),a=document.getElementById(rt.prefix+"-call-state"),r=document.getElementById(rt.prefix+"-call-timer"),i=document.getElementById(rt.prefix+"-tryagain-btn");"newRTCSession"===e?H("oncall"):"confirmed"===e?(a.innerText=Ze[ct].PANELS.AUDIO_CALL.calling_agent,n.classList.remove(rt.prefix+"-hidden"),t.classList.add(rt.prefix+"-hidden"),i.classList.add(rt.prefix+"-hidden")):"ringing"===e?(z(r,"init",0),r.classList.remove(rt.prefix+"-hidden"),at.play("ringout_loop",!0)):"connected"===e?(a.innerText=Ze[ct].PANELS.AUDIO_CALL.connected_with_agent,z(r,"start",0),at.stop()):"ended"===e?(a.innerText=Ze[ct].PANELS.AUDIO_CALL.call_ended,z(r,"stop"),H("oncallend")):"failed"===e||"canceled"===e?("failed"===e?a.innerText=Ze[ct].PANELS.AUDIO_CALL.call_failed:a.innerText=Ze[ct].PANELS.AUDIO_CALL.call_canceled,n.classList.remove(rt.prefix+"-hidden"),t.classList.add(rt.prefix+"-hidden"),r.classList.add(rt.prefix+"-hidden"),i.classList.remove(rt.prefix+"-hidden"),H("oncallend"),at.play("busy")):"oncall"===e?(window.onbeforeunload=function(){return"Your connection is in progress. Do you realy want to close it?"},$e.saveState("call",!0,"cache"),_e("webrtc-call")):"oncallend"===e?(window.onbeforeunload=null,$e.saveState("call",!1,"cache"),be("webrtc-call")):(n.classList.add(rt.prefix+"-hidden"),t.classList.remove(rt.prefix+"-hidden"),i.classList.add(rt.prefix+"-hidden"))}function z(e,t,n){var a=n;"start"===t?Je=setInterval(function(){a+=1,e.textContent=Me(a)},1e3):"stop"===t?clearInterval(Je):"init"===t&&(e.textContent=Me(0))}function K(){nt.isEstablished()||nt.isInProgress()?nt.terminate():(ye(),H("init"))}function J(){Ve.log("open widget: ",$e.getState("sid"));var e={};He&&!He.closed||(Qe.merge(e,rt),e.widget=!0,e.external=!0,He=window.open("","wchat",rt.widgetWindowOptions),He=G(He),Qe.poll(function(){return void 0!==He.Wchat},function(){He.Module=He.Wchat(e),He.Module.on("widget/init",function(){He.Module.initWidgetState()}),Qe.forEach(Ue._events,function(e,t,a){He.Module.on(t,function(e){e.url=n.location.href,Ue.emit("window/"+t,e)})})},function(){console.warn("Wchat module was not initiated due to network connection issues.")},12e4),He.onbeforeunload=function(){$e.getState("chat","storage")&&N()}),He.focus&&He.focus()}function G(e){var t,n,a,r,i=i||Ce(),s=e.document.createElement("div"),o=Y(e,"swc-loader-styles"),l=e.document.getElementsByTagName("head")[0],c=e.document.getElementsByTagName("body")[0];return s.className="swc-widget-loader",s.innerHTML="<span></span><span></span><span></span>",a=e.document.createElement("meta"),a.name="viewport",a.content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0",n=e.document.createElement("meta"),n.setAttribute("charset","utf-8"),r=e.document.createElement("title"),r.textContent=Ze[i].TOP_BAR.title,t=e.document.createElement("script"),t.src=rt.clientPath+"wchat.min.js",t.charset="UTF-8",l.appendChild(a),l.appendChild(n),l.appendChild(r),l.appendChild(o),l.appendChild(t),c.id="swc-wg-window",c.appendChild(s),$(l.getElementsByTagName("style")[0]),e}function Y(e,t){var n=e.document.createElement("style");return n.type="text/css",t&&(n.id=t),n.appendChild(e.document.createTextNode("")),n}function $(e){var t=["body { margin:0; background-color: #eee; }","@keyframes preloading {","0 { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","50% { transform: translate(0,15px); -webkit-transform: translate(0,15px); -moz-transform: translate(0,15px); -ms-transform: translate(0,15px); -o-transform: translate(0,15px); }","100% { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","}","@-webkit-keyframes preloading {","0 { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","50% { transform: translate(0,15px); -webkit-transform: translate(0,15px); -moz-transform: translate(0,15px); -ms-transform: translate(0,15px); -o-transform: translate(0,15px); }","100% { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","}","@-moz-keyframes preloading {","0 { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","50% { transform: translate(0,15px); -webkit-transform: translate(0,15px); -moz-transform: translate(0,15px); -ms-transform: translate(0,15px); -o-transform: translate(0,15px); }","100% { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","}","@-ms-keyframes preloading {","0 { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","50% { transform: translate(0,15px); -webkit-transform: translate(0,15px); -moz-transform: translate(0,15px); -ms-transform: translate(0,15px); -o-transform: translate(0,15px); }","100% { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","}","@-o-keyframes preloading {","0 { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","50% { transform: translate(0,15px); -webkit-transform: translate(0,15px); -moz-transform: translate(0,15px); -ms-transform: translate(0,15px); -o-transform: translate(0,15px); }","100% { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","}",".swc-widget-loader {","position: absolute;","width: 100%;","top: 50%;","margin-top: -18px;","text-align: center;","}",".swc-widget-loader span {","display: inline-block;","width: 18px;","height: 18px;","border-radius: 50%;","background-color: #fff;","margin: 3px;","}",".swc-widget-loader span:nth-last-child(1) { -webkit-animation: preloading .8s .1s linear infinite; -moz-animation: preloading .8s .1s linear infinite; -ms-animation: preloading .8s .1s linear infinite; -o-animation: preloading .8s .1s linear infinite; animation: preloading .8s .1s linear infinite; }",".swc-widget-loader span:nth-last-child(2) { -webkit-animation: preloading .8s .3s linear infinite; -moz-animation: preloading .8s .3s linear infinite; -ms-animation: preloading .8s .3s linear infinite; -o-animation: preloading .8s .3s linear infinite; animation: preloading .8s .3s linear infinite; }",".swc-widget-loader span:nth-last-child(3) { -webkit-animation: preloading .8s .5s linear infinite; -moz-animation: preloading .8s .5s linear infinite; -ms-animation: preloading .8s .5s linear infinite; -o-animation: preloading .8s .5s linear infinite; animation: preloading .8s .5s linear infinite; }"].join(" ");e.innerHTML=t}function X(e){var t=document.getElementById(rt.prefix+"-file-select"),a=document.getElementById(rt.prefix+"-message-text"),r=[].slice.call(e.querySelectorAll("."+rt.prefix+"-inputfile")),i=document.getElementById(rt.prefix+"-btn-cont");[].slice.call(e.querySelectorAll("."+rt.prefix+"-wg-pane")),document.getElementById(rt.prefix+"-messages-cont");r.forEach(function(e){var t=e.nextElementSibling,n=t.textContent;De(e,"change",function(e){var a=e.target.value.split("\\").pop();a?t.textContent=a:t.textContent=n})}),De(i,"click",te),De(e,"click",ee),De(e,"submit",ce),De(t,"change",ue),De(a,"keypress",se),De(a,"focus",oe),De(a,"blur",le),De(n,"DOMMouseScroll",ne),De(n,"wheel",ne),De(e,"mouseenter",Q),De(e,"mouseleave",Z)}function V(e){var t=rt.widget?re:J,n=[].slice.call(document.querySelectorAll(e));n.map(function(e){return De(e,"click",t),e})}function Q(){ut=!0}function Z(){ut=!1}function ee(e){var t,n,a,r,i=e.target;"A"!==i.parentNode.tagName&&"BUTTON"!==i.parentNode.tagName||(i=i.parentNode),t=i.getAttribute("data-"+rt.prefix+"-handler"),r=i.getAttribute("data-"+rt.prefix+"-link"),"closeWidget"===t?ye():"finish"===t?$e.getState("chat")?de("closechat"):ye():"sendMessage"===t?ie():"openWindow"===t?J():"rejectForm"===t?Ue.emit("form/reject",{formName:Qe.findParent(i,"form").name}):"initCall"===t?D():"initFallbackCall"===t?B():"initCallback"===t?U():"setCallback"===t?q():"initChat"===t?y():"endCall"===t&&K(),"A"===i.tagName&&(a=i.href,r?Ue.linkFollowed(r):-1!==a.indexOf("#")&&(e.preventDefault(),n=a.substring(i.href.indexOf("#")+1),n&&de(n)))}function te(e){e.preventDefault();var t=e.target,n=e.currentTarget;return t.id===rt.prefix+"-unnotify-btn"?(be("notified"),void ge(st.state)):void(n.id===rt.prefix+"-btn-cont"&&re())}function ne(e){var t=document.getElementById(rt.prefix+"-messages-cont"),n=ae(e);ut&&(0===t.scrollTop&&"up"===n?(e.stopPropagation(),e.preventDefault()):t.scrollTop>=t.scrollHeight-t.clientHeight&&"down"===n&&(e.stopPropagation(),e.preventDefault()));
}function ae(e){var t;return t=e.wheelDelta?e.wheelDelta:-1*e.deltaY,0>t?"down":t>0?"up":void 0}function re(){var e=$e.getState("chat","cache"),t=($e.getState("opened","session"),$e.getState("call","cache"));b(),he("timeout")?r():e?ve():lt.length?rt.webrtcEnabled?t?ve():rt.chat||rt.channels.callback.task?(de("chooseConnection"),ve()):D():rt.channels.callback.task?rt.chat||rt.webrtcEnabled?(de("chooseConnection"),ve()):(de("callback"),ve()):y():(de("sendemail"),ve())}function ie(){var e,t=document.getElementById(rt.prefix+"-message-text");e=Qe.trim(t.value),e&&(E({message:e}),t.value="",be("type-extend")),$e.getState("chat")||y()}function se(e){var t=e.target,n=document.getElementById("swc-message-text-clone");10===e.keyCode||13===e.keyCode?(e.preventDefault(),ie()):Ke||(Ke=setTimeout(function(){Ke=null,Ue.userIsTyping()},1e3)),n.innerText=t.value,t.style.height=n.clientHeight+"px"}function oe(e){var t=e.target;t.style.borderColor=rt.styles.primary.backgroundColor}function le(e){var t=e.target;t.style.borderColor="#fff"}function ce(e){var t=e.target;e.preventDefault(),"FORM"===t.tagName&&Ue.emit("form/submit",{formElement:t,formData:Ie(t)})}function ue(e){var t=e.target;Ee(t,function(e,t){Ve.log("wgSendFile: ",t),e?alert("File was not sent"):E({message:t.filename,file:t.filedata})})}function de(e){var t="data-"+rt.prefix+"-pane",n=[].slice.call(We.querySelectorAll("."+rt.prefix+"-wg-pane"));n.forEach(function(n){n.getAttribute(t)===e?n.classList.add("active"):n.classList.remove("active")})}function fe(e){if(We&&st.state!==e.state){"offline"===e.state?be("online"):"online"===e.state&&be("offline");var t=document.querySelector("."+rt.prefix+"-wg-state");t&&(t.textContent=Ze[ct].TOP_BAR.STATUS[e.state]),st.state=e.state,_e(e.state),ge(e.state),Ue.emit("widget/statechange",{state:e.state})}}function pe(){return st.state?st.state:lt&&lt.length?"online":"offline"}function me(){var e=We.querySelector("."+rt.prefix+"-wg-btn");console.log("setStyles: ",e,rt.buttonStyles),e.style.borderRadius=rt.buttonStyles.borderRadius,e.style.boxShadow=rt.buttonStyles.boxShadow}function ge(e){if(We&&void 0!==rt.buttonStyles[e]){var t=We.querySelector("."+rt.prefix+"-wg-btn"),n=We.querySelector("."+rt.prefix+"-btn-icon");t.style.background=rt.buttonStyles[e].backgroundColor,n.style.color=rt.buttonStyles[e].color||rt.buttonStyles.color}}function _e(e){We&&We.classList.add(e)}function he(e){return We?We.classList.contains(e):!1}function be(e){We&&We.classList.remove(e)}function ve(){var e=document.getElementById(rt.prefix+"-messages-cont");st.active=!0,$e.saveState("opened",!0,"session"),_e("active"),be("notified"),ge(st.state),e.scrollTop=e.scrollHeight}function ye(){window.opener?window.close():(st.active=!1,$e.saveState("opened",!1,"session"),be("active"))}function xe(e){var t=e.formElement,n=e.formData;if(t.getAttribute("data-validate-form")){var a=Ne(t);if(!a)return}t.id===rt.prefix+"-closechat-form"?I(t,n):t.id===rt.prefix+"-sendmail-form"?T(t,n):t.id===rt.prefix+"-intro-form"?x(n):t.id===rt.prefix+"-call-btn-form"?D():t.id===rt.prefix+"-chat-btn-form"?y():we({formName:t.name},!0)}function we(e,t){var a=n[e.formName];return a?void(t?a.outerHTML='<p class="'+rt.prefix+'-text-center"><i class="'+rt.prefix+"-text-success "+rt.prefix+'-icon-check"></i><span> '+Ze[ct].FORMS.submitted+"</span></p>":a.outerHTML='<p class="'+rt.prefix+'-text-center"><i class="'+rt.prefix+"-text-danger "+rt.prefix+'-icon-remove"></i><span> '+Ze[ct].FORMS.canceled+"</span></p>"):!1}function Ee(e,t){var a,r,i,s=e.files;if(s.length){if(!n.FileReader)return void(t&&t("OBSOLETE_BROWSER"));a=s[0],i=new FileReader,i.onload=function(e){r=e.target.result,r=r.substring(r.indexOf(",")+1),t&&t(null,{filedata:r,filename:a.name})},i.onerror=function(e){Ue.emit("Error",e.target.error),t&&t(e.target.error)},i.readAsDataURL(a)}}function ke(e,t){var n=tt[e];return n(t)}function Se(){var e=document.getElementById(rt.prefix+"-messages-cont"),t=e.cloneNode();e.parentNode.replaceChild(t,e)}function Ce(){var e,t=$e.getState("lang"),a=[];if(t)e=t;else{for(var r in Ze)a.push(r);rt.langFromUrl&&n.location.pathname.split("/").forEach(function(t){-1!==a.indexOf(t)&&(e=t)}),e||(e=rt.lang||(navigator.language||navigator.userLanguage).split("-")[0],-1===a.indexOf(e)&&(e="en"))}return e}function Le(e){var t=new Date(e),n=t.getHours(),a=t.getMinutes(),r=(10>n?"0"+n:n)+":"+(10>a?"0"+a:a);return r}function Ae(e,t,n){var a,r;return t?(a=e.substring(e.indexOf("_")+1),Te(t)?{type:"image",content:'<a href="'+Ue.options.server+"/ipcc/"+e+'" download="'+a+'"><img src="'+Ue.options.server+"/ipcc/"+e+'" alt="file preview" /></a>'}:{type:"file",content:'<a href="'+Ue.options.server+"/ipcc/"+e+'" download="'+a+'">'+a+"</a>"}):"agent"===n&&new RegExp("^{.+}$").test(e)?(Be.forEach(function(t){t.name===e.substring(1,e.length-1)&&(r=t)}),{type:r?"form":"text",content:r?r:e}):{type:"text",content:e.replace(/\n/g," <br> ").split(" ").map(Oe).join(" ").replace(" <br> ","<br>")}}function Oe(e){var t=0,n=e;if(je(e)){for(;!n.charAt(n.length-1).match(/[a-z0-9\/]/i);)n=n.slice(0,-1),t+=1;return'<a href="'+n+'" target="_blank" data-'+rt.prefix+'-link="'+n+'">'+n+"</a>"+e.substr(e.length-t)}return e}function je(e){var t=new RegExp("^http://|^https://");return t.test(e)}function Te(e){var t=new RegExp("png|PNG|jpg|JPG|JPEG|jpeg|gif|GIF"),n=e.substring(e.lastIndexOf(".")+1);return t.test(n)}function Ie(e){var t={};return[].slice.call(e.elements).forEach(function(e){"checkbox"===e.type?t[e.name]=e.checked:e.value&&(t[e.name]=e.value)}),t}function Ne(e){var t=!0;return[].slice.call(e.elements).every(function(e){return!e.hasAttribute("required")||""!==e.value&&null!==e.value?!0:(alert(Ze[ct].ERRORS[e.type]||Ze[ct].ERRORS.required),t=!1,!1)}),t}function Re(){var e=document.createElement("link");e.rel="stylesheet",e.href=rt.stylesPath||rt.clientPath+"main.css",document.head.appendChild(e)}function Me(e){var t=Math.floor(e/60),n=e%60,a=(t>9?t:"0"+t)+":"+(n>9?n:"0"+n);return a}function Fe(e){return e.replace(/\D+/g,"")}function Pe(){return void 0!==document.body.classList}function De(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)}var Be,Ue,qe,We,He,ze,Ke,Je,Ge=e("domify"),Ye=e("./core"),$e=e("./storage"),Xe=e("./request"),Ve=e("./debug"),Qe=e("./lodash"),Ze=null,et=e("./cobrowsing"),tt=e("./templates"),nt=e("./webrtc"),at=e("./audio-control"),rt={prefix:"swc",autoStart:!0,intro:!1,widget:!0,chat:!0,channels:{webrtc:{},callback:{}},cobrowsing:!1,buttonSelector:"",reCreateSession:!0,title:"",lang:"en",langFromUrl:!1,position:"right",hideOfflineButton:!1,offer:!1,styles:{primary:{backgroundColor:"#74b9ff",color:"#FFFFFF"},intro:{},sendmail:{},closeChat:{}},buttonStyles:{online:{backgroundColor:"rgba(175,229,255,0.8)",color:""},offline:{backgroundColor:"rgba(241,241,241,0.8)",color:""},timeout:{backgroundColor:"rgba(241,241,241,0.8)",color:""},notified:{backgroundColor:"rgba(253,250,129,0.8)",color:""},color:"rgb(70,70,70)"},widgetWindowOptions:"left=10,top=10,width=350,height=550,resizable",path:"/ipcc/webchat/",clientPath:"https://cdn.smile-soft.com/wchat/v1/",stylesPath:"",translationsPath:"",host:window.location.host,webrtcEnabled:!1},it="WchatSettings",st={initiated:!1,active:!1,state:"",share:!1,sounds:!0},ot=[],lt=[],ct="",ut=!1,dt=1,ft={initModule:r,initWidgetState:re,openWidget:J,initChat:y,initCall:D,getWidgetElement:f,isWebrtcSupported:nt.isSupported,getWidgetState:function(){return st},getEntity:function(){return $e.getState("entity","session")},on:function(e,t){return Ue.on(e,t),this},emit:function(e,t){return Ue.emit(e,t),this},setDefaultCredentials:function(e){return rt.credentials=e,this}};t.exports={module:a,api:ft},n[it]&&n[it].autoStart!==!1&&rt.autoStart&&("complete"===document.readyState||"interactive"===document.readyState?a(n[it]):document.addEventListener("DOMContentLoaded",function(){a(n[it])},!1))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./audio-control":74,"./cobrowsing":75,"./core":76,"./debug":77,"./lodash":78,"./request":80,"./storage":81,"./templates":82,"./webrtc":83,domify:1}]},{},[79])(79)});