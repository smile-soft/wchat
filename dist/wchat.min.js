!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Wchat=t()}}(function(){var define,module,exports;return function t(e,n,r){function s(l,o){if(!n[l]){if(!e[l]){var a="function"==typeof require&&require;if(!o&&a)return a(l,!0);if(i)return i(l,!0);var u=new Error("Cannot find module '"+l+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[l]={exports:{}};e[l][0].call(c.exports,function(t){var n=e[l][1][t];return s(n?n:t)},c,c.exports,t,e,n,r)}return n[l].exports}for(var i="function"==typeof require&&require,l=0;l<r.length;l++)s(r[l]);return s}({1:[function(t,e,n){function r(t,e){if("string"!=typeof t)throw new TypeError("String expected");e||(e=document);var n=/<([\w:]+)/.exec(t);if(!n)return e.createTextNode(t);t=t.replace(/^\s+|\s+$/g,"");var r=n[1];if("body"==r){var s=e.createElement("html");return s.innerHTML=t,s.removeChild(s.lastChild)}var i=l[r]||l._default,o=i[0],a=i[1],u=i[2],s=e.createElement("div");for(s.innerHTML=a+t+u;o--;)s=s.lastChild;if(s.firstChild==s.lastChild)return s.removeChild(s.firstChild);for(var c=e.createDocumentFragment();s.firstChild;)c.appendChild(s.removeChild(s.firstChild));return c}e.exports=r;var s,i=!1;"undefined"!=typeof document&&(s=document.createElement("div"),s.innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>',i=!s.getElementsByTagName("link").length,s=void 0);var l={legend:[1,"<fieldset>","</fieldset>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],_default:i?[1,"X<div>","</div>"]:[0,"",""]};l.td=l.th=[3,"<table><tbody><tr>","</tr></tbody></table>"],l.option=l.optgroup=[1,'<select multiple="multiple">',"</select>"],l.thead=l.tbody=l.colgroup=l.caption=l.tfoot=[1,"<table>","</table>"],l.polyline=l.ellipse=l.polygon=l.circle=l.text=l.line=l.path=l.rect=l.g=[1,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1">',"</svg>"]},{}],2:[function(t,e,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function s(t){return"function"==typeof t}function i(t){return"number"==typeof t}function l(t){return"object"==typeof t&&null!==t}function o(t){return void 0===t}e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(t){if(!i(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},r.prototype.emit=function(t){var e,n,r,i,a,u;if(this._events||(this._events={}),"error"===t&&(!this._events.error||l(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[t],o(n))return!1;if(s(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:i=Array.prototype.slice.call(arguments,1),n.apply(this,i)}else if(l(n))for(i=Array.prototype.slice.call(arguments,1),u=n.slice(),r=u.length,a=0;a<r;a++)u[a].apply(this,i);return!0},r.prototype.addListener=function(t,e){var n;if(!s(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,s(e.listener)?e.listener:e),this._events[t]?l(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,l(this._events[t])&&!this._events[t].warned&&(n=o(this._maxListeners)?r.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(t,e){function n(){this.removeListener(t,n),r||(r=!0,e.apply(this,arguments))}if(!s(e))throw TypeError("listener must be a function");var r=!1;return n.listener=e,this.on(t,n),this},r.prototype.removeListener=function(t,e){var n,r,i,o;if(!s(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],i=n.length,r=-1,n===e||s(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(l(n)){for(o=i;o-- >0;)if(n[o]===e||n[o].listener&&n[o].listener===e){r=o;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},r.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],s(n))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},r.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?s(this._events[t])?[this._events[t]]:this._events[t].slice():[]},r.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(s(e))return 1;if(e)return e.length}return 0},r.listenerCount=function(t,e){return t.listenerCount(e)}},{}],3:[function(t,e,n){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},{}],4:[function(t,e,n){var r=t("../internal/arrayEach"),s=t("../internal/baseEach"),i=t("../internal/createForEach"),l=i(r,s);e.exports=l},{"../internal/arrayEach":10,"../internal/baseEach":16,"../internal/createForEach":33}],5:[function(t,e,n){var r=t("../internal/getNative"),s=r(Date,"now"),i=s||function(){return(new Date).getTime()};e.exports=i},{"../internal/getNative":40}],6:[function(t,e,n){function r(t,e,n){function r(){_&&clearTimeout(_),p&&clearTimeout(p),b=0,p=_=v=void 0}function a(e,n){n&&clearTimeout(n),p=_=v=void 0,e&&(b=i(),f=t.apply(g,h),_||p||(h=g=void 0))}function u(){var t=e-(i()-m);t<=0||t>e?a(v,p):_=setTimeout(u,t)}function c(){a(y,_)}function d(){if(h=arguments,m=i(),g=this,v=y&&(_||!C),T===!1)var n=C&&!_;else{p||C||(b=m);var r=T-(m-b),s=r<=0||r>T;s?(p&&(p=clearTimeout(p)),b=m,f=t.apply(g,h)):p||(p=setTimeout(c,r))}return s&&_?_=clearTimeout(_):_||e===T||(_=setTimeout(u,e)),n&&(s=!0,f=t.apply(g,h)),!s||_||p||(h=g=void 0),f}var h,p,f,m,g,_,v,b=0,T=!1,y=!0;if("function"!=typeof t)throw new TypeError(l);if(e=e<0?0:+e||0,n===!0){var C=!0;y=!1}else s(n)&&(C=!!n.leading,T="maxWait"in n&&o(+n.maxWait||0,e),y="trailing"in n?!!n.trailing:y);return d.cancel=r,d}var s=t("../lang/isObject"),i=t("../date/now"),l="Expected a function",o=Math.max;e.exports=r},{"../date/now":5,"../lang/isObject":60}],7:[function(t,e,n){function r(t,e){if("function"!=typeof t)throw new TypeError(s);return e=i(void 0===e?t.length-1:+e||0,0),function(){for(var n=arguments,r=-1,s=i(n.length-e,0),l=Array(s);++r<s;)l[r]=n[e+r];switch(e){case 0:return t.call(this,l);case 1:return t.call(this,n[0],l);case 2:return t.call(this,n[0],n[1],l)}var o=Array(e+1);for(r=-1;++r<e;)o[r]=n[r];return o[e]=l,t.apply(this,o)}}var s="Expected a function",i=Math.max;e.exports=r},{}],8:[function(t,e,n){function r(t,e,n){var r=!0,o=!0;if("function"!=typeof t)throw new TypeError(l);return n===!1?r=!1:i(n)&&(r="leading"in n?!!n.leading:r,o="trailing"in n?!!n.trailing:o),s(t,e,{leading:r,maxWait:+e,trailing:o})}var s=t("./debounce"),i=t("../lang/isObject"),l="Expected a function";e.exports=r},{"../lang/isObject":60,"./debounce":6}],9:[function(t,e,n){function r(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}e.exports=r},{}],10:[function(t,e,n){function r(t,e){for(var n=-1,r=t.length;++n<r&&e(t[n],n,t)!==!1;);return t}e.exports=r},{}],11:[function(t,e,n){function r(t,e){for(var n=-1,r=t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}e.exports=r},{}],12:[function(t,e,n){function r(t,e,n,r){return void 0!==t&&i.call(r,n)?t:e}var s=Object.prototype,i=s.hasOwnProperty;e.exports=r},{}],13:[function(t,e,n){function r(t,e,n){for(var r=-1,i=s(e),l=i.length;++r<l;){var o=i[r],a=t[o],u=n(a,e[o],o,t,e);(u===u?u===a:a!==a)&&(void 0!==a||o in t)||(t[o]=u)}return t}var s=t("../object/keys");e.exports=r},{"../object/keys":65}],14:[function(t,e,n){function r(t,e){return null==e?t:s(e,i(e),t)}var s=t("./baseCopy"),i=t("../object/keys");e.exports=r},{"../object/keys":65,"./baseCopy":15}],15:[function(t,e,n){function r(t,e,n){n||(n={});for(var r=-1,s=e.length;++r<s;){var i=e[r];n[i]=t[i]}return n}e.exports=r},{}],16:[function(t,e,n){var r=t("./baseForOwn"),s=t("./createBaseEach"),i=s(r);e.exports=i},{"./baseForOwn":19,"./createBaseEach":31}],17:[function(t,e,n){var r=t("./createBaseFor"),s=r();e.exports=s},{"./createBaseFor":32}],18:[function(t,e,n){function r(t,e){return s(t,e,i)}var s=t("./baseFor"),i=t("../object/keysIn");e.exports=r},{"../object/keysIn":66,"./baseFor":17}],19:[function(t,e,n){function r(t,e){return s(t,e,i)}var s=t("./baseFor"),i=t("../object/keys");e.exports=r},{"../object/keys":65,"./baseFor":17}],20:[function(t,e,n){function r(t,e,n,o,a,u){return t===e||(null==t||null==e||!i(t)&&!l(e)?t!==t&&e!==e:s(t,e,r,n,o,a,u))}var s=t("./baseIsEqualDeep"),i=t("../lang/isObject"),l=t("./isObjectLike");e.exports=r},{"../lang/isObject":60,"./baseIsEqualDeep":21,"./isObjectLike":45}],21:[function(t,e,n){function r(t,e,n,r,h,m,g){var _=o(t),v=o(e),b=c,T=c;_||(b=f.call(t),b==u?b=d:b!=d&&(_=a(t))),v||(T=f.call(e),T==u?T=d:T!=d&&(v=a(e)));var y=b==d,C=T==d,S=b==T;if(S&&!_&&!y)return i(t,e,b);if(!h){var E=y&&p.call(t,"__wrapped__"),A=C&&p.call(e,"__wrapped__");if(E||A)return n(E?t.value():t,A?e.value():e,r,h,m,g)}if(!S)return!1;m||(m=[]),g||(g=[]);for(var w=m.length;w--;)if(m[w]==t)return g[w]==e;m.push(t),g.push(e);var R=(_?s:l)(t,e,n,r,h,m,g);return m.pop(),g.pop(),R}var s=t("./equalArrays"),i=t("./equalByTag"),l=t("./equalObjects"),o=t("../lang/isArray"),a=t("../lang/isTypedArray"),u="[object Arguments]",c="[object Array]",d="[object Object]",h=Object.prototype,p=h.hasOwnProperty,f=h.toString;e.exports=r},{"../lang/isArray":55,"../lang/isTypedArray":62,"./equalArrays":34,"./equalByTag":35,"./equalObjects":36}],22:[function(t,e,n){function r(t,e,n,h,p){if(!a(t))return t;var f=o(e)&&(l(e)||c(e)),m=f?void 0:d(e);return s(m||e,function(s,l){if(m&&(l=s,s=e[l]),u(s))h||(h=[]),p||(p=[]),i(t,e,l,r,n,h,p);else{var o=t[l],a=n?n(o,s,l,t,e):void 0,c=void 0===a;c&&(a=s),void 0===a&&(!f||l in t)||!c&&(a===a?a===o:o!==o)||(t[l]=a)}}),t}var s=t("./arrayEach"),i=t("./baseMergeDeep"),l=t("../lang/isArray"),o=t("./isArrayLike"),a=t("../lang/isObject"),u=t("./isObjectLike"),c=t("../lang/isTypedArray"),d=t("../object/keys");e.exports=r},{"../lang/isArray":55,"../lang/isObject":60,"../lang/isTypedArray":62,"../object/keys":65,"./arrayEach":10,"./baseMergeDeep":23,"./isArrayLike":41,"./isObjectLike":45}],23:[function(t,e,n){function r(t,e,n,r,d,h,p){for(var f=h.length,m=e[n];f--;)if(h[f]==m)return void(t[n]=p[f]);var g=t[n],_=d?d(g,m,n,t,e):void 0,v=void 0===_;v&&(_=m,o(m)&&(l(m)||u(m))?_=l(g)?g:o(g)?s(g):[]:a(m)||i(m)?_=i(g)?c(g):a(g)?g:{}:v=!1),h.push(m),p.push(_),v?t[n]=r(_,m,d,h,p):(_===_?_!==g:g===g)&&(t[n]=_)}var s=t("./arrayCopy"),i=t("../lang/isArguments"),l=t("../lang/isArray"),o=t("./isArrayLike"),a=t("../lang/isPlainObject"),u=t("../lang/isTypedArray"),c=t("../lang/toPlainObject");e.exports=r},{"../lang/isArguments":54,"../lang/isArray":55,"../lang/isPlainObject":61,"../lang/isTypedArray":62,"../lang/toPlainObject":63,"./arrayCopy":9,"./isArrayLike":41}],24:[function(t,e,n){function r(t){return function(e){return null==e?void 0:e[t]}}e.exports=r},{}],25:[function(t,e,n){function r(t){return null==t?"":t+""}e.exports=r},{}],26:[function(t,e,n){function r(t,e){for(var n=-1,r=e.length,s=Array(r);++n<r;)s[n]=t[e[n]];return s}e.exports=r},{}],27:[function(t,e,n){function r(t,e,n){if("function"!=typeof t)return s;if(void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,r,s){return t.call(e,n,r,s)};case 4:return function(n,r,s,i){return t.call(e,n,r,s,i)};case 5:return function(n,r,s,i,l){return t.call(e,n,r,s,i,l)}}return function(){return t.apply(e,arguments)}}var s=t("../utility/identity");e.exports=r},{"../utility/identity":73}],28:[function(t,e,n){function r(t,e){for(var n=-1,r=t.length;++n<r&&e.indexOf(t.charAt(n))>-1;);return n}e.exports=r},{}],29:[function(t,e,n){function r(t,e){for(var n=t.length;n--&&e.indexOf(t.charAt(n))>-1;);return n}e.exports=r},{}],30:[function(t,e,n){function r(t){return l(function(e,n){var r=-1,l=null==e?0:n.length,o=l>2?n[l-2]:void 0,a=l>2?n[2]:void 0,u=l>1?n[l-1]:void 0;for("function"==typeof o?(o=s(o,u,5),l-=2):(o="function"==typeof u?u:void 0,l-=o?1:0),a&&i(n[0],n[1],a)&&(o=l<3?void 0:o,l=1);++r<l;){var c=n[r];c&&t(e,c,o)}return e})}var s=t("./bindCallback"),i=t("./isIterateeCall"),l=t("../function/restParam");e.exports=r},{"../function/restParam":7,"./bindCallback":27,"./isIterateeCall":43}],31:[function(t,e,n){function r(t,e){return function(n,r){var o=n?s(n):0;if(!i(o))return t(n,r);for(var a=e?o:-1,u=l(n);(e?a--:++a<o)&&r(u[a],a,u)!==!1;);return n}}var s=t("./getLength"),i=t("./isLength"),l=t("./toObject");e.exports=r},{"./getLength":39,"./isLength":44,"./toObject":51}],32:[function(t,e,n){function r(t){return function(e,n,r){for(var i=s(e),l=r(e),o=l.length,a=t?o:-1;t?a--:++a<o;){var u=l[a];if(n(i[u],u,i)===!1)break}return e}}var s=t("./toObject");e.exports=r},{"./toObject":51}],33:[function(t,e,n){function r(t,e){return function(n,r,l){return"function"==typeof r&&void 0===l&&i(n)?t(n,r):e(n,s(r,l,3))}}var s=t("./bindCallback"),i=t("../lang/isArray");e.exports=r},{"../lang/isArray":55,"./bindCallback":27}],34:[function(t,e,n){function r(t,e,n,r,i,l,o){var a=-1,u=t.length,c=e.length;if(u!=c&&!(i&&c>u))return!1;for(;++a<u;){var d=t[a],h=e[a],p=r?r(i?h:d,i?d:h,a):void 0;if(void 0!==p){if(p)continue;return!1}if(i){if(!s(e,function(t){return d===t||n(d,t,r,i,l,o)}))return!1}else if(d!==h&&!n(d,h,r,i,l,o))return!1}return!0}var s=t("./arraySome");e.exports=r},{"./arraySome":11}],35:[function(t,e,n){function r(t,e,n){switch(n){case s:case i:return+t==+e;case l:return t.name==e.name&&t.message==e.message;case o:return t!=+t?e!=+e:t==+e;case a:case u:return t==e+""}return!1}var s="[object Boolean]",i="[object Date]",l="[object Error]",o="[object Number]",a="[object RegExp]",u="[object String]";e.exports=r},{}],36:[function(t,e,n){function r(t,e,n,r,i,o,a){var u=s(t),c=u.length,d=s(e),h=d.length;if(c!=h&&!i)return!1;for(var p=c;p--;){var f=u[p];if(!(i?f in e:l.call(e,f)))return!1}for(var m=i;++p<c;){f=u[p];var g=t[f],_=e[f],v=r?r(i?_:g,i?g:_,f):void 0;if(!(void 0===v?n(g,_,r,i,o,a):v))return!1;m||(m="constructor"==f)}if(!m){var b=t.constructor,T=e.constructor;if(b!=T&&"constructor"in t&&"constructor"in e&&!("function"==typeof b&&b instanceof b&&"function"==typeof T&&T instanceof T))return!1}return!0}var s=t("../object/keys"),i=Object.prototype,l=i.hasOwnProperty;e.exports=r},{"../object/keys":65}],37:[function(t,e,n){function r(t){return s[t]}var s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"};e.exports=r},{}],38:[function(t,e,n){function r(t){return"\\"+s[t]}var s={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};e.exports=r},{}],39:[function(t,e,n){var r=t("./baseProperty"),s=r("length");e.exports=s},{"./baseProperty":24}],40:[function(t,e,n){function r(t,e){var n=null==t?void 0:t[e];return s(n)?n:void 0}var s=t("../lang/isNative");e.exports=r},{"../lang/isNative":59}],41:[function(t,e,n){function r(t){return null!=t&&i(s(t))}var s=t("./getLength"),i=t("./isLength");e.exports=r},{"./getLength":39,"./isLength":44}],42:[function(t,e,n){function r(t,e){return t="number"==typeof t||s.test(t)?+t:-1,e=null==e?i:e,t>-1&&t%1==0&&t<e}var s=/^\d+$/,i=9007199254740991;e.exports=r},{}],43:[function(t,e,n){function r(t,e,n){if(!l(n))return!1;var r=typeof e;if("number"==r?s(n)&&i(e,n.length):"string"==r&&e in n){var o=n[e];return t===t?t===o:o!==o}return!1}var s=t("./isArrayLike"),i=t("./isIndex"),l=t("../lang/isObject");e.exports=r},{"../lang/isObject":60,"./isArrayLike":41,"./isIndex":42}],44:[function(t,e,n){function r(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=s}var s=9007199254740991;e.exports=r},{}],45:[function(t,e,n){function r(t){return!!t&&"object"==typeof t}e.exports=r},{}],46:[function(t,e,n){function r(t){return t<=160&&t>=9&&t<=13||32==t||160==t||5760==t||6158==t||t>=8192&&(t<=8202||8232==t||8233==t||8239==t||8287==t||12288==t||65279==t)}e.exports=r},{}],47:[function(t,e,n){var r=/<%-([\s\S]+?)%>/g;e.exports=r},{}],48:[function(t,e,n){var r=/<%([\s\S]+?)%>/g;e.exports=r},{}],49:[function(t,e,n){var r=/<%=([\s\S]+?)%>/g;e.exports=r},{}],50:[function(t,e,n){function r(t){for(var e=a(t),n=e.length,r=n&&t.length,u=!!r&&o(r)&&(i(t)||s(t)),d=-1,h=[];++d<n;){var p=e[d];(u&&l(p,r)||c.call(t,p))&&h.push(p)}return h}var s=t("../lang/isArguments"),i=t("../lang/isArray"),l=t("./isIndex"),o=t("./isLength"),a=t("../object/keysIn"),u=Object.prototype,c=u.hasOwnProperty;e.exports=r},{"../lang/isArguments":54,"../lang/isArray":55,"../object/keysIn":66,"./isIndex":42,"./isLength":44}],51:[function(t,e,n){function r(t){return s(t)?t:Object(t)}var s=t("../lang/isObject");e.exports=r},{"../lang/isObject":60}],52:[function(t,e,n){function r(t){for(var e=-1,n=t.length;++e<n&&s(t.charCodeAt(e)););return e}var s=t("./isSpace");e.exports=r},{"./isSpace":46}],53:[function(t,e,n){function r(t){for(var e=t.length;e--&&s(t.charCodeAt(e)););return e}var s=t("./isSpace");e.exports=r},{"./isSpace":46}],54:[function(t,e,n){function r(t){return i(t)&&s(t)&&o.call(t,"callee")&&!a.call(t,"callee")}var s=t("../internal/isArrayLike"),i=t("../internal/isObjectLike"),l=Object.prototype,o=l.hasOwnProperty,a=l.propertyIsEnumerable;e.exports=r},{"../internal/isArrayLike":41,"../internal/isObjectLike":45}],55:[function(t,e,n){var r=t("../internal/getNative"),s=t("../internal/isLength"),i=t("../internal/isObjectLike"),l="[object Array]",o=Object.prototype,a=o.toString,u=r(Array,"isArray"),c=u||function(t){return i(t)&&s(t.length)&&a.call(t)==l};e.exports=c},{"../internal/getNative":40,"../internal/isLength":44,"../internal/isObjectLike":45}],56:[function(t,e,n){function r(t,e,n,r){n="function"==typeof n?i(n,r,3):void 0;var l=n?n(t,e):void 0;return void 0===l?s(t,e,n):!!l}var s=t("../internal/baseIsEqual"),i=t("../internal/bindCallback");e.exports=r},{"../internal/baseIsEqual":20,"../internal/bindCallback":27}],57:[function(t,e,n){function r(t){return s(t)&&"string"==typeof t.message&&o.call(t)==i}var s=t("../internal/isObjectLike"),i="[object Error]",l=Object.prototype,o=l.toString;e.exports=r},{"../internal/isObjectLike":45}],58:[function(t,e,n){function r(t){return s(t)&&o.call(t)==i}var s=t("./isObject"),i="[object Function]",l=Object.prototype,o=l.toString;e.exports=r},{"./isObject":60}],59:[function(t,e,n){function r(t){return null!=t&&(s(t)?c.test(a.call(t)):i(t)&&l.test(t))}var s=t("./isFunction"),i=t("../internal/isObjectLike"),l=/^\[object .+?Constructor\]$/,o=Object.prototype,a=Function.prototype.toString,u=o.hasOwnProperty,c=RegExp("^"+a.call(u).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=r},{"../internal/isObjectLike":45,"./isFunction":58}],60:[function(t,e,n){function r(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}e.exports=r},{}],61:[function(t,e,n){function r(t){var e;if(!l(t)||c.call(t)!=o||i(t)||!u.call(t,"constructor")&&(e=t.constructor,"function"==typeof e&&!(e instanceof e)))return!1;var n;return s(t,function(t,e){n=e}),void 0===n||u.call(t,n)}var s=t("../internal/baseForIn"),i=t("./isArguments"),l=t("../internal/isObjectLike"),o="[object Object]",a=Object.prototype,u=a.hasOwnProperty,c=a.toString;e.exports=r},{"../internal/baseForIn":18,"../internal/isObjectLike":45,"./isArguments":54}],62:[function(t,e,n){function r(t){return i(t)&&s(t.length)&&!!I[N.call(t)]}var s=t("../internal/isLength"),i=t("../internal/isObjectLike"),l="[object Arguments]",o="[object Array]",a="[object Boolean]",u="[object Date]",c="[object Error]",d="[object Function]",h="[object Map]",p="[object Number]",f="[object Object]",m="[object RegExp]",g="[object Set]",_="[object String]",v="[object WeakMap]",b="[object ArrayBuffer]",T="[object Float32Array]",y="[object Float64Array]",C="[object Int8Array]",S="[object Int16Array]",E="[object Int32Array]",A="[object Uint8Array]",w="[object Uint8ClampedArray]",R="[object Uint16Array]",x="[object Uint32Array]",I={};I[T]=I[y]=I[C]=I[S]=I[E]=I[A]=I[w]=I[R]=I[x]=!0,I[l]=I[o]=I[b]=I[a]=I[u]=I[c]=I[d]=I[h]=I[p]=I[f]=I[m]=I[g]=I[_]=I[v]=!1;var O=Object.prototype,N=O.toString;e.exports=r},{"../internal/isLength":44,"../internal/isObjectLike":45}],63:[function(t,e,n){function r(t){return s(t,i(t))}var s=t("../internal/baseCopy"),i=t("../object/keysIn");e.exports=r},{"../internal/baseCopy":15,"../object/keysIn":66}],64:[function(t,e,n){var r=t("../internal/assignWith"),s=t("../internal/baseAssign"),i=t("../internal/createAssigner"),l=i(function(t,e,n){return n?r(t,e,n):s(t,e)});e.exports=l},{"../internal/assignWith":13,"../internal/baseAssign":14,"../internal/createAssigner":30}],65:[function(t,e,n){var r=t("../internal/getNative"),s=t("../internal/isArrayLike"),i=t("../lang/isObject"),l=t("../internal/shimKeys"),o=r(Object,"keys"),a=o?function(t){var e=null==t?void 0:t.constructor;return"function"==typeof e&&e.prototype===t||"function"!=typeof t&&s(t)?l(t):i(t)?o(t):[]}:l;e.exports=a},{"../internal/getNative":40,"../internal/isArrayLike":41,"../internal/shimKeys":50,"../lang/isObject":60}],66:[function(t,e,n){function r(t){if(null==t)return[];a(t)||(t=Object(t));var e=t.length;e=e&&o(e)&&(i(t)||s(t))&&e||0;for(var n=t.constructor,r=-1,u="function"==typeof n&&n.prototype===t,d=Array(e),h=e>0;++r<e;)d[r]=r+"";for(var p in t)h&&l(p,e)||"constructor"==p&&(u||!c.call(t,p))||d.push(p);return d}var s=t("../lang/isArguments"),i=t("../lang/isArray"),l=t("../internal/isIndex"),o=t("../internal/isLength"),a=t("../lang/isObject"),u=Object.prototype,c=u.hasOwnProperty;e.exports=r},{"../internal/isIndex":42,"../internal/isLength":44,"../lang/isArguments":54,"../lang/isArray":55,"../lang/isObject":60}],67:[function(t,e,n){var r=t("../internal/baseMerge"),s=t("../internal/createAssigner"),i=s(r);e.exports=i},{"../internal/baseMerge":22,"../internal/createAssigner":30}],68:[function(t,e,n){function r(t){return t=s(t),t&&o.test(t)?t.replace(l,i):t}var s=t("../internal/baseToString"),i=t("../internal/escapeHtmlChar"),l=/[&<>"'`]/g,o=RegExp(l.source);e.exports=r},{"../internal/baseToString":25,"../internal/escapeHtmlChar":37}],69:[function(t,e,n){function r(t,e,n){var r=m.imports._.templateSettings||m;n&&h(t,e,n)&&(e=n=void 0),t=a(t),e=i(o({},n||e),r,s);var C,S,E=i(o({},e.imports),r.imports,s),A=p(E),w=u(E,A),R=0,x=e.interpolate||T,I="__p += '",O=RegExp((e.escape||T).source+"|"+x.source+"|"+(x===f?b:T).source+"|"+(e.evaluate||T).source+"|$","g"),N="sourceURL"in e?"//# sourceURL="+e.sourceURL+"\n":"";t.replace(O,function(e,n,r,s,i,l){return r||(r=s),I+=t.slice(R,l).replace(y,c),n&&(C=!0,I+="' +\n__e("+n+") +\n'"),i&&(S=!0,I+="';\n"+i+";\n__p += '"),r&&(I+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),R=l+e.length,e}),I+="';\n";var k=e.variable;k||(I="with (obj) {\n"+I+"\n}\n"),I=(S?I.replace(g,""):I).replace(_,"$1").replace(v,"$1;"),I="function("+(k||"obj")+") {\n"+(k?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(C?", __e = _.escape":"")+(S?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+I+"return __p\n}";var D=l(function(){return Function(A,N+"return "+I).apply(void 0,w)});if(D.source=I,d(D))throw D;return D}var s=t("../internal/assignOwnDefaults"),i=t("../internal/assignWith"),l=t("../utility/attempt"),o=t("../internal/baseAssign"),a=t("../internal/baseToString"),u=t("../internal/baseValues"),c=t("../internal/escapeStringChar"),d=t("../lang/isError"),h=t("../internal/isIterateeCall"),p=t("../object/keys"),f=t("../internal/reInterpolate"),m=t("./templateSettings"),g=/\b__p \+= '';/g,_=/\b(__p \+=) '' \+/g,v=/(__e\(.*?\)|\b__t\)) \+\n'';/g,b=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,T=/($^)/,y=/['\n\r\u2028\u2029\\]/g;e.exports=r},{"../internal/assignOwnDefaults":12,"../internal/assignWith":13,"../internal/baseAssign":14,"../internal/baseToString":25,"../internal/baseValues":26,"../internal/escapeStringChar":38,"../internal/isIterateeCall":43,"../internal/reInterpolate":49,"../lang/isError":57,"../object/keys":65,"../utility/attempt":72,"./templateSettings":70}],70:[function(t,e,n){var r=t("./escape"),s=t("../internal/reEscape"),i=t("../internal/reEvaluate"),l=t("../internal/reInterpolate"),o={escape:s,evaluate:i,interpolate:l,variable:"",imports:{_:{escape:r}}};e.exports=o},{"../internal/reEscape":47,"../internal/reEvaluate":48,"../internal/reInterpolate":49,"./escape":68}],71:[function(t,e,n){function r(t,e,n){var r=t;return(t=s(t))?(n?o(r,e,n):null==e)?t.slice(a(t),u(t)+1):(e+="",t.slice(i(t,e),l(t,e)+1)):t}var s=t("../internal/baseToString"),i=t("../internal/charsLeftIndex"),l=t("../internal/charsRightIndex"),o=t("../internal/isIterateeCall"),a=t("../internal/trimmedLeftIndex"),u=t("../internal/trimmedRightIndex");e.exports=r},{"../internal/baseToString":25,"../internal/charsLeftIndex":28,"../internal/charsRightIndex":29,"../internal/isIterateeCall":43,"../internal/trimmedLeftIndex":52,"../internal/trimmedRightIndex":53}],72:[function(t,e,n){var r=t("../lang/isError"),s=t("../function/restParam"),i=s(function(t,e){try{return t.apply(void 0,e)}catch(n){return r(n)?n:new Error(n)}});e.exports=i},{"../function/restParam":7,"../lang/isError":57}],73:[function(t,e,n){function r(t){return t}e.exports=r},{}],74:[function(t,e,n){var r,s="",i="wav",l=.5;e.exports={init:function(t){return r=document.createElement("audio"),r.setAttribute("autoplay",!0),t&&(s=t),this},play:function(t,e){t&&(r.src=s+t+"."+i),e?r.setAttribute("loop",!0):r.removeAttribute("loop"),r.volume=l,r.play()},stop:function(){r.pause(),r.currentTime=0}}},{}],75:[function(t,e,n){function r(){return w}function s(t){return w?E.info("Cobrowsing already initiated"):(v(document,"keyup",h),v(document,"keydown",h),v(document,"keypress",h),v(document,"mouseup",h),v(document,"click",h),v(document,"change",h),T="string"==typeof t.widget?document.querySelector(t.widget):t.widget,I=t.entity,y=t.emit,O=t.path,w=!0,E.log("cobrowsing module initiated with parameters: ",t),void y("cobrowsing/init"))}function i(){return R?E.info("Browser already shared"):(v(document,"scroll",h),v(document,"select",h),v(document,"mousemove",h),o(),R=!0,E.log("browser shared"),void y("cobrowsing/shared",{entity:I}))}function l(){return R?(b(document,"scroll",h),b(document,"select",h),b(document,"mousemove",h),u(),R=!1,y("cobrowsing/unshared",{entity:I}),void E.log("browser unshared")):E.info("Browser already unshared")}function o(){var t=document.body;x||(x=document.createElement("img"),x.className="wc-rmt-ptr",x.setAttribute("src",O+"images/pointer.png"),x.style.position="absolute",t.firstChild?t.insertBefore(x,t.firstChild):t.appendChild(x),a())}function a(){x.style.left=D,x.style.top=L,C=window.requestAnimationFrame(a)}function u(){x&&(cancelAnimationFrame(C),x.parentNode.removeChild(x),x=null)}function c(t){var e=0;if(document.selection){t.focus();var n=document.selection.createRange();n.moveStart("character",-t.value.length),e=n.text.length}else e=(!t.type||"email"!==t.type&&"number"!==t.type)&&(t.selectionStart||"0"==t.selectionStart)?t.selectionStart:null;return e}function d(t){y("cobrowsing/event",{entity:I,events:t})}function h(t){var e=t||window.event,n=e.type,r=e.target,s=r.nodeName,i=document.body,l={},o=null,a=document.getElementsByTagName(r.nodeName),u=document.documentElement.scrollTop||document.body.scrollTop,d=document.documentElement.scrollLeft||document.body.scrollLeft,h=0;if(3===r.nodeType&&(r=r.parentNode),"user"!==I||!_(T,r)){for(h=0;h<A.length;h++)if(A[h].event==n)return void A.splice(h,1);for(h=0;h<a.length;h++)a[h]==r&&(o=h);if(l.event=n,l.entity=I,l.tn=s,l.tni=o,l.w=i.offsetWidth,l.h=i.offsetHeight,l.sx=d,l.sy=u,"mousemove"===n||"mouseover"===n||"mouseout"===n){var p=e.pageX||e.clientX+u,f=e.pageY||e.clientY+d;l.x=p,l.y=f}else if("scroll"===n);else if("keyup"==n||"keydown"==n||"keypress"==n){var m=e.charCode||e.keyCode||e.which,g=c(r);if("INPUT"===s&&"password"===r.type)return;if("keyup"==n){if(null!==g&&(86!=m||!e.metaKey&&!e.ctrlKey))return;var v=r.value;v&&(v=v.replace(/\n/g,"<br>"),l.value=v)}else if("keydown"==n){if(null===g||8!=m&&46!=m&&190!=m)return;if(!r.value)return;l.pos=g,l.code=m}else if("keypress"===n){if(null===g||8==m||46==m)return;l.pos=g,l.code=m}}else if("change"===n){if("INPUT"===s&&"password"===r.type)return;l.value=r.value}else if("mouseup"==n||"select"==n){var b=window.getSelection()||document.selection.createRange().text,y=b.anchorOffset,C=b.focusOffset,S=0,E="",w=0,R="",x=0,O="",N=0,D="",L=!1;if(null!==b.anchorNode){for(R=b.anchorNode.parentNode,h=0;h<R.childNodes.length;h++)R.childNodes[h]==b.anchorNode&&(w=h);for(E=R.nodeName.toLowerCase(),a=document.getElementsByTagName(E),h=0;h<a.length;h++)a[h]===R&&(S=h);for(D=b.focusNode.parentNode,h=0;h<D.childNodes.length;h++)D.childNodes[h]==b.focusNode&&(N=h);for(O=D.nodeName.toLowerCase(),a=document.getElementsByTagName(O),h=0;h<a.length;h++)a[h]===D&&(x=h);E===O&&S===x&&w===N&&y>C&&(L=!0),l.sn=E,l.sni=S,l.schi=w,l.en=O,l.eni=x,l.echi=N,l.so=L?C:y,l.eo=L?y:C}}else"click"==n&&(l.scx=e.screenX,l.scy=e.screenY);k(l)}}function p(t){var e,n=document.documentElement,r={};if(t.events){if(r=t.events,r.timestamp<N)return;if(r.entity===I)return;if(r.url){var s=r.url,i=document.URL;i.indexOf("chatSessionId")!==-1&&(i=i.substr(0,i.indexOf("chatSessionId")-1)),s!=i&&g(s)}if(r.w&&"user"===r.entity){var l=document.body,o=l.offsetWidth;o!==r.w&&(document.body.style.width=r.w+"px")}if("mousemove"===r.event)x&&(D=r.x+"px",L=r.y+"px");else if("scroll"===r.event)void 0!==r.tn&&(e="#document"===r.tn?n:document.getElementsByTagName(r.tn)[r.tni],e&&(e.scrollTop=r.sy,e.scrollLeft=r.sx),console.log("scroll event: ",e,r.sy));else if("mouseup"===r.event||"select"===r.event){if(r.sn){var a=document.getElementsByTagName(r.sn)[r.sni],u=document.getElementsByTagName(r.en)[r.eni];if(document.createRange&&void 0!==a&&void 0!==u){var c=document.createRange();c.setStart(a.childNodes[r.schi],r.so),c.setEnd(u.childNodes[r.echi],r.eo);var d=window.getSelection();d.removeAllRanges(),d.addRange(c)}}}else if("keyup"===r.event||"keydown"===r.event||"keypress"===r.event){if(void 0!==r.tn&&void 0!==r.tni&&(e=document.getElementsByTagName(r.tn)[r.tni])){var h,p=e.value;if(8==r.code){if(r.pos==p.length-1)h=p.substr(0,r.pos-1);else{if(0===r.pos)return;h=p.substr(0,r.pos-1)+p.substr(r.pos)}e.value=h}else if(46==r.code)h=p.substr(0,r.pos)+p.substr(r.pos+1),e.value=h;else if(190==r.code)h=p.substr(0,r.pos)+"."+p.substr(r.pos),e.value=h;else if(void 0!==r.value){var _=r.value;_=_.replace(/<br>/g,"\n"),e.value=_}else{var v=String.fromCharCode(r.code);h=p?p.substr(0,r.pos)+v+p.substr(r.pos):v,e.value=h}}}else if("change"===r.event)e=document.getElementsByTagName(r.tn)[r.tni],e.value=r.value;else if("click"===r.event)e=document.getElementsByTagName(r.tn)[r.tni],e&&e.click();else if(e=document.getElementsByTagName(r.tn)[r.tni]){var b=f(r.event,r.x,r.y,r.x,r.y);m(e,b)}"click"!==r.event&&"scroll"!==r.event||A.push(r);
}t.timestamp&&(N=t.timestamp)}function f(t,e,n,r,s){var i,l={bubbles:!0,cancelable:"mousemove"!=t,view:window,detail:0,screenX:e,screenY:n,clientX:r,clientY:s,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:void 0};if("function"==typeof document.createEvent)i=document.createEvent("MouseEvents"),i.initMouseEvent(t,l.bubbles,l.cancelable,l.view,l.detail,l.screenX,l.screenY,l.clientX,l.clientY,l.ctrlKey,l.altKey,l.shiftKey,l.metaKey,l.button,document.body.parentNode);else if(document.createEventObject){i=document.createEventObject();for(var o in l)i[o]=l[o];i.button={0:1,1:4,2:2}[i.button]||i.button}return i}function m(t,e){return t.dispatchEvent?t.dispatchEvent(e):t.fireEvent&&t.fireEvent("on"+type,e),e}function g(t){var e=document.URL;e!==t&&(document.location.href=t)}function _(t,e){for(var n=e.parentNode;null!=n;){if(n==t)return!0;n=n.parentNode}return!1}function v(t,e,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent&&t.attachEvent("on"+e,n)}function b(t,e,n){t.removeEventListener?t.removeEventListener(e,n,!1):t.detachEvent&&t.detachEvent("on"+e,n)}var T,y,C,S=t("./lodash"),E=t("./debug"),A=[],w=!1,R=!1,x=null,I="",O="",N=0,k=S.throttle(d,100,{trailing:!0,leading:!0}),D=0,L=0;e.exports={init:s,isInitiated:r,share:i,unshare:l,emitEvents:d,updateEvents:p}},{"./debug":77,"./lodash":79}],76:[function(t,e,n){(function(n){function r(t){return this.options=t||{},this.options.serverUrl=this.options.server+"/ipcc/$$$",this.session={},m=this.options.pageid?f+this.options.pageid:this.options.server,this.createWebsocket(),this.on("session/create",this.onSessionCreate.bind(this)),this.on("Error",this.onError),this}function s(t){var e=1e3*(Math.pow(2,t)-1);return e>3e4&&(e=3e4),Math.random()*e}function i(t){var e=t;return"ua"===t?e="uk":"us"!==t&&"gb"!==t||(e="en"),e}var l=t("events").EventEmitter,o=t("./storage"),a=t("./request"),u=t("./debug"),c=n.location,d=t("./lodash"),h=t("inherits"),p=1,f="main.ringotel.net/chatbot/WebChat/",m="",g=!1,_=null;h(r,l),e.exports=r,r.prototype.onError=function(t){u.log("Error: ",t)},r.prototype.onSessionCreate=function(t){this.session=d.merge(this.session,t),o.saveState("sid",t.sid)},r.prototype.setSessionTimeout=function(){var t=this.session.sessionTimeout;clearTimeout(_),t&&(_=setTimeout(this.onSessionTimeout.bind(this),1e3*t))},r.prototype.onSessionTimeout=function(){this.emit("session/timeout")},r.prototype.sendData=function(t){this.websocket&&this.websocket.send(JSON.stringify(t))},r.prototype.onWebsocketMessage=function(t){var e=JSON.parse(t.data);e.method;if(e.method)if("session"===e.method)this.emit("session/create",e.params);else if("messages"===e.method)e.params.list&&e.params.list.map(function(t){return this.emit("message/new",t),t}.bind(this));else if("message"===e.method)e.params.typing?this.emit("message/typing"):(this.emit("message/new",e.params),this.setSessionTimeout());else if("openShare"===e.method){if(this.session.sharedId===e.params.id)return;if(e.params.url&&c.href!==e.params.url)return window.location=e.params.url;e.params.id&&(this.session.sharedId=e.params.id,this.emit("session/joined",{url:c.href}),this.shareOpened(e.params.id,c.href))}else"shareOpened"===e.method?e.params.id&&(this.session.sharedId=e.params.id,this.emit("session/joined",{url:c.href})):"shareClosed"===e.method?(clearInterval(this.openShareInteval),this.session.sharedId="",this.emit("session/disjoin")):"events"===e.method&&this.emit("cobrowsing/update",e.params)},r.prototype.init=function(){g=!0;var t=o.getState("entity","session"),e=o.getState("sid");if(strIndex=c.href.indexOf("chatSessionId"),u.log("initModule: ",this.session,t,e),strIndex!==-1){e=this.getSidFromUrl(c.href),t="agent";var n=c.href.substr(0,strIndex);n="?"===n[n.length-1]?n.substr(0,n.length-1):n,o.saveState("sid",e),this.joinSession(n)}else"agent"===t?(e=o.getState("sid"),this.joinSession(c.href)):(t="user",this.createSession({sid:e,url:c.href}));this.session.sid=e,this.session.entity=t,o.saveState("entity",t,"session")},r.prototype.createSession=function(t){var e={method:"createSession",params:{url:t.url||c.href}};return t.sid&&(e.params.sid=t.sid),this.websocket?this.sendData(e):void a.post(this.options.serverUrl,e,function(e,n){return e?void this.emit("Error",e,{method:"createSession",params:t}):void this.emit("session/create",n.result)}.bind(this))},r.prototype.joinSession=function(t){this.openShareInteval=setInterval(function(){this.openShare(t)}.bind(this),3e3),n.onclose=function(){this.shareClosed()}.bind(this)},r.prototype.updateEvents=function(t,e){if(this.session.sharedId)return data={method:"events",params:{sid:this.session.sid,id:this.session.sharedId,timestamp:o.getState("eventTimestamp","cache"),events:t}},this.websocket?this.sendData(data):void a.post(this.options.serverUrl,data,function(t,n){return t?(this.emit("Error",t,data),e(t)):void(n.result.timestamp>o.getState("eventTimestamp","cache")?(o.saveState("eventTimestamp",n.result.timestamp,"cache"),e&&e(null,n.result)):e&&e(null,{events:[]}))}.bind(this))},r.prototype.getLanguages=function(t){u.log("this.session: ",this.session),t(null,this.session.langs)},r.prototype.chatRequest=function(t,e){t.sid=this.session.sid,u.log("chatRequest params: ",t);var n={method:"chatRequest",params:t};return this.setSessionTimeout(),this.websocket?this.sendData(n):void a.post(this.options.serverUrl,n,function(n,r){return n?(this.emit("Error",n,{method:"chatRequest",params:t}),void(e&&e(n))):(t.url=c.href,this.emit("chat/start",d.merge(t,r.result)),void(e&&e(null,r)))}.bind(this))},r.prototype.getMessages=function(t){a.post(this.options.serverUrl,{method:"getMessages",params:{sid:this.session.sid,timestamp:o.getState("msgTimestamp")}},function(e,n){return e?(this.emit("Error",e,{method:"getMessages"}),t(e)):(n.result.timestamp>o.getState("msgTimestamp")&&(o.saveState("msgTimestamp",n.result.timestamp),n.result.messages&&this.emit("message/new",n.result)),n.result.typing&&this.emit("message/typing",n.result),void(t&&t(null,n.result)))}.bind(this))},r.prototype.closeChat=function(t){var e={method:"closeChat",params:{sid:this.session.sid}};return t&&(e.params.rating=t),this.websocket?this.sendData(e):void a.post(this.options.serverUrl,e,function(n,r){return n?void this.emit("Error",n,e):(o.saveState("chat",!1),void this.emit("chat/close",{rating:t,url:c.href}))}.bind(this))},r.prototype.sendMessage=function(t,e){var n={method:"message",params:{sid:this.session.sid,content:t.message}};return this.setSessionTimeout(),this.websocket?(t.file&&(n.params.content=t.file,n.params.file=t.message),this.sendData(n)):void a.post(this.options.serverUrl,n,function(t,r){return t?(this.emit("Error",t,{method:"sendMessage",params:n}),void(e&&e(t))):void(e&&e())})},r.prototype.sendEmail=function(t,e){t.sid=this.session.sid;var n={method:"sendMail",params:t};return this.websocket?this.sendData(n):void a.post(this.options.serverUrl,n,function(n,r){return n?(this.emit("Error",n,{method:"sendEmail",params:t}),void(e&&e(n))):(this.emit("chat/send",t),void(e&&e(null,r)))}.bind(this))},r.prototype.requestCallback=function(t,e){t.sid=this.session.sid;var n={method:"requestCallback",params:t};return this.websocket?this.sendData(n):void a.post(this.options.serverUrl,n,function(n,r){return n?(this.emit("Error",n,{method:"requestCallback",params:t}),e(n)):void(e&&e(null,r.result))}.bind(this))},r.prototype.disjoinSession=function(t){var e={method:"disjoinSession",params:{sid:t}};return this.websocket?this.sendData(e):void a.post(this.options.serverUrl,e,function(e,n){return e?void this.emit("Error",e,{method:"disjoinSession",params:{sid:t}}):void this.emit("session/disjoin",{url:c.href})}.bind(this))},r.prototype.shareOpened=function(){var t={method:"shareOpened",params:{id:this.session.sharedId,url:c.href}};if(this.websocket)return this.sendData(t)},r.prototype.shareClosed=function(){var t={method:"shareClosed",params:{id:this.session.sharedId,url:c.href}};if(this.websocket)return this.sendData(t)},r.prototype.openShare=function(t){var e={method:"openShare",params:{sid:this.session.sid,url:t}};return this.websocket?this.sendData(e):void a.post(this.options.serverUrl,e,function(t,e){if(t)return void this.emit("Error",t,{method:"openShare",params:{state:state}})}.bind(this))},r.prototype.setChatTimeout=function(t){return setTimeout(function(){this.emit("chat/timeout")}.bind(this),1e3*t)},r.prototype.userIsTyping=function(){var t={method:"typing",params:{sid:this.session.sid}};return this.websocket?this.sendData(t):void a.post(this.options.serverUrl,t,function(t){if(t)return void this.emit("Error",t,{method:"setChatTimeout"})}.bind(this))},r.prototype.updateUrl=function(t){var e={method:"updateUrl",params:{sid:this.session.sid,url:t}};return this.websocket?this.sendData(e):void a.post(this.options.serverUrl,e,function(e,n){if(e)return void this.emit("Error",e,{method:"updateUrl",params:{url:t}})}.bind(this))},r.prototype.linkFollowed=function(t){var e={method:"linkFollowed",params:{sid:this.session.sid,url:t}};return this.websocket?this.sendData(e):void a.post(this.options.serverUrl,e,function(e,n){if(e)return void this.emit("Error",e,{method:"linkFollowed",params:{url:t}})}.bind(this))},r.prototype.detectLanguage=function(t){var e,n=o.getState("lang","session"),r=[];for(var s in t)r.push(s);return n?e=n:this.options.lang?e=this.options.lang:this.options.langFromUrl&&c.pathname.split("/").map(function(t){return t=i(t),r.indexOf(t)!==-1&&(e=t),t}),e||(e=(navigator.language||navigator.userLanguage).split("-")[0]),r.indexOf(e)===-1&&(e="en"),u.log("detected lang: ",r,n,this.options.lang,this.options.langFromUrl,e),this.session.lang=e,e},r.prototype.getSidFromUrl=function(t){var e=t.substring(t.indexOf("chatSessionId="));return e=e.substring(e.indexOf("=")+1)},r.prototype.createWebsocket=function(t){var e="wss:",r=new WebSocket(e+"//"+m,"json.api.smile-soft.com");r.onopen=function(t){console.log("WebSocket opened: ",t),p=1,g||this.init()}.bind(this),r.onmessage=this.onWebsocketMessage.bind(this),r.onclose=this.onWebsocketClose.bind(this),r.onerror=this.onError,n.onbeforeunload=function(){r.onclose=function(){},r.close()},this.websocket=r},r.prototype.onWebsocketClose=function(t){console.log("WebSocket closed",t);var e=s(p);setTimeout(function(){p++,this.createWebsocket()}.bind(this),e)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./debug":77,"./lodash":79,"./request":81,"./storage":82,events:2,inherits:3}],77:[function(t,e,n){(function(t){function n(e,n){if(t.localStorage.getItem("swc.debug"))return void[].forEach.call(e,function(e){t.console[n]?t.console[n](e):t.console.log(e)})}e.exports={log:function(){n(arguments,"log")},info:function(){n(arguments,"info")},warn:function(){n(arguments,"warn")},error:function(){n(arguments,"error")}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],78:[function(t,e,n){(function(r){!function(t){if("object"==typeof n&&"undefined"!=typeof e)e.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var s;s="undefined"!=typeof window?window:"undefined"!=typeof r?r:"undefined"!=typeof self?self:this,s.JsSIP=t()}}(function(){var e;return function n(e,r,s){function i(o,a){if(!r[o]){if(!e[o]){var u="function"==typeof t&&t;if(!a&&u)return u(o,!0);if(l)return l(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var d=r[o]={exports:{}};e[o][0].call(d.exports,function(t){var n=e[o][1][t];return i(n?n:t)},d,d.exports,n,e,r,s)}return r[o].exports}for(var l="function"==typeof t&&t,o=0;o<s.length;o++)i(s[o]);return i}({1:[function(t,e,n){var r=t("../package.json"),s={USER_AGENT:r.title+" "+r.version,SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",MISSING_SDP:"Missing SDP",AUTHENTICATION_ERROR:"Authentication Error",BYE:"Terminated",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",DIALOG_ERROR:"Dialog Error",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484,424],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",REFER:"REFER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",424:"Bad Location Information",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"JsSIP Internal Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},ALLOWED_METHODS:"INVITE,ACK,CANCEL,BYE,UPDATE,MESSAGE,OPTIONS,REFER,INFO",ACCEPTED_BODY_TYPES:"application/sdp, application/dtmf-relay",MAX_FORWARDS:69,SESSION_EXPIRES:90,MIN_SESSION_EXPIRES:60};e.exports=s},{"../package.json":47}],2:[function(t,e,n){function r(t,e,n,r){var o;return this.uac_pending_reply=!1,this.uas_pending_reply=!1,e.hasHeader("contact")?(r=e instanceof l.IncomingResponse?e.status_code<200?s.STATUS_EARLY:s.STATUS_CONFIRMED:r||s.STATUS_CONFIRMED,o=e.parseHeader("contact"),"UAS"===n?(this.id={call_id:e.call_id,local_tag:e.to_tag,remote_tag:e.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=r,this.remote_seqnum=e.cseq,this.local_uri=e.parseHeader("to").uri,this.remote_uri=e.parseHeader("from").uri,this.remote_target=o.uri,this.route_set=e.getHeaders("record-route")):"UAC"===n&&(this.id={call_id:e.call_id,local_tag:e.from_tag,remote_tag:e.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=r,this.local_seqnum=e.cseq,this.local_uri=e.parseHeader("from").uri,this.remote_uri=e.parseHeader("to").uri,this.remote_target=o.uri,this.route_set=e.getHeaders("record-route").reverse()),this.owner=t,t.ua.dialogs[this.id.toString()]=this,void i("new "+n+" dialog created with status "+(this.state===s.STATUS_EARLY?"EARLY":"CONFIRMED"))):{error:"unable to create a Dialog without Contact header field"}}e.exports=r;var s={STATUS_EARLY:1,STATUS_CONFIRMED:2};r.C=s;var i=t("debug")("JsSIP:Dialog"),l=t("./SIPMessage"),o=t("./Constants"),a=t("./Transactions"),u=t("./Dialog/RequestSender");r.prototype={update:function(t,e){this.state=s.STATUS_CONFIRMED,i("dialog "+this.id.toString()+"  changed to CONFIRMED state"),"UAC"===e&&(this.route_set=t.getHeaders("record-route").reverse())},terminate:function(){i("dialog "+this.id.toString()+" deleted"),delete this.owner.ua.dialogs[this.id.toString()]},createRequest:function(t,e,n){var r,s;return e=e&&e.slice()||[],this.local_seqnum||(this.local_seqnum=Math.floor(1e4*Math.random())),r=t===o.CANCEL||t===o.ACK?this.local_seqnum:this.local_seqnum+=1,s=new l.OutgoingRequest(t,this.remote_target,this.owner.ua,{cseq:r,call_id:this.id.call_id,from_uri:this.local_uri,from_tag:this.id.local_tag,to_uri:this.remote_uri,to_tag:this.id.remote_tag,route_set:this.route_set},e,n),s.dialog=this,s},checkInDialogRequest:function(t){var e=this;if(this.remote_seqnum){if(t.cseq<this.remote_seqnum)return t.method!==o.ACK&&t.reply(500),!1;t.cseq>this.remote_seqnum&&(this.remote_seqnum=t.cseq)}else this.remote_seqnum=t.cseq;if(t.method===o.INVITE||t.method===o.UPDATE&&t.body){if(this.uac_pending_reply===!0)t.reply(491);else{if(this.uas_pending_reply===!0){var n=(10*Math.random()|0)+1;return t.reply(500,null,["Retry-After:"+n]),!1}this.uas_pending_reply=!0,t.server_transaction.on("stateChanged",function r(){this.state!==a.C.STATUS_ACCEPTED&&this.state!==a.C.STATUS_COMPLETED&&this.state!==a.C.STATUS_TERMINATED||(t.server_transaction.removeListener("stateChanged",r),e.uas_pending_reply=!1)})}t.hasHeader("contact")&&t.server_transaction.on("stateChanged",function(){this.state===a.C.STATUS_ACCEPTED&&(e.remote_target=t.parseHeader("contact").uri)})}else t.method===o.NOTIFY&&t.hasHeader("contact")&&t.server_transaction.on("stateChanged",function(){this.state===a.C.STATUS_COMPLETED&&(e.remote_target=t.parseHeader("contact").uri)});return!0},sendRequest:function(t,e,n){n=n||{};var r=n.extraHeaders&&n.extraHeaders.slice()||[],s=n.body||null,i=this.createRequest(e,r,s),l=new u(this,t,i);return l.send(),i},receiveRequest:function(t){this.checkInDialogRequest(t)&&this.owner.receiveRequest(t)}}},{"./Constants":1,"./Dialog/RequestSender":3,"./SIPMessage":18,"./Transactions":21,debug:33}],3:[function(t,e,n){function r(t,e,n){this.dialog=t,this.applicant=e,this.request=n,this.reattempt=!1,this.reattemptTimer=null}e.exports=r;var s=t("../Constants"),i=t("../Transactions"),l=t("../RTCSession"),o=t("../RequestSender");r.prototype={send:function(){var t=this,e=new o(this,this.dialog.owner.ua);e.send(),(this.request.method===s.INVITE||this.request.method===s.UPDATE&&this.request.body)&&e.clientTransaction.state!==i.C.STATUS_TERMINATED&&(this.dialog.uac_pending_reply=!0,e.clientTransaction.on("stateChanged",function n(){this.state!==i.C.STATUS_ACCEPTED&&this.state!==i.C.STATUS_COMPLETED&&this.state!==i.C.STATUS_TERMINATED||(e.clientTransaction.removeListener("stateChanged",n),t.dialog.uac_pending_reply=!1)}))},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(t){var e=this;408===t.status_code||481===t.status_code?this.applicant.onDialogError(t):t.method===s.INVITE&&491===t.status_code?this.reattempt?this.applicant.receiveResponse(t):(this.request.cseq.value=this.dialog.local_seqnum+=1,this.reattemptTimer=setTimeout(function(){e.applicant.owner.status!==l.C.STATUS_TERMINATED&&(e.reattempt=!0,e.request_sender.send())},1e3)):this.applicant.receiveResponse(t)}}},{"../Constants":1,"../RTCSession":11,"../RequestSender":17,"../Transactions":21}],4:[function(t,e,n){function r(t){this.credentials=t,this.cnonce=null,this.nc=0,this.ncHex="00000000",this.algorithm=null,this.realm=null,this.nonce=null,this.opaque=null,this.stale=null,this.qop=null,this.method=null,this.uri=null,this.ha1=null,this.response=null}e.exports=r;var s=t("debug")("JsSIP:DigestAuthentication"),i=t("debug")("JsSIP:ERROR:DigestAuthentication");i.log=console.warn.bind(console);var l=t("./Utils");r.prototype.get=function(t){switch(t){case"realm":return this.realm;case"ha1":return this.ha1;default:return void i('get() | cannot get "%s" parameter',t)}},r.prototype.authenticate=function(t,e){var n,r;if(this.algorithm=e.algorithm,this.realm=e.realm,this.nonce=e.nonce,this.opaque=e.opaque,this.stale=e.stale,this.algorithm){if("MD5"!==this.algorithm)return i('authenticate() | challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this.algorithm="MD5";if(!this.nonce)return i("authenticate() | challenge without Digest nonce, authentication aborted"),!1;if(!this.realm)return i("authenticate() | challenge without Digest realm, authentication aborted"),!1;if(!this.credentials.password){if(!this.credentials.ha1)return i("authenticate() | no plain SIP password nor ha1 provided, authentication aborted"),!1;if(this.credentials.realm!==this.realm)return i('authenticate() | no plain SIP password, and stored `realm` does not match the given `realm`, cannot authenticate [stored:"%s", given:"%s"]',this.credentials.realm,this.realm),!1}if(e.qop)if(e.qop.indexOf("auth")>-1)this.qop="auth";else{if(!(e.qop.indexOf("auth-int")>-1))return i('authenticate() | challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;this.qop="auth-int"}else this.qop=null;return this.method=t.method,this.uri=t.ruri,this.cnonce=l.createRandomToken(12),this.nc+=1,r=Number(this.nc).toString(16),this.ncHex="00000000".substr(0,8-r.length)+r,4294967296===this.nc&&(this.nc=1,this.ncHex="00000001"),this.credentials.password?this.ha1=l.calculateMD5(this.credentials.username+":"+this.realm+":"+this.credentials.password):this.ha1=this.credentials.ha1,"auth"===this.qop?(n=l.calculateMD5(this.method+":"+this.uri),this.response=l.calculateMD5(this.ha1+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+n)):"auth-int"===this.qop?(n=l.calculateMD5(this.method+":"+this.uri+":"+l.calculateMD5(this.body?this.body:"")),this.response=l.calculateMD5(this.ha1+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+n)):null===this.qop&&(n=l.calculateMD5(this.method+":"+this.uri),this.response=l.calculateMD5(this.ha1+":"+this.nonce+":"+n)),s("authenticate() | response generated"),!0},r.prototype.toString=function(){var t=[];if(!this.response)throw new Error("response field does not exist, cannot generate Authorization header");return t.push("algorithm="+this.algorithm),t.push('username="'+this.credentials.username+'"'),t.push('realm="'+this.realm+'"'),t.push('nonce="'+this.nonce+'"'),t.push('uri="'+this.uri+'"'),t.push('response="'+this.response+'"'),this.opaque&&t.push('opaque="'+this.opaque+'"'),this.qop&&(t.push("qop="+this.qop),t.push('cnonce="'+this.cnonce+'"'),t.push("nc="+this.ncHex)),"Digest "+t.join(", ")}},{"./Utils":25,debug:33}],5:[function(t,e,n){var r={ConfigurationError:function(){var t=function(t,e){this.code=1,this.name="CONFIGURATION_ERROR",this.parameter=t,this.value=e,this.message=this.value?"Invalid value "+JSON.stringify(this.value)+' for parameter "'+this.parameter+'"':"Missing parameter: "+this.parameter};return t.prototype=new Error,t}(),InvalidStateError:function(){var t=function(t){this.code=2,this.name="INVALID_STATE_ERROR",this.status=t,this.message="Invalid status: "+t};return t.prototype=new Error,t}(),NotSupportedError:function(){var t=function(t){this.code=3,this.name="NOT_SUPPORTED_ERROR",this.message=t};return t.prototype=new Error,t}(),NotReadyError:function(){var t=function(t){this.code=4,this.name="NOT_READY_ERROR",this.message=t};return t.prototype=new Error,t}()};e.exports=r},{}],6:[function(t,e,n){e.exports=function(){function e(t){return'"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var n={parse:function(n,r){function s(t){Tr>vr||(vr>Tr&&(Tr=vr,yr=[]),yr.push(t))}function i(){var t;return"\r\n"===n.substr(vr,2)?(t="\r\n",vr+=2):(t=null,0===br&&s('"\\r\\n"')),t}function l(){var t;return/^[0-9]/.test(n.charAt(vr))?(t=n.charAt(vr),vr++):(t=null,0===br&&s("[0-9]")),t}function o(){var t;return/^[a-zA-Z]/.test(n.charAt(vr))?(t=n.charAt(vr),vr++):(t=null,0===br&&s("[a-zA-Z]")),t}function a(){var t;return/^[0-9a-fA-F]/.test(n.charAt(vr))?(t=n.charAt(vr),vr++):(t=null,0===br&&s("[0-9a-fA-F]")),t}function u(){var t;return t=h(),null===t&&(t=p()),t}function c(){var t;return/^[\0-\xFF]/.test(n.charAt(vr))?(t=n.charAt(vr),vr++):(t=null,0===br&&s("[\\0-\\xFF]")),t}function d(){var t;return/^["]/.test(n.charAt(vr))?(t=n.charAt(vr),vr++):(t=null,0===br&&s('["]')),t}function h(){var t;return 32===n.charCodeAt(vr)?(t=" ",vr++):(t=null,0===br&&s('" "')),t}function p(){var t;return 9===n.charCodeAt(vr)?(t="\t",vr++):(t=null,0===br&&s('"\\t"')),t}function f(){var t;return/^[a-zA-Z0-9]/.test(n.charAt(vr))?(t=n.charAt(vr),vr++):(t=null,0===br&&s("[a-zA-Z0-9]")),t}function m(){var t;return 59===n.charCodeAt(vr)?(t=";",vr++):(t=null,0===br&&s('";"')),null===t&&(47===n.charCodeAt(vr)?(t="/",vr++):(t=null,0===br&&s('"/"')),null===t&&(63===n.charCodeAt(vr)?(t="?",vr++):(t=null,0===br&&s('"?"')),null===t&&(58===n.charCodeAt(vr)?(t=":",vr++):(t=null,0===br&&s('":"')),null===t&&(64===n.charCodeAt(vr)?(t="@",vr++):(t=null,0===br&&s('"@"')),null===t&&(38===n.charCodeAt(vr)?(t="&",vr++):(t=null,0===br&&s('"&"')),null===t&&(61===n.charCodeAt(vr)?(t="=",vr++):(t=null,0===br&&s('"="')),null===t&&(43===n.charCodeAt(vr)?(t="+",vr++):(t=null,0===br&&s('"+"')),null===t&&(36===n.charCodeAt(vr)?(t="$",vr++):(t=null,0===br&&s('"$"')),null===t&&(44===n.charCodeAt(vr)?(t=",",vr++):(t=null,0===br&&s('","'))))))))))),t}function g(){var t;return t=f(),null===t&&(t=_()),t}function _(){var t;return 45===n.charCodeAt(vr)?(t="-",vr++):(t=null,0===br&&s('"-"')),null===t&&(95===n.charCodeAt(vr)?(t="_",vr++):(t=null,0===br&&s('"_"')),null===t&&(46===n.charCodeAt(vr)?(t=".",vr++):(t=null,0===br&&s('"."')),null===t&&(33===n.charCodeAt(vr)?(t="!",vr++):(t=null,0===br&&s('"!"')),null===t&&(126===n.charCodeAt(vr)?(t="~",vr++):(t=null,0===br&&s('"~"')),null===t&&(42===n.charCodeAt(vr)?(t="*",vr++):(t=null,0===br&&s('"*"')),null===t&&(39===n.charCodeAt(vr)?(t="'",vr++):(t=null,0===br&&s('"\'"')),null===t&&(40===n.charCodeAt(vr)?(t="(",vr++):(t=null,0===br&&s('"("')),null===t&&(41===n.charCodeAt(vr)?(t=")",vr++):(t=null,0===br&&s('")"')))))))))),t}function v(){var t,e,r,i,l;return i=vr,l=vr,37===n.charCodeAt(vr)?(t="%",vr++):(t=null,0===br&&s('"%"')),null!==t?(e=a(),null!==e?(r=a(),null!==r?t=[t,e,r]:(t=null,vr=l)):(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t,e){return e.join("")}(i,t)),null===t&&(vr=i),t}function b(){var t,e,n,r,s,l;for(r=vr,s=vr,l=vr,t=[],e=u();null!==e;)t.push(e),e=u();if(null!==t?(e=i(),null!==e?t=[t,e]:(t=null,vr=l)):(t=null,vr=l),t=null!==t?t:"",null!==t){if(n=u(),null!==n)for(e=[];null!==n;)e.push(n),n=u();else e=null;null!==e?t=[t,e]:(t=null,vr=s)}else t=null,vr=s;return null!==t&&(t=function(t){return" "}(r)),null===t&&(vr=r),t}function T(){var t;return t=b(),t=null!==t?t:""}function y(){var t,e,r,i,l;for(i=vr,l=vr,t=[],e=h(),null===e&&(e=p());null!==e;)t.push(e),e=h(),null===e&&(e=p());return null!==t?(58===n.charCodeAt(vr)?(e=":",vr++):(e=null,0===br&&s('":"')),null!==e?(r=T(),null!==r?t=[t,e,r]:(t=null,vr=l)):(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t){return":"}(i)),null===t&&(vr=i),t}function C(){var t,e,r,s,i,l,o;if(i=vr,l=vr,e=S(),null!==e)for(t=[];null!==e;)t.push(e),e=S();else t=null;if(null!==t){for(e=[],o=vr,r=[],s=b();null!==s;)r.push(s),s=b();for(null!==r?(s=S(),null!==s?r=[r,s]:(r=null,vr=o)):(r=null,vr=o);null!==r;){for(e.push(r),o=vr,r=[],s=b();null!==s;)r.push(s),s=b();null!==r?(s=S(),null!==s?r=[r,s]:(r=null,vr=o)):(r=null,vr=o)}null!==e?t=[t,e]:(t=null,vr=l)}else t=null,vr=l;return null!==t&&(t=function(t){return n.substring(vr,t)}(i)),null===t&&(vr=i),t}function S(){var t;return/^[!-~]/.test(n.charAt(vr))?(t=n.charAt(vr),vr++):(t=null,0===br&&s("[!-~]")),null===t&&(t=E()),t}function E(){var t;return/^[\x80-\uFFFF]/.test(n.charAt(vr))?(t=n.charAt(vr),vr++):(t=null,0===br&&s("[\\x80-\\uFFFF]")),t}function A(){var t;return/^[\x80-\xBF]/.test(n.charAt(vr))?(t=n.charAt(vr),vr++):(t=null,0===br&&s("[\\x80-\\xBF]")),t}function w(){var t;return t=l(),null===t&&(/^[a-f]/.test(n.charAt(vr))?(t=n.charAt(vr),vr++):(t=null,0===br&&s("[a-f]"))),t}function R(){var t,e,r;if(r=vr,e=f(),null===e&&(45===n.charCodeAt(vr)?(e="-",vr++):(e=null,0===br&&s('"-"')),null===e&&(46===n.charCodeAt(vr)?(e=".",vr++):(e=null,0===br&&s('"."')),null===e&&(33===n.charCodeAt(vr)?(e="!",vr++):(e=null,0===br&&s('"!"')),null===e&&(37===n.charCodeAt(vr)?(e="%",vr++):(e=null,0===br&&s('"%"')),null===e&&(42===n.charCodeAt(vr)?(e="*",vr++):(e=null,0===br&&s('"*"')),null===e&&(95===n.charCodeAt(vr)?(e="_",vr++):(e=null,0===br&&s('"_"')),null===e&&(43===n.charCodeAt(vr)?(e="+",vr++):(e=null,0===br&&s('"+"')),null===e&&(96===n.charCodeAt(vr)?(e="`",vr++):(e=null,0===br&&s('"`"')),null===e&&(39===n.charCodeAt(vr)?(e="'",vr++):(e=null,0===br&&s('"\'"')),null===e&&(126===n.charCodeAt(vr)?(e="~",vr++):(e=null,0===br&&s('"~"')))))))))))),null!==e)for(t=[];null!==e;)t.push(e),e=f(),null===e&&(45===n.charCodeAt(vr)?(e="-",vr++):(e=null,0===br&&s('"-"')),null===e&&(46===n.charCodeAt(vr)?(e=".",vr++):(e=null,0===br&&s('"."')),null===e&&(33===n.charCodeAt(vr)?(e="!",vr++):(e=null,0===br&&s('"!"')),null===e&&(37===n.charCodeAt(vr)?(e="%",vr++):(e=null,0===br&&s('"%"')),null===e&&(42===n.charCodeAt(vr)?(e="*",vr++):(e=null,0===br&&s('"*"')),null===e&&(95===n.charCodeAt(vr)?(e="_",vr++):(e=null,0===br&&s('"_"')),null===e&&(43===n.charCodeAt(vr)?(e="+",vr++):(e=null,0===br&&s('"+"')),null===e&&(96===n.charCodeAt(vr)?(e="`",vr++):(e=null,0===br&&s('"`"')),null===e&&(39===n.charCodeAt(vr)?(e="'",vr++):(e=null,0===br&&s('"\'"')),null===e&&(126===n.charCodeAt(vr)?(e="~",vr++):(e=null,0===br&&s('"~"'))))))))))));else t=null;return null!==t&&(t=function(t){return n.substring(vr,t)}(r)),null===t&&(vr=r),t}function x(){var t,e,r;if(r=vr,e=f(),null===e&&(45===n.charCodeAt(vr)?(e="-",vr++):(e=null,0===br&&s('"-"')),null===e&&(33===n.charCodeAt(vr)?(e="!",vr++):(e=null,0===br&&s('"!"')),null===e&&(37===n.charCodeAt(vr)?(e="%",vr++):(e=null,0===br&&s('"%"')),null===e&&(42===n.charCodeAt(vr)?(e="*",vr++):(e=null,0===br&&s('"*"')),null===e&&(95===n.charCodeAt(vr)?(e="_",vr++):(e=null,0===br&&s('"_"')),null===e&&(43===n.charCodeAt(vr)?(e="+",vr++):(e=null,0===br&&s('"+"')),null===e&&(96===n.charCodeAt(vr)?(e="`",vr++):(e=null,0===br&&s('"`"')),null===e&&(39===n.charCodeAt(vr)?(e="'",vr++):(e=null,0===br&&s('"\'"')),null===e&&(126===n.charCodeAt(vr)?(e="~",vr++):(e=null,0===br&&s('"~"'))))))))))),null!==e)for(t=[];null!==e;)t.push(e),e=f(),null===e&&(45===n.charCodeAt(vr)?(e="-",vr++):(e=null,0===br&&s('"-"')),null===e&&(33===n.charCodeAt(vr)?(e="!",vr++):(e=null,0===br&&s('"!"')),null===e&&(37===n.charCodeAt(vr)?(e="%",vr++):(e=null,0===br&&s('"%"')),null===e&&(42===n.charCodeAt(vr)?(e="*",vr++):(e=null,0===br&&s('"*"')),null===e&&(95===n.charCodeAt(vr)?(e="_",vr++):(e=null,0===br&&s('"_"')),null===e&&(43===n.charCodeAt(vr)?(e="+",vr++):(e=null,0===br&&s('"+"')),null===e&&(96===n.charCodeAt(vr)?(e="`",vr++):(e=null,0===br&&s('"`"')),null===e&&(39===n.charCodeAt(vr)?(e="'",vr++):(e=null,0===br&&s('"\'"')),null===e&&(126===n.charCodeAt(vr)?(e="~",vr++):(e=null,0===br&&s('"~"')))))))))));else t=null;return null!==t&&(t=function(t){return n.substring(vr,t)}(r)),null===t&&(vr=r),t}function I(){var t;return 40===n.charCodeAt(vr)?(t="(",vr++):(t=null,0===br&&s('"("')),null===t&&(41===n.charCodeAt(vr)?(t=")",vr++):(t=null,0===br&&s('")"')),null===t&&(60===n.charCodeAt(vr)?(t="<",vr++):(t=null,0===br&&s('"<"')),null===t&&(62===n.charCodeAt(vr)?(t=">",vr++):(t=null,0===br&&s('">"')),null===t&&(64===n.charCodeAt(vr)?(t="@",
vr++):(t=null,0===br&&s('"@"')),null===t&&(44===n.charCodeAt(vr)?(t=",",vr++):(t=null,0===br&&s('","')),null===t&&(59===n.charCodeAt(vr)?(t=";",vr++):(t=null,0===br&&s('";"')),null===t&&(58===n.charCodeAt(vr)?(t=":",vr++):(t=null,0===br&&s('":"')),null===t&&(92===n.charCodeAt(vr)?(t="\\",vr++):(t=null,0===br&&s('"\\\\"')),null===t&&(t=d(),null===t&&(47===n.charCodeAt(vr)?(t="/",vr++):(t=null,0===br&&s('"/"')),null===t&&(91===n.charCodeAt(vr)?(t="[",vr++):(t=null,0===br&&s('"["')),null===t&&(93===n.charCodeAt(vr)?(t="]",vr++):(t=null,0===br&&s('"]"')),null===t&&(63===n.charCodeAt(vr)?(t="?",vr++):(t=null,0===br&&s('"?"')),null===t&&(61===n.charCodeAt(vr)?(t="=",vr++):(t=null,0===br&&s('"="')),null===t&&(123===n.charCodeAt(vr)?(t="{",vr++):(t=null,0===br&&s('"{"')),null===t&&(125===n.charCodeAt(vr)?(t="}",vr++):(t=null,0===br&&s('"}"')),null===t&&(t=h(),null===t&&(t=p())))))))))))))))))),t}function O(){var t,e,r;if(r=vr,e=f(),null===e&&(45===n.charCodeAt(vr)?(e="-",vr++):(e=null,0===br&&s('"-"')),null===e&&(46===n.charCodeAt(vr)?(e=".",vr++):(e=null,0===br&&s('"."')),null===e&&(33===n.charCodeAt(vr)?(e="!",vr++):(e=null,0===br&&s('"!"')),null===e&&(37===n.charCodeAt(vr)?(e="%",vr++):(e=null,0===br&&s('"%"')),null===e&&(42===n.charCodeAt(vr)?(e="*",vr++):(e=null,0===br&&s('"*"')),null===e&&(95===n.charCodeAt(vr)?(e="_",vr++):(e=null,0===br&&s('"_"')),null===e&&(43===n.charCodeAt(vr)?(e="+",vr++):(e=null,0===br&&s('"+"')),null===e&&(96===n.charCodeAt(vr)?(e="`",vr++):(e=null,0===br&&s('"`"')),null===e&&(39===n.charCodeAt(vr)?(e="'",vr++):(e=null,0===br&&s('"\'"')),null===e&&(126===n.charCodeAt(vr)?(e="~",vr++):(e=null,0===br&&s('"~"')),null===e&&(40===n.charCodeAt(vr)?(e="(",vr++):(e=null,0===br&&s('"("')),null===e&&(41===n.charCodeAt(vr)?(e=")",vr++):(e=null,0===br&&s('")"')),null===e&&(60===n.charCodeAt(vr)?(e="<",vr++):(e=null,0===br&&s('"<"')),null===e&&(62===n.charCodeAt(vr)?(e=">",vr++):(e=null,0===br&&s('">"')),null===e&&(58===n.charCodeAt(vr)?(e=":",vr++):(e=null,0===br&&s('":"')),null===e&&(92===n.charCodeAt(vr)?(e="\\",vr++):(e=null,0===br&&s('"\\\\"')),null===e&&(e=d(),null===e&&(47===n.charCodeAt(vr)?(e="/",vr++):(e=null,0===br&&s('"/"')),null===e&&(91===n.charCodeAt(vr)?(e="[",vr++):(e=null,0===br&&s('"["')),null===e&&(93===n.charCodeAt(vr)?(e="]",vr++):(e=null,0===br&&s('"]"')),null===e&&(63===n.charCodeAt(vr)?(e="?",vr++):(e=null,0===br&&s('"?"')),null===e&&(123===n.charCodeAt(vr)?(e="{",vr++):(e=null,0===br&&s('"{"')),null===e&&(125===n.charCodeAt(vr)?(e="}",vr++):(e=null,0===br&&s('"}"'))))))))))))))))))))))))),null!==e)for(t=[];null!==e;)t.push(e),e=f(),null===e&&(45===n.charCodeAt(vr)?(e="-",vr++):(e=null,0===br&&s('"-"')),null===e&&(46===n.charCodeAt(vr)?(e=".",vr++):(e=null,0===br&&s('"."')),null===e&&(33===n.charCodeAt(vr)?(e="!",vr++):(e=null,0===br&&s('"!"')),null===e&&(37===n.charCodeAt(vr)?(e="%",vr++):(e=null,0===br&&s('"%"')),null===e&&(42===n.charCodeAt(vr)?(e="*",vr++):(e=null,0===br&&s('"*"')),null===e&&(95===n.charCodeAt(vr)?(e="_",vr++):(e=null,0===br&&s('"_"')),null===e&&(43===n.charCodeAt(vr)?(e="+",vr++):(e=null,0===br&&s('"+"')),null===e&&(96===n.charCodeAt(vr)?(e="`",vr++):(e=null,0===br&&s('"`"')),null===e&&(39===n.charCodeAt(vr)?(e="'",vr++):(e=null,0===br&&s('"\'"')),null===e&&(126===n.charCodeAt(vr)?(e="~",vr++):(e=null,0===br&&s('"~"')),null===e&&(40===n.charCodeAt(vr)?(e="(",vr++):(e=null,0===br&&s('"("')),null===e&&(41===n.charCodeAt(vr)?(e=")",vr++):(e=null,0===br&&s('")"')),null===e&&(60===n.charCodeAt(vr)?(e="<",vr++):(e=null,0===br&&s('"<"')),null===e&&(62===n.charCodeAt(vr)?(e=">",vr++):(e=null,0===br&&s('">"')),null===e&&(58===n.charCodeAt(vr)?(e=":",vr++):(e=null,0===br&&s('":"')),null===e&&(92===n.charCodeAt(vr)?(e="\\",vr++):(e=null,0===br&&s('"\\\\"')),null===e&&(e=d(),null===e&&(47===n.charCodeAt(vr)?(e="/",vr++):(e=null,0===br&&s('"/"')),null===e&&(91===n.charCodeAt(vr)?(e="[",vr++):(e=null,0===br&&s('"["')),null===e&&(93===n.charCodeAt(vr)?(e="]",vr++):(e=null,0===br&&s('"]"')),null===e&&(63===n.charCodeAt(vr)?(e="?",vr++):(e=null,0===br&&s('"?"')),null===e&&(123===n.charCodeAt(vr)?(e="{",vr++):(e=null,0===br&&s('"{"')),null===e&&(125===n.charCodeAt(vr)?(e="}",vr++):(e=null,0===br&&s('"}"')))))))))))))))))))))))));else t=null;return null!==t&&(t=function(t){return n.substring(vr,t)}(r)),null===t&&(vr=r),t}function N(){var t,e,r,i,l;return i=vr,l=vr,t=T(),null!==t?(42===n.charCodeAt(vr)?(e="*",vr++):(e=null,0===br&&s('"*"')),null!==e?(r=T(),null!==r?t=[t,e,r]:(t=null,vr=l)):(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t){return"*"}(i)),null===t&&(vr=i),t}function k(){var t,e,r,i,l;return i=vr,l=vr,t=T(),null!==t?(47===n.charCodeAt(vr)?(e="/",vr++):(e=null,0===br&&s('"/"')),null!==e?(r=T(),null!==r?t=[t,e,r]:(t=null,vr=l)):(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t){return"/"}(i)),null===t&&(vr=i),t}function D(){var t,e,r,i,l;return i=vr,l=vr,t=T(),null!==t?(61===n.charCodeAt(vr)?(e="=",vr++):(e=null,0===br&&s('"="')),null!==e?(r=T(),null!==r?t=[t,e,r]:(t=null,vr=l)):(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t){return"="}(i)),null===t&&(vr=i),t}function L(){var t,e,r,i,l;return i=vr,l=vr,t=T(),null!==t?(40===n.charCodeAt(vr)?(e="(",vr++):(e=null,0===br&&s('"("')),null!==e?(r=T(),null!==r?t=[t,e,r]:(t=null,vr=l)):(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t){return"("}(i)),null===t&&(vr=i),t}function U(){var t,e,r,i,l;return i=vr,l=vr,t=T(),null!==t?(41===n.charCodeAt(vr)?(e=")",vr++):(e=null,0===br&&s('")"')),null!==e?(r=T(),null!==r?t=[t,e,r]:(t=null,vr=l)):(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t){return")"}(i)),null===t&&(vr=i),t}function M(){var t,e,r,i;return r=vr,i=vr,62===n.charCodeAt(vr)?(t=">",vr++):(t=null,0===br&&s('">"')),null!==t?(e=T(),null!==e?t=[t,e]:(t=null,vr=i)):(t=null,vr=i),null!==t&&(t=function(t){return">"}(r)),null===t&&(vr=r),t}function P(){var t,e,r,i;return r=vr,i=vr,t=T(),null!==t?(60===n.charCodeAt(vr)?(e="<",vr++):(e=null,0===br&&s('"<"')),null!==e?t=[t,e]:(t=null,vr=i)):(t=null,vr=i),null!==t&&(t=function(t){return"<"}(r)),null===t&&(vr=r),t}function q(){var t,e,r,i,l;return i=vr,l=vr,t=T(),null!==t?(44===n.charCodeAt(vr)?(e=",",vr++):(e=null,0===br&&s('","')),null!==e?(r=T(),null!==r?t=[t,e,r]:(t=null,vr=l)):(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t){return","}(i)),null===t&&(vr=i),t}function j(){var t,e,r,i,l;return i=vr,l=vr,t=T(),null!==t?(59===n.charCodeAt(vr)?(e=";",vr++):(e=null,0===br&&s('";"')),null!==e?(r=T(),null!==r?t=[t,e,r]:(t=null,vr=l)):(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t){return";"}(i)),null===t&&(vr=i),t}function H(){var t,e,r,i,l;return i=vr,l=vr,t=T(),null!==t?(58===n.charCodeAt(vr)?(e=":",vr++):(e=null,0===br&&s('":"')),null!==e?(r=T(),null!==r?t=[t,e,r]:(t=null,vr=l)):(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t){return":"}(i)),null===t&&(vr=i),t}function F(){var t,e,n,r;return n=vr,r=vr,t=T(),null!==t?(e=d(),null!==e?t=[t,e]:(t=null,vr=r)):(t=null,vr=r),null!==t&&(t=function(t){return'"'}(n)),null===t&&(vr=n),t}function G(){var t,e,n,r;return n=vr,r=vr,t=d(),null!==t?(e=T(),null!==e?t=[t,e]:(t=null,vr=r)):(t=null,vr=r),null!==t&&(t=function(t){return'"'}(n)),null===t&&(vr=n),t}function B(){var t,e,n,r;if(r=vr,t=L(),null!==t){for(e=[],n=W(),null===n&&(n=J(),null===n&&(n=B()));null!==n;)e.push(n),n=W(),null===n&&(n=J(),null===n&&(n=B()));null!==e?(n=U(),null!==n?t=[t,e,n]:(t=null,vr=r)):(t=null,vr=r)}else t=null,vr=r;return t}function W(){var t;return/^[!-']/.test(n.charAt(vr))?(t=n.charAt(vr),vr++):(t=null,0===br&&s("[!-']")),null===t&&(/^[*-[]/.test(n.charAt(vr))?(t=n.charAt(vr),vr++):(t=null,0===br&&s("[*-[]")),null===t&&(/^[\]-~]/.test(n.charAt(vr))?(t=n.charAt(vr),vr++):(t=null,0===br&&s("[\\]-~]")),null===t&&(t=E(),null===t&&(t=b())))),t}function z(){var t,e,r,s,i,l;if(i=vr,l=vr,t=T(),null!==t)if(e=d(),null!==e){for(r=[],s=V(),null===s&&(s=J());null!==s;)r.push(s),s=V(),null===s&&(s=J());null!==r?(s=d(),null!==s?t=[t,e,r,s]:(t=null,vr=l)):(t=null,vr=l)}else t=null,vr=l;else t=null,vr=l;return null!==t&&(t=function(t){return n.substring(vr,t)}(i)),null===t&&(vr=i),t}function K(){var t,e,r,s,i,l;if(i=vr,l=vr,t=T(),null!==t)if(e=d(),null!==e){for(r=[],s=V(),null===s&&(s=J());null!==s;)r.push(s),s=V(),null===s&&(s=J());null!==r?(s=d(),null!==s?t=[t,e,r,s]:(t=null,vr=l)):(t=null,vr=l)}else t=null,vr=l;else t=null,vr=l;return null!==t&&(t=function(t){return n.substring(vr-1,t+1)}(i)),null===t&&(vr=i),t}function V(){var t;return t=b(),null===t&&(33===n.charCodeAt(vr)?(t="!",vr++):(t=null,0===br&&s('"!"')),null===t&&(/^[#-[]/.test(n.charAt(vr))?(t=n.charAt(vr),vr++):(t=null,0===br&&s("[#-[]")),null===t&&(/^[\]-~]/.test(n.charAt(vr))?(t=n.charAt(vr),vr++):(t=null,0===br&&s("[\\]-~]")),null===t&&(t=E())))),t}function J(){var t,e,r;return r=vr,92===n.charCodeAt(vr)?(t="\\",vr++):(t=null,0===br&&s('"\\\\"')),null!==t?(/^[\0-\t]/.test(n.charAt(vr))?(e=n.charAt(vr),vr++):(e=null,0===br&&s("[\\0-\\t]")),null===e&&(/^[\x0B-\f]/.test(n.charAt(vr))?(e=n.charAt(vr),vr++):(e=null,0===br&&s("[\\x0B-\\f]")),null===e&&(/^[\x0E-]/.test(n.charAt(vr))?(e=n.charAt(vr),vr++):(e=null,0===br&&s("[\\x0E-]")))),null!==e?t=[t,e]:(t=null,vr=r)):(t=null,vr=r),t}function Y(){var t,e,r,i,l,o;return l=vr,o=vr,t=X(),null!==t?(58===n.charCodeAt(vr)?(e=":",vr++):(e=null,0===br&&s('":"')),null!==e?(r=tt(),r=null!==r?r:"",null!==r?(i=st(),null!==i?t=[t,e,r,i]:(t=null,vr=o)):(t=null,vr=o)):(t=null,vr=o)):(t=null,vr=o),null!==t&&(t=function(t){try{Er.uri=new Cr(Er.scheme,Er.user,Er.host,Er.port),delete Er.scheme,delete Er.user,delete Er.host,delete Er.host_type,delete Er.port}catch(e){Er=-1}}(l)),null===t&&(vr=l),t}function $(){var t,e,i,l,o,a,u,c;return u=vr,c=vr,t=X(),null!==t?(58===n.charCodeAt(vr)?(e=":",vr++):(e=null,0===br&&s('":"')),null!==e?(i=tt(),i=null!==i?i:"",null!==i?(l=st(),null!==l?(o=gt(),null!==o?(a=It(),a=null!==a?a:"",null!==a?t=[t,e,i,l,o,a]:(t=null,vr=c)):(t=null,vr=c)):(t=null,vr=c)):(t=null,vr=c)):(t=null,vr=c)):(t=null,vr=c),null!==t&&(t=function(t){try{Er.uri=new Cr(Er.scheme,Er.user,Er.host,Er.port,Er.uri_params,Er.uri_headers),delete Er.scheme,delete Er.user,delete Er.host,delete Er.host_type,delete Er.port,delete Er.uri_params,"SIP_URI"===r&&(Er=Er.uri)}catch(e){Er=-1}}(u)),null===t&&(vr=u),t}function X(){var t;return t=Q(),null===t&&(t=Z()),t}function Q(){var t,e;return e=vr,"sips"===n.substr(vr,4).toLowerCase()?(t=n.substr(vr,4),vr+=4):(t=null,0===br&&s('"sips"')),null!==t&&(t=function(t,e){Er.scheme=e.toLowerCase()}(e,t)),null===t&&(vr=e),t}function Z(){var t,e;return e=vr,"sip"===n.substr(vr,3).toLowerCase()?(t=n.substr(vr,3),vr+=3):(t=null,0===br&&s('"sip"')),null!==t&&(t=function(t,e){Er.scheme=e.toLowerCase()}(e,t)),null===t&&(vr=e),t}function tt(){var t,e,r,i,l,o;return i=vr,l=vr,t=et(),null!==t?(o=vr,58===n.charCodeAt(vr)?(e=":",vr++):(e=null,0===br&&s('":"')),null!==e?(r=rt(),null!==r?e=[e,r]:(e=null,vr=o)):(e=null,vr=o),e=null!==e?e:"",null!==e?(64===n.charCodeAt(vr)?(r="@",vr++):(r=null,0===br&&s('"@"')),null!==r?t=[t,e,r]:(t=null,vr=l)):(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t){Er.user=decodeURIComponent(n.substring(vr-1,t))}(i)),null===t&&(vr=i),t}function et(){var t,e;if(e=g(),null===e&&(e=v(),null===e&&(e=nt())),null!==e)for(t=[];null!==e;)t.push(e),e=g(),null===e&&(e=v(),null===e&&(e=nt()));else t=null;return t}function nt(){var t;return 38===n.charCodeAt(vr)?(t="&",vr++):(t=null,0===br&&s('"&"')),null===t&&(61===n.charCodeAt(vr)?(t="=",vr++):(t=null,0===br&&s('"="')),null===t&&(43===n.charCodeAt(vr)?(t="+",vr++):(t=null,0===br&&s('"+"')),null===t&&(36===n.charCodeAt(vr)?(t="$",vr++):(t=null,0===br&&s('"$"')),null===t&&(44===n.charCodeAt(vr)?(t=",",vr++):(t=null,0===br&&s('","')),null===t&&(59===n.charCodeAt(vr)?(t=";",vr++):(t=null,0===br&&s('";"')),null===t&&(63===n.charCodeAt(vr)?(t="?",vr++):(t=null,0===br&&s('"?"')),null===t&&(47===n.charCodeAt(vr)?(t="/",vr++):(t=null,0===br&&s('"/"'))))))))),t}function rt(){var t,e,r;for(r=vr,t=[],e=g(),null===e&&(e=v(),null===e&&(38===n.charCodeAt(vr)?(e="&",vr++):(e=null,0===br&&s('"&"')),null===e&&(61===n.charCodeAt(vr)?(e="=",vr++):(e=null,0===br&&s('"="')),null===e&&(43===n.charCodeAt(vr)?(e="+",vr++):(e=null,0===br&&s('"+"')),null===e&&(36===n.charCodeAt(vr)?(e="$",vr++):(e=null,0===br&&s('"$"')),null===e&&(44===n.charCodeAt(vr)?(e=",",vr++):(e=null,0===br&&s('","'))))))));null!==e;)t.push(e),e=g(),null===e&&(e=v(),null===e&&(38===n.charCodeAt(vr)?(e="&",vr++):(e=null,0===br&&s('"&"')),null===e&&(61===n.charCodeAt(vr)?(e="=",vr++):(e=null,0===br&&s('"="')),null===e&&(43===n.charCodeAt(vr)?(e="+",vr++):(e=null,0===br&&s('"+"')),null===e&&(36===n.charCodeAt(vr)?(e="$",vr++):(e=null,0===br&&s('"$"')),null===e&&(44===n.charCodeAt(vr)?(e=",",vr++):(e=null,0===br&&s('","'))))))));return null!==t&&(t=function(t){Er.password=n.substring(vr,t)}(r)),null===t&&(vr=r),t}function st(){var t,e,r,i,l;return i=vr,t=it(),null!==t?(l=vr,58===n.charCodeAt(vr)?(e=":",vr++):(e=null,0===br&&s('":"')),null!==e?(r=mt(),null!==r?e=[e,r]:(e=null,vr=l)):(e=null,vr=l),e=null!==e?e:"",null!==e?t=[t,e]:(t=null,vr=i)):(t=null,vr=i),t}function it(){var t,e;return e=vr,t=lt(),null===t&&(t=pt(),null===t&&(t=ut())),null!==t&&(t=function(t){return Er.host=n.substring(vr,t).toLowerCase(),Er.host}(e)),null===t&&(vr=e),t}function lt(){var t,e,r,i,l,o;for(i=vr,l=vr,t=[],o=vr,e=ot(),null!==e?(46===n.charCodeAt(vr)?(r=".",vr++):(r=null,0===br&&s('"."')),null!==r?e=[e,r]:(e=null,vr=o)):(e=null,vr=o);null!==e;)t.push(e),o=vr,e=ot(),null!==e?(46===n.charCodeAt(vr)?(r=".",vr++):(r=null,0===br&&s('"."')),null!==r?e=[e,r]:(e=null,vr=o)):(e=null,vr=o);return null!==t?(e=at(),null!==e?(46===n.charCodeAt(vr)?(r=".",vr++):(r=null,0===br&&s('"."')),r=null!==r?r:"",null!==r?t=[t,e,r]:(t=null,vr=l)):(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t){return Er.host_type="domain",n.substring(vr,t)}(i)),null===t&&(vr=i),t}function ot(){var t,e,r,i;if(i=vr,t=f(),null!==t){for(e=[],r=f(),null===r&&(45===n.charCodeAt(vr)?(r="-",vr++):(r=null,0===br&&s('"-"')),null===r&&(95===n.charCodeAt(vr)?(r="_",vr++):(r=null,0===br&&s('"_"'))));null!==r;)e.push(r),r=f(),null===r&&(45===n.charCodeAt(vr)?(r="-",vr++):(r=null,0===br&&s('"-"')),null===r&&(95===n.charCodeAt(vr)?(r="_",vr++):(r=null,0===br&&s('"_"'))));null!==e?t=[t,e]:(t=null,vr=i)}else t=null,vr=i;return t}function at(){var t,e,r,i;if(i=vr,t=o(),null!==t){for(e=[],r=f(),null===r&&(45===n.charCodeAt(vr)?(r="-",vr++):(r=null,0===br&&s('"-"')),null===r&&(95===n.charCodeAt(vr)?(r="_",vr++):(r=null,0===br&&s('"_"'))));null!==r;)e.push(r),r=f(),null===r&&(45===n.charCodeAt(vr)?(r="-",vr++):(r=null,0===br&&s('"-"')),null===r&&(95===n.charCodeAt(vr)?(r="_",vr++):(r=null,0===br&&s('"_"'))));null!==e?t=[t,e]:(t=null,vr=i)}else t=null,vr=i;return t}function ut(){var t,e,r,i,l;return i=vr,l=vr,91===n.charCodeAt(vr)?(t="[",vr++):(t=null,0===br&&s('"["')),null!==t?(e=ct(),null!==e?(93===n.charCodeAt(vr)?(r="]",vr++):(r=null,0===br&&s('"]"')),null!==r?t=[t,e,r]:(t=null,vr=l)):(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t){return Er.host_type="IPv6",n.substring(vr,t)}(i)),null===t&&(vr=i),t}function ct(){var t,e,r,i,l,o,a,u,c,d,h,p,f,m,g,_;return m=vr,g=vr,t=dt(),null!==t?(58===n.charCodeAt(vr)?(e=":",vr++):(e=null,0===br&&s('":"')),null!==e?(r=dt(),null!==r?(58===n.charCodeAt(vr)?(i=":",vr++):(i=null,0===br&&s('":"')),null!==i?(l=dt(),null!==l?(58===n.charCodeAt(vr)?(o=":",vr++):(o=null,0===br&&s('":"')),null!==o?(a=dt(),null!==a?(58===n.charCodeAt(vr)?(u=":",vr++):(u=null,0===br&&s('":"')),null!==u?(c=dt(),null!==c?(58===n.charCodeAt(vr)?(d=":",vr++):(d=null,0===br&&s('":"')),null!==d?(h=dt(),null!==h?(58===n.charCodeAt(vr)?(p=":",vr++):(p=null,0===br&&s('":"')),null!==p?(f=ht(),null!==f?t=[t,e,r,i,l,o,a,u,c,d,h,p,f]:(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g),null===t&&(g=vr,"::"===n.substr(vr,2)?(t="::",vr+=2):(t=null,0===br&&s('"::"')),null!==t?(e=dt(),null!==e?(58===n.charCodeAt(vr)?(r=":",vr++):(r=null,0===br&&s('":"')),null!==r?(i=dt(),null!==i?(58===n.charCodeAt(vr)?(l=":",vr++):(l=null,0===br&&s('":"')),null!==l?(o=dt(),null!==o?(58===n.charCodeAt(vr)?(a=":",vr++):(a=null,0===br&&s('":"')),null!==a?(u=dt(),null!==u?(58===n.charCodeAt(vr)?(c=":",vr++):(c=null,0===br&&s('":"')),null!==c?(d=dt(),null!==d?(58===n.charCodeAt(vr)?(h=":",vr++):(h=null,0===br&&s('":"')),null!==h?(p=ht(),null!==p?t=[t,e,r,i,l,o,a,u,c,d,h,p]:(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g),null===t&&(g=vr,"::"===n.substr(vr,2)?(t="::",vr+=2):(t=null,0===br&&s('"::"')),null!==t?(e=dt(),null!==e?(58===n.charCodeAt(vr)?(r=":",vr++):(r=null,0===br&&s('":"')),null!==r?(i=dt(),null!==i?(58===n.charCodeAt(vr)?(l=":",vr++):(l=null,0===br&&s('":"')),null!==l?(o=dt(),null!==o?(58===n.charCodeAt(vr)?(a=":",vr++):(a=null,0===br&&s('":"')),null!==a?(u=dt(),null!==u?(58===n.charCodeAt(vr)?(c=":",vr++):(c=null,0===br&&s('":"')),null!==c?(d=ht(),null!==d?t=[t,e,r,i,l,o,a,u,c,d]:(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g),null===t&&(g=vr,"::"===n.substr(vr,2)?(t="::",vr+=2):(t=null,0===br&&s('"::"')),null!==t?(e=dt(),null!==e?(58===n.charCodeAt(vr)?(r=":",vr++):(r=null,0===br&&s('":"')),null!==r?(i=dt(),null!==i?(58===n.charCodeAt(vr)?(l=":",vr++):(l=null,0===br&&s('":"')),null!==l?(o=dt(),null!==o?(58===n.charCodeAt(vr)?(a=":",vr++):(a=null,0===br&&s('":"')),null!==a?(u=ht(),null!==u?t=[t,e,r,i,l,o,a,u]:(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g),null===t&&(g=vr,"::"===n.substr(vr,2)?(t="::",vr+=2):(t=null,0===br&&s('"::"')),null!==t?(e=dt(),null!==e?(58===n.charCodeAt(vr)?(r=":",vr++):(r=null,0===br&&s('":"')),null!==r?(i=dt(),null!==i?(58===n.charCodeAt(vr)?(l=":",vr++):(l=null,0===br&&s('":"')),null!==l?(o=ht(),null!==o?t=[t,e,r,i,l,o]:(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g),null===t&&(g=vr,"::"===n.substr(vr,2)?(t="::",vr+=2):(t=null,0===br&&s('"::"')),null!==t?(e=dt(),null!==e?(58===n.charCodeAt(vr)?(r=":",vr++):(r=null,0===br&&s('":"')),null!==r?(i=ht(),null!==i?t=[t,e,r,i]:(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g),null===t&&(g=vr,"::"===n.substr(vr,2)?(t="::",vr+=2):(t=null,0===br&&s('"::"')),null!==t?(e=ht(),null!==e?t=[t,e]:(t=null,vr=g)):(t=null,vr=g),null===t&&(g=vr,"::"===n.substr(vr,2)?(t="::",vr+=2):(t=null,0===br&&s('"::"')),null!==t?(e=dt(),null!==e?t=[t,e]:(t=null,vr=g)):(t=null,vr=g),null===t&&(g=vr,t=dt(),null!==t?("::"===n.substr(vr,2)?(e="::",vr+=2):(e=null,0===br&&s('"::"')),null!==e?(r=dt(),null!==r?(58===n.charCodeAt(vr)?(i=":",vr++):(i=null,0===br&&s('":"')),null!==i?(l=dt(),null!==l?(58===n.charCodeAt(vr)?(o=":",vr++):(o=null,0===br&&s('":"')),null!==o?(a=dt(),null!==a?(58===n.charCodeAt(vr)?(u=":",vr++):(u=null,0===br&&s('":"')),null!==u?(c=dt(),null!==c?(58===n.charCodeAt(vr)?(d=":",vr++):(d=null,0===br&&s('":"')),null!==d?(h=ht(),null!==h?t=[t,e,r,i,l,o,a,u,c,d,h]:(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g),null===t&&(g=vr,t=dt(),null!==t?(_=vr,58===n.charCodeAt(vr)?(e=":",vr++):(e=null,0===br&&s('":"')),null!==e?(r=dt(),null!==r?e=[e,r]:(e=null,vr=_)):(e=null,vr=_),e=null!==e?e:"",null!==e?("::"===n.substr(vr,2)?(r="::",vr+=2):(r=null,0===br&&s('"::"')),null!==r?(i=dt(),null!==i?(58===n.charCodeAt(vr)?(l=":",vr++):(l=null,0===br&&s('":"')),null!==l?(o=dt(),null!==o?(58===n.charCodeAt(vr)?(a=":",vr++):(a=null,0===br&&s('":"')),null!==a?(u=dt(),null!==u?(58===n.charCodeAt(vr)?(c=":",vr++):(c=null,0===br&&s('":"')),null!==c?(d=ht(),null!==d?t=[t,e,r,i,l,o,a,u,c,d]:(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g),null===t&&(g=vr,t=dt(),null!==t?(_=vr,58===n.charCodeAt(vr)?(e=":",vr++):(e=null,0===br&&s('":"')),null!==e?(r=dt(),null!==r?e=[e,r]:(e=null,vr=_)):(e=null,vr=_),e=null!==e?e:"",null!==e?(_=vr,58===n.charCodeAt(vr)?(r=":",vr++):(r=null,0===br&&s('":"')),null!==r?(i=dt(),null!==i?r=[r,i]:(r=null,vr=_)):(r=null,vr=_),r=null!==r?r:"",null!==r?("::"===n.substr(vr,2)?(i="::",vr+=2):(i=null,0===br&&s('"::"')),null!==i?(l=dt(),null!==l?(58===n.charCodeAt(vr)?(o=":",vr++):(o=null,0===br&&s('":"')),null!==o?(a=dt(),null!==a?(58===n.charCodeAt(vr)?(u=":",vr++):(u=null,0===br&&s('":"')),null!==u?(c=ht(),null!==c?t=[t,e,r,i,l,o,a,u,c]:(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g),null===t&&(g=vr,t=dt(),null!==t?(_=vr,58===n.charCodeAt(vr)?(e=":",vr++):(e=null,0===br&&s('":"')),null!==e?(r=dt(),null!==r?e=[e,r]:(e=null,vr=_)):(e=null,vr=_),e=null!==e?e:"",null!==e?(_=vr,58===n.charCodeAt(vr)?(r=":",vr++):(r=null,0===br&&s('":"')),null!==r?(i=dt(),null!==i?r=[r,i]:(r=null,vr=_)):(r=null,vr=_),r=null!==r?r:"",null!==r?(_=vr,58===n.charCodeAt(vr)?(i=":",vr++):(i=null,0===br&&s('":"')),null!==i?(l=dt(),null!==l?i=[i,l]:(i=null,vr=_)):(i=null,vr=_),i=null!==i?i:"",null!==i?("::"===n.substr(vr,2)?(l="::",vr+=2):(l=null,0===br&&s('"::"')),null!==l?(o=dt(),null!==o?(58===n.charCodeAt(vr)?(a=":",vr++):(a=null,0===br&&s('":"')),null!==a?(u=ht(),null!==u?t=[t,e,r,i,l,o,a,u]:(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g),null===t&&(g=vr,t=dt(),null!==t?(_=vr,58===n.charCodeAt(vr)?(e=":",vr++):(e=null,0===br&&s('":"')),null!==e?(r=dt(),null!==r?e=[e,r]:(e=null,vr=_)):(e=null,vr=_),e=null!==e?e:"",null!==e?(_=vr,58===n.charCodeAt(vr)?(r=":",vr++):(r=null,0===br&&s('":"')),null!==r?(i=dt(),null!==i?r=[r,i]:(r=null,vr=_)):(r=null,vr=_),r=null!==r?r:"",null!==r?(_=vr,58===n.charCodeAt(vr)?(i=":",vr++):(i=null,0===br&&s('":"')),null!==i?(l=dt(),null!==l?i=[i,l]:(i=null,vr=_)):(i=null,vr=_),i=null!==i?i:"",null!==i?(_=vr,58===n.charCodeAt(vr)?(l=":",vr++):(l=null,0===br&&s('":"')),null!==l?(o=dt(),null!==o?l=[l,o]:(l=null,vr=_)):(l=null,vr=_),l=null!==l?l:"",null!==l?("::"===n.substr(vr,2)?(o="::",vr+=2):(o=null,0===br&&s('"::"')),null!==o?(a=ht(),null!==a?t=[t,e,r,i,l,o,a]:(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g),null===t&&(g=vr,t=dt(),null!==t?(_=vr,58===n.charCodeAt(vr)?(e=":",vr++):(e=null,0===br&&s('":"')),null!==e?(r=dt(),null!==r?e=[e,r]:(e=null,vr=_)):(e=null,vr=_),e=null!==e?e:"",null!==e?(_=vr,58===n.charCodeAt(vr)?(r=":",vr++):(r=null,0===br&&s('":"')),null!==r?(i=dt(),null!==i?r=[r,i]:(r=null,vr=_)):(r=null,vr=_),r=null!==r?r:"",null!==r?(_=vr,58===n.charCodeAt(vr)?(i=":",vr++):(i=null,0===br&&s('":"')),null!==i?(l=dt(),null!==l?i=[i,l]:(i=null,vr=_)):(i=null,vr=_),i=null!==i?i:"",null!==i?(_=vr,58===n.charCodeAt(vr)?(l=":",vr++):(l=null,0===br&&s('":"')),null!==l?(o=dt(),null!==o?l=[l,o]:(l=null,vr=_)):(l=null,vr=_),l=null!==l?l:"",null!==l?(_=vr,58===n.charCodeAt(vr)?(o=":",vr++):(o=null,0===br&&s('":"')),null!==o?(a=dt(),null!==a?o=[o,a]:(o=null,vr=_)):(o=null,vr=_),o=null!==o?o:"",null!==o?("::"===n.substr(vr,2)?(a="::",vr+=2):(a=null,0===br&&s('"::"')),null!==a?(u=dt(),null!==u?t=[t,e,r,i,l,o,a,u]:(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g),null===t&&(g=vr,t=dt(),null!==t?(_=vr,58===n.charCodeAt(vr)?(e=":",vr++):(e=null,0===br&&s('":"')),null!==e?(r=dt(),null!==r?e=[e,r]:(e=null,vr=_)):(e=null,vr=_),e=null!==e?e:"",null!==e?(_=vr,58===n.charCodeAt(vr)?(r=":",vr++):(r=null,0===br&&s('":"')),null!==r?(i=dt(),null!==i?r=[r,i]:(r=null,vr=_)):(r=null,vr=_),r=null!==r?r:"",null!==r?(_=vr,58===n.charCodeAt(vr)?(i=":",vr++):(i=null,0===br&&s('":"')),null!==i?(l=dt(),null!==l?i=[i,l]:(i=null,vr=_)):(i=null,vr=_),i=null!==i?i:"",null!==i?(_=vr,58===n.charCodeAt(vr)?(l=":",vr++):(l=null,0===br&&s('":"')),null!==l?(o=dt(),null!==o?l=[l,o]:(l=null,vr=_)):(l=null,vr=_),l=null!==l?l:"",null!==l?(_=vr,58===n.charCodeAt(vr)?(o=":",vr++):(o=null,0===br&&s('":"')),null!==o?(a=dt(),null!==a?o=[o,a]:(o=null,vr=_)):(o=null,vr=_),o=null!==o?o:"",null!==o?(_=vr,58===n.charCodeAt(vr)?(a=":",vr++):(a=null,0===br&&s('":"')),null!==a?(u=dt(),null!==u?a=[a,u]:(a=null,vr=_)):(a=null,vr=_),a=null!==a?a:"",null!==a?("::"===n.substr(vr,2)?(u="::",vr+=2):(u=null,0===br&&s('"::"')),null!==u?t=[t,e,r,i,l,o,a,u]:(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g)):(t=null,vr=g))))))))))))))),null!==t&&(t=function(t){return Er.host_type="IPv6",n.substring(vr,t)}(m)),null===t&&(vr=m),t}function dt(){var t,e,n,r,s;return s=vr,t=a(),null!==t?(e=a(),e=null!==e?e:"",null!==e?(n=a(),n=null!==n?n:"",null!==n?(r=a(),r=null!==r?r:"",null!==r?t=[t,e,n,r]:(t=null,vr=s)):(t=null,vr=s)):(t=null,vr=s)):(t=null,vr=s),t}function ht(){var t,e,r,i;return i=vr,t=dt(),null!==t?(58===n.charCodeAt(vr)?(e=":",vr++):(e=null,0===br&&s('":"')),null!==e?(r=dt(),null!==r?t=[t,e,r]:(t=null,vr=i)):(t=null,vr=i)):(t=null,vr=i),null===t&&(t=pt()),t}function pt(){var t,e,r,i,l,o,a,u,c;return u=vr,c=vr,t=ft(),null!==t?(46===n.charCodeAt(vr)?(e=".",vr++):(e=null,0===br&&s('"."')),null!==e?(r=ft(),null!==r?(46===n.charCodeAt(vr)?(i=".",vr++):(i=null,0===br&&s('"."')),null!==i?(l=ft(),null!==l?(46===n.charCodeAt(vr)?(o=".",vr++):(o=null,0===br&&s('"."')),null!==o?(a=ft(),null!==a?t=[t,e,r,i,l,o,a]:(t=null,vr=c)):(t=null,vr=c)):(t=null,vr=c)):(t=null,vr=c)):(t=null,vr=c)):(t=null,vr=c)):(t=null,vr=c),null!==t&&(t=function(t){return Er.host_type="IPv4",n.substring(vr,t)}(u)),null===t&&(vr=u),t}function ft(){var t,e,r,i;return i=vr,"25"===n.substr(vr,2)?(t="25",vr+=2):(t=null,0===br&&s('"25"')),null!==t?(/^[0-5]/.test(n.charAt(vr))?(e=n.charAt(vr),vr++):(e=null,0===br&&s("[0-5]")),null!==e?t=[t,e]:(t=null,vr=i)):(t=null,vr=i),null===t&&(i=vr,50===n.charCodeAt(vr)?(t="2",vr++):(t=null,0===br&&s('"2"')),null!==t?(/^[0-4]/.test(n.charAt(vr))?(e=n.charAt(vr),vr++):(e=null,0===br&&s("[0-4]")),null!==e?(r=l(),null!==r?t=[t,e,r]:(t=null,vr=i)):(t=null,vr=i)):(t=null,vr=i),null===t&&(i=vr,49===n.charCodeAt(vr)?(t="1",vr++):(t=null,0===br&&s('"1"')),null!==t?(e=l(),null!==e?(r=l(),null!==r?t=[t,e,r]:(t=null,vr=i)):(t=null,vr=i)):(t=null,vr=i),null===t&&(i=vr,/^[1-9]/.test(n.charAt(vr))?(t=n.charAt(vr),vr++):(t=null,0===br&&s("[1-9]")),null!==t?(e=l(),null!==e?t=[t,e]:(t=null,vr=i)):(t=null,vr=i),null===t&&(t=l())))),t}function mt(){var t,e,n,r,s,i,o;return i=vr,o=vr,t=l(),t=null!==t?t:"",null!==t?(e=l(),e=null!==e?e:"",null!==e?(n=l(),n=null!==n?n:"",null!==n?(r=l(),r=null!==r?r:"",null!==r?(s=l(),s=null!==s?s:"",null!==s?t=[t,e,n,r,s]:(t=null,vr=o)):(t=null,vr=o)):(t=null,vr=o)):(t=null,vr=o)):(t=null,vr=o),null!==t&&(t=function(t,e){return e=parseInt(e.join("")),Er.port=e,e}(i,t)),null===t&&(vr=i),t}function gt(){var t,e,r,i;for(t=[],i=vr,59===n.charCodeAt(vr)?(e=";",vr++):(e=null,0===br&&s('";"')),null!==e?(r=_t(),null!==r?e=[e,r]:(e=null,vr=i)):(e=null,vr=i);null!==e;)t.push(e),i=vr,59===n.charCodeAt(vr)?(e=";",vr++):(e=null,0===br&&s('";"')),null!==e?(r=_t(),null!==r?e=[e,r]:(e=null,vr=i)):(e=null,vr=i);return t}function _t(){var t;return t=vt(),null===t&&(t=bt(),null===t&&(t=Tt(),null===t&&(t=yt(),null===t&&(t=Ct(),null===t&&(t=St(),null===t&&(t=Et())))))),t}function vt(){var t,e,r,i;return r=vr,i=vr,"transport="===n.substr(vr,10).toLowerCase()?(t=n.substr(vr,10),vr+=10):(t=null,0===br&&s('"transport="')),null!==t?("udp"===n.substr(vr,3).toLowerCase()?(e=n.substr(vr,3),vr+=3):(e=null,0===br&&s('"udp"')),null===e&&("tcp"===n.substr(vr,3).toLowerCase()?(e=n.substr(vr,3),vr+=3):(e=null,0===br&&s('"tcp"')),null===e&&("sctp"===n.substr(vr,4).toLowerCase()?(e=n.substr(vr,4),vr+=4):(e=null,0===br&&s('"sctp"')),null===e&&("tls"===n.substr(vr,3).toLowerCase()?(e=n.substr(vr,3),vr+=3):(e=null,0===br&&s('"tls"')),null===e&&(e=R())))),null!==e?t=[t,e]:(t=null,vr=i)):(t=null,vr=i),null!==t&&(t=function(t,e){Er.uri_params||(Er.uri_params={}),Er.uri_params.transport=e.toLowerCase()}(r,t[1])),null===t&&(vr=r),t}function bt(){var t,e,r,i;return r=vr,i=vr,"user="===n.substr(vr,5).toLowerCase()?(t=n.substr(vr,5),vr+=5):(t=null,0===br&&s('"user="')),null!==t?("phone"===n.substr(vr,5).toLowerCase()?(e=n.substr(vr,5),vr+=5):(e=null,0===br&&s('"phone"')),null===e&&("ip"===n.substr(vr,2).toLowerCase()?(e=n.substr(vr,2),vr+=2):(e=null,0===br&&s('"ip"')),null===e&&(e=R())),null!==e?t=[t,e]:(t=null,vr=i)):(t=null,vr=i),null!==t&&(t=function(t,e){Er.uri_params||(Er.uri_params={}),Er.uri_params.user=e.toLowerCase()}(r,t[1])),null===t&&(vr=r),t}function Tt(){var t,e,r,i;return r=vr,i=vr,"method="===n.substr(vr,7).toLowerCase()?(t=n.substr(vr,7),vr+=7):(t=null,0===br&&s('"method="')),null!==t?(e=ue(),null!==e?t=[t,e]:(t=null,vr=i)):(t=null,vr=i),null!==t&&(t=function(t,e){Er.uri_params||(Er.uri_params={}),Er.uri_params.method=e}(r,t[1])),null===t&&(vr=r),t}function yt(){var t,e,r,i;return r=vr,i=vr,"ttl="===n.substr(vr,4).toLowerCase()?(t=n.substr(vr,4),vr+=4):(t=null,0===br&&s('"ttl="')),null!==t?(e=Jn(),null!==e?t=[t,e]:(t=null,vr=i)):(t=null,vr=i),null!==t&&(t=function(t,e){Er.params||(Er.params={}),Er.params.ttl=e}(r,t[1])),null===t&&(vr=r),t}function Ct(){var t,e,r,i;return r=vr,i=vr,"maddr="===n.substr(vr,6).toLowerCase()?(t=n.substr(vr,6),vr+=6):(t=null,0===br&&s('"maddr="')),null!==t?(e=it(),null!==e?t=[t,e]:(t=null,vr=i)):(t=null,vr=i),null!==t&&(t=function(t,e){Er.uri_params||(Er.uri_params={}),Er.uri_params.maddr=e}(r,t[1])),null===t&&(vr=r),t}function St(){var t,e,r,i,l,o;return i=vr,l=vr,"lr"===n.substr(vr,2).toLowerCase()?(t=n.substr(vr,2),vr+=2):(t=null,0===br&&s('"lr"')),null!==t?(o=vr,61===n.charCodeAt(vr)?(e="=",vr++):(e=null,0===br&&s('"="')),null!==e?(r=R(),null!==r?e=[e,r]:(e=null,vr=o)):(e=null,vr=o),e=null!==e?e:"",null!==e?t=[t,e]:(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t){Er.uri_params||(Er.uri_params={}),Er.uri_params.lr=void 0}(i)),null===t&&(vr=i),t}function Et(){var t,e,r,i,l,o;return i=vr,l=vr,t=At(),null!==t?(o=vr,61===n.charCodeAt(vr)?(e="=",vr++):(e=null,0===br&&s('"="')),null!==e?(r=wt(),null!==r?e=[e,r]:(e=null,vr=o)):(e=null,vr=o),e=null!==e?e:"",null!==e?t=[t,e]:(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t,e,n){Er.uri_params||(Er.uri_params={}),n="undefined"==typeof n?void 0:n[1],Er.uri_params[e.toLowerCase()]=n}(i,t[0],t[1])),null===t&&(vr=i),t}function At(){var t,e,n;if(n=vr,e=Rt(),null!==e)for(t=[];null!==e;)t.push(e),e=Rt();else t=null;return null!==t&&(t=function(t,e){return e.join("")}(n,t)),null===t&&(vr=n),t}function wt(){var t,e,n;if(n=vr,e=Rt(),null!==e)for(t=[];null!==e;)t.push(e),e=Rt();else t=null;return null!==t&&(t=function(t,e){return e.join("")}(n,t)),null===t&&(vr=n),t}function Rt(){var t;return t=xt(),null===t&&(t=g(),null===t&&(t=v())),t}function xt(){var t;return 91===n.charCodeAt(vr)?(t="[",vr++):(t=null,0===br&&s('"["')),null===t&&(93===n.charCodeAt(vr)?(t="]",vr++):(t=null,0===br&&s('"]"')),null===t&&(47===n.charCodeAt(vr)?(t="/",vr++):(t=null,0===br&&s('"/"')),null===t&&(58===n.charCodeAt(vr)?(t=":",vr++):(t=null,0===br&&s('":"')),null===t&&(38===n.charCodeAt(vr)?(t="&",vr++):(t=null,0===br&&s('"&"')),null===t&&(43===n.charCodeAt(vr)?(t="+",vr++):(t=null,0===br&&s('"+"')),null===t&&(36===n.charCodeAt(vr)?(t="$",vr++):(t=null,0===br&&s('"$"')))))))),t}function It(){var t,e,r,i,l,o,a;if(o=vr,63===n.charCodeAt(vr)?(t="?",vr++):(t=null,0===br&&s('"?"')),null!==t)if(e=Ot(),null!==e){for(r=[],a=vr,38===n.charCodeAt(vr)?(i="&",vr++):(i=null,0===br&&s('"&"')),null!==i?(l=Ot(),null!==l?i=[i,l]:(i=null,vr=a)):(i=null,vr=a);null!==i;)r.push(i),a=vr,38===n.charCodeAt(vr)?(i="&",vr++):(i=null,0===br&&s('"&"')),null!==i?(l=Ot(),
null!==l?i=[i,l]:(i=null,vr=a)):(i=null,vr=a);null!==r?t=[t,e,r]:(t=null,vr=o)}else t=null,vr=o;else t=null,vr=o;return t}function Ot(){var t,e,r,i,l;return i=vr,l=vr,t=Nt(),null!==t?(61===n.charCodeAt(vr)?(e="=",vr++):(e=null,0===br&&s('"="')),null!==e?(r=kt(),null!==r?t=[t,e,r]:(t=null,vr=l)):(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t,e,n){e=e.join("").toLowerCase(),n=n.join(""),Er.uri_headers||(Er.uri_headers={}),Er.uri_headers[e]?Er.uri_headers[e].push(n):Er.uri_headers[e]=[n]}(i,t[0],t[2])),null===t&&(vr=i),t}function Nt(){var t,e;if(e=Dt(),null===e&&(e=g(),null===e&&(e=v())),null!==e)for(t=[];null!==e;)t.push(e),e=Dt(),null===e&&(e=g(),null===e&&(e=v()));else t=null;return t}function kt(){var t,e;for(t=[],e=Dt(),null===e&&(e=g(),null===e&&(e=v()));null!==e;)t.push(e),e=Dt(),null===e&&(e=g(),null===e&&(e=v()));return t}function Dt(){var t;return 91===n.charCodeAt(vr)?(t="[",vr++):(t=null,0===br&&s('"["')),null===t&&(93===n.charCodeAt(vr)?(t="]",vr++):(t=null,0===br&&s('"]"')),null===t&&(47===n.charCodeAt(vr)?(t="/",vr++):(t=null,0===br&&s('"/"')),null===t&&(63===n.charCodeAt(vr)?(t="?",vr++):(t=null,0===br&&s('"?"')),null===t&&(58===n.charCodeAt(vr)?(t=":",vr++):(t=null,0===br&&s('":"')),null===t&&(43===n.charCodeAt(vr)?(t="+",vr++):(t=null,0===br&&s('"+"')),null===t&&(36===n.charCodeAt(vr)?(t="$",vr++):(t=null,0===br&&s('"$"')))))))),t}function Lt(){var t;return t=ce(),null===t&&(t=Ut()),t}function Ut(){var t,e,n,r,s,i;return i=vr,t=ue(),null!==t?(e=h(),null!==e?(n=Mt(),null!==n?(r=h(),null!==r?(s=Zt(),null!==s?t=[t,e,n,r,s]:(t=null,vr=i)):(t=null,vr=i)):(t=null,vr=i)):(t=null,vr=i)):(t=null,vr=i),t}function Mt(){var t;return t=$(),null===t&&(t=Pt()),t}function Pt(){var t,e,r,i;return i=vr,t=Jt(),null!==t?(58===n.charCodeAt(vr)?(e=":",vr++):(e=null,0===br&&s('":"')),null!==e?(r=qt(),null===r&&(r=Ft()),null!==r?t=[t,e,r]:(t=null,vr=i)):(t=null,vr=i)):(t=null,vr=i),t}function qt(){var t,e,r,i,l;return i=vr,t=jt(),null===t&&(t=Ht()),null!==t?(l=vr,63===n.charCodeAt(vr)?(e="?",vr++):(e=null,0===br&&s('"?"')),null!==e?(r=Qt(),null!==r?e=[e,r]:(e=null,vr=l)):(e=null,vr=l),e=null!==e?e:"",null!==e?t=[t,e]:(t=null,vr=i)):(t=null,vr=i),t}function jt(){var t,e,r,i;return i=vr,"//"===n.substr(vr,2)?(t="//",vr+=2):(t=null,0===br&&s('"//"')),null!==t?(e=Yt(),null!==e?(r=Ht(),r=null!==r?r:"",null!==r?t=[t,e,r]:(t=null,vr=i)):(t=null,vr=i)):(t=null,vr=i),t}function Ht(){var t,e,r;return r=vr,47===n.charCodeAt(vr)?(t="/",vr++):(t=null,0===br&&s('"/"')),null!==t?(e=Wt(),null!==e?t=[t,e]:(t=null,vr=r)):(t=null,vr=r),t}function Ft(){var t,e,n,r;if(r=vr,t=Bt(),null!==t){for(e=[],n=Gt();null!==n;)e.push(n),n=Gt();null!==e?t=[t,e]:(t=null,vr=r)}else t=null,vr=r;return t}function Gt(){var t;return t=m(),null===t&&(t=g(),null===t&&(t=v())),t}function Bt(){var t;return t=g(),null===t&&(t=v(),null===t&&(59===n.charCodeAt(vr)?(t=";",vr++):(t=null,0===br&&s('";"')),null===t&&(63===n.charCodeAt(vr)?(t="?",vr++):(t=null,0===br&&s('"?"')),null===t&&(58===n.charCodeAt(vr)?(t=":",vr++):(t=null,0===br&&s('":"')),null===t&&(64===n.charCodeAt(vr)?(t="@",vr++):(t=null,0===br&&s('"@"')),null===t&&(38===n.charCodeAt(vr)?(t="&",vr++):(t=null,0===br&&s('"&"')),null===t&&(61===n.charCodeAt(vr)?(t="=",vr++):(t=null,0===br&&s('"="')),null===t&&(43===n.charCodeAt(vr)?(t="+",vr++):(t=null,0===br&&s('"+"')),null===t&&(36===n.charCodeAt(vr)?(t="$",vr++):(t=null,0===br&&s('"$"')),null===t&&(44===n.charCodeAt(vr)?(t=",",vr++):(t=null,0===br&&s('","')))))))))))),t}function Wt(){var t,e,r,i,l,o;if(l=vr,t=zt(),null!==t){for(e=[],o=vr,47===n.charCodeAt(vr)?(r="/",vr++):(r=null,0===br&&s('"/"')),null!==r?(i=zt(),null!==i?r=[r,i]:(r=null,vr=o)):(r=null,vr=o);null!==r;)e.push(r),o=vr,47===n.charCodeAt(vr)?(r="/",vr++):(r=null,0===br&&s('"/"')),null!==r?(i=zt(),null!==i?r=[r,i]:(r=null,vr=o)):(r=null,vr=o);null!==e?t=[t,e]:(t=null,vr=l)}else t=null,vr=l;return t}function zt(){var t,e,r,i,l,o;for(l=vr,t=[],e=Vt();null!==e;)t.push(e),e=Vt();if(null!==t){for(e=[],o=vr,59===n.charCodeAt(vr)?(r=";",vr++):(r=null,0===br&&s('";"')),null!==r?(i=Kt(),null!==i?r=[r,i]:(r=null,vr=o)):(r=null,vr=o);null!==r;)e.push(r),o=vr,59===n.charCodeAt(vr)?(r=";",vr++):(r=null,0===br&&s('";"')),null!==r?(i=Kt(),null!==i?r=[r,i]:(r=null,vr=o)):(r=null,vr=o);null!==e?t=[t,e]:(t=null,vr=l)}else t=null,vr=l;return t}function Kt(){var t,e;for(t=[],e=Vt();null!==e;)t.push(e),e=Vt();return t}function Vt(){var t;return t=g(),null===t&&(t=v(),null===t&&(58===n.charCodeAt(vr)?(t=":",vr++):(t=null,0===br&&s('":"')),null===t&&(64===n.charCodeAt(vr)?(t="@",vr++):(t=null,0===br&&s('"@"')),null===t&&(38===n.charCodeAt(vr)?(t="&",vr++):(t=null,0===br&&s('"&"')),null===t&&(61===n.charCodeAt(vr)?(t="=",vr++):(t=null,0===br&&s('"="')),null===t&&(43===n.charCodeAt(vr)?(t="+",vr++):(t=null,0===br&&s('"+"')),null===t&&(36===n.charCodeAt(vr)?(t="$",vr++):(t=null,0===br&&s('"$"')),null===t&&(44===n.charCodeAt(vr)?(t=",",vr++):(t=null,0===br&&s('","')))))))))),t}function Jt(){var t,e,r,i,a;if(i=vr,a=vr,t=o(),null!==t){for(e=[],r=o(),null===r&&(r=l(),null===r&&(43===n.charCodeAt(vr)?(r="+",vr++):(r=null,0===br&&s('"+"')),null===r&&(45===n.charCodeAt(vr)?(r="-",vr++):(r=null,0===br&&s('"-"')),null===r&&(46===n.charCodeAt(vr)?(r=".",vr++):(r=null,0===br&&s('"."'))))));null!==r;)e.push(r),r=o(),null===r&&(r=l(),null===r&&(43===n.charCodeAt(vr)?(r="+",vr++):(r=null,0===br&&s('"+"')),null===r&&(45===n.charCodeAt(vr)?(r="-",vr++):(r=null,0===br&&s('"-"')),null===r&&(46===n.charCodeAt(vr)?(r=".",vr++):(r=null,0===br&&s('"."'))))));null!==e?t=[t,e]:(t=null,vr=a)}else t=null,vr=a;return null!==t&&(t=function(t){Er.scheme=n.substring(vr,t)}(i)),null===t&&(vr=i),t}function Yt(){var t;return t=$t(),null===t&&(t=Xt()),t}function $t(){var t,e,r,i;return r=vr,i=vr,t=tt(),null!==t?(64===n.charCodeAt(vr)?(e="@",vr++):(e=null,0===br&&s('"@"')),null!==e?t=[t,e]:(t=null,vr=i)):(t=null,vr=i),t=null!==t?t:"",null!==t?(e=st(),null!==e?t=[t,e]:(t=null,vr=r)):(t=null,vr=r),t=null!==t?t:""}function Xt(){var t,e;if(e=g(),null===e&&(e=v(),null===e&&(36===n.charCodeAt(vr)?(e="$",vr++):(e=null,0===br&&s('"$"')),null===e&&(44===n.charCodeAt(vr)?(e=",",vr++):(e=null,0===br&&s('","')),null===e&&(59===n.charCodeAt(vr)?(e=";",vr++):(e=null,0===br&&s('";"')),null===e&&(58===n.charCodeAt(vr)?(e=":",vr++):(e=null,0===br&&s('":"')),null===e&&(64===n.charCodeAt(vr)?(e="@",vr++):(e=null,0===br&&s('"@"')),null===e&&(38===n.charCodeAt(vr)?(e="&",vr++):(e=null,0===br&&s('"&"')),null===e&&(61===n.charCodeAt(vr)?(e="=",vr++):(e=null,0===br&&s('"="')),null===e&&(43===n.charCodeAt(vr)?(e="+",vr++):(e=null,0===br&&s('"+"'))))))))))),null!==e)for(t=[];null!==e;)t.push(e),e=g(),null===e&&(e=v(),null===e&&(36===n.charCodeAt(vr)?(e="$",vr++):(e=null,0===br&&s('"$"')),null===e&&(44===n.charCodeAt(vr)?(e=",",vr++):(e=null,0===br&&s('","')),null===e&&(59===n.charCodeAt(vr)?(e=";",vr++):(e=null,0===br&&s('";"')),null===e&&(58===n.charCodeAt(vr)?(e=":",vr++):(e=null,0===br&&s('":"')),null===e&&(64===n.charCodeAt(vr)?(e="@",vr++):(e=null,0===br&&s('"@"')),null===e&&(38===n.charCodeAt(vr)?(e="&",vr++):(e=null,0===br&&s('"&"')),null===e&&(61===n.charCodeAt(vr)?(e="=",vr++):(e=null,0===br&&s('"="')),null===e&&(43===n.charCodeAt(vr)?(e="+",vr++):(e=null,0===br&&s('"+"')))))))))));else t=null;return t}function Qt(){var t,e;for(t=[],e=Gt();null!==e;)t.push(e),e=Gt();return t}function Zt(){var t,e,r,i,o,a,u,c;if(u=vr,c=vr,"sip"===n.substr(vr,3).toLowerCase()?(t=n.substr(vr,3),vr+=3):(t=null,0===br&&s('"SIP"')),null!==t)if(47===n.charCodeAt(vr)?(e="/",vr++):(e=null,0===br&&s('"/"')),null!==e){if(i=l(),null!==i)for(r=[];null!==i;)r.push(i),i=l();else r=null;if(null!==r)if(46===n.charCodeAt(vr)?(i=".",vr++):(i=null,0===br&&s('"."')),null!==i){if(a=l(),null!==a)for(o=[];null!==a;)o.push(a),a=l();else o=null;null!==o?t=[t,e,r,i,o]:(t=null,vr=c)}else t=null,vr=c;else t=null,vr=c}else t=null,vr=c;else t=null,vr=c;return null!==t&&(t=function(t){Er.sip_version=n.substring(vr,t)}(u)),null===t&&(vr=u),t}function te(){var t;return"INVITE"===n.substr(vr,6)?(t="INVITE",vr+=6):(t=null,0===br&&s('"INVITE"')),t}function ee(){var t;return"ACK"===n.substr(vr,3)?(t="ACK",vr+=3):(t=null,0===br&&s('"ACK"')),t}function ne(){var t;return"OPTIONS"===n.substr(vr,7)?(t="OPTIONS",vr+=7):(t=null,0===br&&s('"OPTIONS"')),t}function re(){var t;return"BYE"===n.substr(vr,3)?(t="BYE",vr+=3):(t=null,0===br&&s('"BYE"')),t}function se(){var t;return"CANCEL"===n.substr(vr,6)?(t="CANCEL",vr+=6):(t=null,0===br&&s('"CANCEL"')),t}function ie(){var t;return"REGISTER"===n.substr(vr,8)?(t="REGISTER",vr+=8):(t=null,0===br&&s('"REGISTER"')),t}function le(){var t;return"SUBSCRIBE"===n.substr(vr,9)?(t="SUBSCRIBE",vr+=9):(t=null,0===br&&s('"SUBSCRIBE"')),t}function oe(){var t;return"NOTIFY"===n.substr(vr,6)?(t="NOTIFY",vr+=6):(t=null,0===br&&s('"NOTIFY"')),t}function ae(){var t;return"REFER"===n.substr(vr,5)?(t="REFER",vr+=5):(t=null,0===br&&s('"REFER"')),t}function ue(){var t,e;return e=vr,t=te(),null===t&&(t=ee(),null===t&&(t=ne(),null===t&&(t=re(),null===t&&(t=se(),null===t&&(t=ie(),null===t&&(t=le(),null===t&&(t=oe(),null===t&&(t=ae(),null===t&&(t=R()))))))))),null!==t&&(t=function(t){return Er.method=n.substring(vr,t),Er.method}(e)),null===t&&(vr=e),t}function ce(){var t,e,n,r,s,i;return i=vr,t=Zt(),null!==t?(e=h(),null!==e?(n=de(),null!==n?(r=h(),null!==r?(s=pe(),null!==s?t=[t,e,n,r,s]:(t=null,vr=i)):(t=null,vr=i)):(t=null,vr=i)):(t=null,vr=i)):(t=null,vr=i),t}function de(){var t,e;return e=vr,t=he(),null!==t&&(t=function(t,e){Er.status_code=parseInt(e.join(""))}(e,t)),null===t&&(vr=e),t}function he(){var t,e,n,r;return r=vr,t=l(),null!==t?(e=l(),null!==e?(n=l(),null!==n?t=[t,e,n]:(t=null,vr=r)):(t=null,vr=r)):(t=null,vr=r),t}function pe(){var t,e,r;for(r=vr,t=[],e=m(),null===e&&(e=g(),null===e&&(e=v(),null===e&&(e=E(),null===e&&(e=A(),null===e&&(e=h(),null===e&&(e=p()))))));null!==e;)t.push(e),e=m(),null===e&&(e=g(),null===e&&(e=v(),null===e&&(e=E(),null===e&&(e=A(),null===e&&(e=h(),null===e&&(e=p()))))));return null!==t&&(t=function(t){Er.reason_phrase=n.substring(vr,t)}(r)),null===t&&(vr=r),t}function fe(){var t,e,n,r,s,i;if(s=vr,t=Ve(),null!==t){for(e=[],i=vr,n=q(),null!==n?(r=Ve(),null!==r?n=[n,r]:(n=null,vr=i)):(n=null,vr=i);null!==n;)e.push(n),i=vr,n=q(),null!==n?(r=Ve(),null!==r?n=[n,r]:(n=null,vr=i)):(n=null,vr=i);null!==e?t=[t,e]:(t=null,vr=s)}else t=null,vr=s;return t}function me(){var t,e,r,i,l,o;return i=vr,l=vr,t=O(),null!==t?(o=vr,64===n.charCodeAt(vr)?(e="@",vr++):(e=null,0===br&&s('"@"')),null!==e?(r=O(),null!==r?e=[e,r]:(e=null,vr=o)):(e=null,vr=o),e=null!==e?e:"",null!==e?t=[t,e]:(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t){Er=n.substring(vr,t)}(i)),null===t&&(vr=i),t}function ge(){var t,e,n,r,s,i,l;if(s=vr,t=N(),null===t)if(i=vr,t=_e(),null!==t){for(e=[],l=vr,n=q(),null!==n?(r=_e(),null!==r?n=[n,r]:(n=null,vr=l)):(n=null,vr=l);null!==n;)e.push(n),l=vr,n=q(),null!==n?(r=_e(),null!==r?n=[n,r]:(n=null,vr=l)):(n=null,vr=l);null!==e?t=[t,e]:(t=null,vr=i)}else t=null,vr=i;return null!==t&&(t=function(t){var e,n;for(n=Er.multi_header.length,e=0;n>e;e++)if(null===Er.multi_header[e].parsed){Er=null;break}Er=null!==Er?Er.multi_header:-1}(s)),null===t&&(vr=s),t}function _e(){var t,e,n,r,s,i,l;if(s=vr,i=vr,t=Y(),null===t&&(t=ve()),null!==t){for(e=[],l=vr,n=j(),null!==n?(r=Te(),null!==r?n=[n,r]:(n=null,vr=l)):(n=null,vr=l);null!==n;)e.push(n),l=vr,n=j(),null!==n?(r=Te(),null!==r?n=[n,r]:(n=null,vr=l)):(n=null,vr=l);null!==e?t=[t,e]:(t=null,vr=i)}else t=null,vr=i;return null!==t&&(t=function(t){var e;Er.multi_header||(Er.multi_header=[]);try{e=new Sr(Er.uri,Er.display_name,Er.params),delete Er.uri,delete Er.display_name,delete Er.params}catch(n){e=null}Er.multi_header.push({possition:vr,offset:t,parsed:e})}(s)),null===t&&(vr=s),t}function ve(){var t,e,n,r,s;return s=vr,t=be(),t=null!==t?t:"",null!==t?(e=P(),null!==e?(n=$(),null!==n?(r=M(),null!==r?t=[t,e,n,r]:(t=null,vr=s)):(t=null,vr=s)):(t=null,vr=s)):(t=null,vr=s),t}function be(){var t,e,r,s,i,l,o;if(i=vr,l=vr,t=R(),null!==t){for(e=[],o=vr,r=b(),null!==r?(s=R(),null!==s?r=[r,s]:(r=null,vr=o)):(r=null,vr=o);null!==r;)e.push(r),o=vr,r=b(),null!==r?(s=R(),null!==s?r=[r,s]:(r=null,vr=o)):(r=null,vr=o);null!==e?t=[t,e]:(t=null,vr=l)}else t=null,vr=l;return null===t&&(t=z()),null!==t&&(t=function(t,e){e=n.substring(vr,t).trim(),'"'===e[0]&&(e=e.substring(1,e.length-1)),Er.display_name=e}(i,t)),null===t&&(vr=i),t}function Te(){var t;return t=ye(),null===t&&(t=Ce(),null===t&&(t=Ae())),t}function ye(){var t,e,r,i,l;return i=vr,l=vr,"q"===n.substr(vr,1).toLowerCase()?(t=n.substr(vr,1),vr++):(t=null,0===br&&s('"q"')),null!==t?(e=D(),null!==e?(r=Ee(),null!==r?t=[t,e,r]:(t=null,vr=l)):(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t,e){Er.params||(Er.params={}),Er.params.q=e}(i,t[2])),null===t&&(vr=i),t}function Ce(){var t,e,r,i,l;return i=vr,l=vr,"expires"===n.substr(vr,7).toLowerCase()?(t=n.substr(vr,7),vr+=7):(t=null,0===br&&s('"expires"')),null!==t?(e=D(),null!==e?(r=Se(),null!==r?t=[t,e,r]:(t=null,vr=l)):(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t,e){Er.params||(Er.params={}),Er.params.expires=e}(i,t[2])),null===t&&(vr=i),t}function Se(){var t,e,n;if(n=vr,e=l(),null!==e)for(t=[];null!==e;)t.push(e),e=l();else t=null;return null!==t&&(t=function(t,e){return parseInt(e.join(""))}(n,t)),null===t&&(vr=n),t}function Ee(){var t,e,r,i,o,a,u,c;return a=vr,u=vr,48===n.charCodeAt(vr)?(t="0",vr++):(t=null,0===br&&s('"0"')),null!==t?(c=vr,46===n.charCodeAt(vr)?(e=".",vr++):(e=null,0===br&&s('"."')),null!==e?(r=l(),r=null!==r?r:"",null!==r?(i=l(),i=null!==i?i:"",null!==i?(o=l(),o=null!==o?o:"",null!==o?e=[e,r,i,o]:(e=null,vr=c)):(e=null,vr=c)):(e=null,vr=c)):(e=null,vr=c),e=null!==e?e:"",null!==e?t=[t,e]:(t=null,vr=u)):(t=null,vr=u),null!==t&&(t=function(t){return parseFloat(n.substring(vr,t))}(a)),null===t&&(vr=a),t}function Ae(){var t,e,n,r,s,i;return r=vr,s=vr,t=R(),null!==t?(i=vr,e=D(),null!==e?(n=we(),null!==n?e=[e,n]:(e=null,vr=i)):(e=null,vr=i),e=null!==e?e:"",null!==e?t=[t,e]:(t=null,vr=s)):(t=null,vr=s),null!==t&&(t=function(t,e,n){Er.params||(Er.params={}),n="undefined"==typeof n?void 0:n[1],Er.params[e.toLowerCase()]=n}(r,t[0],t[1])),null===t&&(vr=r),t}function we(){var t;return t=R(),null===t&&(t=it(),null===t&&(t=z())),t}function Re(){var t,e,n,r,s,i;if(s=vr,t=xe(),null!==t){for(e=[],i=vr,n=j(),null!==n?(r=Ie(),null!==r?n=[n,r]:(n=null,vr=i)):(n=null,vr=i);null!==n;)e.push(n),i=vr,n=j(),null!==n?(r=Ie(),null!==r?n=[n,r]:(n=null,vr=i)):(n=null,vr=i);null!==e?t=[t,e]:(t=null,vr=s)}else t=null,vr=s;return t}function xe(){var t;return"render"===n.substr(vr,6).toLowerCase()?(t=n.substr(vr,6),vr+=6):(t=null,0===br&&s('"render"')),null===t&&("session"===n.substr(vr,7).toLowerCase()?(t=n.substr(vr,7),vr+=7):(t=null,0===br&&s('"session"')),null===t&&("icon"===n.substr(vr,4).toLowerCase()?(t=n.substr(vr,4),vr+=4):(t=null,0===br&&s('"icon"')),null===t&&("alert"===n.substr(vr,5).toLowerCase()?(t=n.substr(vr,5),vr+=5):(t=null,0===br&&s('"alert"')),null===t&&(t=R())))),t}function Ie(){var t;return t=Oe(),null===t&&(t=Ae()),t}function Oe(){var t,e,r,i;return i=vr,"handling"===n.substr(vr,8).toLowerCase()?(t=n.substr(vr,8),vr+=8):(t=null,0===br&&s('"handling"')),null!==t?(e=D(),null!==e?("optional"===n.substr(vr,8).toLowerCase()?(r=n.substr(vr,8),vr+=8):(r=null,0===br&&s('"optional"')),null===r&&("required"===n.substr(vr,8).toLowerCase()?(r=n.substr(vr,8),vr+=8):(r=null,0===br&&s('"required"')),null===r&&(r=R())),null!==r?t=[t,e,r]:(t=null,vr=i)):(t=null,vr=i)):(t=null,vr=i),t}function Ne(){var t,e,n,r,s,i;if(s=vr,t=R(),null!==t){for(e=[],i=vr,n=q(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,vr=i)):(n=null,vr=i);null!==n;)e.push(n),i=vr,n=q(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,vr=i)):(n=null,vr=i);null!==e?t=[t,e]:(t=null,vr=s)}else t=null,vr=s;return t}function ke(){var t,e,n;if(n=vr,e=l(),null!==e)for(t=[];null!==e;)t.push(e),e=l();else t=null;return null!==t&&(t=function(t,e){Er=parseInt(e.join(""))}(n,t)),null===t&&(vr=n),t}function De(){var t,e;return e=vr,t=Le(),null!==t&&(t=function(t){Er=n.substring(vr,t)}(e)),null===t&&(vr=e),t}function Le(){var t,e,n,r,s,i,l,o;if(l=vr,t=Ue(),null!==t)if(e=k(),null!==e)if(n=He(),null!==n){for(r=[],o=vr,s=j(),null!==s?(i=Fe(),null!==i?s=[s,i]:(s=null,vr=o)):(s=null,vr=o);null!==s;)r.push(s),o=vr,s=j(),null!==s?(i=Fe(),null!==i?s=[s,i]:(s=null,vr=o)):(s=null,vr=o);null!==r?t=[t,e,n,r]:(t=null,vr=l)}else t=null,vr=l;else t=null,vr=l;else t=null,vr=l;return t}function Ue(){var t;return t=Me(),null===t&&(t=Pe()),t}function Me(){var t;return"text"===n.substr(vr,4).toLowerCase()?(t=n.substr(vr,4),vr+=4):(t=null,0===br&&s('"text"')),null===t&&("image"===n.substr(vr,5).toLowerCase()?(t=n.substr(vr,5),vr+=5):(t=null,0===br&&s('"image"')),null===t&&("audio"===n.substr(vr,5).toLowerCase()?(t=n.substr(vr,5),vr+=5):(t=null,0===br&&s('"audio"')),null===t&&("video"===n.substr(vr,5).toLowerCase()?(t=n.substr(vr,5),vr+=5):(t=null,0===br&&s('"video"')),null===t&&("application"===n.substr(vr,11).toLowerCase()?(t=n.substr(vr,11),vr+=11):(t=null,0===br&&s('"application"')),null===t&&(t=qe()))))),t}function Pe(){var t;return"message"===n.substr(vr,7).toLowerCase()?(t=n.substr(vr,7),vr+=7):(t=null,0===br&&s('"message"')),null===t&&("multipart"===n.substr(vr,9).toLowerCase()?(t=n.substr(vr,9),vr+=9):(t=null,0===br&&s('"multipart"')),null===t&&(t=qe())),t}function qe(){var t;return t=R(),null===t&&(t=je()),t}function je(){var t,e,r;return r=vr,"x-"===n.substr(vr,2).toLowerCase()?(t=n.substr(vr,2),vr+=2):(t=null,0===br&&s('"x-"')),null!==t?(e=R(),null!==e?t=[t,e]:(t=null,vr=r)):(t=null,vr=r),t}function He(){var t;return t=qe(),null===t&&(t=R()),t}function Fe(){var t,e,n,r;return r=vr,t=R(),null!==t?(e=D(),null!==e?(n=Ge(),null!==n?t=[t,e,n]:(t=null,vr=r)):(t=null,vr=r)):(t=null,vr=r),t}function Ge(){var t;return t=R(),null===t&&(t=z()),t}function Be(){var t,e,n,r;return r=vr,t=We(),null!==t?(e=b(),null!==e?(n=ue(),null!==n?t=[t,e,n]:(t=null,vr=r)):(t=null,vr=r)):(t=null,vr=r),t}function We(){var t,e,n;if(n=vr,e=l(),null!==e)for(t=[];null!==e;)t.push(e),e=l();else t=null;return null!==t&&(t=function(t,e){Er.value=parseInt(e.join(""))}(n,t)),null===t&&(vr=n),t}function ze(){var t,e;return e=vr,t=Se(),null!==t&&(t=function(t,e){Er=e}(e,t)),null===t&&(vr=e),t}function Ke(){var t,e,n,r,s,i,l;if(s=vr,i=vr,t=Ve(),null!==t){for(e=[],l=vr,n=j(),null!==n?(r=Ae(),null!==r?n=[n,r]:(n=null,vr=l)):(n=null,vr=l);null!==n;)e.push(n),l=vr,n=j(),null!==n?(r=Ae(),null!==r?n=[n,r]:(n=null,vr=l)):(n=null,vr=l);null!==e?t=[t,e]:(t=null,vr=i)}else t=null,vr=i;return null!==t&&(t=function(t,e){Er.event=e.join("").toLowerCase()}(s,t[0])),null===t&&(vr=s),t}function Ve(){var t,e,r,i,l,o;if(l=vr,t=x(),null!==t){for(e=[],o=vr,46===n.charCodeAt(vr)?(r=".",vr++):(r=null,0===br&&s('"."')),null!==r?(i=x(),null!==i?r=[r,i]:(r=null,vr=o)):(r=null,vr=o);null!==r;)e.push(r),o=vr,46===n.charCodeAt(vr)?(r=".",vr++):(r=null,0===br&&s('"."')),null!==r?(i=x(),null!==i?r=[r,i]:(r=null,vr=o)):(r=null,vr=o);null!==e?t=[t,e]:(t=null,vr=l)}else t=null,vr=l;return t}function Je(){var t,e,n,r,s,i,l;if(s=vr,i=vr,t=Y(),null===t&&(t=ve()),null!==t){for(e=[],l=vr,n=j(),null!==n?(r=Ye(),null!==r?n=[n,r]:(n=null,vr=l)):(n=null,vr=l);null!==n;)e.push(n),l=vr,n=j(),null!==n?(r=Ye(),null!==r?n=[n,r]:(n=null,vr=l)):(n=null,vr=l);null!==e?t=[t,e]:(t=null,vr=i)}else t=null,vr=i;return null!==t&&(t=function(t){var e=Er.tag;try{Er=new Sr(Er.uri,Er.display_name,Er.params),e&&Er.setParam("tag",e)}catch(n){Er=-1}}(s)),null===t&&(vr=s),t}function Ye(){var t;return t=$e(),null===t&&(t=Ae()),t}function $e(){var t,e,r,i,l;return i=vr,l=vr,"tag"===n.substr(vr,3).toLowerCase()?(t=n.substr(vr,3),vr+=3):(t=null,0===br&&s('"tag"')),null!==t?(e=D(),null!==e?(r=R(),null!==r?t=[t,e,r]:(t=null,vr=l)):(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t,e){Er.tag=e}(i,t[2])),null===t&&(vr=i),t}function Xe(){var t,e,n;if(n=vr,e=l(),null!==e)for(t=[];null!==e;)t.push(e),e=l();else t=null;return null!==t&&(t=function(t,e){Er=parseInt(e.join(""))}(n,t)),null===t&&(vr=n),t}function Qe(){var t,e;return e=vr,t=Se(),null!==t&&(t=function(t,e){Er=e}(e,t)),null===t&&(vr=e),t}function Ze(){var t,e,n,r,s,i,l,o,a,u;for(o=vr,a=vr,t=[],e=be();null!==e;)t.push(e),e=be();if(null!==t)if(e=P(),null!==e)if(n=$(),null!==n)if(r=M(),null!==r){for(s=[],u=vr,i=j(),null!==i?(l=Ae(),null!==l?i=[i,l]:(i=null,vr=u)):(i=null,vr=u);null!==i;)s.push(i),u=vr,i=j(),null!==i?(l=Ae(),null!==l?i=[i,l]:(i=null,vr=u)):(i=null,vr=u);null!==s?t=[t,e,n,r,s]:(t=null,vr=a)}else t=null,vr=a;else t=null,vr=a;else t=null,vr=a;else t=null,vr=a;return null!==t&&(t=function(t){try{Er=new Sr(Er.uri,Er.display_name,Er.params)}catch(e){Er=-1}}(o)),null===t&&(vr=o),t}function tn(){var t;return t=en()}function en(){var t,e,r,i,l,o,a,u;if(a=vr,"digest"===n.substr(vr,6).toLowerCase()?(t=n.substr(vr,6),vr+=6):(t=null,0===br&&s('"Digest"')),null!==t)if(e=b(),null!==e)if(r=sn(),null!==r){for(i=[],u=vr,l=q(),null!==l?(o=sn(),null!==o?l=[l,o]:(l=null,vr=u)):(l=null,vr=u);null!==l;)i.push(l),u=vr,l=q(),null!==l?(o=sn(),null!==o?l=[l,o]:(l=null,vr=u)):(l=null,vr=u);null!==i?t=[t,e,r,i]:(t=null,vr=a)}else t=null,vr=a;else t=null,vr=a;else t=null,vr=a;return null===t&&(t=nn()),t}function nn(){var t,e,n,r,s,i,l,o;if(l=vr,t=R(),null!==t)if(e=b(),null!==e)if(n=rn(),null!==n){for(r=[],o=vr,s=q(),null!==s?(i=rn(),null!==i?s=[s,i]:(s=null,vr=o)):(s=null,vr=o);null!==s;)r.push(s),o=vr,s=q(),null!==s?(i=rn(),null!==i?s=[s,i]:(s=null,vr=o)):(s=null,vr=o);null!==r?t=[t,e,n,r]:(t=null,vr=l)}else t=null,vr=l;else t=null,vr=l;else t=null,vr=l;return t}function rn(){var t,e,n,r;return r=vr,t=R(),null!==t?(e=D(),null!==e?(n=R(),null===n&&(n=z()),null!==n?t=[t,e,n]:(t=null,vr=r)):(t=null,vr=r)):(t=null,vr=r),t}function sn(){var t;return t=ln(),null===t&&(t=an(),null===t&&(t=cn(),null===t&&(t=hn(),null===t&&(t=pn(),null===t&&(t=fn(),null===t&&(t=mn(),null===t&&(t=rn()))))))),t}function ln(){var t,e,r,i;return i=vr,"realm"===n.substr(vr,5).toLowerCase()?(t=n.substr(vr,5),vr+=5):(t=null,0===br&&s('"realm"')),null!==t?(e=D(),null!==e?(r=on(),null!==r?t=[t,e,r]:(t=null,vr=i)):(t=null,vr=i)):(t=null,vr=i),t}function on(){var t,e;return e=vr,t=K(),null!==t&&(t=function(t,e){Er.realm=e}(e,t)),null===t&&(vr=e),t}function an(){var t,e,r,i,l,o,a,u,c;if(u=vr,"domain"===n.substr(vr,6).toLowerCase()?(t=n.substr(vr,6),vr+=6):(t=null,0===br&&s('"domain"')),null!==t)if(e=D(),null!==e)if(r=F(),null!==r)if(i=un(),null!==i){if(l=[],c=vr,a=h(),null!==a)for(o=[];null!==a;)o.push(a),a=h();else o=null;for(null!==o?(a=un(),null!==a?o=[o,a]:(o=null,vr=c)):(o=null,vr=c);null!==o;){if(l.push(o),c=vr,a=h(),null!==a)for(o=[];null!==a;)o.push(a),a=h();else o=null;null!==o?(a=un(),null!==a?o=[o,a]:(o=null,vr=c)):(o=null,vr=c)}null!==l?(o=G(),null!==o?t=[t,e,r,i,l,o]:(t=null,vr=u)):(t=null,vr=u)}else t=null,vr=u;else t=null,vr=u;else t=null,vr=u;else t=null,vr=u;return t}function un(){var t;return t=Pt(),null===t&&(t=Ht()),t}function cn(){var t,e,r,i;return i=vr,"nonce"===n.substr(vr,5).toLowerCase()?(t=n.substr(vr,5),vr+=5):(t=null,0===br&&s('"nonce"')),null!==t?(e=D(),null!==e?(r=dn(),null!==r?t=[t,e,r]:(t=null,vr=i)):(t=null,vr=i)):(t=null,vr=i),t}function dn(){var t,e;return e=vr,t=K(),null!==t&&(t=function(t,e){Er.nonce=e}(e,t)),null===t&&(vr=e),t}function hn(){var t,e,r,i,l;return i=vr,l=vr,"opaque"===n.substr(vr,6).toLowerCase()?(t=n.substr(vr,6),vr+=6):(t=null,0===br&&s('"opaque"')),null!==t?(e=D(),null!==e?(r=K(),null!==r?t=[t,e,r]:(t=null,vr=l)):(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t,e){Er.opaque=e}(i,t[2])),null===t&&(vr=i),t}function pn(){var t,e,r,i,l;return i=vr,"stale"===n.substr(vr,5).toLowerCase()?(t=n.substr(vr,5),vr+=5):(t=null,0===br&&s('"stale"')),null!==t?(e=D(),null!==e?(l=vr,"true"===n.substr(vr,4).toLowerCase()?(r=n.substr(vr,4),vr+=4):(r=null,0===br&&s('"true"')),null!==r&&(r=function(t){Er.stale=!0}(l)),null===r&&(vr=l),null===r&&(l=vr,"false"===n.substr(vr,5).toLowerCase()?(r=n.substr(vr,5),vr+=5):(r=null,0===br&&s('"false"')),null!==r&&(r=function(t){Er.stale=!1}(l)),null===r&&(vr=l)),null!==r?t=[t,e,r]:(t=null,vr=i)):(t=null,vr=i)):(t=null,vr=i),t}function fn(){var t,e,r,i,l;return i=vr,l=vr,"algorithm"===n.substr(vr,9).toLowerCase()?(t=n.substr(vr,9),vr+=9):(t=null,0===br&&s('"algorithm"')),null!==t?(e=D(),null!==e?("md5"===n.substr(vr,3).toLowerCase()?(r=n.substr(vr,3),vr+=3):(r=null,0===br&&s('"MD5"')),null===r&&("md5-sess"===n.substr(vr,8).toLowerCase()?(r=n.substr(vr,8),vr+=8):(r=null,0===br&&s('"MD5-sess"')),null===r&&(r=R())),null!==r?t=[t,e,r]:(t=null,vr=l)):(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t,e){Er.algorithm=e.toUpperCase()}(i,t[2])),null===t&&(vr=i),t}function mn(){var t,e,r,i,l,o,a,u,c,d;if(u=vr,"qop"===n.substr(vr,3).toLowerCase()?(t=n.substr(vr,3),vr+=3):(t=null,0===br&&s('"qop"')),null!==t)if(e=D(),null!==e)if(r=F(),null!==r){if(c=vr,i=gn(),null!==i){for(l=[],d=vr,44===n.charCodeAt(vr)?(o=",",vr++):(o=null,0===br&&s('","')),null!==o?(a=gn(),null!==a?o=[o,a]:(o=null,vr=d)):(o=null,vr=d);null!==o;)l.push(o),d=vr,44===n.charCodeAt(vr)?(o=",",vr++):(o=null,0===br&&s('","')),null!==o?(a=gn(),null!==a?o=[o,a]:(o=null,vr=d)):(o=null,vr=d);null!==l?i=[i,l]:(i=null,vr=c)}else i=null,vr=c;null!==i?(l=G(),null!==l?t=[t,e,r,i,l]:(t=null,vr=u)):(t=null,vr=u)}else t=null,vr=u;else t=null,vr=u;else t=null,vr=u;return t}function gn(){var t,e;return e=vr,"auth-int"===n.substr(vr,8).toLowerCase()?(t=n.substr(vr,8),vr+=8):(t=null,0===br&&s('"auth-int"')),null===t&&("auth"===n.substr(vr,4).toLowerCase()?(t=n.substr(vr,4),vr+=4):(t=null,0===br&&s('"auth"')),null===t&&(t=R())),null!==t&&(t=function(t,e){Er.qop||(Er.qop=[]),Er.qop.push(e.toLowerCase())}(e,t)),null===t&&(vr=e),t}function _n(){var t,e,n,r,s,i;if(s=vr,t=R(),null!==t){for(e=[],i=vr,n=q(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,vr=i)):(n=null,vr=i);null!==n;)e.push(n),i=vr,n=q(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,vr=i)):(n=null,vr=i);null!==e?t=[t,e]:(t=null,vr=s)}else t=null,vr=s;return t}function vn(){var t,e,n,r,s,i,l;if(s=vr,i=vr,t=bn(),null!==t){for(e=[],l=vr,n=q(),null!==n?(r=bn(),null!==r?n=[n,r]:(n=null,vr=l)):(n=null,vr=l);null!==n;)e.push(n),l=vr,n=q(),null!==n?(r=bn(),null!==r?n=[n,r]:(n=null,vr=l)):(n=null,vr=l);null!==e?t=[t,e]:(t=null,vr=i)}else t=null,vr=i;return null!==t&&(t=function(t){var e,n;for(n=Er.multi_header.length,e=0;n>e;e++)if(null===Er.multi_header[e].parsed){Er=null;break}Er=null!==Er?Er.multi_header:-1}(s)),null===t&&(vr=s),t}function bn(){var t,e,n,r,s,i,l;if(s=vr,i=vr,t=ve(),null!==t){for(e=[],l=vr,n=j(),null!==n?(r=Ae(),null!==r?n=[n,r]:(n=null,vr=l)):(n=null,vr=l);null!==n;)e.push(n),l=vr,n=j(),null!==n?(r=Ae(),null!==r?n=[n,r]:(n=null,vr=l)):(n=null,vr=l);null!==e?t=[t,e]:(t=null,vr=i)}else t=null,vr=i;return null!==t&&(t=function(t){var e;Er.multi_header||(Er.multi_header=[]);try{e=new Sr(Er.uri,Er.display_name,Er.params),delete Er.uri,delete Er.display_name,delete Er.params}catch(n){e=null}Er.multi_header.push({possition:vr,offset:t,parsed:e})}(s)),null===t&&(vr=s),t}function Tn(){var t,e,r,i,l,o,a;if(l=vr,o=vr,"sip"===n.substr(vr,3).toLowerCase()?(t=n.substr(vr,3),vr+=3):(t=null,0===br&&s('"SIP"')),null===t&&(t=R()),null!==t){for(e=[],a=vr,r=j(),null!==r?(i=yn(),null!==i?r=[r,i]:(r=null,vr=a)):(r=null,vr=a);null!==r;)e.push(r),a=vr,r=j(),null!==r?(i=yn(),null!==i?r=[r,i]:(r=null,vr=a)):(r=null,vr=a);null!==e?t=[t,e]:(t=null,vr=o)}else t=null,vr=o;return null!==t&&(t=function(t,e){if(Er.protocol=e.toLowerCase(),Er.params||(Er.params={}),Er.params.text&&'"'===Er.params.text[0]){var n=Er.params.text;Er.text=n.substring(1,n.length-1),delete Er.params.text}}(l,t[0])),null===t&&(vr=l),t}function yn(){var t;return t=Cn(),null===t&&(t=Ae()),t}function Cn(){var t,e,r,i,o,a;if(o=vr,a=vr,"cause"===n.substr(vr,5).toLowerCase()?(t=n.substr(vr,5),vr+=5):(t=null,0===br&&s('"cause"')),null!==t)if(e=D(),null!==e){if(i=l(),null!==i)for(r=[];null!==i;)r.push(i),i=l();else r=null;null!==r?t=[t,e,r]:(t=null,vr=a)}else t=null,vr=a;else t=null,vr=a;return null!==t&&(t=function(t,e){Er.cause=parseInt(e.join(""))}(o,t[2])),null===t&&(vr=o),t}function Sn(){var t,e,n,r,s,i;if(s=vr,t=R(),null!==t){for(e=[],i=vr,n=q(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,vr=i)):(n=null,vr=i);null!==n;)e.push(n),i=vr,n=q(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,vr=i)):(n=null,vr=i);null!==e?t=[t,e]:(t=null,vr=s)}else t=null,vr=s;return t}function En(){var t,e,n,r,s,i;if(s=vr,t=An(),null!==t){for(e=[],i=vr,n=q(),null!==n?(r=An(),null!==r?n=[n,r]:(n=null,vr=i)):(n=null,vr=i);null!==n;)e.push(n),i=vr,n=q(),null!==n?(r=An(),null!==r?n=[n,r]:(n=null,vr=i)):(n=null,vr=i);null!==e?t=[t,e]:(t=null,vr=s)}else t=null,vr=s;return t}function An(){var t,e,n,r,s,i;if(s=vr,t=ve(),null!==t){for(e=[],i=vr,n=j(),null!==n?(r=Ae(),null!==r?n=[n,r]:(n=null,vr=i)):(n=null,vr=i);null!==n;)e.push(n),i=vr,n=j(),null!==n?(r=Ae(),null!==r?n=[n,r]:(n=null,vr=i)):(n=null,vr=i);null!==e?t=[t,e]:(t=null,vr=s)}else t=null,vr=s;return t}function wn(){var t,e,n,r,s,i;if(s=vr,t=Rn(),null!==t){for(e=[],i=vr,n=j(),null!==n?(r=xn(),null!==r?n=[n,r]:(n=null,vr=i)):(n=null,vr=i);null!==n;)e.push(n),i=vr,n=j(),null!==n?(r=xn(),null!==r?n=[n,r]:(n=null,vr=i)):(n=null,vr=i);null!==e?t=[t,e]:(t=null,vr=s)}else t=null,vr=s;return t}function Rn(){var t,e;return e=vr,"active"===n.substr(vr,6).toLowerCase()?(t=n.substr(vr,6),vr+=6):(t=null,0===br&&s('"active"')),null===t&&("pending"===n.substr(vr,7).toLowerCase()?(t=n.substr(vr,7),vr+=7):(t=null,0===br&&s('"pending"')),null===t&&("terminated"===n.substr(vr,10).toLowerCase()?(t=n.substr(vr,10),vr+=10):(t=null,0===br&&s('"terminated"')),null===t&&(t=R()))),null!==t&&(t=function(t){Er.state=n.substring(vr,t)}(e)),null===t&&(vr=e),t}function xn(){var t,e,r,i,l;return i=vr,l=vr,"reason"===n.substr(vr,6).toLowerCase()?(t=n.substr(vr,6),vr+=6):(t=null,0===br&&s('"reason"')),null!==t?(e=D(),null!==e?(r=In(),null!==r?t=[t,e,r]:(t=null,vr=l)):(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t,e){"undefined"!=typeof e&&(Er.reason=e)}(i,t[2])),null===t&&(vr=i),null===t&&(i=vr,l=vr,"expires"===n.substr(vr,7).toLowerCase()?(t=n.substr(vr,7),vr+=7):(t=null,0===br&&s('"expires"')),null!==t?(e=D(),null!==e?(r=Se(),null!==r?t=[t,e,r]:(t=null,vr=l)):(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t,e){"undefined"!=typeof e&&(Er.expires=e)}(i,t[2])),null===t&&(vr=i),null===t&&(i=vr,l=vr,"retry_after"===n.substr(vr,11).toLowerCase()?(t=n.substr(vr,11),vr+=11):(t=null,0===br&&s('"retry_after"')),null!==t?(e=D(),null!==e?(r=Se(),null!==r?t=[t,e,r]:(t=null,vr=l)):(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t,e){"undefined"!=typeof e&&(Er.retry_after=e)}(i,t[2])),null===t&&(vr=i),null===t&&(t=Ae()))),t}function In(){var t;return"deactivated"===n.substr(vr,11).toLowerCase()?(t=n.substr(vr,11),vr+=11):(t=null,0===br&&s('"deactivated"')),null===t&&("probation"===n.substr(vr,9).toLowerCase()?(t=n.substr(vr,9),vr+=9):(t=null,0===br&&s('"probation"')),null===t&&("rejected"===n.substr(vr,8).toLowerCase()?(t=n.substr(vr,8),vr+=8):(t=null,0===br&&s('"rejected"')),null===t&&("timeout"===n.substr(vr,7).toLowerCase()?(t=n.substr(vr,7),vr+=7):(t=null,0===br&&s('"timeout"')),null===t&&("giveup"===n.substr(vr,6).toLowerCase()?(t=n.substr(vr,6),vr+=6):(t=null,0===br&&s('"giveup"')),null===t&&("noresource"===n.substr(vr,10).toLowerCase()?(t=n.substr(vr,10),vr+=10):(t=null,0===br&&s('"noresource"')),null===t&&("invariant"===n.substr(vr,9).toLowerCase()?(t=n.substr(vr,9),vr+=9):(t=null,0===br&&s('"invariant"')),null===t&&(t=R()))))))),t}function On(){var t;return t=C(),t=null!==t?t:""}function Nn(){var t,e,n,r,s,i;if(s=vr,t=R(),null!==t){for(e=[],i=vr,n=q(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,vr=i)):(n=null,vr=i);null!==n;)e.push(n),i=vr,n=q(),null!==n?(r=R(),null!==r?n=[n,r]:(n=null,vr=i)):(n=null,vr=i);null!==e?t=[t,e]:(t=null,vr=s)}else t=null,vr=s;return t=null!==t?t:""}function kn(){var t,e,n,r,s,i,l;if(s=vr,i=vr,t=Y(),null===t&&(t=ve()),null!==t){for(e=[],l=vr,n=j(),null!==n?(r=Dn(),null!==r?n=[n,r]:(n=null,
vr=l)):(n=null,vr=l);null!==n;)e.push(n),l=vr,n=j(),null!==n?(r=Dn(),null!==r?n=[n,r]:(n=null,vr=l)):(n=null,vr=l);null!==e?t=[t,e]:(t=null,vr=i)}else t=null,vr=i;return null!==t&&(t=function(t){var e=Er.tag;try{Er=new Sr(Er.uri,Er.display_name,Er.params),e&&Er.setParam("tag",e)}catch(n){Er=-1}}(s)),null===t&&(vr=s),t}function Dn(){var t;return t=$e(),null===t&&(t=Ae()),t}function Ln(){var t,e,n,r,s,i;if(s=vr,t=Un(),null!==t){for(e=[],i=vr,n=q(),null!==n?(r=Un(),null!==r?n=[n,r]:(n=null,vr=i)):(n=null,vr=i);null!==n;)e.push(n),i=vr,n=q(),null!==n?(r=Un(),null!==r?n=[n,r]:(n=null,vr=i)):(n=null,vr=i);null!==e?t=[t,e]:(t=null,vr=s)}else t=null,vr=s;return t}function Un(){var t,e,n,r,s,i,l,o;if(l=vr,t=Gn(),null!==t)if(e=b(),null!==e)if(n=zn(),null!==n){for(r=[],o=vr,s=j(),null!==s?(i=Mn(),null!==i?s=[s,i]:(s=null,vr=o)):(s=null,vr=o);null!==s;)r.push(s),o=vr,s=j(),null!==s?(i=Mn(),null!==i?s=[s,i]:(s=null,vr=o)):(s=null,vr=o);null!==r?t=[t,e,n,r]:(t=null,vr=l)}else t=null,vr=l;else t=null,vr=l;else t=null,vr=l;return t}function Mn(){var t;return t=Pn(),null===t&&(t=qn(),null===t&&(t=jn(),null===t&&(t=Hn(),null===t&&(t=Fn(),null===t&&(t=Ae()))))),t}function Pn(){var t,e,r,i,l;return i=vr,l=vr,"ttl"===n.substr(vr,3).toLowerCase()?(t=n.substr(vr,3),vr+=3):(t=null,0===br&&s('"ttl"')),null!==t?(e=D(),null!==e?(r=Jn(),null!==r?t=[t,e,r]:(t=null,vr=l)):(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t,e){Er.ttl=e}(i,t[2])),null===t&&(vr=i),t}function qn(){var t,e,r,i,l;return i=vr,l=vr,"maddr"===n.substr(vr,5).toLowerCase()?(t=n.substr(vr,5),vr+=5):(t=null,0===br&&s('"maddr"')),null!==t?(e=D(),null!==e?(r=it(),null!==r?t=[t,e,r]:(t=null,vr=l)):(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t,e){Er.maddr=e}(i,t[2])),null===t&&(vr=i),t}function jn(){var t,e,r,i,l;return i=vr,l=vr,"received"===n.substr(vr,8).toLowerCase()?(t=n.substr(vr,8),vr+=8):(t=null,0===br&&s('"received"')),null!==t?(e=D(),null!==e?(r=pt(),null===r&&(r=ct()),null!==r?t=[t,e,r]:(t=null,vr=l)):(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t,e){Er.received=e}(i,t[2])),null===t&&(vr=i),t}function Hn(){var t,e,r,i,l;return i=vr,l=vr,"branch"===n.substr(vr,6).toLowerCase()?(t=n.substr(vr,6),vr+=6):(t=null,0===br&&s('"branch"')),null!==t?(e=D(),null!==e?(r=R(),null!==r?t=[t,e,r]:(t=null,vr=l)):(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t,e){Er.branch=e}(i,t[2])),null===t&&(vr=i),t}function Fn(){var t,e,r,i,o,a,u;if(o=vr,a=vr,"rport"===n.substr(vr,5).toLowerCase()?(t=n.substr(vr,5),vr+=5):(t=null,0===br&&s('"rport"')),null!==t){if(u=vr,e=D(),null!==e){for(r=[],i=l();null!==i;)r.push(i),i=l();null!==r?e=[e,r]:(e=null,vr=u)}else e=null,vr=u;e=null!==e?e:"",null!==e?t=[t,e]:(t=null,vr=a)}else t=null,vr=a;return null!==t&&(t=function(t){"undefined"!=typeof response_port&&(Er.rport=response_port.join(""))}(o)),null===t&&(vr=o),t}function Gn(){var t,e,n,r,s,i;return i=vr,t=Bn(),null!==t?(e=k(),null!==e?(n=R(),null!==n?(r=k(),null!==r?(s=Wn(),null!==s?t=[t,e,n,r,s]:(t=null,vr=i)):(t=null,vr=i)):(t=null,vr=i)):(t=null,vr=i)):(t=null,vr=i),t}function Bn(){var t,e;return e=vr,"sip"===n.substr(vr,3).toLowerCase()?(t=n.substr(vr,3),vr+=3):(t=null,0===br&&s('"SIP"')),null===t&&(t=R()),null!==t&&(t=function(t,e){Er.protocol=e}(e,t)),null===t&&(vr=e),t}function Wn(){var t,e;return e=vr,"udp"===n.substr(vr,3).toLowerCase()?(t=n.substr(vr,3),vr+=3):(t=null,0===br&&s('"UDP"')),null===t&&("tcp"===n.substr(vr,3).toLowerCase()?(t=n.substr(vr,3),vr+=3):(t=null,0===br&&s('"TCP"')),null===t&&("tls"===n.substr(vr,3).toLowerCase()?(t=n.substr(vr,3),vr+=3):(t=null,0===br&&s('"TLS"')),null===t&&("sctp"===n.substr(vr,4).toLowerCase()?(t=n.substr(vr,4),vr+=4):(t=null,0===br&&s('"SCTP"')),null===t&&(t=R())))),null!==t&&(t=function(t,e){Er.transport=e}(e,t)),null===t&&(vr=e),t}function zn(){var t,e,n,r,s;return r=vr,t=Kn(),null!==t?(s=vr,e=H(),null!==e?(n=Vn(),null!==n?e=[e,n]:(e=null,vr=s)):(e=null,vr=s),e=null!==e?e:"",null!==e?t=[t,e]:(t=null,vr=r)):(t=null,vr=r),t}function Kn(){var t,e;return e=vr,t=pt(),null===t&&(t=ut(),null===t&&(t=lt())),null!==t&&(t=function(t){Er.host=n.substring(vr,t)}(e)),null===t&&(vr=e),t}function Vn(){var t,e,n,r,s,i,o;return i=vr,o=vr,t=l(),t=null!==t?t:"",null!==t?(e=l(),e=null!==e?e:"",null!==e?(n=l(),n=null!==n?n:"",null!==n?(r=l(),r=null!==r?r:"",null!==r?(s=l(),s=null!==s?s:"",null!==s?t=[t,e,n,r,s]:(t=null,vr=o)):(t=null,vr=o)):(t=null,vr=o)):(t=null,vr=o)):(t=null,vr=o),null!==t&&(t=function(t,e){Er.port=parseInt(e.join(""))}(i,t)),null===t&&(vr=i),t}function Jn(){var t,e,n,r,s;return r=vr,s=vr,t=l(),null!==t?(e=l(),e=null!==e?e:"",null!==e?(n=l(),n=null!==n?n:"",null!==n?t=[t,e,n]:(t=null,vr=s)):(t=null,vr=s)):(t=null,vr=s),null!==t&&(t=function(t,e){return parseInt(e.join(""))}(r,t)),null===t&&(vr=r),t}function Yn(){var t;return t=en()}function $n(){var t,e,n,r,s,i;if(s=vr,t=Xn(),null!==t){for(e=[],i=vr,n=j(),null!==n?(r=Qn(),null!==r?n=[n,r]:(n=null,vr=i)):(n=null,vr=i);null!==n;)e.push(n),i=vr,n=j(),null!==n?(r=Qn(),null!==r?n=[n,r]:(n=null,vr=i)):(n=null,vr=i);null!==e?t=[t,e]:(t=null,vr=s)}else t=null,vr=s;return t}function Xn(){var t,e;return e=vr,t=Se(),null!==t&&(t=function(t,e){Er.expires=e}(e,t)),null===t&&(vr=e),t}function Qn(){var t;return t=Zn(),null===t&&(t=Ae()),t}function Zn(){var t,e,r,i,l;return i=vr,l=vr,"refresher"===n.substr(vr,9).toLowerCase()?(t=n.substr(vr,9),vr+=9):(t=null,0===br&&s('"refresher"')),null!==t?(e=D(),null!==e?("uac"===n.substr(vr,3).toLowerCase()?(r=n.substr(vr,3),vr+=3):(r=null,0===br&&s('"uac"')),null===r&&("uas"===n.substr(vr,3).toLowerCase()?(r=n.substr(vr,3),vr+=3):(r=null,0===br&&s('"uas"'))),null!==r?t=[t,e,r]:(t=null,vr=l)):(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t,e){Er.refresher=e.toLowerCase()}(i,t[2])),null===t&&(vr=i),t}function tr(){var t,e,n,r;return r=vr,t=R(),null!==t?(e=y(),null!==e?(n=er(),null!==n?t=[t,e,n]:(t=null,vr=r)):(t=null,vr=r)):(t=null,vr=r),t}function er(){var t,e;for(t=[],e=S(),null===e&&(e=A(),null===e&&(e=b()));null!==e;)t.push(e),e=S(),null===e&&(e=A(),null===e&&(e=b()));return t}function nr(){var t,e;for(t=[],e=c();null!==e;)t.push(e),e=c();return t}function rr(){var t,e,r;return r=vr,"uuid:"===n.substr(vr,5)?(t="uuid:",vr+=5):(t=null,0===br&&s('"uuid:"')),null!==t?(e=sr(),null!==e?t=[t,e]:(t=null,vr=r)):(t=null,vr=r),t}function sr(){var t,e,r,i,l,o,a,u,c,d,h;return d=vr,h=vr,t=lr(),null!==t?(45===n.charCodeAt(vr)?(e="-",vr++):(e=null,0===br&&s('"-"')),null!==e?(r=ir(),null!==r?(45===n.charCodeAt(vr)?(i="-",vr++):(i=null,0===br&&s('"-"')),null!==i?(l=ir(),null!==l?(45===n.charCodeAt(vr)?(o="-",vr++):(o=null,0===br&&s('"-"')),null!==o?(a=ir(),null!==a?(45===n.charCodeAt(vr)?(u="-",vr++):(u=null,0===br&&s('"-"')),null!==u?(c=or(),null!==c?t=[t,e,r,i,l,o,a,u,c]:(t=null,vr=h)):(t=null,vr=h)):(t=null,vr=h)):(t=null,vr=h)):(t=null,vr=h)):(t=null,vr=h)):(t=null,vr=h)):(t=null,vr=h)):(t=null,vr=h),null!==t&&(t=function(t,e){Er=n.substring(vr+5,t)}(d,t[0])),null===t&&(vr=d),t}function ir(){var t,e,n,r,s;return s=vr,t=a(),null!==t?(e=a(),null!==e?(n=a(),null!==n?(r=a(),null!==r?t=[t,e,n,r]:(t=null,vr=s)):(t=null,vr=s)):(t=null,vr=s)):(t=null,vr=s),t}function lr(){var t,e,n;return n=vr,t=ir(),null!==t?(e=ir(),null!==e?t=[t,e]:(t=null,vr=n)):(t=null,vr=n),t}function or(){var t,e,n,r;return r=vr,t=ir(),null!==t?(e=ir(),null!==e?(n=ir(),null!==n?t=[t,e,n]:(t=null,vr=r)):(t=null,vr=r)):(t=null,vr=r),t}function ar(){var t,e,n,r,s,i,l;if(s=vr,i=vr,t=Y(),null===t&&(t=ve()),null!==t){for(e=[],l=vr,n=j(),null!==n?(r=Ae(),null!==r?n=[n,r]:(n=null,vr=l)):(n=null,vr=l);null!==n;)e.push(n),l=vr,n=j(),null!==n?(r=Ae(),null!==r?n=[n,r]:(n=null,vr=l)):(n=null,vr=l);null!==e?t=[t,e]:(t=null,vr=i)}else t=null,vr=i;return null!==t&&(t=function(t){try{Er=new Sr(Er.uri,Er.display_name,Er.params)}catch(e){Er=-1}}(s)),null===t&&(vr=s),t}function ur(){var t,e,n,r,s,i;if(s=vr,t=cr(),null!==t){for(e=[],i=vr,n=j(),null!==n?(r=dr(),null!==r?n=[n,r]:(n=null,vr=i)):(n=null,vr=i);null!==n;)e.push(n),i=vr,n=j(),null!==n?(r=dr(),null!==r?n=[n,r]:(n=null,vr=i)):(n=null,vr=i);null!==e?t=[t,e]:(t=null,vr=s)}else t=null,vr=s;return t}function cr(){var t,e,r,i,l,o;return i=vr,l=vr,t=O(),null!==t?(o=vr,64===n.charCodeAt(vr)?(e="@",vr++):(e=null,0===br&&s('"@"')),null!==e?(r=O(),null!==r?e=[e,r]:(e=null,vr=o)):(e=null,vr=o),e=null!==e?e:"",null!==e?t=[t,e]:(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t){Er.call_id=n.substring(vr,t)}(i)),null===t&&(vr=i),t}function dr(){var t;return t=hr(),null===t&&(t=pr(),null===t&&(t=fr(),null===t&&(t=Ae()))),t}function hr(){var t,e,r,i,l;return i=vr,l=vr,"to-tag"===n.substr(vr,6)?(t="to-tag",vr+=6):(t=null,0===br&&s('"to-tag"')),null!==t?(e=D(),null!==e?(r=R(),null!==r?t=[t,e,r]:(t=null,vr=l)):(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t,e){Er.to_tag=e}(i,t[2])),null===t&&(vr=i),t}function pr(){var t,e,r,i,l;return i=vr,l=vr,"from-tag"===n.substr(vr,8)?(t="from-tag",vr+=8):(t=null,0===br&&s('"from-tag"')),null!==t?(e=D(),null!==e?(r=R(),null!==r?t=[t,e,r]:(t=null,vr=l)):(t=null,vr=l)):(t=null,vr=l),null!==t&&(t=function(t,e){Er.from_tag=e}(i,t[2])),null===t&&(vr=i),t}function fr(){var t,e;return e=vr,"early-only"===n.substr(vr,10)?(t="early-only",vr+=10):(t=null,0===br&&s('"early-only"')),null!==t&&(t=function(t){Er.early_only=!0}(e)),null===t&&(vr=e),t}function mr(t){t.sort();for(var e=null,n=[],r=0;r<t.length;r++)t[r]!==e&&(n.push(t[r]),e=t[r]);return n}function gr(){for(var t=1,e=1,r=!1,s=0;s<Math.max(vr,Tr);s++){var i=n.charAt(s);"\n"===i?(r||t++,e=1,r=!1):"\r"===i||"\u2028"===i||"\u2029"===i?(t++,e=1,r=!0):(e++,r=!1)}return{line:t,column:e}}var _r={CRLF:i,DIGIT:l,ALPHA:o,HEXDIG:a,WSP:u,OCTET:c,DQUOTE:d,SP:h,HTAB:p,alphanum:f,reserved:m,unreserved:g,mark:_,escaped:v,LWS:b,SWS:T,HCOLON:y,TEXT_UTF8_TRIM:C,TEXT_UTF8char:S,UTF8_NONASCII:E,UTF8_CONT:A,LHEX:w,token:R,token_nodot:x,separators:I,word:O,STAR:N,SLASH:k,EQUAL:D,LPAREN:L,RPAREN:U,RAQUOT:M,LAQUOT:P,COMMA:q,SEMI:j,COLON:H,LDQUOT:F,RDQUOT:G,comment:B,ctext:W,quoted_string:z,quoted_string_clean:K,qdtext:V,quoted_pair:J,SIP_URI_noparams:Y,SIP_URI:$,uri_scheme:X,uri_scheme_sips:Q,uri_scheme_sip:Z,userinfo:tt,user:et,user_unreserved:nt,password:rt,hostport:st,host:it,hostname:lt,domainlabel:ot,toplabel:at,IPv6reference:ut,IPv6address:ct,h16:dt,ls32:ht,IPv4address:pt,dec_octet:ft,port:mt,uri_parameters:gt,uri_parameter:_t,transport_param:vt,user_param:bt,method_param:Tt,ttl_param:yt,maddr_param:Ct,lr_param:St,other_param:Et,pname:At,pvalue:wt,paramchar:Rt,param_unreserved:xt,headers:It,header:Ot,hname:Nt,hvalue:kt,hnv_unreserved:Dt,Request_Response:Lt,Request_Line:Ut,Request_URI:Mt,absoluteURI:Pt,hier_part:qt,net_path:jt,abs_path:Ht,opaque_part:Ft,uric:Gt,uric_no_slash:Bt,path_segments:Wt,segment:zt,param:Kt,pchar:Vt,scheme:Jt,authority:Yt,srvr:$t,reg_name:Xt,query:Qt,SIP_Version:Zt,INVITEm:te,ACKm:ee,OPTIONSm:ne,BYEm:re,CANCELm:se,REGISTERm:ie,SUBSCRIBEm:le,NOTIFYm:oe,REFERm:ae,Method:ue,Status_Line:ce,Status_Code:de,extension_code:he,Reason_Phrase:pe,Allow_Events:fe,Call_ID:me,Contact:ge,contact_param:_e,name_addr:ve,display_name:be,contact_params:Te,c_p_q:ye,c_p_expires:Ce,delta_seconds:Se,qvalue:Ee,generic_param:Ae,gen_value:we,Content_Disposition:Re,disp_type:xe,disp_param:Ie,handling_param:Oe,Content_Encoding:Ne,Content_Length:ke,Content_Type:De,media_type:Le,m_type:Ue,discrete_type:Me,composite_type:Pe,extension_token:qe,x_token:je,m_subtype:He,m_parameter:Fe,m_value:Ge,CSeq:Be,CSeq_value:We,Expires:ze,Event:Ke,event_type:Ve,From:Je,from_param:Ye,tag_param:$e,Max_Forwards:Xe,Min_Expires:Qe,Name_Addr_Header:Ze,Proxy_Authenticate:tn,challenge:en,other_challenge:nn,auth_param:rn,digest_cln:sn,realm:ln,realm_value:on,domain:an,URI:un,nonce:cn,nonce_value:dn,opaque:hn,stale:pn,algorithm:fn,qop_options:mn,qop_value:gn,Proxy_Require:_n,Record_Route:vn,rec_route:bn,Reason:Tn,reason_param:yn,reason_cause:Cn,Require:Sn,Route:En,route_param:An,Subscription_State:wn,substate_value:Rn,subexp_params:xn,event_reason_value:In,Subject:On,Supported:Nn,To:kn,to_param:Dn,Via:Ln,via_param:Un,via_params:Mn,via_ttl:Pn,via_maddr:qn,via_received:jn,via_branch:Hn,response_port:Fn,sent_protocol:Gn,protocol_name:Bn,transport:Wn,sent_by:zn,via_host:Kn,via_port:Vn,ttl:Jn,WWW_Authenticate:Yn,Session_Expires:$n,s_e_expires:Xn,s_e_params:Qn,s_e_refresher:Zn,extension_header:tr,header_value:er,message_body:nr,uuid_URI:rr,uuid:sr,hex4:ir,hex8:lr,hex12:or,Refer_To:ar,Replaces:ur,call_id:cr,replaces_param:dr,to_tag:hr,from_tag:pr,early_flag:fr};if(void 0!==r){if(void 0===_r[r])throw new Error("Invalid rule name: "+e(r)+".")}else r="CRLF";var vr=0,br=0,Tr=0,yr=[],Cr=t("./URI"),Sr=t("./NameAddrHeader"),Er={},Ar=_r[r]();if(null===Ar||vr!==n.length){var wr=Math.max(vr,Tr),Rr=wr<n.length?n.charAt(wr):null,xr=gr();return new this.SyntaxError(mr(yr),Rr,wr,xr.line,xr.column),-1}return Er},toSource:function(){return this._source}};return n.SyntaxError=function(t,n,r,s,i){function l(t,n){var r,s;switch(t.length){case 0:r="end of input";break;case 1:r=t[0];break;default:r=t.slice(0,t.length-1).join(", ")+" or "+t[t.length-1]}return s=n?e(n):"end of input","Expected "+r+" but "+s+" found."}this.name="SyntaxError",this.expected=t,this.found=n,this.message=l(t,n),this.offset=r,this.line=s,this.column=i},n.SyntaxError.prototype=Error.prototype,n}()},{"./NameAddrHeader":9,"./URI":24}],7:[function(t,e,n){var r=t("debug")("JsSIP"),s=t("../package.json");r("version %s",s.version);var i=t("rtcninja"),l=t("./Constants"),o=t("./Exceptions"),a=t("./Utils"),u=t("./UA"),c=t("./URI"),d=t("./NameAddrHeader"),h=t("./Grammar"),p=t("./Socket"),f=t("./WebSocketInterface"),m=e.exports={C:l,Exceptions:o,Utils:a,UA:u,URI:c,NameAddrHeader:d,Socket:p,WebSocketInterface:f,Grammar:h,debug:t("debug"),rtcninja:i};Object.defineProperties(m,{name:{get:function(){return s.title}},version:{get:function(){return s.version}}})},{"../package.json":47,"./Constants":1,"./Exceptions":5,"./Grammar":6,"./NameAddrHeader":9,"./Socket":19,"./UA":23,"./URI":24,"./Utils":25,"./WebSocketInterface":26,debug:33,rtcninja:38}],8:[function(t,e,n){function r(t){this.ua=t,this.data={},i.EventEmitter.call(this)}e.exports=r;var s=t("util"),i=t("events"),l=t("./Constants"),o=t("./SIPMessage"),a=t("./Utils"),u=t("./RequestSender"),c=t("./Transactions"),d=t("./Exceptions");s.inherits(r,i.EventEmitter),r.prototype.send=function(t,e,n){var r,s,i,a,c,d=t;if(void 0===t||void 0===e)throw new TypeError("Not enough arguments");if(t=this.ua.normalizeTarget(t),!t)throw new TypeError("Invalid target: "+d);n=n||{},c=n.extraHeaders&&n.extraHeaders.slice()||[],a=n.eventHandlers||{},i=n.contentType||"text/plain",this.content_type=i;for(s in a)this.on(s,a[s]);this.closed=!1,this.ua.applicants[this]=this,c.push("Content-Type: "+i),this.request=new o.OutgoingRequest(l.MESSAGE,t,this.ua,null,c),e?(this.request.body=e,this.content=e):this.content=null,r=new u(this,this.ua),this.newMessage("local",this.request),r.send()},r.prototype.receiveResponse=function(t){var e;if(!this.closed)switch(!0){case/^1[0-9]{2}$/.test(t.status_code):break;case/^2[0-9]{2}$/.test(t.status_code):delete this.ua.applicants[this],this.emit("succeeded",{originator:"remote",response:t});break;default:delete this.ua.applicants[this],e=a.sipErrorCause(t.status_code),this.emit("failed",{originator:"remote",response:t,cause:e})}},r.prototype.onRequestTimeout=function(){this.closed||this.emit("failed",{originator:"system",cause:l.causes.REQUEST_TIMEOUT})},r.prototype.onTransportError=function(){this.closed||this.emit("failed",{originator:"system",cause:l.causes.CONNECTION_ERROR})},r.prototype.close=function(){this.closed=!0,delete this.ua.applicants[this]},r.prototype.init_incoming=function(t){var e;this.request=t,this.content_type=t.getHeader("Content-Type"),t.body?this.content=t.body:this.content=null,this.newMessage("remote",t),e=this.ua.transactions.nist[t.via_branch],!e||e.state!==c.C.STATUS_TRYING&&e.state!==c.C.STATUS_PROCEEDING||t.reply(200)},r.prototype.accept=function(t){t=t||{};var e=t.extraHeaders&&t.extraHeaders.slice()||[],n=t.body;if("incoming"!==this.direction)throw new d.NotSupportedError('"accept" not supported for outgoing Message');this.request.reply(200,null,e,n)},r.prototype.reject=function(t){t=t||{};var e=t.status_code||480,n=t.reason_phrase,r=t.extraHeaders&&t.extraHeaders.slice()||[],s=t.body;if("incoming"!==this.direction)throw new d.NotSupportedError('"reject" not supported for outgoing Message');if(300>e||e>=700)throw new TypeError("Invalid status_code: "+e);this.request.reply(e,n,r,s)},r.prototype.newMessage=function(t,e){"remote"===t?(this.direction="incoming",this.local_identity=e.to,this.remote_identity=e.from):"local"===t&&(this.direction="outgoing",this.local_identity=e.from,this.remote_identity=e.to),this.ua.newMessage({originator:t,message:this,request:e})}},{"./Constants":1,"./Exceptions":5,"./RequestSender":17,"./SIPMessage":18,"./Transactions":21,"./Utils":25,events:28,util:32}],9:[function(t,e,n){function r(t,e,n){var r;if(!(t&&t instanceof s))throw new TypeError('missing or invalid "uri" parameter');this.uri=t,this.parameters={};for(r in n)this.setParam(r,n[r]);Object.defineProperties(this,{display_name:{get:function(){return e},set:function(t){e=0===t?"0":t}}})}e.exports=r;var s=t("./URI"),i=t("./Grammar");r.prototype={setParam:function(t,e){t&&(this.parameters[t.toLowerCase()]="undefined"==typeof e||null===e?null:e.toString())},getParam:function(t){return t?this.parameters[t.toLowerCase()]:void 0},hasParam:function(t){return t?this.parameters.hasOwnProperty(t.toLowerCase())&&!0||!1:void 0},deleteParam:function(t){var e;return t=t.toLowerCase(),this.parameters.hasOwnProperty(t)?(e=this.parameters[t],delete this.parameters[t],e):void 0},clearParams:function(){this.parameters={}},clone:function(){return new r(this.uri.clone(),this.display_name,JSON.parse(JSON.stringify(this.parameters)))},toString:function(){var t,e;t=this.display_name||0===this.display_name?'"'+this.display_name+'" ':"",t+="<"+this.uri.toString()+">";for(e in this.parameters)t+=";"+e,null!==this.parameters[e]&&(t+="="+this.parameters[e]);return t}},r.parse=function(t){return t=i.parse(t,"Name_Addr_Header"),-1!==t?t:void 0}},{"./Grammar":6,"./URI":24}],10:[function(t,e,n){function r(t,e){var n=e,r=0,s=0;if(t.substring(n,n+2).match(/(^\r\n)/))return-2;for(;0===r;){if(s=t.indexOf("\r\n",n),-1===s)return s;!t.substring(s+2,s+4).match(/(^\r\n)/)&&t.charAt(s+2).match(/(^\s+)/)?n=s+2:r=s}return r}function s(t,e,n,r){var s,i,l,u,c=e.indexOf(":",n),d=e.substring(n,c).trim(),h=e.substring(c+1,r).trim();switch(d.toLowerCase()){case"via":case"v":t.addHeader("via",h),1===t.getHeaders("via").length?(u=t.parseHeader("Via"),u&&(t.via=u,t.via_branch=u.branch)):u=0;break;case"from":case"f":t.setHeader("from",h),u=t.parseHeader("from"),u&&(t.from=u,t.from_tag=u.getParam("tag"));break;case"to":case"t":t.setHeader("to",h),u=t.parseHeader("to"),u&&(t.to=u,t.to_tag=u.getParam("tag"));break;case"record-route":for(u=o.parse(h,"Record_Route"),-1===u&&(u=void 0),l=u.length,i=0;l>i;i++)s=u[i],t.addHeader("record-route",h.substring(s.possition,s.offset)),t.headers["Record-Route"][t.getHeaders("record-route").length-1].parsed=s.parsed;break;case"call-id":case"i":t.setHeader("call-id",h),u=t.parseHeader("call-id"),u&&(t.call_id=h);break;case"contact":case"m":for(u=o.parse(h,"Contact"),-1===u&&(u=void 0),l=u.length,i=0;l>i;i++)s=u[i],t.addHeader("contact",h.substring(s.possition,s.offset)),t.headers.Contact[t.getHeaders("contact").length-1].parsed=s.parsed;break;case"content-length":case"l":t.setHeader("content-length",h),u=t.parseHeader("content-length");break;case"content-type":case"c":t.setHeader("content-type",h),u=t.parseHeader("content-type");break;case"cseq":t.setHeader("cseq",h),u=t.parseHeader("cseq"),u&&(t.cseq=u.value),t instanceof a.IncomingResponse&&(t.method=u.method);break;case"max-forwards":t.setHeader("max-forwards",h),u=t.parseHeader("max-forwards");break;case"www-authenticate":t.setHeader("www-authenticate",h),u=t.parseHeader("www-authenticate");break;case"proxy-authenticate":t.setHeader("proxy-authenticate",h),u=t.parseHeader("proxy-authenticate");break;case"session-expires":case"x":t.setHeader("session-expires",h),u=t.parseHeader("session-expires"),u&&(t.session_expires=u.expires,t.session_expires_refresher=u.refresher);break;case"refer-to":case"r":t.setHeader("refer-to",h),u=t.parseHeader("refer-to"),u&&(t.refer_to=u);break;case"replaces":t.setHeader("replaces",h),u=t.parseHeader("replaces"),u&&(t.replaces=u);break;case"event":case"o":t.setHeader("event",h),u=t.parseHeader("event"),u&&(t.event=u);break;default:t.setHeader(d,h),u=0}return void 0!==u||{error:'error parsing header "'+d+'"'}}var i={};e.exports=i;var l=t("debug")("JsSIP:ERROR:Parser");l.log=console.warn.bind(console);var o=t("./Grammar"),a=t("./SIPMessage");i.parseMessage=function(t,e){var n,i,u,c,d,h=0,p=t.indexOf("\r\n");if(-1===p)return void l("parseMessage() | no CRLF found, not a SIP message");if(i=t.substring(0,p),d=o.parse(i,"Request_Response"),-1===d)return void l('parseMessage() | error parsing first line of SIP message: "'+i+'"');for(d.status_code?(n=new a.IncomingResponse,n.status_code=d.status_code,n.reason_phrase=d.reason_phrase):(n=new a.IncomingRequest(e),n.method=d.method,n.ruri=d.uri),n.data=t,h=p+2;;){if(p=r(t,h),-2===p){c=h+2;break}if(-1===p)return void l("parseMessage() | malformed message");if(d=s(n,t,h,p),d!==!0)return void l("parseMessage() |",d.error);h=p+2}return n.hasHeader("content-length")?(u=n.getHeader("content-length"),n.body=t.substr(c,u)):n.body=t.substring(c),n}},{"./Grammar":6,"./SIPMessage":18,debug:33}],11:[function(t,e,n){function r(t){F("new"),this.ua=t,this.status=q.STATUS_NULL,this.dialog=null,this.earlyDialogs={},this.connection=null,this.is_confirmed=!1,this.late_sdp=!1,this.rtcOfferConstraints=null,this.rtcAnswerConstraints=null,this.localMediaStream=null,this.localMediaStreamLocallyGenerated=!1,this.rtcReady=!0,this.timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null},this.direction=null,this.local_identity=null,this.remote_identity=null,this.start_time=null,this.end_time=null,this.tones=null,this.audioMuted=!1,this.videoMuted=!1,this.localHold=!1,this.remoteHold=!1,this.sessionTimers={enabled:this.ua.configuration.session_timers,defaultExpires:z.SESSION_EXPIRES,currentExpires:null,running:!1,refresher:!1,timer:null},this.referSubscribers={},this.data={},H.EventEmitter.call(this)}function s(t,e){var n=this,r=Y.T1;this.timers.invite2xxTimer=setTimeout(function s(){n.status===q.STATUS_WAITING_FOR_ACK&&(t.reply(200,null,["Contact: "+n.contact],e),r<Y.T2&&(r=2*r,r>Y.T2&&(r=Y.T2)),n.timers.invite2xxTimer=setTimeout(s,r))},r)}function i(){var t=this;this.timers.ackTimer=setTimeout(function(){t.status===q.STATUS_WAITING_FOR_ACK&&(F("no ACK received, terminating the session"),clearTimeout(t.timers.invite2xxTimer),b.call(t,z.BYE),k.call(t,"remote",null,z.causes.NO_ACK))},Y.TIMER_H)}function l(t,e){var n=this;this.connection=new B.RTCPeerConnection(t,e),this.connection.onaddstream=function(t,e){n.emit("addstream",{stream:e})},this.connection.onremovestream=function(t,e){n.emit("removestream",{stream:e})},this.connection.oniceconnectionstatechange=function(t,e){n.emit("iceconnectionstatechange",{state:e}),"failed"===e&&n.terminate({cause:z.causes.RTP_TIMEOUT,status_code:200,reason_phrase:z.causes.RTP_TIMEOUT})}}function o(t,e,n,r){function s(r){l.onicecandidate=function(n,r){if(!r){if(l.onicecandidate=null,i.rtcReady=!0,e){var s={originator:"local",type:t,sdp:l.localDescription.sdp};i.emit("sdp",s),e(s.sdp)}e=null}},l.setLocalDescription(r,function(){if("complete"===l.iceGatheringState){if(i.rtcReady=!0,e){var n={originator:"local",type:t,sdp:l.localDescription.sdp};i.emit("sdp",n),e(n.sdp)}e=null}},function(t){i.rtcReady=!0,n&&n(t)})}F("createLocalDescription()");var i=this,l=this.connection;if(this.rtcReady=!1,"offer"===t)l.createOffer(s,function(t){i.rtcReady=!0,n&&n(t)},r);else{if("answer"!==t)throw new Error('createLocalDescription() | type must be "offer" or "answer", but "'+t+'" was given');l.createAnswer(s,function(t){i.rtcReady=!0,n&&n(t)},r)}}function a(t,e,n){var r,s,i="UAS"===e?t.to_tag:t.from_tag,l="UAS"===e?t.from_tag:t.to_tag,o=t.call_id+i+l;return s=this.earlyDialogs[o],n?!!s||(s=new X(this,t,e,X.C.STATUS_EARLY),s.error?(F(s.error),D.call(this,"remote",t,z.causes.INTERNAL_ERROR),!1):(this.earlyDialogs[o]=s,!0)):(this.from_tag=t.from_tag,this.to_tag=t.to_tag,s?(s.update(t,e),this.dialog=s,delete this.earlyDialogs[o],!0):(r=new X(this,t,e),r.error?(F(r.error),D.call(this,"remote",t,z.causes.INTERNAL_ERROR),!1):(this.dialog=r,!0)))}function u(t){function e(e){e=e||{},f=!0;var n=e.status_code||403,r=e.reason_phrase||"",s=e.extraHeaders&&e.extraHeaders.slice()||[];if(this.status!==q.STATUS_CONFIRMED)return!1;if(300>n||n>=700)throw new TypeError("Invalid status_code: "+n);t.reply(n,r,s)}function n(){r(function(e){var n=["Contact: "+d.contact];C.call(d,t,n),d.late_sdp&&(e=T.call(d,e)),t.reply(200,null,n,e,function(){d.status=q.STATUS_WAITING_FOR_ACK,s.call(d,t,e),i.call(d)}),"function"==typeof m.callback&&m.callback()},function(){t.reply(500)})}function r(t,e){d.late_sdp?o.call(d,"offer",t,e,d.rtcOfferConstraints):(d.remoteHold===!0&&p===!1?(d.remoteHold=!1,U.call(d,"remote")):d.remoteHold===!1&&p===!0&&(d.remoteHold=!0,L.call(d,"remote")),o.call(d,"answer",t,e,d.rtcAnswerConstraints))}F("receiveReinvite()");var l,a,u,c,d=this,h=t.getHeader("Content-Type"),p=!1,f=!1,m={request:t,callback:void 0,reject:e.bind(this)};if(this.emit("reinvite",m),!f)if(t.body){if(this.late_sdp=!1,"application/sdp"!==h)return F("invalid Content-Type"),void t.reply(415);for(l=t.parseSDP(),a=0;a<l.media.length;a++)if(c=l.media[a],-1!==rt.indexOf(c.type)){if(u=c.direction||l.direction||"sendrecv","sendonly"!==u&&"inactive"!==u){p=!1;break}p=!0}var g={originator:"remote",type:"offer",sdp:t.body};this.emit("sdp",g),this.connection.setRemoteDescription(new B.RTCSessionDescription({type:"offer",sdp:g.sdp}),n,function(){t.reply(488)})}else this.late_sdp=!0,n()}function c(t){function e(e){e=e||{},u=!0;var n=e.status_code||403,r=e.reason_phrase||"",s=e.extraHeaders&&e.extraHeaders.slice()||[];if(this.status!==q.STATUS_CONFIRMED)return!1;if(300>n||n>=700)throw new TypeError("Invalid status_code: "+n);t.reply(n,r,s)}F("receiveUpdate()");var n,r,s,i,l=this,a=t.getHeader("Content-Type"),u=!1,c=!1,d={request:t,callback:void 0,reject:e.bind(this)};if(this.emit("update",d),!u){if(!t.body){var h=[];return C.call(this,t,h),void t.reply(200,null,h)}if("application/sdp"!==a)return F("invalid Content-Type"),void t.reply(415);for(n=t.parseSDP(),r=0;r<n.media.length;r++)if(i=n.media[r],-1!==rt.indexOf(i.type)){if(s=i.direction||n.direction||"sendrecv","sendonly"!==s&&"inactive"!==s){c=!1;break}c=!0}var p={originator:"remote",type:"offer",sdp:t.body};this.emit("sdp",p),this.connection.setRemoteDescription(new B.RTCSessionDescription({type:"offer",sdp:p.sdp}),function(){l.remoteHold===!0&&c===!1?(l.remoteHold=!1,U.call(l,"remote")):l.remoteHold===!1&&c===!0&&(l.remoteHold=!0,L.call(l,"remote")),o.call(l,"answer",function(e){var n=["Contact: "+l.contact];C.call(l,t,n),t.reply(200,null,n,e),"function"==typeof d.callback&&d.callback()},function(){t.reply(500)})},function(){t.reply(488)},this.rtcAnswerConstraints)}}function d(t){function e(e,n){var i,l;return n=n||{},e="function"==typeof e?e:null,(this.status===q.STATUS_WAITING_FOR_ACK||this.status===q.STATUS_CONFIRMED)&&(i=new r(this.ua),i.on("progress",function(t){s.notify(t.response.status_code,t.response.reason_phrase)}),i.on("accepted",function(t){s.notify(t.response.status_code,t.response.reason_phrase)}),i.on("failed",function(t){t.message?s.notify(t.message.status_code,t.message.reason_phrase):s.notify(487,t.cause)}),t.refer_to.uri.hasHeader("replaces")&&(l=decodeURIComponent(t.refer_to.uri.getHeader("replaces")),n.extraHeaders=n.extraHeaders||[],n.extraHeaders.push("Replaces: "+l)),void i.connect(t.refer_to.uri.toAor(),n,e))}function n(){s.notify(603)}F("receiveRefer()");var s,i=this;return void 0===typeof t.refer_to?(F("no Refer-To header field present in REFER"),void t.reply(400)):t.refer_to.uri.scheme!==z.SIP?(F("Refer-To header field points to a non-SIP URI scheme"),void t.reply(416)):(t.reply(202),s=new et(this,t.cseq),void this.emit("refer",{request:t,accept:function(t,n){e.call(i,t,n)},reject:function(){n.call(i)}}))}function h(t){switch(F("receiveNotify()"),void 0===typeof t.event&&t.reply(400),t.event.event){case"refer":var e=t.event.params.id,n=this.referSubscribers[e];if(!n)return void t.reply(481,"Subscription does not exist");n.receiveNotify(t),t.reply(200);break;default:t.reply(489)}}function p(t){function e(e){var n;return(this.status===q.STATUS_WAITING_FOR_ACK||this.status===q.STATUS_CONFIRMED)&&(n=new r(this.ua),n.on("confirmed",function(){s.terminate()}),void n.init_incoming(t,e))}function n(){F("Replaced INVITE rejected by the user"),t.reply(486)}F("receiveReplaces()");var s=this;this.emit("replaces",{request:t,accept:function(t){e.call(s,t)},reject:function(){n.call(s)}})}function f(t,e,n){function r(t){a.status!==q.STATUS_TERMINATED&&(a.localMediaStream=t,t&&a.connection.addStream(t),a.emit("peerconnection",{peerconnection:a.connection}),x.call(a,a.request),o.call(a,"offer",i,l,e))}function s(){a.status!==q.STATUS_TERMINATED&&D.call(a,"local",null,z.causes.USER_DENIED_MEDIA_ACCESS)}function i(t){a.isCanceled||a.status===q.STATUS_TERMINATED||(a.request.body=t,a.status=q.STATUS_INVITE_SENT,a.emit("sending",{request:a.request}),u.send())}function l(){a.status!==q.STATUS_TERMINATED&&D.call(a,"system",null,z.causes.WEBRTC_ERROR)}var a=this,u=new Q(a,this.ua);this.receiveResponse=function(t){m.call(a,t)},n?setTimeout(function(){r(n)}):t.audio||t.video?(this.localMediaStreamLocallyGenerated=!0,B.getUserMedia(t,r,s)):r(null)}function m(t){F("receiveInviteResponse()");var e,n,r,s=this;if(this.dialog&&t.status_code>=200&&t.status_code<=299)return this.dialog.id.call_id===t.call_id&&this.dialog.id.local_tag===t.from_tag&&this.dialog.id.remote_tag===t.to_tag?void b.call(this,z.ACK):(n=new X(this,t,"UAC"),void 0!==n.error?void F(n.error):(n.sendRequest({owner:{status:q.STATUS_TERMINATED},onRequestTimeout:function(){},onTransportError:function(){},onDialogError:function(){},receiveResponse:function(){}},z.ACK),void n.sendRequest({owner:{status:q.STATUS_TERMINATED},onRequestTimeout:function(){},onTransportError:function(){},onDialogError:function(){},receiveResponse:function(){}},z.BYE)));if(this.isCanceled)return this.isCanceled=!1,void(t.status_code>=100&&t.status_code<200?this.request.cancel(this.cancelReason):t.status_code>=200&&t.status_code<299&&v.call(this,t));if(this.status===q.STATUS_INVITE_SENT||this.status===q.STATUS_1XX_RECEIVED)switch(!0){case/^100$/.test(t.status_code):this.status=q.STATUS_1XX_RECEIVED;break;case/^1[0-9]{2}$/.test(t.status_code):if(!t.to_tag){F("1xx response received without to tag");break}if(t.hasHeader("contact")&&!a.call(this,t,"UAC",!0))break;if(this.status=q.STATUS_1XX_RECEIVED,I.call(this,"remote",t),!t.body)break;r={originator:"remote",type:"pranswer",sdp:t.body},this.emit("sdp",r),this.connection.setRemoteDescription(new B.RTCSessionDescription({type:"pranswer",sdp:r.sdp}),null,null);break;case/^2[0-9]{2}$/.test(t.status_code):if(this.status=q.STATUS_CONFIRMED,!t.body){v.call(this,t,400,z.causes.MISSING_SDP),D.call(this,"remote",t,z.causes.BAD_MEDIA_DESCRIPTION);break}if(!a.call(this,t,"UAC"))break;r={originator:"remote",type:"answer",sdp:t.body},this.emit("sdp",r),this.connection.setRemoteDescription(new B.RTCSessionDescription({type:"answer",sdp:r.sdp}),function(){S.call(s,t),O.call(s,"remote",t),b.call(s,z.ACK),N.call(s,"local",null)},function(){v.call(s,t,488,"Not Acceptable Here"),D.call(s,"remote",t,z.causes.BAD_MEDIA_DESCRIPTION)});break;default:e=J.sipErrorCause(t.status_code),D.call(this,"remote",t,e)}}function g(t){function e(t){if(r.status!==q.STATUS_TERMINATED&&(b.call(r,z.ACK),!a)){if(S.call(r,t),!t.body)return void n();
if("application/sdp"!==t.getHeader("Content-Type"))return void n();var e={originator:"remote",type:"answer",sdp:t.body};r.emit("sdp",e),r.connection.setRemoteDescription(new B.RTCSessionDescription({type:"answer",sdp:e.sdp}),function(){i.succeeded&&i.succeeded(t)},function(){n()})}}function n(t){i.failed&&i.failed(t)}F("sendReinvite()"),t=t||{};var r=this,s=t.extraHeaders||[],i=t.eventHandlers||{},l=t.rtcOfferConstraints||this.rtcOfferConstraints||null,a=!1;s.push("Contact: "+this.contact),s.push("Content-Type: application/sdp"),this.sessionTimers.running&&s.push("Session-Expires: "+this.sessionTimers.currentExpires+";refresher="+(this.sessionTimers.refresher?"uac":"uas")),o.call(this,"offer",function(t){t=T.call(r,t);var i=new Z(r,z.INVITE);i.send({extraHeaders:s,body:t,eventHandlers:{onSuccessResponse:function(t){e(t),a=!0},onErrorResponse:function(t){n(t)},onTransportError:function(){r.onTransportError()},onRequestTimeout:function(){r.onRequestTimeout()},onDialogError:function(){r.onDialogError()}}})},function(){n()},l)}function _(t){function e(t){if(r.status!==q.STATUS_TERMINATED&&!u)if(S.call(r,t),a){if(!t.body)return void n();if("application/sdp"!==t.getHeader("Content-Type"))return void n();var e={originator:"remote",type:"answer",sdp:t.body};r.emit("sdp",e),r.connection.setRemoteDescription(new B.RTCSessionDescription({type:"answer",sdp:e.sdp}),function(){i.succeeded&&i.succeeded(t)},function(){n()})}else i.succeeded&&i.succeeded(t)}function n(t){i.failed&&i.failed(t)}F("sendUpdate()"),t=t||{};var r=this,s=t.extraHeaders||[],i=t.eventHandlers||{},l=t.rtcOfferConstraints||this.rtcOfferConstraints||null,a=t.sdpOffer||!1,u=!1;if(s.push("Contact: "+this.contact),this.sessionTimers.running&&s.push("Session-Expires: "+this.sessionTimers.currentExpires+";refresher="+(this.sessionTimers.refresher?"uac":"uas")),a)s.push("Content-Type: application/sdp"),o.call(this,"offer",function(t){t=T.call(r,t);var i=new Z(r,z.UPDATE);i.send({extraHeaders:s,body:t,eventHandlers:{onSuccessResponse:function(t){e(t),u=!0},onErrorResponse:function(t){n(t)},onTransportError:function(){r.onTransportError()},onRequestTimeout:function(){r.onRequestTimeout()},onDialogError:function(){r.onDialogError()}}})},function(){n()},l);else{var c=new Z(r,z.UPDATE);c.send({extraHeaders:s,eventHandlers:{onSuccessResponse:function(t){e(t)},onErrorResponse:function(t){n(t)},onTransportError:function(){r.onTransportError()},onRequestTimeout:function(){r.onRequestTimeout()},onDialogError:function(){r.onDialogError()}}})}}function v(t,e,n){F("acceptAndTerminate()");var r=[];e&&(n=n||z.REASON_PHRASE[e]||"",r.push("Reason: SIP ;cause="+e+'; text="'+n+'"')),(this.dialog||a.call(this,t,"UAC"))&&(b.call(this,z.ACK),b.call(this,z.BYE,{extraHeaders:r})),this.status=q.STATUS_TERMINATED}function b(t,e){F("sendRequest()");var n=new Z(this,t);n.send(e)}function T(t){var e,n,r;if(!this.localHold&&!this.remoteHold)return t;if(t=W.parse(t),this.localHold&&!this.remoteHold)for(F("mangleOffer() | me on hold, mangling offer"),n=t.media.length,e=0;n>e;e++)r=t.media[e],-1!==rt.indexOf(r.type)&&(r.direction?"sendrecv"===r.direction?r.direction="sendonly":"recvonly"===r.direction&&(r.direction="inactive"):r.direction="sendonly");else if(this.localHold&&this.remoteHold)for(F("mangleOffer() | both on hold, mangling offer"),n=t.media.length,e=0;n>e;e++)r=t.media[e],-1!==rt.indexOf(r.type)&&(r.direction="inactive");else if(this.remoteHold)for(F("mangleOffer() | remote on hold, mangling offer"),n=t.media.length,e=0;n>e;e++)r=t.media[e],-1!==rt.indexOf(r.type)&&(r.direction?"sendrecv"===r.direction?r.direction="recvonly":"recvonly"===r.direction&&(r.direction="inactive"):r.direction="recvonly");return W.write(t)}function y(){var t=!0,e=!0;(this.localHold||this.remoteHold)&&(t=!1,e=!1),this.audioMuted&&(t=!1),this.videoMuted&&(e=!1),A.call(this,!t),w.call(this,!e)}function C(t,e){if(this.sessionTimers.enabled){var n;t.session_expires&&t.session_expires>=z.MIN_SESSION_EXPIRES?(this.sessionTimers.currentExpires=t.session_expires,n=t.session_expires_refresher||"uas"):(this.sessionTimers.currentExpires=this.sessionTimers.defaultExpires,n="uas"),e.push("Session-Expires: "+this.sessionTimers.currentExpires+";refresher="+n),this.sessionTimers.refresher="uas"===n,E.call(this)}}function S(t){if(this.sessionTimers.enabled){var e;t.session_expires&&t.session_expires>=z.MIN_SESSION_EXPIRES?(this.sessionTimers.currentExpires=t.session_expires,e=t.session_expires_refresher||"uac"):(this.sessionTimers.currentExpires=this.sessionTimers.defaultExpires,e="uac"),this.sessionTimers.refresher="uac"===e,E.call(this)}}function E(){var t=this,e=this.sessionTimers.currentExpires;this.sessionTimers.running=!0,clearTimeout(this.sessionTimers.timer),this.sessionTimers.refresher?this.sessionTimers.timer=setTimeout(function(){t.status!==q.STATUS_TERMINATED&&(F("runSessionTimer() | sending session refresh request"),_.call(t,{eventHandlers:{succeeded:function(e){S.call(t,e)}}}))},500*e):this.sessionTimers.timer=setTimeout(function(){t.status!==q.STATUS_TERMINATED&&(G("runSessionTimer() | timer expired, terminating the session"),t.terminate({cause:z.causes.REQUEST_TIMEOUT,status_code:408,reason_phrase:"Session Timer Expired"}))},1100*e)}function A(t){var e,n,r,s,i,l=this.connection.getLocalStreams();for(r=l.length,e=0;r>e;e++)for(i=l[e].getAudioTracks(),s=i.length,n=0;s>n;n++)i[n].enabled=!t}function w(t){var e,n,r,s,i,l=this.connection.getLocalStreams();for(r=l.length,e=0;r>e;e++)for(i=l[e].getVideoTracks(),s=i.length,n=0;s>n;n++)i[n].enabled=!t}function R(t,e){F("newRTCSession"),this.ua.newRTCSession({originator:t,session:this,request:e})}function x(t){F("session connecting"),this.emit("connecting",{request:t})}function I(t,e){F("session progress"),this.emit("progress",{originator:t,response:e||null})}function O(t,e){F("session accepted"),this.start_time=new Date,this.emit("accepted",{originator:t,response:e||null})}function N(t,e){F("session confirmed"),this.is_confirmed=!0,this.emit("confirmed",{originator:t,ack:e||null})}function k(t,e,n){F("session ended"),this.end_time=new Date,this.close(),this.emit("ended",{originator:t,message:e||null,cause:n})}function D(t,e,n){F("session failed"),this.close(),this.emit("failed",{originator:t,message:e||null,cause:n})}function L(t){F("session onhold"),y.call(this),this.emit("hold",{originator:t})}function U(t){F("session onunhold"),y.call(this),this.emit("unhold",{originator:t})}function M(t){F("session onmute"),y.call(this),this.emit("muted",{audio:t.audio,video:t.video})}function P(t){F("session onunmute"),y.call(this),this.emit("unmuted",{audio:t.audio,video:t.video})}e.exports=r;var q={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_ACK:6,STATUS_CANCELED:7,STATUS_TERMINATED:8,STATUS_CONFIRMED:9};r.C=q;var j=t("util"),H=t("events"),F=t("debug")("JsSIP:RTCSession"),G=t("debug")("JsSIP:ERROR:RTCSession");G.log=console.warn.bind(console);var B=t("rtcninja"),W=t("sdp-transform"),z=t("./Constants"),K=t("./Exceptions"),V=t("./Transactions"),J=t("./Utils"),Y=t("./Timers"),$=t("./SIPMessage"),X=t("./Dialog"),Q=t("./RequestSender"),Z=t("./RTCSession/Request"),tt=t("./RTCSession/DTMF"),et=t("./RTCSession/ReferNotifier"),nt=t("./RTCSession/ReferSubscriber"),rt=["audio","video"];j.inherits(r,H.EventEmitter),r.prototype.isInProgress=function(){switch(this.status){case q.STATUS_NULL:case q.STATUS_INVITE_SENT:case q.STATUS_1XX_RECEIVED:case q.STATUS_INVITE_RECEIVED:case q.STATUS_WAITING_FOR_ANSWER:return!0;default:return!1}},r.prototype.isEstablished=function(){switch(this.status){case q.STATUS_ANSWERED:case q.STATUS_WAITING_FOR_ACK:case q.STATUS_CONFIRMED:return!0;default:return!1}},r.prototype.isEnded=function(){switch(this.status){case q.STATUS_CANCELED:case q.STATUS_TERMINATED:return!0;default:return!1}},r.prototype.isMuted=function(){return{audio:this.audioMuted,video:this.videoMuted}},r.prototype.isOnHold=function(){return{local:this.localHold,remote:this.remoteHold}},r.prototype.isReadyToReOffer=function(){return this.rtcReady?this.dialog?this.dialog.uac_pending_reply!==!0&&this.dialog.uas_pending_reply!==!0||(F("isReadyToReOffer() | there is another INVITE/UPDATE transaction in progress"),!1):(F("isReadyToReOffer() | session not established yet"),!1):(F("isReadyToReOffer() | internal WebRTC status not ready"),!1)},r.prototype.connect=function(t,e,n){F("connect()"),e=e||{};var r,s,i=t,o=e.eventHandlers||{},a=e.extraHeaders&&e.extraHeaders.slice()||[],u=e.mediaConstraints||{audio:!0,video:!0},c=e.mediaStream||null,d=e.pcConfig||{iceServers:[]},h=e.rtcConstraints||null,p=e.rtcOfferConstraints||null;if(this.rtcOfferConstraints=p,this.rtcAnswerConstraints=e.rtcAnswerConstraints||null,this.sessionTimers.enabled&&J.isDecimal(e.sessionTimersExpires)&&(e.sessionTimersExpires>=z.MIN_SESSION_EXPIRES?this.sessionTimers.defaultExpires=e.sessionTimersExpires:this.sessionTimers.defaultExpires=z.SESSION_EXPIRES),this.data=e.data||this.data,void 0===t)throw new TypeError("Not enough arguments");if(!B.hasWebRTC())throw new K.NotSupportedError("WebRTC not supported");if(t=this.ua.normalizeTarget(t),!t)throw new TypeError("Invalid target: "+i);if(this.status!==q.STATUS_NULL)throw new K.InvalidStateError(this.status);for(r in o)this.on(r,o[r]);this.from_tag=J.newTag(),this.anonymous=e.anonymous||!1,this.isCanceled=!1,s={from_tag:this.from_tag},this.contact=this.ua.contact.toString({anonymous:this.anonymous,outbound:!0}),this.anonymous&&(s.from_display_name="Anonymous",s.from_uri="sip:anonymous@anonymous.invalid",a.push("P-Preferred-Identity: "+this.ua.configuration.uri.toString()),a.push("Privacy: id")),a.push("Contact: "+this.contact),a.push("Content-Type: application/sdp"),this.sessionTimers.enabled&&a.push("Session-Expires: "+this.sessionTimers.defaultExpires),this.request=new $.OutgoingRequest(z.INVITE,t,this.ua,s,a),this.id=this.request.call_id+this.from_tag,l.call(this,d,h),this.ua.sessions[this.id]=this,this.direction="outgoing",this.local_identity=this.request.from,this.remote_identity=this.request.to,n?n(this):R.call(this,"local",this.request),f.call(this,u,p,c)},r.prototype.init_incoming=function(t,e){F("init_incoming()");var n,r=this,s=t.getHeader("Content-Type");return t.body&&"application/sdp"!==s?void t.reply(415):(this.status=q.STATUS_INVITE_RECEIVED,this.from_tag=t.from_tag,this.id=t.call_id+this.from_tag,this.request=t,this.contact=this.ua.contact.toString(),this.ua.sessions[this.id]=this,t.hasHeader("expires")&&(n=1e3*t.getHeader("expires")),t.to_tag=J.newTag(),a.call(this,t,"UAS",!0)?(t.body?this.late_sdp=!1:this.late_sdp=!0,this.status=q.STATUS_WAITING_FOR_ANSWER,this.timers.userNoAnswerTimer=setTimeout(function(){t.reply(408),D.call(r,"local",null,z.causes.NO_ANSWER)},this.ua.configuration.no_answer_timeout),n&&(this.timers.expiresTimer=setTimeout(function(){r.status===q.STATUS_WAITING_FOR_ANSWER&&(t.reply(487),D.call(r,"system",null,z.causes.EXPIRES))},n)),this.direction="incoming",this.local_identity=t.to,this.remote_identity=t.from,e?e(this):R.call(this,"remote",t),void(this.status!==q.STATUS_TERMINATED&&(t.reply(180,null,["Contact: "+r.contact]),I.call(r,"local",null)))):void t.reply(500,"Missing Contact header field"))},r.prototype.answer=function(t){function e(t){if(b.status!==q.STATUS_TERMINATED)if(b.localMediaStream=t,t&&b.connection.addStream(t),b.request.body||b.emit("peerconnection",{peerconnection:b.connection}),b.late_sdp)r();else{var e={originator:"remote",type:"offer",sdp:T.body};b.emit("sdp",e),b.connection.setRemoteDescription(new B.RTCSessionDescription({type:"offer",sdp:e.sdp}),r,function(){T.reply(488),D.call(b,"system",null,z.causes.WEBRTC_ERROR)})}}function n(){b.status!==q.STATUS_TERMINATED&&(T.reply(480),D.call(b,"local",null,z.causes.USER_DENIED_MEDIA_ACCESS))}function r(){x.call(b,T),b.late_sdp?o.call(b,"offer",u,c,b.rtcOfferConstraints):o.call(b,"answer",u,c,R)}function u(t){function e(){b.status=q.STATUS_WAITING_FOR_ACK,s.call(b,T,t),i.call(b),O.call(b,"local")}function n(){D.call(b,"system",null,z.causes.CONNECTION_ERROR)}b.status!==q.STATUS_TERMINATED&&(C.call(b,T,y),T.reply(200,null,y,t,e,n))}function c(){b.status!==q.STATUS_TERMINATED&&(T.reply(500),D.call(b,"system",null,z.causes.WEBRTC_ERROR))}F("answer()"),t=t||{};var d,h,p,f,m=!1,g=!1,_=!1,v=!1,b=this,T=this.request,y=t.extraHeaders&&t.extraHeaders.slice()||[],S=t.mediaConstraints||{},E=t.mediaStream||null,A=t.pcConfig||{iceServers:[]},w=t.rtcConstraints||null,R=t.rtcAnswerConstraints||null;if(this.rtcAnswerConstraints=R,this.rtcOfferConstraints=t.rtcOfferConstraints||null,this.sessionTimers.enabled&&J.isDecimal(t.sessionTimersExpires)&&(t.sessionTimersExpires>=z.MIN_SESSION_EXPIRES?this.sessionTimers.defaultExpires=t.sessionTimersExpires:this.sessionTimers.defaultExpires=z.SESSION_EXPIRES),this.data=t.data||this.data,"incoming"!==this.direction)throw new K.NotSupportedError('"answer" not supported for outgoing RTCSession');if(this.status!==q.STATUS_WAITING_FOR_ANSWER)throw new K.InvalidStateError(this.status);if(this.status=q.STATUS_ANSWERED,!a.call(this,T,"UAS"))return void T.reply(500,"Error creating dialog");for(clearTimeout(this.timers.userNoAnswerTimer),y.unshift("Contact: "+b.contact),p=T.parseSDP(),Array.isArray(p.media)||(p.media=[p.media]),d=p.media.length;d--;){var I=p.media[d];"audio"===I.type&&(m=!0,I.direction&&"sendrecv"!==I.direction||(_=!0)),"video"===I.type&&(g=!0,I.direction&&"sendrecv"!==I.direction||(v=!0))}if(E&&S.audio===!1)for(f=E.getAudioTracks(),h=f.length,d=0;h>d;d++)E.removeTrack(f[d]);if(E&&S.video===!1)for(f=E.getVideoTracks(),h=f.length,d=0;h>d;d++)E.removeTrack(f[d]);E||void 0!==S.audio||(S.audio=_),E||void 0!==S.video||(S.video=v),E||m||(S.audio=!1),E||g||(S.video=!1),l.call(this,A,w),E?e(E):S.audio||S.video?(b.localMediaStreamLocallyGenerated=!0,B.getUserMedia(S,e,n)):e(null)},r.prototype.terminate=function(t){F("terminate()"),t=t||{};var e,n,r=t.cause||z.causes.BYE,s=t.status_code,i=t.reason_phrase,l=t.extraHeaders&&t.extraHeaders.slice()||[],o=t.body,a=this;if(this.status===q.STATUS_TERMINATED)throw new K.InvalidStateError(this.status);switch(this.status){case q.STATUS_NULL:case q.STATUS_INVITE_SENT:case q.STATUS_1XX_RECEIVED:if(F("canceling sesssion"),s&&(200>s||s>=700))throw new TypeError("Invalid status_code: "+s);s&&(i=i||z.REASON_PHRASE[s]||"",e="SIP ;cause="+s+' ;text="'+i+'"'),this.status===q.STATUS_NULL?(this.isCanceled=!0,this.cancelReason=e):this.status===q.STATUS_INVITE_SENT?(this.isCanceled=!0,this.cancelReason=e):this.status===q.STATUS_1XX_RECEIVED&&this.request.cancel(e),this.status=q.STATUS_CANCELED,D.call(this,"local",null,z.causes.CANCELED);break;case q.STATUS_WAITING_FOR_ANSWER:case q.STATUS_ANSWERED:if(F("rejecting session"),s=s||480,300>s||s>=700)throw new TypeError("Invalid status_code: "+s);this.request.reply(s,i,l,o),D.call(this,"local",null,z.causes.REJECTED);break;case q.STATUS_WAITING_FOR_ACK:case q.STATUS_CONFIRMED:if(F("terminating session"),i=t.reason_phrase||z.REASON_PHRASE[s]||"",s&&(200>s||s>=700))throw new TypeError("Invalid status_code: "+s);s&&l.push("Reason: SIP ;cause="+s+'; text="'+i+'"'),this.status===q.STATUS_WAITING_FOR_ACK&&"incoming"===this.direction&&this.request.server_transaction.state!==V.C.STATUS_TERMINATED?(n=this.dialog,this.receiveRequest=function(t){t.method===z.ACK&&(b.call(this,z.BYE,{extraHeaders:l,body:o}),n.terminate())},this.request.server_transaction.on("stateChanged",function(){this.state===V.C.STATUS_TERMINATED&&(b.call(a,z.BYE,{extraHeaders:l,body:o}),n.terminate())}),k.call(this,"local",null,r),this.dialog=n,this.ua.dialogs[n.id.toString()]=n):(b.call(this,z.BYE,{extraHeaders:l,body:o}),k.call(this,"local",null,r))}},r.prototype.close=function(){F("close()");var t;if(this.status!==q.STATUS_TERMINATED){if(this.connection)try{this.connection.close()}catch(e){G("close() | error closing the RTCPeerConnection: %o",e)}this.localMediaStream&&this.localMediaStreamLocallyGenerated&&(F("close() | closing local MediaStream"),B.closeMediaStream(this.localMediaStream));for(t in this.timers)clearTimeout(this.timers[t]);clearTimeout(this.sessionTimers.timer),this.dialog&&(this.dialog.terminate(),delete this.dialog);for(t in this.earlyDialogs)this.earlyDialogs[t].terminate(),delete this.earlyDialogs[t];this.status=q.STATUS_TERMINATED,delete this.ua.sessions[this.id]}},r.prototype.sendDTMF=function(t,e){function n(){var t,o;if(l.status===q.STATUS_TERMINATED||!l.tones||i>=l.tones.length)return void(l.tones=null);if(t=l.tones[i],i+=1,","===t)o=2e3;else{var a=new tt(l);e.eventHandlers={failed:function(){l.tones=null}},a.send(t,e),o=r+s}setTimeout(n,o)}F("sendDTMF() | tones: %s",t);var r,s,i=0,l=this;if(e=e||{},r=e.duration||null,s=e.interToneGap||null,void 0===t)throw new TypeError("Not enough arguments");if(this.status!==q.STATUS_CONFIRMED&&this.status!==q.STATUS_WAITING_FOR_ACK)throw new K.InvalidStateError(this.status);if("number"==typeof t&&(t=t.toString()),!t||"string"!=typeof t||!t.match(/^[0-9A-D#*,]+$/i))throw new TypeError("Invalid tones: "+t);if(r&&!J.isDecimal(r))throw new TypeError("Invalid tone duration: "+r);if(r?r<tt.C.MIN_DURATION?(F('"duration" value is lower than the minimum allowed, setting it to '+tt.C.MIN_DURATION+" milliseconds"),r=tt.C.MIN_DURATION):r>tt.C.MAX_DURATION?(F('"duration" value is greater than the maximum allowed, setting it to '+tt.C.MAX_DURATION+" milliseconds"),r=tt.C.MAX_DURATION):r=Math.abs(r):r=tt.C.DEFAULT_DURATION,e.duration=r,s&&!J.isDecimal(s))throw new TypeError("Invalid interToneGap: "+s);return s?s<tt.C.MIN_INTER_TONE_GAP?(F('"interToneGap" value is lower than the minimum allowed, setting it to '+tt.C.MIN_INTER_TONE_GAP+" milliseconds"),s=tt.C.MIN_INTER_TONE_GAP):s=Math.abs(s):s=tt.C.DEFAULT_INTER_TONE_GAP,this.tones?void(this.tones+=t):(this.tones=t,void n())},r.prototype.mute=function(t){F("mute()"),t=t||{audio:!0,video:!1};var e=!1,n=!1;this.audioMuted===!1&&t.audio&&(e=!0,this.audioMuted=!0,A.call(this,!0)),this.videoMuted===!1&&t.video&&(n=!0,this.videoMuted=!0,w.call(this,!0)),e!==!0&&n!==!0||M.call(this,{audio:e,video:n})},r.prototype.unmute=function(t){F("unmute()"),t=t||{audio:!0,video:!0};var e=!1,n=!1;this.audioMuted===!0&&t.audio&&(e=!0,this.audioMuted=!1,this.localHold===!1&&A.call(this,!1)),this.videoMuted===!0&&t.video&&(n=!0,this.videoMuted=!1,this.localHold===!1&&w.call(this,!1)),e!==!0&&n!==!0||P.call(this,{audio:e,video:n})},r.prototype.hold=function(t,e){F("hold()"),t=t||{};var n,r=this;return(this.status===q.STATUS_WAITING_FOR_ACK||this.status===q.STATUS_CONFIRMED)&&(this.localHold!==!0&&(!!this.isReadyToReOffer()&&(this.localHold=!0,L.call(this,"local"),n={succeeded:function(){e&&e()},failed:function(){r.terminate({cause:z.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Hold Failed"})}},t.useUpdate?_.call(this,{sdpOffer:!0,eventHandlers:n,extraHeaders:t.extraHeaders}):g.call(this,{eventHandlers:n,extraHeaders:t.extraHeaders}),!0)))},r.prototype.unhold=function(t,e){F("unhold()"),t=t||{};var n,r=this;return(this.status===q.STATUS_WAITING_FOR_ACK||this.status===q.STATUS_CONFIRMED)&&(this.localHold!==!1&&(!!this.isReadyToReOffer()&&(this.localHold=!1,U.call(this,"local"),n={succeeded:function(){e&&e()},failed:function(){r.terminate({cause:z.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Unhold Failed"})}},t.useUpdate?_.call(this,{sdpOffer:!0,eventHandlers:n,extraHeaders:t.extraHeaders}):g.call(this,{eventHandlers:n,extraHeaders:t.extraHeaders}),!0)))},r.prototype.renegotiate=function(t,e){F("renegotiate()"),t=t||{};var n,r=this,s=t.rtcOfferConstraints||null;return(this.status===q.STATUS_WAITING_FOR_ACK||this.status===q.STATUS_CONFIRMED)&&(!!this.isReadyToReOffer()&&(n={succeeded:function(){e&&e()},failed:function(){r.terminate({cause:z.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Media Renegotiation Failed"})}},y.call(this),t.useUpdate?_.call(this,{sdpOffer:!0,eventHandlers:n,rtcOfferConstraints:s,extraHeaders:t.extraHeaders}):g.call(this,{eventHandlers:n,rtcOfferConstraints:s,extraHeaders:t.extraHeaders}),!0))},r.prototype.refer=function(t,e){F("refer()");var n,r,s=this,i=t;if(this.status!==q.STATUS_WAITING_FOR_ACK&&this.status!==q.STATUS_CONFIRMED)return!1;if(t=this.ua.normalizeTarget(t),!t)throw new TypeError("Invalid target: "+i);return n=new nt(this),n.sendRefer(t,e),r=n.outgoingRequest.cseq,this.referSubscribers[r]=n,n.on("requestFailed",function(){delete s.referSubscribers[r]}),n.on("accepted",function(){delete s.referSubscribers[r]}),n.on("failed",function(){delete s.referSubscribers[r]}),n},r.prototype.receiveRequest=function(t){F("receiveRequest()");var e,n=this;if(t.method===z.CANCEL)this.status!==q.STATUS_WAITING_FOR_ANSWER&&this.status!==q.STATUS_ANSWERED||(this.status=q.STATUS_CANCELED,this.request.reply(487),D.call(this,"remote",t,z.causes.CANCELED));else switch(t.method){case z.ACK:if(this.status!==q.STATUS_WAITING_FOR_ACK)return;if(this.status=q.STATUS_CONFIRMED,clearTimeout(this.timers.ackTimer),clearTimeout(this.timers.invite2xxTimer),this.late_sdp){if(!t.body){this.terminate({cause:z.causes.MISSING_SDP,status_code:400});break}var r={originator:"remote",type:"answer",sdp:t.body};this.emit("sdp",r),this.connection.setRemoteDescription(new B.RTCSessionDescription({type:"answer",sdp:r.sdp}),function(){n.is_confirmed||N.call(n,"remote",t)},function(){n.terminate({cause:z.causes.BAD_MEDIA_DESCRIPTION,status_code:488})})}else this.is_confirmed||N.call(this,"remote",t);break;case z.BYE:this.status===q.STATUS_CONFIRMED?(t.reply(200),k.call(this,"remote",t,z.causes.BYE)):this.status===q.STATUS_INVITE_RECEIVED?(t.reply(200),this.request.reply(487,"BYE Received"),k.call(this,"remote",t,z.causes.BYE)):t.reply(403,"Wrong Status");break;case z.INVITE:this.status===q.STATUS_CONFIRMED?t.hasHeader("replaces")?p.call(this,t):u.call(this,t):t.reply(403,"Wrong Status");break;case z.INFO:this.status===q.STATUS_CONFIRMED||this.status===q.STATUS_WAITING_FOR_ACK||this.status===q.STATUS_INVITE_RECEIVED?(e=t.getHeader("content-type"),e&&e.match(/^application\/dtmf-relay/i)?new tt(this).init_incoming(t):t.reply(415)):t.reply(403,"Wrong Status");break;case z.UPDATE:this.status===q.STATUS_CONFIRMED?c.call(this,t):t.reply(403,"Wrong Status");break;case z.REFER:this.status===q.STATUS_CONFIRMED?d.call(this,t):t.reply(403,"Wrong Status");break;case z.NOTIFY:this.status===q.STATUS_CONFIRMED?h.call(this,t):t.reply(403,"Wrong Status");break;default:t.reply(501)}},r.prototype.onTransportError=function(){G("onTransportError()"),this.status!==q.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:z.causes.CONNECTION_ERROR,cause:z.causes.CONNECTION_ERROR})},r.prototype.onRequestTimeout=function(){F("onRequestTimeout"),this.status!==q.STATUS_TERMINATED&&this.terminate({status_code:408,reason_phrase:z.causes.REQUEST_TIMEOUT,cause:z.causes.REQUEST_TIMEOUT})},r.prototype.onDialogError=function(){G("onDialogError()"),this.status!==q.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:z.causes.DIALOG_ERROR,cause:z.causes.DIALOG_ERROR})},r.prototype.newDTMF=function(t){F("newDTMF()"),this.emit("newDTMF",t)},r.prototype.resetLocalMedia=function(){F("resetLocalMedia()"),this.localHold=!1,this.audioMuted=!1,this.videoMuted=!1,y.call(this)}},{"./Constants":1,"./Dialog":2,"./Exceptions":5,"./RTCSession/DTMF":12,"./RTCSession/ReferNotifier":13,"./RTCSession/ReferSubscriber":14,"./RTCSession/Request":15,"./RequestSender":17,"./SIPMessage":18,"./Timers":20,"./Transactions":21,"./Utils":25,debug:33,events:28,rtcninja:38,"sdp-transform":44,util:32}],12:[function(t,e,n){function r(t){this.owner=t,this.direction=null,this.tone=null,this.duration=null}e.exports=r;var s={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};r.C=s;var i=t("debug")("JsSIP:RTCSession:DTMF"),l=t("debug")("JsSIP:ERROR:RTCSession:DTMF");l.log=console.warn.bind(console);var o=t("../Constants"),a=t("../Exceptions"),u=t("../RTCSession");r.prototype.send=function(t,e){var n,r;if(void 0===t)throw new TypeError("Not enough arguments");if(this.direction="outgoing",this.owner.status!==u.C.STATUS_CONFIRMED&&this.owner.status!==u.C.STATUS_WAITING_FOR_ACK)throw new a.InvalidStateError(this.owner.status);if(e=e||{},n=e.extraHeaders?e.extraHeaders.slice():[],this.eventHandlers=e.eventHandlers||{},"string"==typeof t)t=t.toUpperCase();else{if("number"!=typeof t)throw new TypeError("Invalid tone: "+t);t=t.toString()}if(!t.match(/^[0-9A-D#*]$/))throw new TypeError("Invalid tone: "+t);this.tone=t,this.duration=e.duration,n.push("Content-Type: application/dtmf-relay"),r="Signal="+this.tone+"\r\n",r+="Duration="+this.duration,this.owner.newDTMF({originator:"local",dtmf:this,request:this.request}),this.owner.dialog.sendRequest(this,o.INFO,{extraHeaders:n,body:r})},r.prototype.receiveResponse=function(t){switch(!0){case/^1[0-9]{2}$/.test(t.status_code):break;case/^2[0-9]{2}$/.test(t.status_code):i("onSuccessResponse"),this.eventHandlers.onSuccessResponse&&this.eventHandlers.onSuccessResponse(t);break;default:this.eventHandlers.onErrorResponse&&this.eventHandlers.onErrorResponse(t)}},r.prototype.onRequestTimeout=function(){l("onRequestTimeout"),this.eventHandlers.onRequestTimeout&&this.eventHandlers.onRequestTimeout()},r.prototype.onTransportError=function(){l("onTransportError"),this.eventHandlers.onTransportError&&this.eventHandlers.onTransportError()},r.prototype.onDialogError=function(){l("onDialogError"),this.eventHandlers.onDialogError&&this.eventHandlers.onDialogError()},r.prototype.init_incoming=function(t){var e,n=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,r=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;this.direction="incoming",this.request=t,t.reply(200),t.body&&(e=t.body.split("\n"),e.length>=1&&n.test(e[0])&&(this.tone=e[0].replace(n,"$2")),e.length>=2&&r.test(e[1])&&(this.duration=parseInt(e[1].replace(r,"$2"),10))),this.duration||(this.duration=s.DEFAULT_DURATION),this.tone?this.owner.newDTMF({originator:"remote",dtmf:this,request:t}):i("invalid INFO DTMF received, discarded")}},{"../Constants":1,"../Exceptions":5,"../RTCSession":11,debug:33}],13:[function(t,e,n){function r(t,e,n){this.session=t,this.id=e,this.expires=n||s.expires,this.active=!0,this.notify(100)}e.exports=r;var s={event_type:"refer",body_type:"message/sipfrag;version=2.0",expires:300},i=t("debug")("JsSIP:RTCSession:ReferNotifier"),l=t("../Constants"),o=t("./Request");r.prototype.notify=function(t,e){i("notify()");var n,r=this;if(this.active!==!1){e=e||l.REASON_PHRASE[t]||"",n=t>=200?"terminated;reason=noresource":"active;expires="+this.expires;var a=new o(this.session,l.NOTIFY);a.send({extraHeaders:["Event: "+s.event_type+";id="+r.id,"Subscription-State: "+n,"Content-Type: "+s.body_type],body:"SIP/2.0 "+t+" "+e,eventHandlers:{onErrorResponse:function(){r.active=!1}}})}}},{"../Constants":1,"./Request":15,debug:33}],14:[function(t,e,n){function r(t){this.session=t,this.timer=null,this.outgoingRequest=null,o.EventEmitter.call(this)}function s(){console.log("removeSubscriber()"),clearTimeout(this.timer),this.session.referSubscriber=null}e.exports=r;var i={expires:120},l=t("util"),o=t("events"),a=t("debug")("JsSIP:RTCSession:ReferSubscriber"),u=t("../Constants"),c=t("../Grammar"),d=t("./Request");l.inherits(r,o.EventEmitter),r.prototype.sendRefer=function(t,e){a("sendRefer()");var n,r,l,o=null,c=this;e=e||{},n=e.extraHeaders?e.extraHeaders.slice():[],r=e.eventHandlers||{};for(var h in r)this.on(h,r[h]);e.replaces&&(o=e.replaces.request.call_id,o+=";to-tag="+e.replaces.to_tag,o+=";from-tag="+e.replaces.from_tag,o=encodeURIComponent(o)),l="Refer-To: <"+t+(o?"?Replaces="+o:"")+">",n.push(l);var p=new d(this.session,u.REFER);this.timer=setTimeout(function(){s.call(c)},1e3*i.expires),p.send({extraHeaders:n,eventHandlers:{onSuccessResponse:function(t){c.emit("requestSucceeded",{response:t})},onErrorResponse:function(t){c.emit("requestFailed",{response:t,cause:u.causes.REJECTED})},onTransportError:function(){s.call(c),c.emit("requestFailed",{response:null,cause:u.causes.CONNECTION_ERROR})},onRequestTimeout:function(){s.call(c),c.emit("requestFailed",{response:null,cause:u.causes.REQUEST_TIMEOUT})},onDialogError:function(){s.call(c),c.emit("requestFailed",{response:null,cause:u.causes.DIALOG_ERROR})}}}),this.outgoingRequest=p.outgoingRequest},r.prototype.receiveNotify=function(t){a("receiveNotify()");var e;if(t.body){if(e=c.parse(t.body,"Status_Line"),-1===e)return void a('receiveNotify() | error parsing NOTIFY body: "'+t.body+'"');switch(!0){case/^100$/.test(e.status_code):this.emit("trying",{request:t,status_line:e});break;case/^1[0-9]{2}$/.test(e.status_code):this.emit("progress",{request:t,status_line:e});break;case/^2[0-9]{2}$/.test(e.status_code):s.call(this),this.emit("accepted",{request:t,status_line:e});break;default:s.call(this),this.emit("failed",{request:t,status_line:e})}}}},{"../Constants":1,"../Grammar":6,"./Request":15,debug:33,events:28,util:32}],15:[function(t,e,n){function r(t,e){if(s("new | %s",e),this.session=t,this.method=e,this.outgoingRequest=null,this.session.status!==a.C.STATUS_1XX_RECEIVED&&this.session.status!==a.C.STATUS_WAITING_FOR_ANSWER&&this.session.status!==a.C.STATUS_WAITING_FOR_ACK&&this.session.status!==a.C.STATUS_CONFIRMED&&this.session.status!==a.C.STATUS_TERMINATED)throw new o.InvalidStateError(this.session.status);if(this.session.status===a.C.STATUS_TERMINATED&&e!==l.BYE)throw new o.InvalidStateError(this.session.status)}e.exports=r;var s=t("debug")("JsSIP:RTCSession:Request"),i=t("debug")("JsSIP:ERROR:RTCSession:Request");i.log=console.warn.bind(console);var l=t("../Constants"),o=t("../Exceptions"),a=t("../RTCSession");r.prototype.send=function(t){t=t||{};var e=t.extraHeaders&&t.extraHeaders.slice()||[],n=t.body||null;this.eventHandlers=t.eventHandlers||{},this.outgoingRequest=this.session.dialog.sendRequest(this,this.method,{extraHeaders:e,body:n})},r.prototype.receiveResponse=function(t){switch(!0){case/^1[0-9]{2}$/.test(t.status_code):s("onProgressResponse"),this.eventHandlers.onProgressResponse&&this.eventHandlers.onProgressResponse(t);break;case/^2[0-9]{2}$/.test(t.status_code):s("onSuccessResponse"),this.eventHandlers.onSuccessResponse&&this.eventHandlers.onSuccessResponse(t);break;default:s("onErrorResponse"),this.eventHandlers.onErrorResponse&&this.eventHandlers.onErrorResponse(t)}},r.prototype.onRequestTimeout=function(){i("onRequestTimeout"),this.eventHandlers.onRequestTimeout&&this.eventHandlers.onRequestTimeout()},r.prototype.onTransportError=function(){i("onTransportError"),this.eventHandlers.onTransportError&&this.eventHandlers.onTransportError()},r.prototype.onDialogError=function(){i("onDialogError"),this.eventHandlers.onDialogError&&this.eventHandlers.onDialogError()}},{"../Constants":1,"../Exceptions":5,"../RTCSession":11,debug:33}],16:[function(t,e,n){function r(t,e){var n=1;this.ua=t,this.transport=e,this.registrar=t.configuration.registrar_server,this.expires=t.configuration.register_expires,this.call_id=i.createRandomToken(22),this.cseq=0,this.to_uri=t.configuration.uri,this.registrationTimer=null,this.registered=!1,this.contact=this.ua.contact.toString(),this.contact+=";+sip.ice",this.extraHeaders=[],this.extraContactParams="",n&&(this.contact+=";reg-id="+n,this.contact+=';+sip.instance="<urn:uuid:'+this.ua.configuration.instance_id+'>"')}e.exports=r;var s=t("debug")("JsSIP:Registrator"),i=t("./Utils"),l=t("./Constants"),o=t("./SIPMessage"),a=t("./RequestSender");r.prototype={setExtraHeaders:function(t){Array.isArray(t)||(t=[]),this.extraHeaders=t.slice()},setExtraContactParams:function(t){t instanceof Object||(t={}),this.extraContactParams="";for(var e in t){var n=t[e];this.extraContactParams+=";"+e,n&&(this.extraContactParams+="="+n)}},register:function(){var t,e,n,r=this;n=this.extraHeaders.slice(),n.push("Contact: "+this.contact+";expires="+this.expires+this.extraContactParams),n.push("Expires: "+this.expires),this.request=new o.OutgoingRequest(l.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,
call_id:this.call_id,cseq:this.cseq+=1},n),t=new a(this,this.ua),this.receiveResponse=function(t){var n,o,a=t.getHeaders("contact").length;if(t.cseq===this.cseq)switch(null!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=null),!0){case/^1[0-9]{2}$/.test(t.status_code):break;case/^2[0-9]{2}$/.test(t.status_code):if(t.hasHeader("expires")&&(o=t.getHeader("expires")),!a){s("no Contact header in response to REGISTER, response ignored");break}for(;a--;){if(n=t.parseHeader("contact",a),n.uri.user===this.ua.contact.uri.user){o=n.getParam("expires");break}n=null}if(!n){s("no Contact header pointing to us, response ignored");break}o||(o=this.expires),this.registrationTimer=setTimeout(function(){r.registrationTimer=null,r.register()},1e3*o-3e3),n.hasParam("temp-gruu")&&(this.ua.contact.temp_gruu=n.getParam("temp-gruu").replace(/"/g,"")),n.hasParam("pub-gruu")&&(this.ua.contact.pub_gruu=n.getParam("pub-gruu").replace(/"/g,"")),this.registered||(this.registered=!0,this.ua.registered({response:t}));break;case/^423$/.test(t.status_code):t.hasHeader("min-expires")?(this.expires=t.getHeader("min-expires"),this.register()):(s("423 response received for REGISTER without Min-Expires"),this.registrationFailure(t,l.causes.SIP_FAILURE_CODE));break;default:e=i.sipErrorCause(t.status_code),this.registrationFailure(t,e)}},this.onRequestTimeout=function(){this.registrationFailure(null,l.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.registrationFailure(null,l.causes.CONNECTION_ERROR)},t.send()},unregister:function(t){var e;if(!this.registered)return void s("already unregistered");t=t||{},this.registered=!1,null!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=null),e=this.extraHeaders.slice(),t.all?(e.push("Contact: *"+this.extraContactParams),e.push("Expires: 0"),this.request=new o.OutgoingRequest(l.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},e)):(e.push("Contact: "+this.contact+";expires=0"+this.extraContactParams),e.push("Expires: 0"),this.request=new o.OutgoingRequest(l.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},e));var n=new a(this,this.ua);this.receiveResponse=function(t){var e;switch(!0){case/^1[0-9]{2}$/.test(t.status_code):break;case/^2[0-9]{2}$/.test(t.status_code):this.unregistered(t);break;default:e=i.sipErrorCause(t.status_code),this.unregistered(t,e)}},this.onRequestTimeout=function(){this.unregistered(null,l.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.unregistered(null,l.causes.CONNECTION_ERROR)},n.send()},registrationFailure:function(t,e){this.ua.registrationFailed({response:t||null,cause:e}),this.registered&&(this.registered=!1,this.ua.unregistered({response:t||null,cause:e}))},unregistered:function(t,e){this.registered=!1,this.ua.unregistered({response:t||null,cause:e||null})},onTransportClosed:function(){null!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=null),this.registered&&(this.registered=!1,this.ua.unregistered({}))},close:function(){this.registered&&this.unregister()}}},{"./Constants":1,"./RequestSender":17,"./SIPMessage":18,"./Utils":25,debug:33}],17:[function(t,e,n){function r(t,e){this.ua=e,this.applicant=t,this.method=t.request.method,this.request=t.request,this.auth=null,this.challenged=!1,this.staled=!1,e.status!==l.C.STATUS_USER_CLOSED||this.method===i.BYE&&this.method===i.ACK||this.onTransportError()}e.exports=r;var s=t("debug")("JsSIP:RequestSender"),i=t("./Constants"),l=t("./UA"),o=t("./DigestAuthentication"),a=t("./Transactions");r.prototype={send:function(){switch(this.method){case"INVITE":this.clientTransaction=new a.InviteClientTransaction(this,this.request,this.ua.transport);break;case"ACK":this.clientTransaction=new a.AckClientTransaction(this,this.request,this.ua.transport);break;default:this.clientTransaction=new a.NonInviteClientTransaction(this,this.request,this.ua.transport)}this.clientTransaction.send()},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(t){var e,n,r,l=t.status_code;if(401!==l&&407!==l||null===this.ua.configuration.password&&null===this.ua.configuration.ha1)this.applicant.receiveResponse(t);else{if(401===t.status_code?(n=t.parseHeader("www-authenticate"),r="authorization"):(n=t.parseHeader("proxy-authenticate"),r="proxy-authorization"),!n)return s(t.status_code+" with wrong or missing challenge, cannot authenticate"),void this.applicant.receiveResponse(t);if(!this.challenged||!this.staled&&n.stale===!0){if(this.auth||(this.auth=new o({username:this.ua.configuration.authorization_user,password:this.ua.configuration.password,realm:this.ua.configuration.realm,ha1:this.ua.configuration.ha1})),!this.auth.authenticate(this.request,n))return void this.applicant.receiveResponse(t);this.challenged=!0,this.ua.set("realm",this.auth.get("realm")),this.ua.set("ha1",this.auth.get("ha1")),n.stale&&(this.staled=!0),e=t.method===i.REGISTER?this.applicant.cseq+=1:this.request.dialog?this.request.dialog.local_seqnum+=1:this.request.cseq+1,this.request=this.request.clone(),this.request.cseq=e,this.request.setHeader("cseq",e+" "+this.method),this.request.setHeader(r,this.auth.toString()),this.send()}else this.applicant.receiveResponse(t)}}}},{"./Constants":1,"./DigestAuthentication":4,"./Transactions":21,"./UA":23,debug:33}],18:[function(t,e,n){function r(t,e,n,r,s,i){var l,o,a,h;return r=r||{},t&&e&&n?(this.ua=n,this.headers={},this.method=t,this.ruri=e,this.body=i,this.extraHeaders=s&&s.slice()||[],r.route_set?this.setHeader("route",r.route_set):n.configuration.use_preloaded_route&&this.setHeader("route","<"+n.transport.sip_uri+";lr>"),this.setHeader("via",""),this.setHeader("max-forwards",u.MAX_FORWARDS),l=r.to_display_name||0===r.to_display_name?'"'+r.to_display_name+'" ':"",l+="<"+(r.to_uri||e)+">",l+=r.to_tag?";tag="+r.to_tag:"",this.to=new d.parse(l),this.setHeader("to",l),o=r.from_display_name||0===r.from_display_name?'"'+r.from_display_name+'" ':n.configuration.display_name?'"'+n.configuration.display_name+'" ':"",o+="<"+(r.from_uri||n.configuration.uri)+">;tag=",o+=r.from_tag||c.newTag(),this.from=new d.parse(o),this.setHeader("from",o),a=r.call_id||n.configuration.jssip_id+c.createRandomToken(15),this.call_id=a,this.setHeader("call-id",a),h=r.cseq||Math.floor(1e4*Math.random()),this.cseq=h,void this.setHeader("cseq",h+" "+t)):null}function s(){this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null,this.sdp=null}function i(t){this.ua=t,this.headers={},this.ruri=null,this.transport=null,this.server_transaction=null}function l(){this.headers={},this.status_code=null,this.reason_phrase=null}e.exports={OutgoingRequest:r,IncomingRequest:i,IncomingResponse:l};var o=t("debug")("JsSIP:SIPMessage"),a=t("sdp-transform"),u=t("./Constants"),c=t("./Utils"),d=t("./NameAddrHeader"),h=t("./Grammar");r.prototype={setHeader:function(t,e){var n,r;for(n=new RegExp("^\\s*"+t+"\\s*:","i"),r=0;r<this.extraHeaders.length;r++)n.test(this.extraHeaders[r])&&this.extraHeaders.splice(r,1);this.headers[c.headerize(t)]=Array.isArray(e)?e:[e]},getHeader:function(t){var e,n,r=this.extraHeaders.length,s=this.headers[c.headerize(t)];if(s){if(s[0])return s[0]}else for(e=new RegExp("^\\s*"+t+"\\s*:","i"),n=0;r>n;n++)if(s=this.extraHeaders[n],e.test(s))return s.substring(s.indexOf(":")+1).trim()},getHeaders:function(t){var e,n,r,s=this.headers[c.headerize(t)],i=[];if(s){for(n=s.length,e=0;n>e;e++)i.push(s[e]);return i}for(n=this.extraHeaders.length,r=new RegExp("^\\s*"+t+"\\s*:","i"),e=0;n>e;e++)s=this.extraHeaders[e],r.test(s)&&i.push(s.substring(s.indexOf(":")+1).trim());return i},hasHeader:function(t){var e,n,r=this.extraHeaders.length;if(this.headers[c.headerize(t)])return!0;for(e=new RegExp("^\\s*"+t+"\\s*:","i"),n=0;r>n;n++)if(e.test(this.extraHeaders[n]))return!0;return!1},parseSDP:function(t){return!t&&this.sdp?this.sdp:(this.sdp=a.parse(this.body||""),this.sdp)},toString:function(){var t,e,n,r="",s=[];r+=this.method+" "+this.ruri+" SIP/2.0\r\n";for(t in this.headers)for(e=this.headers[t].length,n=0;e>n;n++)r+=t+": "+this.headers[t][n]+"\r\n";for(e=this.extraHeaders.length,n=0;e>n;n++)r+=this.extraHeaders[n].trim()+"\r\n";switch(this.method){case u.REGISTER:s.push("path","gruu");break;case u.INVITE:this.ua.configuration.session_timers&&s.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&s.push("gruu"),s.push("ice","replaces");break;case u.UPDATE:this.ua.configuration.session_timers&&s.push("timer"),s.push("ice")}return s.push("outbound"),r+="Allow: "+u.ALLOWED_METHODS+"\r\n",r+="Supported: "+s+"\r\n",r+="User-Agent: "+u.USER_AGENT+"\r\n",this.body?(e=c.str_utf8_length(this.body),r+="Content-Length: "+e+"\r\n\r\n",r+=this.body):r+="Content-Length: 0\r\n\r\n",r},clone:function(){var t=new r(this.method,this.ruri,this.ua);return Object.keys(this.headers).forEach(function(e){t.headers[e]=this.headers[e].slice()},this),t.body=this.body,t.extraHeaders=this.extraHeaders&&this.extraHeaders.slice()||[],t.to=this.to,t.from=this.from,t.call_id=this.call_id,t.cseq=this.cseq,t}},s.prototype={addHeader:function(t,e){var n={raw:e};t=c.headerize(t),this.headers[t]?this.headers[t].push(n):this.headers[t]=[n]},getHeader:function(t){var e=this.headers[c.headerize(t)];if(e)return e[0]?e[0].raw:void 0},getHeaders:function(t){var e,n,r=this.headers[c.headerize(t)],s=[];if(!r)return[];for(n=r.length,e=0;n>e;e++)s.push(r[e].raw);return s},hasHeader:function(t){return!!this.headers[c.headerize(t)]},parseHeader:function(t,e){var n,r,s;return t=c.headerize(t),e=e||0,this.headers[t]?e>=this.headers[t].length?void o('not so many "'+t+'" headers present'):(n=this.headers[t][e],r=n.raw,n.parsed?n.parsed:(s=h.parse(r,t.replace(/-/g,"_")),-1===s?(this.headers[t].splice(e,1),void o('error parsing "'+t+'" header field with value "'+r+'"')):(n.parsed=s,s))):void o('header "'+t+'" not present')},s:function(t,e){return this.parseHeader(t,e)},setHeader:function(t,e){var n={raw:e};this.headers[c.headerize(t)]=[n]},parseSDP:function(t){return!t&&this.sdp?this.sdp:(this.sdp=a.parse(this.body||""),this.sdp)},toString:function(){return this.data}},i.prototype=new s,i.prototype.reply=function(t,e,n,r,s,i){var l,o,a,d,h,p=[],f=this.getHeader("To"),m=0,g=0;if(t=t||null,e=e||null,!t||100>t||t>699)throw new TypeError("Invalid status_code: "+t);if(e&&"string"!=typeof e&&!(e instanceof String))throw new TypeError("Invalid reason_phrase: "+e);if(e=e||u.REASON_PHRASE[t]||"",n=n&&n.slice()||[],h="SIP/2.0 "+t+" "+e+"\r\n",this.method===u.INVITE&&t>100&&200>=t)for(l=this.getHeaders("record-route"),a=l.length,m;a>m;m++)h+="Record-Route: "+l[m]+"\r\n";for(o=this.getHeaders("via"),a=o.length,g;a>g;g++)h+="Via: "+o[g]+"\r\n";for(!this.to_tag&&t>100?f+=";tag="+c.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(f+=";tag="+this.to_tag),h+="To: "+f+"\r\n",h+="From: "+this.getHeader("From")+"\r\n",h+="Call-ID: "+this.call_id+"\r\n",h+="CSeq: "+this.cseq+" "+this.method+"\r\n",a=n.length,d=0;a>d;d++)h+=n[d].trim()+"\r\n";switch(this.method){case u.INVITE:this.ua.configuration.session_timers&&p.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&p.push("gruu"),p.push("ice","replaces");break;case u.UPDATE:this.ua.configuration.session_timers&&p.push("timer"),r&&p.push("ice"),p.push("replaces")}p.push("outbound"),this.method===u.OPTIONS?(h+="Allow: "+u.ALLOWED_METHODS+"\r\n",h+="Accept: "+u.ACCEPTED_BODY_TYPES+"\r\n"):405===t?h+="Allow: "+u.ALLOWED_METHODS+"\r\n":415===t&&(h+="Accept: "+u.ACCEPTED_BODY_TYPES+"\r\n"),h+="Supported: "+p+"\r\n",r?(a=c.str_utf8_length(r),h+="Content-Type: application/sdp\r\n",h+="Content-Length: "+a+"\r\n\r\n",h+=r):h+="Content-Length: 0\r\n\r\n",this.server_transaction.receiveResponse(t,h,s,i)},i.prototype.reply_sl=function(t,e){var n,r,s=0,i=this.getHeaders("via"),l=i.length;if(t=t||null,e=e||null,!t||100>t||t>699)throw new TypeError("Invalid status_code: "+t);if(e&&"string"!=typeof e&&!(e instanceof String))throw new TypeError("Invalid reason_phrase: "+e);for(e=e||u.REASON_PHRASE[t]||"",r="SIP/2.0 "+t+" "+e+"\r\n",s;l>s;s++)r+="Via: "+i[s]+"\r\n";n=this.getHeader("To"),!this.to_tag&&t>100?n+=";tag="+c.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(n+=";tag="+this.to_tag),r+="To: "+n+"\r\n",r+="From: "+this.getHeader("From")+"\r\n",r+="Call-ID: "+this.call_id+"\r\n",r+="CSeq: "+this.cseq+" "+this.method+"\r\n",r+="Content-Length: 0\r\n\r\n",this.transport.send(r)},l.prototype=new s},{"./Constants":1,"./Grammar":6,"./NameAddrHeader":9,"./Utils":25,debug:33,"sdp-transform":44}],19:[function(t,e,n){function r(){}e.exports=r;var s=t("./Utils"),i=t("./Grammar"),l=t("debug")("JsSIP:ERROR:Socket");r.isSocket=function(t){if("undefined"==typeof t)return l("undefined JsSIP.Socket instance"),!1;try{if(!s.isString(t.url))throw l("missing or invalid JsSIP.Socket url property"),new Error;if(!s.isString(t.via_transport))throw l("missing or invalid JsSIP.Socket via_transport property"),new Error;if(-1===i.parse(t.sip_uri,"SIP_URI"))throw l("missing or invalid JsSIP.Socket sip_uri property"),new Error}catch(e){return!1}try{["connect","disconnect","send"].forEach(function(e){if(!s.isFunction(t[e]))throw l("missing or invalid JsSIP.Socket method: "+e),new Error})}catch(e){return!1}return!0}},{"./Grammar":6,"./Utils":25,debug:33}],20:[function(t,e,n){var r=500,s=4e3,i=5e3,l={T1:r,T2:s,T4:i,TIMER_B:64*r,TIMER_D:0*r,TIMER_F:64*r,TIMER_H:64*r,TIMER_I:0*r,TIMER_J:0*r,TIMER_K:0*i,TIMER_L:64*r,TIMER_M:64*r,PROVISIONAL_RESPONSE_INTERVAL:6e4};e.exports=l},{}],21:[function(t,e,n){function r(t,e,n){var r;this.type=u.NON_INVITE_CLIENT,this.transport=n,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=t,this.request=e,r="SIP/2.0/"+n.via_transport,r+=" "+t.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",r),this.request_sender.ua.newTransaction(this),d.EventEmitter.call(this)}function s(t,e,n){var r,s=this;this.type=u.INVITE_CLIENT,this.transport=n,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=t,this.request=e,r="SIP/2.0/"+n.via_transport,r+=" "+t.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",r),this.request_sender.ua.newTransaction(this),this.request.cancel=function(t){s.cancel_request(s,t)},d.EventEmitter.call(this)}function i(t,e,n){var r;this.transport=n,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=t,this.request=e,r="SIP/2.0/"+n.via_transport,r+=" "+t.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",r),d.EventEmitter.call(this)}function l(t,e){this.type=u.NON_INVITE_SERVER,this.id=t.via_branch,this.request=t,this.transport=t.transport,this.ua=e,this.last_response="",t.server_transaction=this,this.state=u.STATUS_TRYING,e.newTransaction(this),d.EventEmitter.call(this)}function o(t,e){this.type=u.INVITE_SERVER,this.id=t.via_branch,this.request=t,this.transport=t.transport,this.ua=e,this.last_response="",t.server_transaction=this,this.state=u.STATUS_PROCEEDING,e.newTransaction(this),this.resendProvisionalTimer=null,t.reply(100),d.EventEmitter.call(this)}function a(t,e){var n;switch(e.method){case _.INVITE:if(n=t.transactions.ist[e.via_branch]){switch(n.state){case u.STATUS_PROCEEDING:n.transport.send(n.last_response);break;case u.STATUS_ACCEPTED:}return!0}break;case _.ACK:if(n=t.transactions.ist[e.via_branch],!n)return!1;if(n.state===u.STATUS_ACCEPTED)return!1;if(n.state===u.STATUS_COMPLETED)return n.state=u.STATUS_CONFIRMED,n.I=setTimeout(function(){n.timer_I()},v.TIMER_I),!0;break;case _.CANCEL:return n=t.transactions.ist[e.via_branch],n?(e.reply_sl(200),n.state!==u.STATUS_PROCEEDING):(e.reply_sl(481),!0);default:if(n=t.transactions.nist[e.via_branch]){switch(n.state){case u.STATUS_TRYING:break;case u.STATUS_PROCEEDING:case u.STATUS_COMPLETED:n.transport.send(n.last_response)}return!0}}}e.exports={C:null,NonInviteClientTransaction:r,InviteClientTransaction:s,AckClientTransaction:i,NonInviteServerTransaction:l,InviteServerTransaction:o,checkTransaction:a};var u={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"};e.exports.C=u;var c=t("util"),d=t("events"),h=t("debug")("JsSIP:NonInviteClientTransaction"),p=t("debug")("JsSIP:InviteClientTransaction"),f=t("debug")("JsSIP:AckClientTransaction"),m=t("debug")("JsSIP:NonInviteServerTransaction"),g=t("debug")("JsSIP:InviteServerTransaction"),_=t("./Constants"),v=t("./Timers");c.inherits(r,d.EventEmitter),r.prototype.stateChanged=function(t){this.state=t,this.emit("stateChanged")},r.prototype.send=function(){var t=this;this.stateChanged(u.STATUS_TRYING),this.F=setTimeout(function(){t.timer_F()},v.TIMER_F),this.transport.send(this.request)||this.onTransportError()},r.prototype.onTransportError=function(){h("transport error occurred, deleting transaction "+this.id),clearTimeout(this.F),clearTimeout(this.K),this.stateChanged(u.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onTransportError()},r.prototype.timer_F=function(){h("Timer F expired for transaction "+this.id),this.stateChanged(u.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout()},r.prototype.timer_K=function(){this.stateChanged(u.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},r.prototype.receiveResponse=function(t){var e=this,n=t.status_code;if(200>n)switch(this.state){case u.STATUS_TRYING:case u.STATUS_PROCEEDING:this.stateChanged(u.STATUS_PROCEEDING),this.request_sender.receiveResponse(t)}else switch(this.state){case u.STATUS_TRYING:case u.STATUS_PROCEEDING:this.stateChanged(u.STATUS_COMPLETED),clearTimeout(this.F),408===n?this.request_sender.onRequestTimeout():this.request_sender.receiveResponse(t),this.K=setTimeout(function(){e.timer_K()},v.TIMER_K);break;case u.STATUS_COMPLETED:}},c.inherits(s,d.EventEmitter),s.prototype.stateChanged=function(t){this.state=t,this.emit("stateChanged")},s.prototype.send=function(){var t=this;this.stateChanged(u.STATUS_CALLING),this.B=setTimeout(function(){t.timer_B()},v.TIMER_B),this.transport.send(this.request)||this.onTransportError()},s.prototype.onTransportError=function(){clearTimeout(this.B),clearTimeout(this.D),clearTimeout(this.M),this.state!==u.STATUS_ACCEPTED&&(p("transport error occurred, deleting transaction "+this.id),this.request_sender.onTransportError()),this.stateChanged(u.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},s.prototype.timer_M=function(){p("Timer M expired for transaction "+this.id),this.state===u.STATUS_ACCEPTED&&(clearTimeout(this.B),this.stateChanged(u.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this))},s.prototype.timer_B=function(){p("Timer B expired for transaction "+this.id),this.state===u.STATUS_CALLING&&(this.stateChanged(u.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout())},s.prototype.timer_D=function(){p("Timer D expired for transaction "+this.id),clearTimeout(this.B),this.stateChanged(u.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},s.prototype.sendACK=function(t){var e=this;this.ack="ACK "+this.request.ruri+" SIP/2.0\r\n",this.ack+="Via: "+this.request.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.ack+="Route: "+this.request.headers.Route.toString()+"\r\n"),this.ack+="To: "+t.getHeader("to")+"\r\n",this.ack+="From: "+this.request.headers.From.toString()+"\r\n",this.ack+="Call-ID: "+this.request.headers["Call-ID"].toString()+"\r\n",this.ack+="CSeq: "+this.request.headers.CSeq.toString().split(" ")[0],this.ack+=" ACK\r\n",this.ack+="Content-Length: 0\r\n\r\n",this.D=setTimeout(function(){e.timer_D()},v.TIMER_D),this.transport.send(this.ack)},s.prototype.cancel_request=function(t,e){var n=t.request;this.cancel=_.CANCEL+" "+n.ruri+" SIP/2.0\r\n",this.cancel+="Via: "+n.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.cancel+="Route: "+n.headers.Route.toString()+"\r\n"),this.cancel+="To: "+n.headers.To.toString()+"\r\n",this.cancel+="From: "+n.headers.From.toString()+"\r\n",this.cancel+="Call-ID: "+n.headers["Call-ID"].toString()+"\r\n",this.cancel+="CSeq: "+n.headers.CSeq.toString().split(" ")[0]+" CANCEL\r\n",e&&(this.cancel+="Reason: "+e+"\r\n"),this.cancel+="Content-Length: 0\r\n\r\n",this.state===u.STATUS_PROCEEDING&&this.transport.send(this.cancel)},s.prototype.receiveResponse=function(t){var e=this,n=t.status_code;if(n>=100&&199>=n)switch(this.state){case u.STATUS_CALLING:this.stateChanged(u.STATUS_PROCEEDING),this.request_sender.receiveResponse(t);break;case u.STATUS_PROCEEDING:this.request_sender.receiveResponse(t)}else if(n>=200&&299>=n)switch(this.state){case u.STATUS_CALLING:case u.STATUS_PROCEEDING:this.stateChanged(u.STATUS_ACCEPTED),this.M=setTimeout(function(){e.timer_M()},v.TIMER_M),this.request_sender.receiveResponse(t);break;case u.STATUS_ACCEPTED:this.request_sender.receiveResponse(t)}else if(n>=300&&699>=n)switch(this.state){case u.STATUS_CALLING:case u.STATUS_PROCEEDING:this.stateChanged(u.STATUS_COMPLETED),this.sendACK(t),this.request_sender.receiveResponse(t);break;case u.STATUS_COMPLETED:this.sendACK(t)}},c.inherits(i,d.EventEmitter),i.prototype.send=function(){this.transport.send(this.request)||this.onTransportError()},i.prototype.onTransportError=function(){f("transport error occurred for transaction "+this.id),this.request_sender.onTransportError()},c.inherits(l,d.EventEmitter),l.prototype.stateChanged=function(t){this.state=t,this.emit("stateChanged")},l.prototype.timer_J=function(){m("Timer J expired for transaction "+this.id),this.stateChanged(u.STATUS_TERMINATED),this.ua.destroyTransaction(this)},l.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,m("transport error occurred, deleting transaction "+this.id),clearTimeout(this.J),this.stateChanged(u.STATUS_TERMINATED),this.ua.destroyTransaction(this))},l.prototype.receiveResponse=function(t,e,n,r){var s=this;if(100===t)switch(this.state){case u.STATUS_TRYING:this.stateChanged(u.STATUS_PROCEEDING),this.transport.send(e)||this.onTransportError();break;case u.STATUS_PROCEEDING:this.last_response=e,this.transport.send(e)?n&&n():(this.onTransportError(),r&&r())}else if(t>=200&&699>=t)switch(this.state){case u.STATUS_TRYING:case u.STATUS_PROCEEDING:this.stateChanged(u.STATUS_COMPLETED),this.last_response=e,this.J=setTimeout(function(){s.timer_J()},v.TIMER_J),this.transport.send(e)?n&&n():(this.onTransportError(),r&&r());break;case u.STATUS_COMPLETED:}},c.inherits(o,d.EventEmitter),o.prototype.stateChanged=function(t){this.state=t,this.emit("stateChanged")},o.prototype.timer_H=function(){g("Timer H expired for transaction "+this.id),this.state===u.STATUS_COMPLETED&&g("ACK not received, dialog will be terminated"),this.stateChanged(u.STATUS_TERMINATED),this.ua.destroyTransaction(this)},o.prototype.timer_I=function(){this.stateChanged(u.STATUS_TERMINATED)},o.prototype.timer_L=function(){g("Timer L expired for transaction "+this.id),this.state===u.STATUS_ACCEPTED&&(this.stateChanged(u.STATUS_TERMINATED),this.ua.destroyTransaction(this))},o.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,g("transport error occurred, deleting transaction "+this.id),null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),clearTimeout(this.L),clearTimeout(this.H),clearTimeout(this.I),this.stateChanged(u.STATUS_TERMINATED),this.ua.destroyTransaction(this))},o.prototype.resend_provisional=function(){this.transport.send(this.last_response)||this.onTransportError()},o.prototype.receiveResponse=function(t,e,n,r){var s=this;if(t>=100&&199>=t)switch(this.state){case u.STATUS_PROCEEDING:this.transport.send(e)||this.onTransportError(),this.last_response=e}if(t>100&&199>=t&&this.state===u.STATUS_PROCEEDING)null===this.resendProvisionalTimer&&(this.resendProvisionalTimer=setInterval(function(){s.resend_provisional()},v.PROVISIONAL_RESPONSE_INTERVAL));else if(t>=200&&299>=t)switch(this.state){case u.STATUS_PROCEEDING:this.stateChanged(u.STATUS_ACCEPTED),this.last_response=e,this.L=setTimeout(function(){s.timer_L()},v.TIMER_L),null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null);case u.STATUS_ACCEPTED:this.transport.send(e)?n&&n():(this.onTransportError(),r&&r())}else if(t>=300&&699>=t)switch(this.state){case u.STATUS_PROCEEDING:null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(e)?(this.stateChanged(u.STATUS_COMPLETED),this.H=setTimeout(function(){s.timer_H()},v.TIMER_H),n&&n()):(this.onTransportError(),r&&r())}}},{"./Constants":1,"./Timers":20,debug:33,events:28,util:32}],22:[function(t,e,n){function r(t,e){if(c("new()"),this.status=h.STATUS_DISCONNECTED,this.socket=null,this.sockets=[],this.recovery_options=e||h.recovery_options,this.recover_attempts=0,this.recovery_timer=null,this.close_requested=!1,"undefined"==typeof t)throw new TypeError("Invalid argument. undefined 'sockets' argument");t instanceof Array||(t=[t]),t.forEach(function(t){if(!u.isSocket(t.socket))throw new TypeError("Invalid argument. invalid 'JsSIP.Socket' instance");if(t.weight&&!Number(t.weight))throw new TypeError("Invalid argument. 'weight' attribute is not a number");this.sockets.push({socket:t.socket,weight:t.weight||0,status:h.SOCKET_STATUS_READY})},this),Object.defineProperties(this,{via_transport:{get:function(){return this.socket.via_transport}},url:{get:function(){return this.socket.url}},sip_uri:{get:function(){return this.socket.sip_uri}}}),a.call(this)}function s(){this.recover_attempts=0,this.status=h.STATUS_CONNECTED,null!==this.recovery_timer&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.onconnect({socket:this})}function i(t,e,n){this.status=h.STATUS_DISCONNECTED,this.ondisconnect({socket:this.socket,error:t,code:e,reason:n}),this.close_requested||(t&&(this.socket.status=h.SOCKET_STATUS_ERROR),o.call(this,t))}function l(t){if("\r\n"===t)return void c("received message with CRLF Keep Alive response");if("string"!=typeof t){try{t=String.fromCharCode.apply(null,new Uint8Array(t))}catch(e){return void c("received binary message failed to be converted into string, message discarded")}c("received binary message:\n\n"+t+"\n")}else c("received text message:\n\n"+t+"\n");this.ondata({transport:this,message:t})}function o(){var t,e=this;this.recover_attempts+=1,t=Math.floor(Math.random()*Math.pow(2,this.recover_attempts)+1),t<this.recovery_options.min_interval?t=this.recovery_options.min_interval:t>this.recovery_options.max_interval&&(t=this.recovery_options.max_interval),c("reconnection attempt: "+this.recover_attempts+". next connection attempt in "+t+" seconds"),this.recovery_timer=setTimeout(function(){e.close_requested||e.isConnected()||e.isConnecting()||(a.call(e),e.connect())},1e3*t)}function a(){var t=[];if(this.sockets.forEach(function(e){e.status!==h.SOCKET_STATUS_ERROR&&(0===t.length?t.push(e):e.weight>t[0].weight?t=[e]:e.weight===t[0].weight&&t.push(e))}),0===t.length)return this.sockets.forEach(function(t){t.status=h.SOCKET_STATUS_READY}),void a.call(this);var e=Math.floor(Math.random()*t.length);this.socket=t[e].socket}e.exports=r;var u=t("./Socket"),c=t("debug")("JsSIP:Transport"),d=t("debug")("JsSIP:ERROR:Transport"),h={STATUS_CONNECTED:0,STATUS_CONNECTING:1,STATUS_DISCONNECTED:2,SOCKET_STATUS_READY:0,SOCKET_STATUS_ERROR:1,recovery_options:{min_interval:2,max_interval:30}};r.prototype.connect=function(){return c("connect()"),this.isConnected()?void c("Transport is already connected"):this.isConnecting()?void c("Transport is connecting"):(this.close_requested=!1,this.status=h.STATUS_CONNECTING,this.onconnecting({socket:this.socket,attempts:this.recover_attempts}),void(this.close_requested||(this.socket.onconnect=s.bind(this),this.socket.ondisconnect=i.bind(this),this.socket.ondata=l.bind(this),this.socket.connect())))},r.prototype.disconnect=function(){c("close()"),this.close_requested=!0,this.recover_attempts=0,this.status=h.STATUS_DISCONNECTED,null!==this.recovery_timer&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.socket.onconnect=function(){},this.socket.ondisconnect=function(){},this.socket.ondata=function(){},this.socket.disconnect(),this.ondisconnect()},r.prototype.send=function(t){if(c("send()"),!this.isConnected())return d("unable to send message, transport is not connected"),!1;var e=t.toString();return c("sending message:\n\n"+e+"\n"),this.socket.send(e)},r.prototype.isConnected=function(){return this.status===h.STATUS_CONNECTED},r.prototype.isConnecting=function(){return this.status===h.STATUS_CONNECTING}},{"./Socket":19,debug:33}],23:[function(t,e,n){function r(t){if(this.cache={credentials:{}},this.configuration={},this.dynConfiguration={},this.dialogs={},this.applicants={},this.sessions={},this.transport=null,this.contact=null,this.status=a.STATUS_INIT,this.error=null,this.transactions={nist:{},nict:{},ist:{},ict:{}},this.data={},Object.defineProperties(this,{transactionsCount:{get:function(){var t,e=["nist","nict","ist","ict"],n=0;for(t in e)n+=Object.keys(this.transactions[e[t]]).length;return n}},nictTransactionsCount:{get:function(){return Object.keys(this.transactions.nict).length}},nistTransactionsCount:{get:function(){return Object.keys(this.transactions.nist).length}},ictTransactionsCount:{get:function(){return Object.keys(this.transactions.ict).length}},istTransactionsCount:{get:function(){return Object.keys(this.transactions.ist).length}}}),void 0===t)throw new TypeError("Not enough arguments");try{this.loadConfig(t)}catch(e){throw this.status=a.STATUS_NOT_READY,this.error=a.CONFIGURATION_ERROR,e}this._registrator=new m(this),c.EventEmitter.call(this),p.called||p()}function s(t){this.emit("connecting",t)}function i(t){this.status!==a.STATUS_USER_CLOSED&&(this.status=a.STATUS_READY,this.error=null,this.emit("connected",t),this.dynConfiguration.register&&this._registrator.register())}function l(t){var e,n,r,s=["nict","ict","nist","ist"];for(r=s.length,e=0;r>e;e++)for(n in this.transactions[s[e]])this.transactions[s[e]][n].onTransportError();this.emit("disconnected",t),this._registrator.onTransportClosed(),this.status!==a.STATUS_USER_CLOSED&&(this.status=a.STATUS_NOT_READY,this.error=a.NETWORK_ERROR)}function o(t){var e,n=t.transport,s=t.message;if(s=w.parseMessage(s,this),s&&!(this.status===r.C.STATUS_USER_CLOSED&&s instanceof R.IncomingRequest)&&x(s,this,n))if(s instanceof R.IncomingRequest)s.transport=n,this.receiveRequest(s);else if(s instanceof R.IncomingResponse)switch(s.method){case f.INVITE:e=this.transactions.ict[s.via_branch],e&&e.receiveResponse(s);break;case f.ACK:break;default:e=this.transactions.nict[s.via_branch],e&&e.receiveResponse(s)}}e.exports=r;var a={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,NETWORK_ERROR:2};r.C=a;var u=t("util"),c=t("events"),d=t("debug")("JsSIP:UA"),h=t("debug")("JsSIP:ERROR:UA");h.log=console.warn.bind(console);var p=t("rtcninja"),f=t("./Constants"),m=t("./Registrator"),g=t("./RTCSession"),_=t("./Message"),v=t("./Transactions"),b=t("./Transport"),T=t("./WebSocketInterface"),y=t("./Socket"),C=t("./Utils"),S=t("./Exceptions"),E=t("./URI"),A=t("./Grammar"),w=t("./Parser"),R=t("./SIPMessage"),x=t("./sanityCheck");u.inherits(r,c.EventEmitter),r.prototype.start=function(){function t(){d("restarting UA"),e.status=a.STATUS_READY,e.transport.connect()}d("start()");var e=this;this.status===a.STATUS_INIT?this.transport.connect():this.status===a.STATUS_USER_CLOSED?this.isConnected()?this.once("disconnected",t):t():d(this.status===a.STATUS_READY?"UA is in READY status, not restarted":"ERROR: connection is down, Auto-Recovery system is trying to reconnect"),
this.dynConfiguration.register=this.configuration.register},r.prototype.register=function(){d("register()"),this.dynConfiguration.register=!0,this._registrator.register()},r.prototype.unregister=function(t){d("unregister()"),this.dynConfiguration.register=!1,this._registrator.unregister(t)},r.prototype.registrator=function(){return this._registrator},r.prototype.isRegistered=function(){return!!this._registrator.registered},r.prototype.isConnected=function(){return this.transport.isConnected()},r.prototype.call=function(t,e){d("call()");var n;return n=new g(this),n.connect(t,e),n},r.prototype.sendMessage=function(t,e,n){d("sendMessage()");var r;return r=new _(this),r.send(t,e,n),r},r.prototype.terminateSessions=function(t){d("terminateSessions()");for(var e in this.sessions)this.sessions[e].isEnded()||this.sessions[e].terminate(t)},r.prototype.stop=function(){d("stop()");var t,e,n,r=this;if(this.dynConfiguration={},this.status===a.STATUS_USER_CLOSED)return void d("UA already closed");this._registrator.close(),n=Object.keys(this.sessions).length;for(t in this.sessions){d("closing session "+t);try{this.sessions[t].terminate()}catch(s){}}for(e in this.applicants)try{this.applicants[e].close()}catch(s){}this.status=a.STATUS_USER_CLOSED,0===this.nistTransactionsCount&&0===this.nictTransactionsCount&&0===this.ictTransactionsCount&&0===this.istTransactionsCount&&0===n?r.transport.disconnect():setTimeout(function(){r.transport.disconnect()},2e3)},r.prototype.normalizeTarget=function(t){return C.normalizeTarget(t,this.configuration.hostport_params)},r.prototype.get=function(t){switch(t){case"realm":return this.configuration.realm;case"ha1":return this.configuration.ha1;default:return void h('get() | cannot get "%s" parameter in runtime',t)}return!0},r.prototype.set=function(t,e){switch(t){case"password":this.configuration.password=String(e);break;case"realm":this.configuration.realm=String(e);break;case"ha1":this.configuration.ha1=String(e),this.configuration.password=null;break;case"display_name":if(-1===A.parse('"'+e+'"',"display_name"))return h('set() | wrong "display_name"'),!1;this.configuration.display_name=e;break;default:return h('set() | cannot set "%s" parameter in runtime',t),!1}return!0},r.prototype.newTransaction=function(t){this.transactions[t.type][t.id]=t,this.emit("newTransaction",{transaction:t})},r.prototype.destroyTransaction=function(t){delete this.transactions[t.type][t.id],this.emit("transactionDestroyed",{transaction:t})},r.prototype.newMessage=function(t){this.emit("newMessage",t)},r.prototype.newRTCSession=function(t){this.emit("newRTCSession",t)},r.prototype.registered=function(t){this.emit("registered",t)},r.prototype.unregistered=function(t){this.emit("unregistered",t)},r.prototype.registrationFailed=function(t){this.emit("registrationFailed",t)},r.prototype.receiveRequest=function(t){var e,n,r,s,i=t.method;if(t.ruri.user!==this.configuration.uri.user&&t.ruri.user!==this.contact.uri.user)return d("Request-URI does not point to us"),void(t.method!==f.ACK&&t.reply_sl(404));if(t.ruri.scheme===f.SIPS)return void t.reply_sl(416);if(!v.checkTransaction(this,t)){if(i===f.INVITE?new v.InviteServerTransaction(t,this):i!==f.ACK&&i!==f.CANCEL&&new v.NonInviteServerTransaction(t,this),i===f.OPTIONS)t.reply(200);else if(i===f.MESSAGE){if(0===this.listeners("newMessage").length)return void t.reply(405);r=new _(this),r.init_incoming(t)}else if(i===f.INVITE&&!t.to_tag&&0===this.listeners("newRTCSession").length)return void t.reply(405);if(t.to_tag)e=this.findDialog(t.call_id,t.from_tag,t.to_tag),e?e.receiveRequest(t):i===f.NOTIFY?(n=this.findSession(t),n?n.receiveRequest(t):(d("received NOTIFY request for a non existent subscription"),t.reply(481,"Subscription does not exist"))):i!==f.ACK&&t.reply(481);else switch(i){case f.INVITE:p.hasWebRTC()?t.hasHeader("replaces")?(s=t.replaces,e=this.findDialog(s.call_id,s.from_tag,s.to_tag),e?(n=e.owner,n.isEnded()?t.reply(603):n.receiveRequest(t)):t.reply(481)):(n=new g(this),n.init_incoming(t)):(d("INVITE received but WebRTC is not supported"),t.reply(488));break;case f.BYE:t.reply(481);break;case f.CANCEL:n=this.findSession(t),n?n.receiveRequest(t):d("received CANCEL request for a non existent session");break;case f.ACK:break;default:t.reply(405)}}},r.prototype.findSession=function(t){var e=t.call_id+t.from_tag,n=this.sessions[e],r=t.call_id+t.to_tag,s=this.sessions[r];return n?n:s?s:null},r.prototype.findDialog=function(t,e,n){var r=t+e+n,s=this.dialogs[r];return s?s:(r=t+n+e,s=this.dialogs[r],s?s:null)},r.prototype.loadConfig=function(t){var e,n,a,u,c,p={via_host:C.createRandomToken(12)+".invalid",contact_uri:null,password:null,realm:null,ha1:null,register_expires:600,register:!0,registrar_server:null,use_preloaded_route:!1,no_answer_timeout:60,session_timers:!0};for(e in r.configuration_check.mandatory){if(!t.hasOwnProperty(e))throw new S.ConfigurationError(e);if(n=t[e],a=r.configuration_check.mandatory[e].call(this,n),void 0===a)throw new S.ConfigurationError(e,n);p[e]=a}for(e in r.configuration_check.optional)if(t.hasOwnProperty(e)){if(n=t[e],C.isEmpty(n))continue;if(a=r.configuration_check.optional[e].call(this,n,t),void 0===a)throw new S.ConfigurationError(e,n);p[e]=a}0===p.display_name&&(p.display_name="0"),p.instance_id||(p.instance_id=C.newUUID()),p.jssip_id=C.createRandomToken(5),u=p.uri.clone(),u.user=null,p.hostport_params=u.toString().replace(/^sip:/i,"");var f=[];if(p.ws_servers&&Array.isArray(p.ws_servers)&&(f=f.concat(p.ws_servers)),p.sockets&&Array.isArray(p.sockets)&&(f=f.concat(p.sockets)),0===f.length)throw new S.ConfigurationError("sockets");try{this.transport=new b(f,{max_interval:p.connection_recovery_max_interval,min_interval:p.connection_recovery_min_interval}),this.transport.onconnecting=s.bind(this),this.transport.onconnect=i.bind(this),this.transport.ondisconnect=l.bind(this),this.transport.ondata=o.bind(this),delete p.connection_recovery_max_interval,delete p.connection_recovery_min_interval,delete p.ws_servers,delete p.sockets}catch(m){throw h(m),new S.ConfigurationError("sockets",f)}p.authorization_user||(p.authorization_user=p.uri.user),p.registrar_server||(c=p.uri.clone(),c.user=null,c.clearParams(),c.clearHeaders(),p.registrar_server=c),p.no_answer_timeout=1e3*p.no_answer_timeout,p.contact_uri?p.via_host=p.contact_uri.host:p.contact_uri=new E("sip",C.createRandomToken(8),p.via_host,null,{transport:"ws"}),this.contact={pub_gruu:null,temp_gruu:null,uri:p.contact_uri,toString:function(t){t=t||{};var e=t.anonymous||null,n=t.outbound||null,r="<";return r+=e?this.temp_gruu||"sip:anonymous@anonymous.invalid;transport=ws":this.pub_gruu||this.uri.toString(),!n||(e?this.temp_gruu:this.pub_gruu)||(r+=";ob"),r+=">"}};for(e in p)r.configuration_skeleton[e].value=p[e];Object.defineProperties(this.configuration,r.configuration_skeleton);for(e in p)r.configuration_skeleton[e].value="";d("configuration parameters after validation:");for(e in p)switch(e){case"uri":case"registrar_server":d("- "+e+": "+p[e]);break;case"password":case"ha1":d("- "+e+": NOT SHOWN");break;default:d("- "+e+": "+JSON.stringify(p[e]))}},r.configuration_skeleton=function(){var t,e,n,r={},s=["jssip_id","hostport_params","uri","authorization_user","contact_uri","display_name","instance_id","no_answer_timeout","session_timers","password","realm","ha1","register_expires","registrar_server","sockets","use_preloaded_route","ws_servers","via_core_value","via_host"],i=["password","realm","ha1","display_name"];for(t in s)e=s[t],n=-1!==i.indexOf(e),r[e]={value:"",writable:n,configurable:!1};return r.register={value:"",writable:!0,configurable:!1},r}(),r.configuration_check={mandatory:{uri:function(t){var e;return/^sip:/i.test(t)||(t=f.SIP+":"+t),e=E.parse(t),e&&e.user?e:void 0}},optional:{authorization_user:function(t){return-1===A.parse('"'+t+'"',"quoted_string")?void 0:t},connection_recovery_max_interval:function(t){var e;return C.isDecimal(t)&&(e=Number(t),e>0)?e:void 0},connection_recovery_min_interval:function(t){var e;return C.isDecimal(t)&&(e=Number(t),e>0)?e:void 0},contact_uri:function(t){if("string"==typeof t){var e=A.parse(t,"SIP_URI");if(-1!==e)return e}},display_name:function(t){return-1===A.parse('"'+t+'"',"display_name")?void 0:t},instance_id:function(t){return/^uuid:/i.test(t)&&(t=t.substr(5)),-1===A.parse(t,"uuid")?void 0:t},no_answer_timeout:function(t){var e;return C.isDecimal(t)&&(e=Number(t),e>0)?e:void 0},session_timers:function(t){return"boolean"==typeof t?t:void 0},password:function(t){return String(t)},realm:function(t){return String(t)},ha1:function(t){return String(t)},register:function(t){return"boolean"==typeof t?t:void 0},register_expires:function(t){var e;return C.isDecimal(t)&&(e=Number(t),e>0)?e:void 0},registrar_server:function(t){var e;return/^sip:/i.test(t)||(t=f.SIP+":"+t),e=E.parse(t),e?e.user?void 0:e:void 0},sockets:function(t){var e,n;if(y.isSocket(t))t=[{socket:t}];else{if(!Array.isArray(t)||!t.length)return;for(n=t.length,e=0;n>e;e++)y.isSocket(t[e])&&(t[e]={socket:t[e]})}return t},use_preloaded_route:function(t){return"boolean"==typeof t?t:void 0},ws_servers:function(t){var e,n,r=[];if("string"==typeof t)t=[{ws_uri:t}];else{if(!Array.isArray(t)||!t.length)return;for(n=t.length,e=0;n>e;e++)"string"==typeof t[e]&&(t[e]={ws_uri:t[e]})}for(n=t.length,e=0;n>e;e++)try{r.push({socket:new T(t[e].ws_uri),weight:t[e].weight||0})}catch(s){return void h(s)}return r}}}},{"./Constants":1,"./Exceptions":5,"./Grammar":6,"./Message":8,"./Parser":10,"./RTCSession":11,"./Registrator":16,"./SIPMessage":18,"./Socket":19,"./Transactions":21,"./Transport":22,"./URI":24,"./Utils":25,"./WebSocketInterface":26,"./sanityCheck":27,debug:33,events:28,rtcninja:38,util:32}],24:[function(t,e,n){function r(t,e,n,r,i,l){var o,a;if(!n)throw new TypeError('missing or invalid "host" parameter');t=t||s.SIP,this.parameters={},this.headers={};for(o in i)this.setParam(o,i[o]);for(a in l)this.setHeader(a,l[a]);Object.defineProperties(this,{scheme:{get:function(){return t},set:function(e){t=e.toLowerCase()}},user:{get:function(){return e},set:function(t){e=t}},host:{get:function(){return n},set:function(t){n=t.toLowerCase()}},port:{get:function(){return r},set:function(t){r=0===t?t:parseInt(t,10)||null}}})}e.exports=r;var s=t("./Constants"),i=t("./Utils"),l=t("./Grammar");r.prototype={setParam:function(t,e){t&&(this.parameters[t.toLowerCase()]="undefined"==typeof e||null===e?null:e.toString())},getParam:function(t){return t?this.parameters[t.toLowerCase()]:void 0},hasParam:function(t){return t?this.parameters.hasOwnProperty(t.toLowerCase())&&!0||!1:void 0},deleteParam:function(t){var e;return t=t.toLowerCase(),this.parameters.hasOwnProperty(t)?(e=this.parameters[t],delete this.parameters[t],e):void 0},clearParams:function(){this.parameters={}},setHeader:function(t,e){this.headers[i.headerize(t)]=Array.isArray(e)?e:[e]},getHeader:function(t){return t?this.headers[i.headerize(t)]:void 0},hasHeader:function(t){return t?this.headers.hasOwnProperty(i.headerize(t))&&!0||!1:void 0},deleteHeader:function(t){var e;return t=i.headerize(t),this.headers.hasOwnProperty(t)?(e=this.headers[t],delete this.headers[t],e):void 0},clearHeaders:function(){this.headers={}},clone:function(){return new r(this.scheme,this.user,this.host,this.port,JSON.parse(JSON.stringify(this.parameters)),JSON.parse(JSON.stringify(this.headers)))},toString:function(){var t,e,n,r,s=[];r=this.scheme+":",this.user&&(r+=i.escapeUser(this.user)+"@"),r+=this.host,(this.port||0===this.port)&&(r+=":"+this.port);for(e in this.parameters)r+=";"+e,null!==this.parameters[e]&&(r+="="+this.parameters[e]);for(t in this.headers)for(n=0;n<this.headers[t].length;n++)s.push(t+"="+this.headers[t][n]);return s.length>0&&(r+="?"+s.join("&")),r},toAor:function(t){var e;return e=this.scheme+":",this.user&&(e+=i.escapeUser(this.user)+"@"),e+=this.host,t&&(this.port||0===this.port)&&(e+=":"+this.port),e}},r.parse=function(t){return t=l.parse(t,"SIP_URI"),-1!==t?t:void 0}},{"./Constants":1,"./Grammar":6,"./Utils":25}],25:[function(t,e,n){var r={};e.exports=r;var s=t("./Constants"),i=t("./URI"),l=t("./Grammar");r.str_utf8_length=function(t){return unescape(encodeURIComponent(t)).length},r.isFunction=function(t){return void 0!==t&&"[object Function]"===Object.prototype.toString.call(t)},r.isString=function(t){return void 0!==t&&"[object String]"===Object.prototype.toString.call(t)},r.isDecimal=function(t){return!isNaN(t)&&parseFloat(t)===parseInt(t,10)},r.isEmpty=function(t){return!!(null===t||""===t||void 0===t||Array.isArray(t)&&0===t.length||"number"==typeof t&&isNaN(t))||void 0},r.hasMethods=function(t){for(var e,n=1;e=arguments[n++];)if(this.isFunction(t[e]))return!1;return!0},r.createRandomToken=function(t,e){var n,r,s="";for(e=e||32,n=0;t>n;n++)r=Math.random()*e|0,s+=r.toString(e);return s},r.newTag=function(){return r.createRandomToken(10)},r.newUUID=function(){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,n="x"===t?e:3&e|8;return n.toString(16)});return t},r.hostType=function(t){return t?(t=l.parse(t,"host"),-1!==t?t.host_type:void 0):void 0},r.normalizeTarget=function(t,e){var n,l,o,a;if(t){if(t instanceof i)return t;if("string"==typeof t){switch(l=t.split("@"),l.length){case 1:if(!e)return;o=t,a=e;break;case 2:o=l[0],a=l[1];break;default:o=l.slice(0,l.length-1).join("@"),a=l[l.length-1]}return o=o.replace(/^(sips?|tel):/i,""),/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(o)&&(o=o.replace(/[\-\.\(\)]/g,"")),t=s.SIP+":"+r.escapeUser(o)+"@"+a,(n=i.parse(t))?n:void 0}}},r.escapeUser=function(t){return encodeURIComponent(decodeURIComponent(t)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")},r.headerize=function(t){var e,n={"Call-Id":"Call-ID",Cseq:"CSeq","Www-Authenticate":"WWW-Authenticate"},r=t.toLowerCase().replace(/_/g,"-").split("-"),s="",i=r.length;for(e=0;i>e;e++)0!==e&&(s+="-"),s+=r[e].charAt(0).toUpperCase()+r[e].substring(1);return n[s]&&(s=n[s]),s},r.sipErrorCause=function(t){var e;for(e in s.SIP_ERROR_CAUSES)if(-1!==s.SIP_ERROR_CAUSES[e].indexOf(t))return s.causes[e];return s.causes.SIP_FAILURE_CODE},r.getRandomTestNetIP=function(){function t(t,e){return Math.floor(Math.random()*(e-t+1)+t)}return"192.0.2."+t(1,254)},r.calculateMD5=function(t){function e(t,e){return t<<e|t>>>32-e}function n(t,e){var n,r,s,i,l;return s=2147483648&t,i=2147483648&e,n=1073741824&t,r=1073741824&e,l=(1073741823&t)+(1073741823&e),n&r?2147483648^l^s^i:n|r?1073741824&l?3221225472^l^s^i:1073741824^l^s^i:l^s^i}function r(t,e,n){return t&e|~t&n}function s(t,e,n){return t&n|e&~n}function i(t,e,n){return t^e^n}function l(t,e,n){return e^(t|~n)}function o(t,s,i,l,o,a,u){return t=n(t,n(n(r(s,i,l),o),u)),n(e(t,a),s)}function a(t,r,i,l,o,a,u){return t=n(t,n(n(s(r,i,l),o),u)),n(e(t,a),r)}function u(t,r,s,l,o,a,u){return t=n(t,n(n(i(r,s,l),o),u)),n(e(t,a),r)}function c(t,r,s,i,o,a,u){return t=n(t,n(n(l(r,s,i),o),u)),n(e(t,a),r)}function d(t){for(var e,n=t.length,r=n+8,s=(r-r%64)/64,i=16*(s+1),l=new Array(i-1),o=0,a=0;n>a;)e=(a-a%4)/4,o=a%4*8,l[e]=l[e]|t.charCodeAt(a)<<o,a++;return e=(a-a%4)/4,o=a%4*8,l[e]=l[e]|128<<o,l[i-2]=n<<3,l[i-1]=n>>>29,l}function h(t){var e,n,r="",s="";for(n=0;3>=n;n++)e=t>>>8*n&255,s="0"+e.toString(16),r+=s.substr(s.length-2,2);return r}function p(t){t=t.replace(/\r\n/g,"\n");for(var e="",n=0;n<t.length;n++){var r=t.charCodeAt(n);128>r?e+=String.fromCharCode(r):r>127&&2048>r?(e+=String.fromCharCode(r>>6|192),e+=String.fromCharCode(63&r|128)):(e+=String.fromCharCode(r>>12|224),e+=String.fromCharCode(r>>6&63|128),e+=String.fromCharCode(63&r|128))}return e}var f,m,g,_,v,b,T,y,C,S=[],E=7,A=12,w=17,R=22,x=5,I=9,O=14,N=20,k=4,D=11,L=16,U=23,M=6,P=10,q=15,j=21;for(t=p(t),S=d(t),b=1732584193,T=4023233417,y=2562383102,C=271733878,f=0;f<S.length;f+=16)m=b,g=T,_=y,v=C,b=o(b,T,y,C,S[f+0],E,3614090360),C=o(C,b,T,y,S[f+1],A,3905402710),y=o(y,C,b,T,S[f+2],w,606105819),T=o(T,y,C,b,S[f+3],R,3250441966),b=o(b,T,y,C,S[f+4],E,4118548399),C=o(C,b,T,y,S[f+5],A,1200080426),y=o(y,C,b,T,S[f+6],w,2821735955),T=o(T,y,C,b,S[f+7],R,4249261313),b=o(b,T,y,C,S[f+8],E,1770035416),C=o(C,b,T,y,S[f+9],A,2336552879),y=o(y,C,b,T,S[f+10],w,4294925233),T=o(T,y,C,b,S[f+11],R,2304563134),b=o(b,T,y,C,S[f+12],E,1804603682),C=o(C,b,T,y,S[f+13],A,4254626195),y=o(y,C,b,T,S[f+14],w,2792965006),T=o(T,y,C,b,S[f+15],R,1236535329),b=a(b,T,y,C,S[f+1],x,4129170786),C=a(C,b,T,y,S[f+6],I,3225465664),y=a(y,C,b,T,S[f+11],O,643717713),T=a(T,y,C,b,S[f+0],N,3921069994),b=a(b,T,y,C,S[f+5],x,3593408605),C=a(C,b,T,y,S[f+10],I,38016083),y=a(y,C,b,T,S[f+15],O,3634488961),T=a(T,y,C,b,S[f+4],N,3889429448),b=a(b,T,y,C,S[f+9],x,568446438),C=a(C,b,T,y,S[f+14],I,3275163606),y=a(y,C,b,T,S[f+3],O,4107603335),T=a(T,y,C,b,S[f+8],N,1163531501),b=a(b,T,y,C,S[f+13],x,2850285829),C=a(C,b,T,y,S[f+2],I,4243563512),y=a(y,C,b,T,S[f+7],O,1735328473),T=a(T,y,C,b,S[f+12],N,2368359562),b=u(b,T,y,C,S[f+5],k,4294588738),C=u(C,b,T,y,S[f+8],D,2272392833),y=u(y,C,b,T,S[f+11],L,1839030562),T=u(T,y,C,b,S[f+14],U,4259657740),b=u(b,T,y,C,S[f+1],k,2763975236),C=u(C,b,T,y,S[f+4],D,1272893353),y=u(y,C,b,T,S[f+7],L,4139469664),T=u(T,y,C,b,S[f+10],U,3200236656),b=u(b,T,y,C,S[f+13],k,681279174),C=u(C,b,T,y,S[f+0],D,3936430074),y=u(y,C,b,T,S[f+3],L,3572445317),T=u(T,y,C,b,S[f+6],U,76029189),b=u(b,T,y,C,S[f+9],k,3654602809),C=u(C,b,T,y,S[f+12],D,3873151461),y=u(y,C,b,T,S[f+15],L,530742520),T=u(T,y,C,b,S[f+2],U,3299628645),b=c(b,T,y,C,S[f+0],M,4096336452),C=c(C,b,T,y,S[f+7],P,1126891415),y=c(y,C,b,T,S[f+14],q,2878612391),T=c(T,y,C,b,S[f+5],j,4237533241),b=c(b,T,y,C,S[f+12],M,1700485571),C=c(C,b,T,y,S[f+3],P,2399980690),y=c(y,C,b,T,S[f+10],q,4293915773),T=c(T,y,C,b,S[f+1],j,2240044497),b=c(b,T,y,C,S[f+8],M,1873313359),C=c(C,b,T,y,S[f+15],P,4264355552),y=c(y,C,b,T,S[f+6],q,2734768916),T=c(T,y,C,b,S[f+13],j,1309151649),b=c(b,T,y,C,S[f+4],M,4149444226),C=c(C,b,T,y,S[f+11],P,3174756917),y=c(y,C,b,T,S[f+2],q,718787259),T=c(T,y,C,b,S[f+9],j,3951481745),b=n(b,m),T=n(T,g),y=n(y,_),C=n(C,v);var H=h(b)+h(T)+h(y)+h(C);return H.toLowerCase()}},{"./Constants":1,"./Grammar":6,"./URI":24}],26:[function(t,e,n){function r(t){u("new()");var e=null,n=null;this.ws=null,Object.defineProperties(this,{via_transport:{get:function(){return n},set:function(t){n=t.toUpperCase()}},sip_uri:{get:function(){return e}},url:{get:function(){return t}}});var r=a.parse(t,"absoluteURI");if(-1===r)throw c("invalid WebSocket URI: "+t),new TypeError("Invalid argument: "+t);if("wss"!==r.scheme&&"ws"!==r.scheme)throw c("invalid WebSocket URI scheme: "+r.scheme),new TypeError("Invalid argument: "+t);e="sip:"+r.host+(r.port?":"+r.port:"")+";transport=ws",this.via_transport=r.scheme}function s(){u("WebSocket "+this.url+" connected"),this.onconnect()}function i(t){u("WebSocket "+this.url+" closed"),t.wasClean===!1&&u("WebSocket abrupt disconnection"),this.ondisconnect(t.wasClean,t.code,t.reason)}function l(t){u("received WebSocket message"),this.ondata(t.data)}function o(t){c("WebSocket "+this.url+" error: "+t)}e.exports=r;var a=t("./Grammar"),u=t("debug")("JsSIP:WebSocketInterface"),c=t("debug")("JsSIP:ERROR:WebSocketInterface");r.prototype.connect=function(){if(u("connect()"),this.isConnected())return void u("WebSocket "+this.url+" is already connected");if(this.isConnecting())return void u("WebSocket "+this.url+" is connecting");this.ws&&this.ws.close(),u("connecting to WebSocket "+this.url);try{this.ws=new WebSocket(this.url,"sip"),this.ws.binaryType="arraybuffer",this.ws.onopen=s.bind(this),this.ws.onclose=i.bind(this),this.ws.onmessage=l.bind(this),this.ws.onerror=o.bind(this)}catch(t){o.call(this,t)}},r.prototype.disconnect=function(){u("disconnect()"),this.ws&&(this.ws.close(),this.ws=null)},r.prototype.send=function(t){return u("send()"),this.isConnected()?(this.ws.send(t),!0):(c("unable to send message, WebSocket is not open"),!1)},r.prototype.isConnected=function(){return this.ws&&this.ws.readyState===this.ws.OPEN},r.prototype.isConnecting=function(){return this.ws&&this.ws.readyState===this.ws.CONNECTING}},{"./Grammar":6,debug:33}],27:[function(t,e,n){function r(t,e,n){var r,s;for(h=t,p=e,f=n,r=y.length;r--;)if(s=y[r](h),s===!1)return!1;if(h instanceof _.IncomingRequest){for(r=b.length;r--;)if(s=b[r](h),s===!1)return!1}else if(h instanceof _.IncomingResponse)for(r=T.length;r--;)if(s=T[r](h),s===!1)return!1;return!0}function s(){return"sip"!==h.s("to").uri.scheme?(d(416),!1):void 0}function i(){return h.to_tag||h.call_id.substr(0,5)!==p.configuration.jssip_id?void 0:(d(482),!1)}function l(){var t=v.str_utf8_length(h.body),e=h.getHeader("content-length");return e>t?(d(400),!1):void 0}function o(){var t,e,n=h.from_tag,r=h.call_id,s=h.cseq;if(!h.to_tag)if(h.method===g.INVITE){if(p.transactions.ist[h.via_branch])return!1;for(e in p.transactions.ist)if(t=p.transactions.ist[e],t.request.from_tag===n&&t.request.call_id===r&&t.request.cseq===s)return d(482),!1}else{if(p.transactions.nist[h.via_branch])return!1;for(e in p.transactions.nist)if(t=p.transactions.nist[e],t.request.from_tag===n&&t.request.call_id===r&&t.request.cseq===s)return d(482),!1}}function a(){return h.getHeaders("via").length>1?(m("more than one Via header field present in the response, dropping the response"),!1):void 0}function u(){var t=v.str_utf8_length(h.body),e=h.getHeader("content-length");return e>t?(m("message body length is lower than the value in Content-Length header field, dropping the response"),!1):void 0}function c(){for(var t=["from","to","call_id","cseq","via"],e=t.length;e--;)if(!h.hasHeader(t[e]))return m("missing mandatory header field : "+t[e]+", dropping the response"),!1}function d(t){var e,n="SIP/2.0 "+t+" "+g.REASON_PHRASE[t]+"\r\n",r=h.getHeaders("via"),s=r.length,i=0;for(i;s>i;i++)n+="Via: "+r[i]+"\r\n";e=h.getHeader("To"),h.to_tag||(e+=";tag="+v.newTag()),n+="To: "+e+"\r\n",n+="From: "+h.getHeader("From")+"\r\n",n+="Call-ID: "+h.call_id+"\r\n",n+="CSeq: "+h.cseq+" "+h.method+"\r\n",n+="\r\n",f.send(n)}e.exports=r;var h,p,f,m=t("debug")("JsSIP:sanityCheck"),g=t("./Constants"),_=t("./SIPMessage"),v=t("./Utils"),b=[],T=[],y=[];b.push(s),b.push(i),b.push(l),b.push(o),T.push(a),T.push(u),y.push(c)},{"./Constants":1,"./SIPMessage":18,"./Utils":25,debug:33}],28:[function(t,e,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function s(t){return"function"==typeof t}function i(t){return"number"==typeof t}function l(t){return"object"==typeof t&&null!==t}function o(t){return void 0===t}e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(t){if(!i(t)||0>t||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},r.prototype.emit=function(t){var e,n,r,i,a,u;if(this._events||(this._events={}),"error"===t&&(!this._events.error||l(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[t],o(n))return!1;if(s(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:i=Array.prototype.slice.call(arguments,1),n.apply(this,i)}else if(l(n))for(i=Array.prototype.slice.call(arguments,1),u=n.slice(),r=u.length,a=0;r>a;a++)u[a].apply(this,i);return!0},r.prototype.addListener=function(t,e){var n;if(!s(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,s(e.listener)?e.listener:e),this._events[t]?l(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,l(this._events[t])&&!this._events[t].warned&&(n=o(this._maxListeners)?r.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(t,e){function n(){this.removeListener(t,n),r||(r=!0,e.apply(this,arguments))}if(!s(e))throw TypeError("listener must be a function");var r=!1;return n.listener=e,this.on(t,n),this},r.prototype.removeListener=function(t,e){var n,r,i,o;if(!s(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],i=n.length,r=-1,n===e||s(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(l(n)){for(o=i;o-- >0;)if(n[o]===e||n[o].listener&&n[o].listener===e){r=o;break}if(0>r)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},r.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],s(n))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},r.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?s(this._events[t])?[this._events[t]]:this._events[t].slice():[]},r.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(s(e))return 1;if(e)return e.length}return 0},r.listenerCount=function(t,e){return t.listenerCount(e)}},{}],29:[function(t,e,n){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},{}],30:[function(t,e,n){function r(){c&&o&&(c=!1,o.length?u=o.concat(u):d=-1,u.length&&s())}function s(){if(!c){var t=setTimeout(r);c=!0;for(var e=u.length;e;){for(o=u,u=[];++d<e;)o&&o[d].run();d=-1,e=u.length}o=null,c=!1,clearTimeout(t)}}function i(t,e){this.fun=t,this.array=e}function l(){}var o,a=e.exports={},u=[],c=!1,d=-1;a.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];u.push(new i(t,e)),1!==u.length||c||setTimeout(s,0)},i.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=l,a.addListener=l,a.once=l,a.off=l,a.removeListener=l,a.removeAllListeners=l,a.emit=l,a.binding=function(t){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(t){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},{}],31:[function(t,e,n){e.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},{}],32:[function(t,e,n){(function(e,r){function s(t,e){var r={seen:[],stylize:l};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),m(e)?r.showHidden=e:e&&n._extend(r,e),y(r.showHidden)&&(r.showHidden=!1),y(r.depth)&&(r.depth=2),y(r.colors)&&(r.colors=!1),y(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=i),a(r,t,r.depth)}function i(t,e){var n=s.styles[e];return n?"["+s.colors[n][0]+"m"+t+"["+s.colors[n][1]+"m":t}function l(t,e){return t}function o(t){var e={};return t.forEach(function(t,n){e[t]=!0}),e}function a(t,e,r){if(t.customInspect&&e&&w(e.inspect)&&e.inspect!==n.inspect&&(!e.constructor||e.constructor.prototype!==e)){var s=e.inspect(r,t);return b(s)||(s=a(t,s,r)),s}var i=u(t,e);if(i)return i;var l=Object.keys(e),m=o(l);if(t.showHidden&&(l=Object.getOwnPropertyNames(e)),A(e)&&(l.indexOf("message")>=0||l.indexOf("description")>=0))return c(e);if(0===l.length){if(w(e)){var g=e.name?": "+e.name:"";return t.stylize("[Function"+g+"]","special")}if(C(e))return t.stylize(RegExp.prototype.toString.call(e),"regexp");if(E(e))return t.stylize(Date.prototype.toString.call(e),"date");if(A(e))return c(e)}var _="",v=!1,T=["{","}"];if(f(e)&&(v=!0,T=["[","]"]),w(e)){var y=e.name?": "+e.name:"";_=" [Function"+y+"]"}if(C(e)&&(_=" "+RegExp.prototype.toString.call(e)),E(e)&&(_=" "+Date.prototype.toUTCString.call(e)),A(e)&&(_=" "+c(e)),0===l.length&&(!v||0==e.length))return T[0]+_+T[1];if(0>r)return C(e)?t.stylize(RegExp.prototype.toString.call(e),"regexp"):t.stylize("[Object]","special");t.seen.push(e);var S;return S=v?d(t,e,r,m,l):l.map(function(n){return h(t,e,r,m,n,v)}),t.seen.pop(),p(S,_,T)}function u(t,e){if(y(e))return t.stylize("undefined","undefined");if(b(e)){var n="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(n,"string")}return v(e)?t.stylize(""+e,"number"):m(e)?t.stylize(""+e,"boolean"):g(e)?t.stylize("null","null"):void 0}function c(t){return"["+Error.prototype.toString.call(t)+"]"}function d(t,e,n,r,s){for(var i=[],l=0,o=e.length;o>l;++l)N(e,String(l))?i.push(h(t,e,n,r,String(l),!0)):i.push("");return s.forEach(function(s){s.match(/^\d+$/)||i.push(h(t,e,n,r,s,!0))}),i}function h(t,e,n,r,s,i){var l,o,u;if(u=Object.getOwnPropertyDescriptor(e,s)||{value:e[s]},u.get?o=u.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):u.set&&(o=t.stylize("[Setter]","special")),N(r,s)||(l="["+s+"]"),o||(t.seen.indexOf(u.value)<0?(o=g(n)?a(t,u.value,null):a(t,u.value,n-1),o.indexOf("\n")>-1&&(o=i?o.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+o.split("\n").map(function(t){return"   "+t}).join("\n"))):o=t.stylize("[Circular]","special")),y(l)){if(i&&s.match(/^\d+$/))return o;l=JSON.stringify(""+s),l.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(l=l.substr(1,l.length-2),l=t.stylize(l,"name")):(l=l.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),l=t.stylize(l,"string"))}return l+": "+o}function p(t,e,n){var r=0,s=t.reduce(function(t,e){return r++,e.indexOf("\n")>=0&&r++,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0);return s>60?n[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+n[1]:n[0]+e+" "+t.join(", ")+" "+n[1]}function f(t){return Array.isArray(t)}function m(t){return"boolean"==typeof t}function g(t){return null===t}function _(t){return null==t}function v(t){return"number"==typeof t}function b(t){return"string"==typeof t}function T(t){return"symbol"==typeof t}function y(t){return void 0===t}function C(t){return S(t)&&"[object RegExp]"===x(t)}function S(t){return"object"==typeof t&&null!==t}function E(t){return S(t)&&"[object Date]"===x(t)}function A(t){return S(t)&&("[object Error]"===x(t)||t instanceof Error)}function w(t){return"function"==typeof t}function R(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||"undefined"==typeof t}function x(t){return Object.prototype.toString.call(t)}function I(t){return 10>t?"0"+t.toString(10):t.toString(10)}function O(){var t=new Date,e=[I(t.getHours()),I(t.getMinutes()),I(t.getSeconds())].join(":");return[t.getDate(),U[t.getMonth()],e].join(" ")}function N(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var k=/%[sdj%]/g;n.format=function(t){if(!b(t)){for(var e=[],n=0;n<arguments.length;n++)e.push(s(arguments[n]));return e.join(" ")}for(var n=1,r=arguments,i=r.length,l=String(t).replace(k,function(t){if("%%"===t)return"%";if(n>=i)return t;switch(t){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return t}}),o=r[n];i>n;o=r[++n])l+=g(o)||!S(o)?" "+o:" "+s(o);return l},n.deprecate=function(t,s){function i(){if(!l){if(e.throwDeprecation)throw new Error(s);e.traceDeprecation?console.trace(s):console.error(s),l=!0}return t.apply(this,arguments);
}if(y(r.process))return function(){return n.deprecate(t,s).apply(this,arguments)};if(e.noDeprecation===!0)return t;var l=!1;return i};var D,L={};n.debuglog=function(t){if(y(D)&&(D=e.env.NODE_DEBUG||""),t=t.toUpperCase(),!L[t])if(new RegExp("\\b"+t+"\\b","i").test(D)){var r=e.pid;L[t]=function(){var e=n.format.apply(n,arguments);console.error("%s %d: %s",t,r,e)}}else L[t]=function(){};return L[t]},n.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=f,n.isBoolean=m,n.isNull=g,n.isNullOrUndefined=_,n.isNumber=v,n.isString=b,n.isSymbol=T,n.isUndefined=y,n.isRegExp=C,n.isObject=S,n.isDate=E,n.isError=A,n.isFunction=w,n.isPrimitive=R,n.isBuffer=t("./support/isBuffer");var U=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];n.log=function(){console.log("%s - %s",O(),n.format.apply(n,arguments))},n.inherits=t("inherits"),n._extend=function(t,e){if(!e||!S(e))return t;for(var n=Object.keys(e),r=n.length;r--;)t[n[r]]=e[n[r]];return t}}).call(this,t("_process"),"undefined"!=typeof r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":31,_process:30,inherits:29}],33:[function(t,e,n){function r(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function s(){var t=arguments,e=this.useColors;if(t[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+t[0]+(e?"%c ":" ")+"+"+n.humanize(this.diff),!e)return t;var r="color: "+this.color;t=[t[0],r,"color: inherit"].concat(Array.prototype.slice.call(t,1));var s=0,i=0;return t[0].replace(/%[a-z%]/g,function(t){"%%"!==t&&(s++,"%c"===t&&(i=s))}),t.splice(i,0,r),t}function i(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function l(t){try{null==t?n.storage.removeItem("debug"):n.storage.debug=t}catch(e){}}function o(){var t;try{t=n.storage.debug}catch(e){}return t}function a(){try{return window.localStorage}catch(t){}}n=e.exports=t("./debug"),n.log=i,n.formatArgs=s,n.save=l,n.load=o,n.useColors=r,n.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:a(),n.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],n.formatters.j=function(t){return JSON.stringify(t)},n.enable(o())},{"./debug":34}],34:[function(t,e,n){function r(){return n.colors[c++%n.colors.length]}function s(t){function e(){}function s(){var t=s,e=+new Date,i=e-(u||e);t.diff=i,t.prev=u,t.curr=e,u=e,null==t.useColors&&(t.useColors=n.useColors()),null==t.color&&t.useColors&&(t.color=r());var l=Array.prototype.slice.call(arguments);l[0]=n.coerce(l[0]),"string"!=typeof l[0]&&(l=["%o"].concat(l));var o=0;l[0]=l[0].replace(/%([a-z%])/g,function(e,r){if("%%"===e)return e;o++;var s=n.formatters[r];if("function"==typeof s){var i=l[o];e=s.call(t,i),l.splice(o,1),o--}return e}),"function"==typeof n.formatArgs&&(l=n.formatArgs.apply(t,l));var a=s.log||n.log||console.log.bind(console);a.apply(t,l)}e.enabled=!1,s.enabled=!0;var i=n.enabled(t)?s:e;return i.namespace=t,i}function i(t){n.save(t);for(var e=(t||"").split(/[\s,]+/),r=e.length,s=0;r>s;s++)e[s]&&(t=e[s].replace(/\*/g,".*?"),"-"===t[0]?n.skips.push(new RegExp("^"+t.substr(1)+"$")):n.names.push(new RegExp("^"+t+"$")))}function l(){n.enable("")}function o(t){var e,r;for(e=0,r=n.skips.length;r>e;e++)if(n.skips[e].test(t))return!1;for(e=0,r=n.names.length;r>e;e++)if(n.names[e].test(t))return!0;return!1}function a(t){return t instanceof Error?t.stack||t.message:t}n=e.exports=s,n.coerce=a,n.disable=l,n.enable=i,n.enabled=o,n.humanize=t("ms"),n.names=[],n.skips=[],n.formatters={};var u,c=0},{ms:35}],35:[function(t,e,n){function r(t){if(t=""+t,!(t.length>1e4)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var n=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return n*d;case"days":case"day":case"d":return n*c;case"hours":case"hour":case"hrs":case"hr":case"h":return n*u;case"minutes":case"minute":case"mins":case"min":case"m":return n*a;case"seconds":case"second":case"secs":case"sec":case"s":return n*o;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n}}}}function s(t){return t>=c?Math.round(t/c)+"d":t>=u?Math.round(t/u)+"h":t>=a?Math.round(t/a)+"m":t>=o?Math.round(t/o)+"s":t+"ms"}function i(t){return l(t,c,"day")||l(t,u,"hour")||l(t,a,"minute")||l(t,o,"second")||t+" ms"}function l(t,e,n){return e>t?void 0:1.5*e>t?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}var o=1e3,a=60*o,u=60*a,c=24*u,d=365.25*c;e.exports=function(t,e){return e=e||{},"string"==typeof t?r(t):e["long"]?i(t):s(t)}},{}],36:[function(t,e,n){(function(n){"use strict";function r(t){function e(t){return function(){throw new Error("rtcninja: WebRTC not supported, missing "+t+" [browser: "+l.name+" "+l.version+"]")}}if(b&&l.chrome&&v>=32||l.android&&l.chrome&&v>=39||b&&l.opera&&v>=27||l.android&&l.opera&&v>=24||l.android&&l.webkit&&!l.chrome&&v>=37||i.webkitGetUserMedia&&s.webkitRTCPeerConnection)T=!0,u=i.webkitGetUserMedia.bind(i),c=s.webkitRTCPeerConnection,d=s.RTCSessionDescription,h=s.RTCIceCandidate,p=s.MediaStreamTrack,p&&p.getSources?f=p.getSources.bind(p):i.getMediaDevices&&(f=i.getMediaDevices.bind(i)),m=function(t,e){return t.src=URL.createObjectURL(e),t},g=!0,_=!1;else if(b&&l.firefox&&v>=22||l.android&&l.firefox&&v>=33||i.mozGetUserMedia&&s.mozRTCPeerConnection)T=!0,u=i.mozGetUserMedia.bind(i),c=s.mozRTCPeerConnection,d=s.mozRTCSessionDescription,h=s.mozRTCIceCandidate,p=s.MediaStreamTrack,m=function(t,e){return t.src=URL.createObjectURL(e),t},g=!1,_=!1;else if(t.plugin&&"function"==typeof t.plugin.isRequired&&t.plugin.isRequired()&&"function"==typeof t.plugin.isInstalled&&t.plugin.isInstalled()){var n=t.plugin["interface"];T=!0,u=n.getUserMedia,c=n.RTCPeerConnection,d=n.RTCSessionDescription,h=n.RTCIceCandidate,p=n.MediaStreamTrack,p&&p.getSources?f=p.getSources.bind(p):i.getMediaDevices&&(f=i.getMediaDevices.bind(i)),m=n.attachMediaStream,g=n.canRenegotiate,_=!0}else i.getUserMedia&&s.RTCPeerConnection&&(T=!0,u=i.getUserMedia.bind(i),c=s.RTCPeerConnection,d=s.RTCSessionDescription,h=s.RTCIceCandidate,p=s.MediaStreamTrack,p&&p.getSources?f=p.getSources.bind(p):i.getMediaDevices&&(f=i.getMediaDevices.bind(i)),m=s.attachMediaStream||function(t,e){return t.src=URL.createObjectURL(e),t},g=!0,_=!1);return r.hasWebRTC=function(){return T},u?r.getUserMedia=function(t,e,n){o("getUserMedia() | constraints: %o",t);try{u(t,function(t){o("getUserMedia() | success"),e&&e(t)},function(t){o("getUserMedia() | error:",t),n&&n(t)})}catch(r){a("getUserMedia() | error:",r),n&&n(r)}}:r.getUserMedia=function(t,n,r){a("getUserMedia() | WebRTC not supported"),r?r(new Error("rtcninja: WebRTC not supported, missing getUserMedia [browser: "+l.name+" "+l.version+"]")):e("getUserMedia")},r.RTCPeerConnection=c||e("RTCPeerConnection"),r.RTCSessionDescription=d||e("RTCSessionDescription"),r.RTCIceCandidate=h||e("RTCIceCandidate"),r.MediaStreamTrack=p||e("MediaStreamTrack"),r.getMediaDevices=f,r.attachMediaStream=m||e("attachMediaStream"),r.canRenegotiate=g,r.closeMediaStream=function(t){if(t)try{o("closeMediaStream() | calling stop() on all the MediaStreamTrack");var e,n,r;if(t.getTracks)for(e=t.getTracks(),n=0,r=e.length;r>n;n+=1)e[n].stop();else{for(e=t.getAudioTracks(),n=0,r=e.length;r>n;n+=1)e[n].stop();for(e=t.getVideoTracks(),n=0,r=e.length;r>n;n+=1)e[n].stop()}}catch(s){"function"!=typeof t.stop&&"object"!=typeof t.stop||(o("closeMediaStream() | calling stop() on the MediaStream"),t.stop())}},r.fixPeerConnectionConfig=function(t){var e,n,r,s,i;for(Array.isArray(t.iceServers)||(t.iceServers=[]),e=0,n=t.iceServers.length;n>e;e+=1)r=t.iceServers[e],s=r.hasOwnProperty("urls"),i=r.hasOwnProperty("url"),"object"==typeof r&&(s&&!i?r.url=Array.isArray(r.urls)?r.urls[0]:r.urls:!s&&i&&(r.urls=Array.isArray(r.url)?r.url.slice():r.url),i&&Array.isArray(r.url)&&(r.url=r.url[0]))},r.fixRTCOfferOptions=function(t){t=t||{},_?(t.hasOwnProperty("offerToReceiveAudio")&&(t.mandatory=t.mandatory||{},t.mandatory.OfferToReceiveAudio=!!t.offerToReceiveAudio),t.hasOwnProperty("offerToReceiveVideo")&&(t.mandatory=t.mandatory||{},t.mandatory.OfferToReceiveVideo=!!t.offerToReceiveVideo)):(t.mandatory&&t.mandatory.hasOwnProperty("OfferToReceiveAudio")&&(t.offerToReceiveAudio=t.mandatory.OfferToReceiveAudio?1:0),t.mandatory&&t.mandatory.hasOwnProperty("OfferToReceiveVideo")&&(t.offerToReceiveVideo=t.mandatory.OfferToReceiveVideo?1:0),delete t.mandatory)},r}e.exports=r;var s,i,l=t("bowser"),o=t("debug")("rtcninja:Adapter"),a=t("debug")("rtcninja:ERROR:Adapter"),u=null,c=null,d=null,h=null,p=null,f=null,m=null,g=!1,_=!1,v=Number(l.version)||0,b=!(l.mobile||l.tablet&&!(l.msie&&v>=10)),T=!1;a.log=console.warn.bind(console),s=n.window||n,i=s.navigator||{}}).call(this,"undefined"!=typeof r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{bowser:40,debug:33}],37:[function(t,e,n){"use strict";function r(t,e){d("new | [pcConfig:%o, pcConstraints:%o]",t,e),s.call(this,t),this.pcConstraints=e,this.ourLocalDescription=null,this.ourSignalingState=null,this.ourIceConnectionState=null,this.ourIceGatheringState=null,this.timerGatheringTimeout=null,this.timerGatheringTimeoutAfterRelay=null,this.ignoreIceGathering=!1,this.closed=!1,o.call(this),u.call(this)}function s(t){this.pcConfig=c(!0,t),p.fixPeerConnectionConfig(this.pcConfig),this.options={iceTransportsRelay:"relay"===this.pcConfig.iceTransports,iceTransportsNone:"none"===this.pcConfig.iceTransports,gatheringTimeout:this.pcConfig.gatheringTimeout,gatheringTimeoutAfterRelay:this.pcConfig.gatheringTimeoutAfterRelay},delete this.pcConfig.gatheringTimeout,delete this.pcConfig.gatheringTimeoutAfterRelay,d("setConfigurationAndOptions | processed pcConfig: %o",this.pcConfig)}function i(){return this.closed||this.pc&&"closed"===this.pc.iceConnectionState}function l(){var t=this,e=this.pc;e.onnegotiationneeded=function(e){i.call(t)||(d("onnegotiationneeded()"),t.onnegotiationneeded&&t.onnegotiationneeded(e))},e.onicecandidate=function(e){var n,r,s;if(!i.call(t)&&!t.ignoreIceGathering&&!t.options.iceTransportsNone)if(n=e.candidate){if(r=f.REGEXP_RELAY_CANDIDATE.test(n.candidate),t.options.iceTransportsRelay&&!r)return;r&&!t.timerGatheringTimeoutAfterRelay&&"number"==typeof t.options.gatheringTimeoutAfterRelay&&(d("onicecandidate() | first relay candidate found, ending gathering in %d ms",t.options.gatheringTimeoutAfterRelay),t.timerGatheringTimeoutAfterRelay=setTimeout(function(){i.call(t)||(d("forced end of candidates after timeout"),delete t.timerGatheringTimeoutAfterRelay,clearTimeout(t.timerGatheringTimeout),delete t.timerGatheringTimeout,t.ignoreIceGathering=!0,t.onicecandidate&&t.onicecandidate({candidate:null},null))},t.options.gatheringTimeoutAfterRelay)),s=new p.RTCIceCandidate({sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,candidate:n.candidate}),null===m.normalizeCandidate&&(f.REGEXP_NORMALIZED_CANDIDATE.test(n.candidate)?m.normalizeCandidate=!1:(d('onicecandidate() | normalizing ICE candidates syntax (remove "a=" and "\\r\\n")'),m.normalizeCandidate=!0)),m.normalizeCandidate&&(s.candidate=n.candidate.replace(f.REGEXP_FIX_CANDIDATE,"")),d("onicecandidate() | m%d(%s) %s",s.sdpMLineIndex,s.sdpMid||"no mid",s.candidate),t.onicecandidate&&t.onicecandidate(e,s)}else d("onicecandidate() | end of candidates"),clearTimeout(t.timerGatheringTimeout),delete t.timerGatheringTimeout,clearTimeout(t.timerGatheringTimeoutAfterRelay),delete t.timerGatheringTimeoutAfterRelay,t.onicecandidate&&t.onicecandidate(e,null)},e.onaddstream=function(e){i.call(t)||(d("onaddstream() | stream: %o",e.stream),t.onaddstream&&t.onaddstream(e,e.stream))},e.onremovestream=function(e){i.call(t)||(d("onremovestream() | stream: %o",e.stream),t.onremovestream&&t.onremovestream(e,e.stream))},e.ondatachannel=function(e){i.call(t)||(d("ondatachannel() | datachannel: %o",e.channel),t.ondatachannel&&t.ondatachannel(e,e.channel))},e.onsignalingstatechange=function(n){e.signalingState!==t.ourSignalingState&&(d("onsignalingstatechange() | signalingState: %s",e.signalingState),t.ourSignalingState=e.signalingState,t.onsignalingstatechange&&t.onsignalingstatechange(n,e.signalingState))},e.oniceconnectionstatechange=function(n){e.iceConnectionState!==t.ourIceConnectionState&&(d("oniceconnectionstatechange() | iceConnectionState: %s",e.iceConnectionState),t.ourIceConnectionState=e.iceConnectionState,t.oniceconnectionstatechange&&t.oniceconnectionstatechange(n,e.iceConnectionState))},e.onicegatheringstatechange=function(n){i.call(t)||e.iceGatheringState!==t.ourIceGatheringState&&(d("onicegatheringstatechange() | iceGatheringState: %s",e.iceGatheringState),t.ourIceGatheringState=e.iceGatheringState,t.onicegatheringstatechange&&t.onicegatheringstatechange(n,e.iceGatheringState))},e.onidentityresult=function(e){i.call(t)||(d("onidentityresult()"),t.onidentityresult&&t.onidentityresult(e))},e.onpeeridentity=function(e){i.call(t)||(d("onpeeridentity()"),t.onpeeridentity&&t.onpeeridentity(e))},e.onidpassertionerror=function(e){i.call(t)||(d("onidpassertionerror()"),t.onidpassertionerror&&t.onidpassertionerror(e))},e.onidpvalidationerror=function(e){i.call(t)||(d("onidpvalidationerror()"),t.onidpvalidationerror&&t.onidpvalidationerror(e))}}function o(){this.pcConstraints?this.pc=new p.RTCPeerConnection(this.pcConfig,this.pcConstraints):this.pc=new p.RTCPeerConnection(this.pcConfig),l.call(this)}function a(){var t=this.pc,e=this.options,n=null;return t.localDescription?(e.iceTransportsRelay?n=t.localDescription.sdp.replace(f.REGEXP_SDP_NON_RELAY_CANDIDATES,""):e.iceTransportsNone&&(n=t.localDescription.sdp.replace(f.REGEXP_SDP_CANDIDATES,"")),this.ourLocalDescription=new p.RTCSessionDescription({type:t.localDescription.type,sdp:n||t.localDescription.sdp}),this.ourLocalDescription):(this.ourLocalDescription=null,null)}function u(){var t=this;Object.defineProperties(this,{peerConnection:{get:function(){return t.pc}},signalingState:{get:function(){return t.pc.signalingState}},iceConnectionState:{get:function(){return t.pc.iceConnectionState}},iceGatheringState:{get:function(){return t.pc.iceGatheringState}},localDescription:{get:function(){return a.call(t)}},remoteDescription:{get:function(){return t.pc.remoteDescription}},peerIdentity:{get:function(){return t.pc.peerIdentity}}})}e.exports=r;var c=t("merge"),d=t("debug")("rtcninja:RTCPeerConnection"),h=t("debug")("rtcninja:ERROR:RTCPeerConnection"),p=t("./Adapter"),f={REGEXP_NORMALIZED_CANDIDATE:new RegExp(/^candidate:/i),REGEXP_FIX_CANDIDATE:new RegExp(/(^a=|\r|\n)/gi),REGEXP_RELAY_CANDIDATE:new RegExp(/ relay /i),REGEXP_SDP_CANDIDATES:new RegExp(/^a=candidate:.*\r\n/gim),REGEXP_SDP_NON_RELAY_CANDIDATES:new RegExp(/^a=candidate:(.(?!relay ))*\r\n/gim)},m={normalizeCandidate:null};h.log=console.warn.bind(console),r.prototype.createOffer=function(t,e,n){d("createOffer()");var r=this;p.fixRTCOfferOptions(n),this.pc.createOffer(function(e){i.call(r)||(d("createOffer() | success"),t&&t(e))},function(t){i.call(r)||(h("createOffer() | error:",t),e&&e(t))},n)},r.prototype.createAnswer=function(t,e,n){d("createAnswer()");var r=this;this.pc.createAnswer(function(e){i.call(r)||(d("createAnswer() | success"),t&&t(e))},function(t){i.call(r)||(h("createAnswer() | error:",t),e&&e(t))},n)},r.prototype.setLocalDescription=function(t,e,n){function r(){"number"==typeof s.options.gatheringTimeout&&"complete"!==s.pc.iceGatheringState&&(d("setLocalDescription() | ending gathering in %d ms (gatheringTimeout option)",s.options.gatheringTimeout),s.timerGatheringTimeout=setTimeout(function(){i.call(s)||(d("forced end of candidates after gatheringTimeout timeout"),delete s.timerGatheringTimeout,clearTimeout(s.timerGatheringTimeoutAfterRelay),delete s.timerGatheringTimeoutAfterRelay,s.ignoreIceGathering=!0,s.onicecandidate&&s.onicecandidate({candidate:null},null))},s.options.gatheringTimeout))}d("setLocalDescription()");var s=this;this.pc.setLocalDescription(t,function(){i.call(s)||(d("setLocalDescription() | success"),clearTimeout(s.timerGatheringTimeout),delete s.timerGatheringTimeout,clearTimeout(s.timerGatheringTimeoutAfterRelay),delete s.timerGatheringTimeoutAfterRelay,r(),e&&e())},function(t){i.call(s)||(h("setLocalDescription() | error:",t),n&&n(t))}),this.ignoreIceGathering=!1},r.prototype.setRemoteDescription=function(t,e,n){d("setRemoteDescription()");var r=this;this.pc.setRemoteDescription(t,function(){i.call(r)||(d("setRemoteDescription() | success"),e&&e())},function(t){i.call(r)||(h("setRemoteDescription() | error:",t),n&&n(t))})},r.prototype.updateIce=function(t){d("updateIce() | pcConfig: %o",t),s.call(this,t),this.pc.updateIce(this.pcConfig),this.ignoreIceGathering=!1},r.prototype.addIceCandidate=function(t,e,n){d("addIceCandidate() | candidate: %o",t);var r=this;this.pc.addIceCandidate(t,function(){i.call(r)||(d("addIceCandidate() | success"),e&&e())},function(t){i.call(r)||(h("addIceCandidate() | error:",t),n&&n(t))})},r.prototype.getConfiguration=function(){return d("getConfiguration()"),this.pc.getConfiguration()},r.prototype.getLocalStreams=function(){return d("getLocalStreams()"),this.pc.getLocalStreams()},r.prototype.getRemoteStreams=function(){return d("getRemoteStreams()"),this.pc.getRemoteStreams()},r.prototype.getStreamById=function(t){return d("getStreamById() | streamId: %s",t),this.pc.getStreamById(t)},r.prototype.addStream=function(t){d("addStream() | stream: %s",t),this.pc.addStream(t)},r.prototype.removeStream=function(t){d("removeStream() | stream: %o",t),this.pc.removeStream(t)},r.prototype.close=function(){d("close()"),this.closed=!0,clearTimeout(this.timerGatheringTimeout),delete this.timerGatheringTimeout,clearTimeout(this.timerGatheringTimeoutAfterRelay),delete this.timerGatheringTimeoutAfterRelay,this.pc.close()},r.prototype.createDataChannel=function(){return d("createDataChannel()"),this.pc.createDataChannel.apply(this.pc,arguments)},r.prototype.createDTMFSender=function(t){return d("createDTMFSender()"),this.pc.createDTMFSender(t)},r.prototype.getStats=function(){return d("getStats()"),this.pc.getStats.apply(this.pc,arguments)},r.prototype.setIdentityProvider=function(){return d("setIdentityProvider()"),this.pc.setIdentityProvider.apply(this.pc,arguments)},r.prototype.getIdentityAssertion=function(){return d("getIdentityAssertion()"),this.pc.getIdentityAssertion()},r.prototype.reset=function(t){d("reset() | pcConfig: %o",t);var e=this.pc;e.onnegotiationneeded=null,e.onicecandidate=null,e.onaddstream=null,e.onremovestream=null,e.ondatachannel=null,e.onsignalingstatechange=null,e.oniceconnectionstatechange=null,e.onicegatheringstatechange=null,e.onidentityresult=null,e.onpeeridentity=null,e.onidpassertionerror=null,e.onidpvalidationerror=null,clearTimeout(this.timerGatheringTimeout),delete this.timerGatheringTimeout,clearTimeout(this.timerGatheringTimeoutAfterRelay),delete this.timerGatheringTimeoutAfterRelay,d("reset() | closing current peerConnection"),e.close(),s.call(this,t),o.call(this)}},{"./Adapter":36,debug:33,merge:41}],38:[function(t,e,n){"use strict";function r(t){var e=a(t||{});return c=!0,r.RTCPeerConnection=u,r.getUserMedia=e.getUserMedia,r.RTCSessionDescription=e.RTCSessionDescription,r.RTCIceCandidate=e.RTCIceCandidate,r.MediaStreamTrack=e.MediaStreamTrack,r.getMediaDevices=e.getMediaDevices,r.attachMediaStream=e.attachMediaStream,r.closeMediaStream=e.closeMediaStream,r.canRenegotiate=e.canRenegotiate,e.hasWebRTC()?(i("WebRTC supported"),!0):(l("WebRTC not supported"),!1)}e.exports=r;var s=t("bowser"),i=t("debug")("rtcninja"),l=t("debug")("rtcninja:ERROR"),o=t("./version"),a=t("./Adapter"),u=t("./RTCPeerConnection"),c=!1;l.log=console.warn.bind(console),i("version %s",o),i("detected browser: %s %s [mobile:%s, tablet:%s, android:%s, ios:%s]",s.name,s.version,!!s.mobile,!!s.tablet,!!s.android,!!s.ios),r.hasWebRTC=function(){return c||r(),a.hasWebRTC()},Object.defineProperty(r,"version",{get:function(){return o}}),Object.defineProperty(r,"called",{get:function(){return c}}),r.debug=t("debug"),r.browser=s},{"./Adapter":36,"./RTCPeerConnection":37,"./version":39,bowser:40,debug:33}],39:[function(t,e,n){"use strict";e.exports=t("../package.json").version},{"../package.json":42}],40:[function(t,n,r){!function(t,r){"undefined"!=typeof n&&n.exports?n.exports=r():"function"==typeof e&&e.amd?e(r):this[t]=r()}("bowser",function(){function t(t){function n(e){var n=t.match(e);return n&&n.length>1&&n[1]||""}function r(e){var n=t.match(e);return n&&n.length>1&&n[2]||""}var s,i=n(/(ipod|iphone|ipad)/i).toLowerCase(),l=/like android/i.test(t),o=!l&&/android/i.test(t),a=/nexus\s*[0-6]\s*/i.test(t),u=!a&&/nexus\s*[0-9]+/i.test(t),c=/CrOS/.test(t),d=/silk/i.test(t),h=/sailfish/i.test(t),p=/tizen/i.test(t),f=/(web|hpw)os/i.test(t),m=/windows phone/i.test(t),g=!m&&/windows/i.test(t),_=!i&&!d&&/macintosh/i.test(t),v=!o&&!h&&!p&&!f&&/linux/i.test(t),b=n(/edge\/(\d+(\.\d+)?)/i),T=n(/version\/(\d+(\.\d+)?)/i),y=/tablet/i.test(t),C=!y&&/[^-]mobi/i.test(t),S=/xbox/i.test(t);/opera|opr|opios/i.test(t)?s={name:"Opera",opera:e,version:T||n(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/coast/i.test(t)?s={name:"Opera Coast",coast:e,version:T||n(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(t)?s={name:"Yandex Browser",yandexbrowser:e,version:T||n(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(t)?s={name:"UC Browser",ucbrowser:e,version:n(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(t)?s={name:"Maxthon",maxthon:e,version:n(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(t)?s={name:"Epiphany",epiphany:e,version:n(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(t)?s={name:"Puffin",puffin:e,version:n(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(t)?s={name:"Sleipnir",sleipnir:e,version:n(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(t)?s={name:"K-Meleon",kMeleon:e,version:n(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:m?(s={name:"Windows Phone",windowsphone:e},b?(s.msedge=e,s.version=b):(s.msie=e,s.version=n(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(t)?s={name:"Internet Explorer",msie:e,version:n(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:c?s={name:"Chrome",chromeos:e,chromeBook:e,chrome:e,version:n(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/chrome.+? edge/i.test(t)?s={name:"Microsoft Edge",msedge:e,version:b}:/vivaldi/i.test(t)?s={name:"Vivaldi",vivaldi:e,version:n(/vivaldi\/(\d+(\.\d+)?)/i)||T}:h?s={name:"Sailfish",sailfish:e,version:n(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(t)?s={name:"SeaMonkey",seamonkey:e,version:n(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(t)?(s={name:"Firefox",firefox:e,version:n(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(t)&&(s.firefoxos=e)):d?s={name:"Amazon Silk",silk:e,version:n(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(t)?s={name:"PhantomJS",phantom:e,version:n(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(t)?s={name:"SlimerJS",slimer:e,version:n(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(t)||/rim\stablet/i.test(t)?s={name:"BlackBerry",blackberry:e,version:T||n(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:f?(s={name:"WebOS",webos:e,version:T||n(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(t)&&(s.touchpad=e)):/bada/i.test(t)?s={name:"Bada",bada:e,version:n(/dolfin\/(\d+(\.\d+)?)/i)}:p?s={name:"Tizen",tizen:e,version:n(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||T}:/qupzilla/i.test(t)?s={name:"QupZilla",qupzilla:e,version:n(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||T}:/chromium/i.test(t)?s={name:"Chromium",chromium:e,version:n(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||T}:/chrome|crios|crmo/i.test(t)?s={name:"Chrome",chrome:e,version:n(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:o?s={name:"Android",version:T}:/safari|applewebkit/i.test(t)?(s={name:"Safari",safari:e},T&&(s.version=T)):i?(s={name:"iphone"==i?"iPhone":"ipad"==i?"iPad":"iPod"},T&&(s.version=T)):s=/googlebot/i.test(t)?{name:"Googlebot",googlebot:e,version:n(/googlebot\/(\d+(\.\d+))/i)||T}:{name:n(/^(.*)\/(.*) /),version:r(/^(.*)\/(.*) /)},!s.msedge&&/(apple)?webkit/i.test(t)?(/(apple)?webkit\/537\.36/i.test(t)?(s.name=s.name||"Blink",s.blink=e):(s.name=s.name||"Webkit",s.webkit=e),!s.version&&T&&(s.version=T)):!s.opera&&/gecko\//i.test(t)&&(s.name=s.name||"Gecko",s.gecko=e,s.version=s.version||n(/gecko\/(\d+(\.\d+)?)/i)),s.msedge||!o&&!s.silk?i?(s[i]=e,s.ios=e):_?s.mac=e:S?s.xbox=e:g?s.windows=e:v&&(s.linux=e):s.android=e;var E="";s.windowsphone?E=n(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):i?(E=n(/os (\d+([_\s]\d+)*) like mac os x/i),E=E.replace(/[_\s]/g,".")):o?E=n(/android[ \/-](\d+(\.\d+)*)/i):s.webos?E=n(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):s.blackberry?E=n(/rim\stablet\sos\s(\d+(\.\d+)*)/i):s.bada?E=n(/bada\/(\d+(\.\d+)*)/i):s.tizen&&(E=n(/tizen[\/\s](\d+(\.\d+)*)/i)),E&&(s.osversion=E);var A=E.split(".")[0];return y||u||"ipad"==i||o&&(3==A||A>=4&&!C)||s.silk?s.tablet=e:(C||"iphone"==i||"ipod"==i||o||a||s.blackberry||s.webos||s.bada)&&(s.mobile=e),s.msedge||s.msie&&s.version>=10||s.yandexbrowser&&s.version>=15||s.vivaldi&&s.version>=1||s.chrome&&s.version>=20||s.firefox&&s.version>=20||s.safari&&s.version>=6||s.opera&&s.version>=10||s.ios&&s.osversion&&s.osversion.split(".")[0]>=6||s.blackberry&&s.version>=10.1?s.a=e:s.msie&&s.version<10||s.chrome&&s.version<20||s.firefox&&s.version<20||s.safari&&s.version<6||s.opera&&s.version<10||s.ios&&s.osversion&&s.osversion.split(".")[0]<6?s.c=e:s.x=e,s}var e=!0,n=t("undefined"!=typeof navigator?navigator.userAgent:"");return n.test=function(t){for(var e=0;e<t.length;++e){var r=t[e];if("string"==typeof r&&r in n)return!0}return!1},n._detect=t,n})},{}],41:[function(t,e,n){!function(t){function n(t,e){if("object"!==s(t))return e;for(var r in e)"object"===s(t[r])&&"object"===s(e[r])?t[r]=n(t[r],e[r]):t[r]=e[r];return t}function r(t,e,r){var l=r[0],o=r.length;(t||"object"!==s(l))&&(l={});for(var a=0;o>a;++a){var u=r[a],c=s(u);if("object"===c)for(var d in u){var h=t?i.clone(u[d]):u[d];e?l[d]=n(l[d],h):l[d]=h}}return l}function s(t){return{}.toString.call(t).slice(8,-1).toLowerCase()}var i=function(t){return r(t===!0,!1,arguments)},l="merge";i.recursive=function(t){return r(t===!0,!0,arguments)},i.clone=function(t){var e,n,r=t,l=s(t);if("array"===l)for(r=[],n=t.length,e=0;n>e;++e)r[e]=i.clone(t[e]);else if("object"===l){r={};for(e in t)r[e]=i.clone(t[e])}return r},t?e.exports=i:window[l]=i}("object"==typeof e&&e&&"object"==typeof e.exports&&e.exports)},{}],42:[function(t,e,n){e.exports={name:"rtcninja",version:"0.6.7",description:"WebRTC API wrapper to deal with different browsers",author:{name:"Iaki Baz Castillo",email:"inaki.baz@eface2face.com",url:"http://eface2face.com"},contributors:[{name:"Jess Prez",email:"jesus.perez@eface2face.com"}],license:"MIT",main:"lib/rtcninja.js",homepage:"https://github.com/eface2face/rtcninja.js",repository:{type:"git",url:"git+https://github.com/eface2face/rtcninja.js.git"},keywords:["webrtc"],engines:{node:">=0.10.32"},dependencies:{bowser:"^1.2.0",debug:"^2.2.0",merge:"^1.2.0"},devDependencies:{browserify:"^13.0.1",gulp:"git+https://github.com/gulpjs/gulp.git#4.0","gulp-expect-file":"0.0.7","gulp-filelog":"^0.4.1","gulp-header":"^1.8.2","gulp-jscs":"^3.0.2","gulp-jscs-stylish":"^1.4.0","gulp-jshint":"^2.0.1","gulp-rename":"^1.2.2","gulp-uglify":"^1.5.3","jshint-stylish":"^2.2.0","vinyl-source-stream":"^1.1.0"},readme:'# rtcninja.js <img src="http://www.pubnub.com/blog/wp-content/uploads/2014/01/google-webrtc-logo.png" height="30" width="30">\n\nWebRTC API wrapper to deal with different browsers transparently, [eventually](http://iswebrtcreadyyet.com/) this library shouldn\'t be needed. We only have to wait until W3C group in charge [finishes the specification](https://tools.ietf.org/wg/rtcweb/) and the different browsers implement it correctly :sweat_smile:.\n\n<img src="http://images4.fanpop.com/image/photos/21800000/browser-fight-google-chrome-21865454-600-531.jpg" height="250" width="250">\n\nSupported environments:\n* [Google Chrome](https://www.google.com/chrome/browser/desktop/index.html) (desktop & mobile)\n* [Google Canary](https://www.google.com/chrome/browser/canary.html) (desktop & mobile)\n* [Mozilla Firefox](https://www.mozilla.org/en-GB/firefox/new) (desktop & mobile)\n* [Firefox Nigthly](https://nightly.mozilla.org/) (desktop & mobile)\n* [Opera](http://www.opera.com/)\n* [Vivaldi](https://vivaldi.com/)\n* [CrossWalk](https://crosswalk-project.org/)\n* [Cordova](http://cordova.apache.org/): iOS support, you only have to use our plugin [following these steps](https://github.com/eface2face/cordova-plugin-iosrtc#usage).\n* [NW.js](https://github.com/nwjs/nw.js/)\n* [Electron](https://github.com/atom/electron)\n\n\n## Installation\n\n### **npm**:\n\n```bash\n$ npm install rtcninja\n```\n\nand then:\n\n```javascript\nvar rtcninja = require(\'rtcninja\');\n```\n\n### **bower**:\n\n```bash\n$ bower install rtcninja\n```\n\n\n## Browserified library\n\nTake a browserified version of the library from the `dist/` folder:\n\n* `dist/rtcninja.js`: The uncompressed version.\n* `dist/rtcninja.min.js`: The compressed production-ready version.\n\nThey expose the global `window.rtcninja` module.\n\n\n## Usage\n\nIn the [examples](./examples/) folder we provide a complete one.\n\n```javascript\n// Must first call it.\nrtcninja();\n\n// Then check.\nif (rtcninja.hasWebRTC()) {\n    // Do something.\n}\nelse {\n    // Do something.\n}\n```\n\n\n## Documentation\n\nYou can read the full [API documentation](docs/index.md) in the docs folder.\n\n\n## Issues\n\nhttps://github.com/eface2face/rtcninja.js/issues\n\n\n## Developer guide\n\n* Create a branch with a name including your user and a meaningful word about the fix/feature you\'re going to implement, ie: "jesusprubio/fixstuff"\n* Use [GitHub pull requests](https://help.github.com/articles/using-pull-requests).\n* Conventions:\n * We use [JSHint](http://jshint.com/) and [Crockford\'s Styleguide](http://javascript.crockford.com/code.html).\n * Please run `grunt lint` to be sure your code fits with them.\n\n\n### Debugging\n\nThe library includes the Node [debug](https://github.com/visionmedia/debug) module. In order to enable debugging:\n\nIn Node set the `DEBUG=rtcninja*` environment variable before running the application, or set it at the top of the script:\n\n```javascript\nprocess.env.DEBUG = \'rtcninja*\';\n```\n\nIn the browser run `rtcninja.debug.enable(\'rtcninja*\');` and reload the page. Note that the debugging settings are stored into the browser LocalStorage. To disable it run `rtcninja.debug.disable(\'rtcninja*\');`.\n\n\n## Copyright & License\n\n* eFace2Face Inc.\n* [MIT](./LICENSE)\n',readmeFilename:"README.md",gitHead:"d36b02d0503ca152771692935a4096130f28dc5d",bugs:{url:"https://github.com/eface2face/rtcninja.js/issues"},_id:"rtcninja@0.6.7",scripts:{},_shasum:"f7c8855f2c0e41ae08c638375bad1dc977369ec2",_from:"rtcninja@>=0.6.7 <0.7.0"}},{}],43:[function(t,e,n){var r=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,
names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(t){return t.encoding?"rtpmap:%d %s/%s/%s":t.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(t){return null!=t.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(t){return null!=t.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["value","uri","config"],format:function(t){return null!=t.config?"extmap:%s %s %s":"extmap:%s %s"}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(t){return null!=t.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation"],format:function(t){var e="candidate:%s %d %s %d %s %d typ %s";return e+=null!=t.raddr?" raddr %s rport %d":"%v%v",e+=null!=t.tcptype?" tcptype %s":"%v",null!=t.generation&&(e+=" generation %d"),e}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_]*):(.*)/,names:["id","attribute","value"],format:"ssrc:%d %s:%s"},{push:"ssrcGroups",reg:/^ssrc-group:(\w*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(t){return null!=t.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{push:"invalid",names:["value"]}]};Object.keys(r).forEach(function(t){var e=r[t];e.forEach(function(t){t.reg||(t.reg=/(.*)/),t.format||(t.format="%s")})})},{}],44:[function(t,e,n){var r=t("./parser"),s=t("./writer");n.write=s,n.parse=r.parse,n.parseFmtpConfig=r.parseFmtpConfig,n.parsePayloads=r.parsePayloads,n.parseRemoteCandidates=r.parseRemoteCandidates},{"./parser":45,"./writer":46}],45:[function(t,e,n){var r=function(t){return String(Number(t))===t?Number(t):t},s=function(t,e,n,s){if(s&&!n)e[s]=r(t[1]);else for(var i=0;i<n.length;i+=1)null!=t[i+1]&&(e[n[i]]=r(t[i+1]))},i=function(t,e,n){var r=t.name&&t.names;t.push&&!e[t.push]?e[t.push]=[]:r&&!e[t.name]&&(e[t.name]={});var i=t.push?{}:r?e[t.name]:e;s(n.match(t.reg),i,t.names,t.name),t.push&&e[t.push].push(i)},l=t("./grammar"),o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);n.parse=function(t){var e={},n=[],r=e;return t.split(/(\r\n|\r|\n)/).filter(o).forEach(function(t){var e=t[0],s=t.slice(2);"m"===e&&(n.push({rtp:[],fmtp:[]}),r=n[n.length-1]);for(var o=0;o<(l[e]||[]).length;o+=1){var a=l[e][o];if(a.reg.test(s))return i(a,r,s)}}),e.media=n,e};var a=function(t,e){var n=e.split(/=(.+)/,2);return 2===n.length&&(t[n[0]]=r(n[1])),t};n.parseFmtpConfig=function(t){return t.split(/\;\s?/).reduce(a,{})},n.parsePayloads=function(t){return t.split(" ").map(Number)},n.parseRemoteCandidates=function(t){for(var e=[],n=t.split(" ").map(r),s=0;s<n.length;s+=3)e.push({component:n[s],ip:n[s+1],port:n[s+2]});return e}},{"./grammar":43}],46:[function(t,e,n){var r=t("./grammar"),s=/%[sdv%]/g,i=function(t){var e=1,n=arguments,r=n.length;return t.replace(s,function(t){if(e>=r)return t;var s=n[e];switch(e+=1,t){case"%%":return"%";case"%s":return String(s);case"%d":return Number(s);case"%v":return""}})},l=function(t,e,n){var r=e.format instanceof Function?e.format(e.push?n:n[e.name]):e.format,s=[t+"="+r];if(e.names)for(var l=0;l<e.names.length;l+=1){var o=e.names[l];e.name?s.push(n[e.name][o]):s.push(n[e.names[l]])}else s.push(n[e.name]);return i.apply(null,s)},o=["v","o","s","i","u","e","p","c","b","t","r","z","a"],a=["i","c","b","a"];e.exports=function(t,e){e=e||{},null==t.version&&(t.version=0),null==t.name&&(t.name=" "),t.media.forEach(function(t){null==t.payloads&&(t.payloads="")});var n=e.outerOrder||o,s=e.innerOrder||a,i=[];return n.forEach(function(e){r[e].forEach(function(n){n.name in t&&null!=t[n.name]?i.push(l(e,n,t)):n.push in t&&null!=t[n.push]&&t[n.push].forEach(function(t){i.push(l(e,n,t))})})}),t.media.forEach(function(t){i.push(l("m",r.m[0],t)),s.forEach(function(e){r[e].forEach(function(n){n.name in t&&null!=t[n.name]?i.push(l(e,n,t)):n.push in t&&null!=t[n.push]&&t[n.push].forEach(function(t){i.push(l(e,n,t))})})})}),i.join("\r\n")+"\r\n"}},{"./grammar":43}],47:[function(t,e,n){e.exports={name:"jssip",title:"JsSIP",description:"the Javascript SIP library",version:"2.0.1",homepage:"http://jssip.net",author:"Jos Luis Milln <jmillan@aliax.net> (https://github.com/jmillan)",contributors:["Iaki Baz Castillo <ibc@aliax.net> (https://github.com/ibc)","Sal Ibarra Corretg <saghul@gmail.com> (https://github.com/saghul)"],main:"lib/JsSIP.js",keywords:["sip","websocket","webrtc","node","browser","library"],license:"MIT",repository:{type:"git",url:"https://github.com/versatica/JsSIP.git"},bugs:{url:"https://github.com/versatica/JsSIP/issues"},dependencies:{debug:"^2.2.0",rtcninja:"^0.6.7","sdp-transform":"^1.6.2"},devDependencies:{browserify:"^13.0.1",gulp:"git+https://github.com/gulpjs/gulp.git#4.0","gulp-expect-file":"0.0.7","gulp-header":"^1.8.2","gulp-jshint":"^2.0.1","gulp-nodeunit-runner":"^0.2.2","gulp-rename":"^1.2.2","gulp-uglify":"^1.5.3","gulp-util":"^3.0.7",jshint:"^2.9.2","jshint-stylish":"^2.2.0",pegjs:"0.7.0","vinyl-buffer":"^1.0.0","vinyl-source-stream":"^1.1.0"},scripts:{test:"gulp test"}}},{}]},{},[7])(7)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],79:[function(t,e,n){function r(t,e,n){var r;return function(){var s=this,i=arguments,l=function(){r=null,n||t.apply(s,i)},o=n&&!r;clearTimeout(r),r=setTimeout(l,e),o&&t.apply(s,i)}}function s(t,e){for(var n=e.charAt(0);t&&t!==document;t=t.parentNode)if("."===n){if(t.classList.contains(e.substr(1)))return t}else if("#"===n){if(t.id===e.substr(1))return t}else if("["===n){if(t.hasAttribute(e.substr(1,e.length-2)))return t}else if(t.nodeName===e.toUpperCase())return t;return!1}function i(t,e,n,r,s){var i=Number(new Date)+(r||2e3);s=s||300,function l(){t()?e():Number(new Date)<i?setTimeout(l,s):n(new Error("timed out for "+t+": "+arguments))}()}var l=t("lodash/string/template"),o=t("lodash/collection/forEach"),a=t("lodash/object/assign"),u=t("lodash/object/merge"),c=t("lodash/lang/isEqual"),d=t("lodash/string/trim"),h=t("lodash/function/throttle");t("lodash/function/debounce");e.exports={template:l,forEach:o,assign:a,merge:u,isEqual:c,trim:d,throttle:h,debounce:r,poll:i,findParent:s}},{"lodash/collection/forEach":4,"lodash/function/debounce":6,"lodash/function/throttle":8,"lodash/lang/isEqual":56,"lodash/object/assign":64,"lodash/object/merge":67,"lodash/string/template":69,"lodash/string/trim":71}],80:[function(t,e,n){var r=t("./widget.js");t("./core.js");e.exports=r.module},{"./core.js":76,"./widget.js":85}],81:[function(t,e,n){function r(t,e,n){var e=JSON.stringify(e);l("POST",t,e,function(t,e){return o.log("post respose: ",t,e),t?n(t):void n(null,e)})}function s(t,e,n){return t&&a[t]?n(null,a[t]):void l("GET",e,null,function(e,r){return e?n(e):(t&&(a[t]=r),void n(null,r))})}function i(t,e,n){l("PUT",t,e,function(t,e){return o.log("put respose: ",t,e),t?n(t):void n(null,e)})}function l(t,e,n,r){var s,i,l;s=new XMLHttpRequest,s.open(t,e,!0),l=setTimeout(function(){s.abort()},6e4),s.onreadystatechange=function(){if(4==s.readyState&&(clearTimeout(l),s.response)){if(i="POST"===t?JSON.parse(s.response):s.response,i.error)return r(i.error);r(null,i)}},"POST"===t&&s.setRequestHeader("Content-Type","application/json; charset=UTF-8"),n?s.send(n):s.send()}var o=t("./debug"),a={};e.exports={post:r,get:s,put:i}},{"./debug":77}],82:[function(t,e,n){(function(t){function n(t,e){return"session"===e?JSON.parse(u.getItem(c+d+t)):JSON.parse(a.getItem(c+d+t))}function r(t,e,n){return"session"===n?u.setItem(c+d+t,JSON.stringify(e)):a.setItem(c+d+t,JSON.stringify(e)),e}function s(t,e){"session"===e?u.removeItem(c+d+t):a.removeItem(c+d+t)}function i(t,e){return e?"cache"===e?h[t]:n(t,e):void 0!==h[t]&&null!==h[t]?h[t]:n(t)}function l(t,e,n){return h[t]=e,"cache"!==n&&r(t,e,n),e}function o(t,e){delete h[t],s(t)}var a=t.localStorage,u=t.sessionStorage,c="swc",d=".",h={sid:null,eventTimestamp:0,msgTimestamp:0,entity:null,chat:null};e.exports={get:n,set:r,remove:s,getState:i,saveState:l,removeState:o}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],83:[function(require,module,exports){var _={},escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},escapeRegexp=new RegExp("["+Object.keys(escapeMap).join("")+"]","g");_.escape=function(t){return t?String(t).replace(escapeRegexp,function(t){return escapeMap[t]}):""},exports.email=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){var prefix=defaults.prefix;__p+='\n<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">\n<html xmlns="http://www.w3.org/1999/xhtml">\n    <head>\n        <meta http-equiv="Content-Type" content="text/html; charset=windows-1251" />\n        <!--[if !mso]><!-->\n            <meta http-equiv="X-UA-Compatible" content="IE=edge" />\n        <!--<![endif]-->\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title></title>\n        <!--[if (gte mso 9)|(IE)]>\n        <style type="text/css">\n            table {border-collapse: collapse;}\n        </style>\n        <![endif]-->\n        <style type="text/css">\n            /* Basics */\n            body {\n            Margin: 0;\n                padding: 0;\n                min-width: 100%;\n                background-color: #ffffff;\n            }\n            table {\n                border-spacing: 0;\n                font-family: sans-serif;\n                color: #333333;\n            }\n            td {\n                padding: 0;\n            }\n            img {\n                border: 0;\n            }\n            .wrapper {\n                width: 100%;\n                table-layout: fixed;\n                -webkit-text-size-adjust: 100%;\n                -ms-text-size-adjust: 100%;\n                background-color: #F1F1F1;\n            }\n            .webkit {\n                max-width: 500px;\n            }\n            .outer {\n            Margin: 0 auto;\n                height: 100%;\n                width: 95%;\n                max-width: 500px;\n                padding: 10px;\n            }\n            p {\n                Margin: 0;\n            }\n            a {\n                color: #ee6a56;\n                text-decoration: underline;\n            }\n            .h1 {\n                font-size: 21px;\n                font-weight: bold;\n                Margin-bottom: 18px;\n            }\n            .h2 {\n                font-size: 18px;\n                font-weight: bold;\n                Margin-bottom: 12px;\n            }\n             \n            /* One column layout */\n            .one-column .contents {\n                text-align: left;\n                color:#505050;\n                font-family:Arial;\n                font-size:14px;\n                line-height:150%;\n            }\n            .one-column p {\n                font-size: 14px;\n                Margin-bottom: 10px;\n            }\n            .'+__e(prefix)+"-message {\n                display: block;\n                margin-bottom: 10px;\n                padding: 10px;\n                background-color: #FFFFFF;\n                border-bottom: 4px solid #CCCCCC;\n            }\n            ."+__e(prefix)+"-message img {\n                width: 100%;\n                max-width: 500px;\n                height: auto;\n            }\n            ."+__e(prefix)+"-message span {\n                font-weight: bold;\n                color: #999999;\n            }\n            ."+__e(prefix)+"-agent-msg ."+__e(prefix)+"-message-from {\n                color: #555555;\n            }\n            ."+__e(prefix)+"-user-msg ."+__e(prefix)+"-message-from {\n                color: #F75B5D;\n            }\n\n            ."+__e(prefix)+"-message ."+__e(prefix)+'-message-time {\n                position: relative;\n                float: right;\n            }\n            .copyright {\n                margin-top: 5px;\n                font-size: 12px;\n                font-style: italic;\n                color: #CCCCCC;\n                text-align: right;\n            }\n\n        </style>\n    </head>\n    <body>\n        <center class="wrapper">\n            <div class="webkit">\n                <!--[if (gte mso 9)|(IE)]>\n                <table width="500" align="center" cellpadding="0" cellspacing="0" border="0">\n                <tr>\n                <td>\n                <![endif]-->\n                <table class="outer" align="center" cellpadding="0" cellspacing="0" border="0">\n                    <tr>\n                        <td class="one-column">\n                            <table width="100%">\n                                <tr>\n                                    <td class="inner contents">\n                                        '+(null==(__t=content)?"":__t)+"\n                                    </td>\n                                </tr>\n                            </table>\n                        </td>\n                    </tr>\n                </table>\n                <!--[if (gte mso 9)|(IE)]>\n                </td>\n                </tr>\n                </table>\n                <![endif]-->\n            </div>\n        </center>\n    </body>\n</html>"}return __p};var _={},escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},escapeRegexp=new RegExp("["+Object.keys(escapeMap).join("")+"]","g");_.escape=function(t){return t?String(t).replace(escapeRegexp,function(t){return escapeMap[t]}):""},exports.forms=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="'+__e(defaults.prefix)+"-message "+__e(defaults.prefix)+"-"+__e(message.entity)+'-msg">\n\t<span class="'+__e(defaults.prefix)+'-message-from">'+__e(message.from)+'</span>\n\t<div class="'+__e(defaults.prefix)+'-message-content" ',"user"===message.entity&&(__p+=" style=\"border-color:'"+__e(defaults.styles.primary.backgroundColor)+'" '),__p+='>\n\t\t<form id="'+__e(defaults.prefix)+"-"+__e(form.name)+'" name="'+__e(form.name)+'" ',form.autocomplete&&(__p+='autocomplete="on"'),__p+=' data-validate-form="true">\n\t\t\t',form.description&&(__p+='\n\t\t\t\t<p style="margin: 10px 0">'+(null==(__t=frases.FORMS.DESCRIPTIONS[form.description]||form.description)?"":__t)+"</p>\n\t\t\t"),__p+="\n\t\t\t",_.forEach(form.fields,function(t){__p+="\n\t\t\t\t","select"===t.type?(__p+='\n\t\t\t\t\t<select name="'+__e(t.name)+'">\n\t\t\t\t\t\t',_.forEach(t.options,function(t){__p+='\n\t\t\t\t\t\t\t<option value="'+__e(t.value)+'" ',t.selected&&(__p+=" selected "),__p+=" >\n\t\t\t\t\t\t\t\t"+__e(frases.FORMS.PLACEHOLDERS[t.text]||t.text)+"\n\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t"}),__p+="\n\t\t\t\t\t</select>\n\t\t\t\t"):"textarea"===t.type?(__p+='\n\t\t\t\t\t<textarea \n\t\t\t\t\t\tname="'+__e(t.name)+'"\n\t\t\t\t\t\tplaceholder="'+(null==(__t=frases.FORMS.PLACEHOLDERS[t.placeholder]||frases.FORMS.PLACEHOLDERS[t.name])?"":__t)+" ",t.required&&(__p+="*"),__p+='"\n\t\t\t\t\t></textarea>\n\t\t\t\t'):(__p+='\n\t\t\t\t\t<input \n\t\t\t\t\t\ttype="'+(null==(__t=t.type||"text")?"":__t)+'"\n\t\t\t\t\t\tplaceholder="'+(null==(__t=frases.FORMS.PLACEHOLDERS[t.placeholder]||frases.FORMS.PLACEHOLDERS[t.name])?"":__t)+" ",t.required&&(__p+="*"),__p+='"\n\t\t\t\t\t\tname="'+__e(t.name)+'" ',t.value&&(__p+='\n\t\t\t\t\t\tvalue="'+__e(credentials[t.value])+'" '),__p+=" ",t.required&&(__p+="required"),__p+="\n\t\t\t\t\t/>\n\t\t\t\t"),__p+="\n\t\t\t"}),__p+='\n\t\t\t<button \n\t\t\t\ttype="submit"\n\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block"\n\t\t\t\tstyle="background-color: '+__e(defaults.styles.primary.backgroundColor)+"; color: "+__e(defaults.styles.primary.color)+"; border: 1px solid "+__e(defaults.styles.primary.backgroundColor)+';">'+__e(frases.FORMS.send)+'</button>\n\t\t\t<button\n\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block"\n\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="rejectForm">'+__e(frases.FORMS.cancel)+'</button>\n\t\t</form>\n\t</div>\n\t<span class="'+__e(defaults.prefix)+'-message-time"> '+__e(message.time)+"</span>\n</div>";return __p};var _={},escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},escapeRegexp=new RegExp("["+Object.keys(escapeMap).join("")+"]","g");_.escape=function(t){return t?String(t).replace(escapeRegexp,function(t){return escapeMap[t]}):""},exports.message=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="'+__e(defaults.prefix)+"-message "+__e(defaults.prefix)+"-"+__e(message.entity)+'-msg">\n\t<span class="'+__e(defaults.prefix)+'-message-from">'+__e(message.from)+'</span>\n\t<div class="'+__e(defaults.prefix)+'-message-content"\n\t\t',"user"!==message.entity&&(__p+=' \n\t\t\tstyle="border-color:'+(null==(__t=defaults.styles.primary.backgroundColor)?"":__t)+'" \n\t\t'),__p+=">\n\t\t<p>"+(null==(__t=message.content)?"":__t)+'</p>\n\t</div>\n\t<span class="'+__e(defaults.prefix)+'-message-time"> '+__e(message.time)+"</span>\n</div>";return __p};var _={},escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},escapeRegexp=new RegExp("["+Object.keys(escapeMap).join("")+"]","g");_.escape=function(t){return t?String(t).replace(escapeRegexp,function(t){return escapeMap[t]}):""},exports.widget=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){var frases=translations;__p+="\n";var panels=frases.PANELS;__p+="\n";var channels=defaults.channels;__p+="\n";var positionClass="right"===defaults.position?"position-right":"position-left";__p+='\n<div id="'+__e(defaults.prefix)+'-wg-cont" class="'+__e(defaults.prefix)+"-wg-cont "+__e(positionClass)+'">\n\n\t<!-- ***** Panes container ***** -->\n\t<div \n\t\tid="'+__e(defaults.prefix)+'-wg-panes" \n\t\tclass="'+__e(defaults.prefix)+'-wg-panes" \n\t\tstyle="',defaults.styles.width&&(__p+="width: "+__e(defaults.styles.width)+";"),__p+='">\n\n\t\t<!-- ***** Top bar ***** -->\n\t\t<div \n\t\t\tclass="'+__e(defaults.prefix)+'-top-bar" \n\t\t\tstyle="background: '+__e(defaults.styles.primary.backgroundColor)+"; color: "+__e(defaults.styles.primary.color)+';">\n\n\t\t\t<!-- Main title -->\n\t\t\t<h4 class="'+__e(defaults.prefix)+"-wg-title "+__e(defaults.prefix)+'-uppercase">\n\t\t\t\t'+__e(defaults.title||frases.TOP_BAR.title)+'\n\t\t\t</h4>\n\n\t\t\t<div class="'+__e(defaults.prefix)+'-wg-state-cont">\n\t\t\t\t<span class="'+__e(defaults.prefix)+'-wg-state-icon"> </span>\n\t\t\t\t<span class="'+__e(defaults.prefix)+'-wg-state"></span>\n\t\t\t</div>\n\n\t\t\t<!-- Action buttons (minimize, close) -->\n\t\t\t<div class="'+__e(defaults.prefix)+'-wg-minimize">\n\n\t\t\t\t<!--<a \n\t\t\t\t\thref="#" \n\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="closeWidget">\n\t\t\t\t\t\n\t\t\t\t\t<span style="font-weight: bold">_</span>\n\t\t\t\t\n\t\t\t\t</a>-->\n\t\t\t\t\n\t\t\t\t<a \n\t\t\t\t\thref="#" \n\t\t\t\t\tstyle="color: '+__e(defaults.styles.primary.color)+'"\n\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="closeWidget"\n\t\t\t\t\t<span class="'+__e(defaults.prefix)+'-icon-remove"></span>\n\n\t\t\t\t</a>\n\n\t\t\t</div>\n\t\t</div>\n\t\t<!-- ***** Top bar ends ***** -->\n\n\t\t<!-- ***** Connection types pane ***** -->\n\t\t<div \n\t\t\tclass="'+__e(defaults.prefix)+'-wg-pane" \n\t\t\tdata-'+__e(defaults.prefix)+'-pane="chooseConnection">\n\t\t\t\n\t\t\t<!-- Panel\'s image container -->\n\t\t\t<div \n\t\t\t\tclass="'+__e(defaults.prefix)+"-pane-header "+__e(defaults.prefix)+'-dark" \n\t\t\t\t',defaults.styles.intro.backgroundImage&&(__p+=' \n\t\t\t\t\tstyle="background-image: url('+__e(defaults.clientPath)+__e(defaults.styles.intro.backgroundImage)+')" \n\t\t\t\t'),__p+='>\n\n\t\t\t\t<!-- The text displayed on image -->\n\t\t\t\t<div class="'+__e(defaults.prefix)+"-backdrop-cont "+__e(defaults.prefix)+'-white">\n\t\t\t\t\t<br>\n\t\t\t\t\t<p>'+__e(panels.CONNECTION_TYPES.choose_conn_type)+'</p>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\n\t\t\t\t<form \n\t\t\t\t\tid="'+__e(defaults.prefix)+'-init-form" \n\t\t\t\t\tname="'+__e(defaults.prefix)+'InitForm">\n\n\t\t\t\t\t',channels.webrtc&&(__p+=" \n\t\t\t\t\t\t<!-- Display call button if WebRTC is enabled and supported by the browser -->\n\t\t\t\t\t\t",defaults.webrtcEnabled?__p+=' \n\t\t\t\t\t\t\t<button \n\t\t\t\t\t\t\t\ttype="button" \n\t\t\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n\t\t\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\t\t\tbackground: '+__e(defaults.styles.primary.backgroundColor)+"; \n\t\t\t\t\t\t\t\t\tcolor: "+__e(defaults.styles.primary.color)+"; \n\t\t\t\t\t\t\t\t\tborder: 1px solid "+__e(defaults.styles.primary.color)+';"\n\t\t\t\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="initCall">\n\n\t\t\t\t\t\t\t\t'+__e(panels.CONNECTION_TYPES.call_agent_btn)+"\n\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<!-- If WebRTC is not supported and fallback is set -->\n\t\t\t\t\t\t":channels.webrtc.fallback&&channels.webrtc.fallback.sipCall&&(__p+='\n\t\t\t\t\t\t\t<button \n\t\t\t\t\t\t\t\ttype="button" \n\t\t\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n\t\t\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\t\t\tbackground: '+__e(defaults.styles.primary.backgroundColor)+"; \n\t\t\t\t\t\t\t\t\tcolor: "+__e(defaults.styles.primary.color)+"; \n\t\t\t\t\t\t\t\t\tborder: 1px solid "+__e(defaults.styles.primary.color)+';"\n\t\t\t\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="initFallbackCall">\n\n\t\t\t\t\t\t\t\t'+__e(panels.CONNECTION_TYPES.call_agent_btn)+"\n\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t"),__p+="\n\t\t\t\t\t"),__p+="\n\n\t\t\t\t\t<!-- Display callback button if callback task is configured in the settings -->\n\t\t\t\t\t",channels.callback&&channels.callback.task&&(__p+='\n\t\t\t\t\t\t<button \n\t\t\t\t\t\t\ttype="button" \n\t\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n\t\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\t\tbackground: '+__e(defaults.styles.primary.backgroundColor)+"; \n\t\t\t\t\t\t\t\tcolor: "+__e(defaults.styles.primary.color)+"; \n\t\t\t\t\t\t\t\tborder: 1px solid "+__e(defaults.styles.primary.color)+';"\n\t\t\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="initCallback">\n\n\t\t\t\t\t\t\t'+__e(panels.CONNECTION_TYPES.callback_btn)+"\n\n\t\t\t\t\t\t</button>\n\t\t\t\t\t"),__p+="\n\n\t\t\t\t\t<!-- Init chat button -->\n\t\t\t\t\t",defaults.chat&&(__p+='\n\t\t\t\t\t<button\n\t\t\t\t\t\ttype="button" \n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n\t\t\t\t\t\tstyle="background: '+__e(defaults.styles.primary.backgroundColor)+"; color: "+__e(defaults.styles.primary.color)+"; border: 1px solid "+__e(defaults.styles.primary.color)+';"\n\t\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="initChat">\n\t\t\t\t\t\t'+__e(panels.CONNECTION_TYPES.chat_agent_btn)+"\n\t\t\t\t\t</button>\n\t\t\t\t\t"),__p+='\n\n\t\t\t\t\t<!-- Close widget button -->\n\t\t\t\t\t<a href="#" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block" data-'+__e(defaults.prefix)+'-handler="closeWidget">'+__e(panels.CONNECTION_TYPES.cancel)+"</a>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t\t<!-- ***** Connection types pane ends ***** -->\n\n\t\t<!-- ***** Intro pane. Displayed if configured in the settings object. ***** -->\n\t\t",defaults.intro.length&&(__p+='\n\t\t\t<div \n\t\t\t\tclass="'+__e(defaults.prefix)+'-wg-pane" \n\t\t\t\tdata-'+__e(defaults.prefix)+'-pane="credentials">\n\n\t\t\t\t<!-- Panel\'s image container -->\n\t\t\t\t<div \n\t\t\t\t\tclass="'+__e(defaults.prefix)+"-pane-header "+__e(defaults.prefix)+'-dark" \n\t\t\t\t\t',defaults.styles.intro.backgroundImage&&(__p+=' \n\t\t\t\t\t\tstyle="background-image: url('+__e(defaults.clientPath)+__e(defaults.styles.intro.backgroundImage)+')" \n\t\t\t\t\t'),__p+='>\n\n\t\t\t\t\t<!-- The text displayed on image -->\n\t\t\t\t\t<div class="'+__e(defaults.prefix)+"-backdrop-cont "+__e(defaults.prefix)+'-white">\n\t\t\t\t\t\t<br>\n\t\t\t\t\t\t<p>'+__e(panels.INTRO.intro_message)+'</p>\n\t\t\t\t\t</div>\n\n\t\t\t\t</div>\n\n\t\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\t\t\t\t\t<form \n\t\t\t\t\t\tid="'+__e(defaults.prefix)+'-intro-form" \n\t\t\t\t\t\tname="'+__e(defaults.prefix)+'IntroForm" \n\t\t\t\t\t\tdata-validate-form="true">\n\n\t\t\t\t\t\t<!-- Iterating over intro array, which is a list of fields and their properties -->\n\t\t\t\t\t\t',_.forEach(defaults.intro,function(t){__p+="\n\t\t\t\t\t\t\t","lang"===t.name?(__p+='\n\t\t\t\t\t\t\t\t<select name="lang">\n\t\t\t\t\t\t\t\t\t',_.forEach(languages,function(t){__p+='\n\t\t\t\t\t\t\t\t\t\t<option \n\t\t\t\t\t\t\t\t\t\t\tvalue="'+__e(t)+'" \n\t\t\t\t\t\t\t\t\t\t\t',t===currLang&&(__p+=" selected "),__p+=" >\n\t\t\t\t\t\t\t\t\t\t\t"+__e(translations[t].lang)+"\n\t\t\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t\t"}),__p+="\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t"):"message"===t.name?(__p+='\n\t\t\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\t\t\tname="message"\n\t\t\t\t\t\t\t\t\tplaceholder="'+(null==(__t=t.placeholder||panels.INTRO.PLACEHOLDERS[t.name])?"":__t)+" ",t.required&&(__p+=" * "),__p+='"\n\t\t\t\t\t\t\t\t></textarea>\n\t\t\t\t\t\t\t'):(__p+='\n\t\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\t\ttype="'+(null==(__t=t.type||"text")?"":__t)+'" \n\t\t\t\t\t\t\t\t\tplaceholder="'+(null==(__t=t.placeholder||panels.INTRO.PLACEHOLDERS[t.name])?"":__t)+" ",t.required&&(__p+=" * "),__p+='" \n\t\t\t\t\t\t\t\t\tname="'+__e(t.name)+'" \n\t\t\t\t\t\t\t\t\t',t.save&&(__p+=' value="'+__e(credentials[t.name])+'" '),__p+=" \n\t\t\t\t\t\t\t\t\t",t.required&&(__p+=" required "),__p+=">\n\t\t\t\t\t\t\t"),__p+="\n\n\t\t\t\t\t\t"}),__p+='\n\n\t\t\t\t\t\t<!-- Init chat with intro properties -->\n\t\t\t\t\t\t<button \n\t\t\t\t\t\t\ttype="submit" \n\t\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n\t\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\t\tbackground: '+__e(defaults.styles.primary.backgroundColor)+"; \n\t\t\t\t\t\t\t\tcolor: "+__e(defaults.styles.primary.color)+"; \n\t\t\t\t\t\t\t\tborder: 1px solid "+__e(defaults.styles.primary.color)+';">\n\n\t\t\t\t\t\t\t'+__e(panels.INTRO.start_dialog_button)+'\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t<!-- Close widget button -->\n\t\t\t\t\t\t<a href="#" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block" data-'+__e(defaults.prefix)+'-handler="closeWidget">'+__e(panels.INTRO.cancel)+"</a>\n\t\t\t\t\t</form>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"),__p+='\n\t\t<!-- ***** Intro pane ends ***** -->\n\n\t\t<!-- ***** Messages pane ***** -->\n\t\t<div  class="'+__e(defaults.prefix)+'-wg-pane" data-'+__e(defaults.prefix)+'-pane="messages">\n\t\t\t\n\t\t\t<!-- Messages container -->\n\t\t\t<ul \n\t\t\t\tid="'+__e(defaults.prefix)+'-messages-cont" \n\t\t\t\tclass="'+__e(defaults.prefix)+'-messages-cont" \n\t\t\t\tstyle="\n\t\t\t\t\t',defaults.styles.height&&(__p+="\n\t\t\t\t\t\theight: "+__e(defaults.styles.height)+";\n\t\t\t\t\t"),__p+='">\n\t\t\t\t\t\n\t\t\t</ul>\n\n\t\t\t<div class="'+__e(defaults.prefix)+'-write-cont">\n\t\t\t\t\n\t\t\t\t<!-- End dialog button -->\n\t\t\t\t<div class="'+__e(defaults.prefix)+'-end-dialog-btn">\n\t\t\t\t\t<a href="#" data-'+__e(defaults.prefix)+'-handler="finish">'+__e(panels.MESSAGES.end_dialog)+'</a>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- "Agent is typing" indicator -->\n\t\t\t\t<div class="'+__e(defaults.prefix)+'-loader">\n\t\t\t\t\t<span></span>\n\t\t\t\t\t<span></span>\n\t\t\t\t\t<span></span>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- "Attach file" button -->\n\t\t\t\t<label \n\t\t\t\t\tclass="'+__e(defaults.prefix)+'-sendfile-cont" \n\t\t\t\t\tfor="'+__e(defaults.prefix)+'-file-select">\n\n\t\t\t\t\t<input \n\t\t\t\t\t\ttype="file" \n\t\t\t\t\t\tid="'+__e(defaults.prefix)+'-file-select">\n\t\t\t\t\t\n\t\t\t\t\t<span \n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+'-icon-upload" \n\t\t\t\t\t\tstyle="color: '+__e(defaults.styles.primary.backgroundColor)+'">\n\t\t\t\t\t<span>\n\n\t\t\t\t</label>\n\n\t\t\t\t<div id="'+__e(defaults.prefix)+'-message-text-clone"  class="'+__e(defaults.prefix)+'-msg-textarea-clone" ></div>\n\n\t\t\t\t<!-- Field for typing the user message -->\n\t\t\t\t<textarea \n\t\t\t\t\tid="'+__e(defaults.prefix)+'-message-text" \n\t\t\t\t\tclass="'+__e(defaults.prefix)+'-msg-textarea" \n\t\t\t\t\tplaceholder="'+__e(panels.MESSAGES.PLACEHOLDERS.message)+'" \n\t\t\t\t\tmaxlength="1000"></textarea>\n\t\t\t\t\n\t\t\t\t<!-- "Send a message" button -->\n\t\t\t\t<a \n\t\t\t\t\thref="#" \n\t\t\t\t\tclass="'+__e(defaults.prefix)+"-sendmsg-btn "+__e(defaults.prefix)+'-button" \n\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="sendMessage">\n\n\t\t\t\t\t<span \n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+'-icon-paper-plane" \n\t\t\t\t\t\tstyle="color: '+__e(defaults.styles.primary.backgroundColor)+'">\n\t\t\t\t\t</span>\n\t\t\t\t</a>\n\n\t\t\t</div>\n\t\t</div>\n\t\t<!-- ***** Messages pane ends ***** -->\n\n\t\t<!-- ***** Offline pane ***** -->\n\t\t<div \n\t\t\tclass="'+__e(defaults.prefix)+'-wg-pane" \n\t\t\tdata-'+__e(defaults.prefix)+'-pane="sendemail">\n\n\t\t\t<!-- Panel\'s image container -->\n\t\t\t<div \n\t\t\t\tclass="'+__e(defaults.prefix)+"-pane-header "+__e(defaults.prefix)+'-dark" \n\t\t\t\t',defaults.styles.sendmail.backgroundImage&&(__p+=' \n\t\t\t\t\tstyle="background-image: url('+__e(defaults.clientPath)+__e(defaults.styles.sendmail.backgroundImage)+')" \n\t\t\t\t'),
__p+='>\n\n\t\t\t\t<!-- The text displayed on image -->\n\t\t\t\t<div class="'+__e(defaults.prefix)+"-backdrop-cont "+__e(defaults.prefix)+'-dark">\n\t\t\t\t\t<p>'+__e(panels.OFFLINE.offline_message)+'</p>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\n\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\t\t\t\t<h4 class="'+__e(defaults.prefix)+'-uppercase">'+__e(panels.OFFLINE.send_message_header)+'</h4>\n\t\t\t\t<form id="'+__e(defaults.prefix)+'-sendmail-form" data-validate-form="true">\n\t\t\t\t\t<input type="text" name="uname" placeholder="'+__e(panels.OFFLINE.PLACEHOLDERS.uname)+'">\n\t\t\t\t\t<input type="email" name="email" placeholder="'+__e(panels.OFFLINE.PLACEHOLDERS.email)+' *" required>\n\t\t\t\t\t<textarea name="text" placeholder="'+__e(panels.OFFLINE.PLACEHOLDERS.message)+'" maxlength="1500"></textarea>\n\n\t\t\t\t\t<input type="file" name="file" id="'+__e(defaults.prefix)+'-contactfile" class="'+__e(defaults.prefix)+'-inputfile" />\n\t\t\t\t\t<label for="'+__e(defaults.prefix)+'-contactfile">'+__e(panels.OFFLINE.choose_file)+'</label>\n\n\t\t\t\t\t<!-- "Send offline message" button -->\n\t\t\t\t\t<button \n\t\t\t\t\t\ttype="submit" \n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\tbackground: '+__e(defaults.styles.primary.backgroundColor)+"; \n\t\t\t\t\t\t\tcolor: "+__e(defaults.styles.primary.color)+"; \n\t\t\t\t\t\t\tborder: 1px solid "+__e(defaults.styles.primary.color)+';">\n\n\t\t\t\t\t\t'+__e(panels.OFFLINE.send_message_button)+'\n\t\t\t\t\t\t\t\n\t\t\t\t\t</button>\n\n\t\t\t\t\t<!-- Close widget button -->\n\t\t\t\t\t<a href="#" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block" data-'+__e(defaults.prefix)+'-handler="closeWidget">'+__e(panels.OFFLINE.close)+'</a>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t\t<!-- ***** Offline pane ends ***** -->\n\n\t\t<!-- ***** Close chat pane ***** -->\n\t\t<div \n\t\t\tclass="'+__e(defaults.prefix)+'-wg-pane" \n\t\t\tdata-'+__e(defaults.prefix)+'-pane="closechat">\n\n\t\t\t<!-- Panel\'s image container -->\n\t\t\t<div \n\t\t\t\tclass="'+__e(defaults.prefix)+"-pane-header "+__e(defaults.prefix)+'-white" \n\t\t\t\t',defaults.styles.closeChat.backgroundImage&&(__p+=' \n\t\t\t\t\tstyle="background-image: url('+__e(defaults.clientPath)+__e(defaults.styles.closeChat.backgroundImage)+')" \n\t\t\t\t'),__p+='>\n\n\t\t\t\t<!-- The text displayed on image -->\n\t\t\t\t<div class="'+__e(defaults.prefix)+"-backdrop-cont "+__e(defaults.prefix)+'-white">\n\t\t\t\t\t<br>\n\t\t\t\t\t<p>'+__e(panels.CLOSE_CHAT.close_chat_header)+'</p>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\n\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\t\t\t\t<form id="'+__e(defaults.prefix)+'-closechat-form" data-validate-form="true">\n\t\t\t\t\t<label for="'+__e(defaults.prefix)+'-send-dialog">\n\t\t\t\t\t\t<input type="checkbox" name="sendDialog" id="'+__e(defaults.prefix)+'-send-dialog" />\n\t\t\t\t\t\t<span>'+__e(panels.CLOSE_CHAT.send_dialog_label)+'</span>\n\t\t\t\t\t</label>\n\t\t\t\t\t<input type="email" name="email" placeholder="'+__e(panels.CLOSE_CHAT.PLACEHOLDERS.email)+'">\n\t\t\t\t\t<select name="rating">\n\t\t\t\t\t\t<option value="">--- '+__e(panels.CLOSE_CHAT.rate_agent)+' ---</option>\n\t\t\t\t\t\t<option value="5">'+__e(frases.AGENT_RATES.excellent)+'</option>\n\t\t\t\t\t\t<option value="4">'+__e(frases.AGENT_RATES.good)+'</option>\n\t\t\t\t\t\t<option value="3">'+__e(frases.AGENT_RATES.fair)+'</option>\n\t\t\t\t\t\t<option value="2">'+__e(frases.AGENT_RATES.bad)+'</option>\n\t\t\t\t\t</select>\n\t\t\t\t\t<textarea placeholder="'+__e(panels.CLOSE_CHAT.PLACEHOLDERS.comment)+'" name="text" maxlength="1500"></textarea>\n\n\t\t\t\t\t<!-- End chat and close widget button -->\n\t\t\t\t\t<button \n\t\t\t\t\t\ttype="submit" \n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block" \n\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\tbackground: '+__e(defaults.styles.primary.backgroundColor)+"; \n\t\t\t\t\t\t\tcolor: "+__e(defaults.styles.primary.color)+"; \n\t\t\t\t\t\t\tborder: 1px solid "+__e(defaults.styles.primary.color)+';">\n\n\t\t\t\t\t\t'+__e(panels.CLOSE_CHAT.finish_dialog_button)+'\n\t\t\t\t\t\t\t\n\t\t\t\t\t</button>\n\n\t\t\t\t\t<!-- "Back to the chat" button -->\n\t\t\t\t\t<a href="#messages" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block">'+__e(panels.CLOSE_CHAT.back)+'</a>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t\t<!-- ***** Close chat pane ends ***** -->\n\n\t\t<!-- ***** Audio call pane ***** -->\n\t\t<div class="'+__e(defaults.prefix)+'-wg-pane" data-'+__e(defaults.prefix)+'-pane="callAgent">\n\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\t\t\t\t<div id="'+__e(defaults.prefix)+'-call-spinner" class="'+__e(defaults.prefix)+'-spinner-pane">\n\t\t\t\t\t<h3 class="'+__e(defaults.prefix)+'-text-center">'+__e(panels.AUDIO_CALL.confirm_access)+'</h3>\n\t\t\t\t\t<h3 class="'+__e(defaults.prefix)+"-text-center "+__e(defaults.prefix)+"-loader "+__e(defaults.prefix)+'-shown" style="position: relative;">\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t</h3>\n\t\t\t\t</div>\n\t\t\t\t<div id="'+__e(defaults.prefix)+'-call-info" class="'+__e(defaults.prefix)+'-hidden">\n\t\t\t\t\t<h3 class="'+__e(defaults.prefix)+'-text-center" id="'+__e(defaults.prefix)+'-call-state">'+__e(panels.AUDIO_CALL.calling_agent)+'</h3>\n\t\t\t\t\t<h3 class="'+__e(defaults.prefix)+'-text-center" id="'+__e(defaults.prefix)+'-call-timer">00:00</h3>\n\t\t\t\t</div>\n\t\t\t\t<form id="'+__e(defaults.prefix)+'-call-control">\n\t\t\t\t\t<hr>\n\t\t\t\t\t<button\n\t\t\t\t\t\tid="'+__e(defaults.prefix)+'-tryagain-btn"\n\t\t\t\t\t\ttype="button"\n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+"-block "+__e(defaults.prefix)+'-hidden"\n\t\t\t\t\t\tstyle="background: '+__e(defaults.styles.primary.backgroundColor)+"; color: "+__e(defaults.styles.primary.color)+"; border: 1px solid "+__e(defaults.styles.primary.color)+';"\n\t\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="initCall">\n\t\t\t\t\t\t'+__e(panels.AUDIO_CALL.try_again)+'\n\t\t\t\t\t</button>\t\n\t\t\t\t\t<button \n\t\t\t\t\t\ttype="button"\n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-warn "+__e(defaults.prefix)+'-block"\n\t\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="endCall">\n\n\t\t\t\t\t\t'+__e(panels.AUDIO_CALL.end_call)+'\n\n\t\t\t\t\t</button>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t\t<!-- ***** Audio call pane ends ***** -->\n\n\t\t<!-- ***** Audio call fallback pane ***** -->\n\t\t<div class="'+__e(defaults.prefix)+'-wg-pane" data-'+__e(defaults.prefix)+'-pane="callAgentFallback">\n\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\t\t\t\t<div class="'+__e(defaults.prefix)+'-text-center">\n\t\t\t\t\t<h3>'+__e(panels.AUDIO_CALL_FALLBACK.DOWNLOAD_MSG)+"</h3>\n\t\t\t\t\t<br>\n\t\t\t\t\t",defaults.webrtc&&defaults.webrtc.fallback&&(__p+='\n\t\t\t\t\t\t<a href="'+__e(defaults.webrtc.fallback.sipCall)+'">call.jnlp</a>\n\t\t\t\t\t'),__p+='\n\t\t\t\t</div>\n\t\t\t\t<form>\n\t\t\t\t\t<hr>\n\t\t\t\t\t<a href="#chooseConnection" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block">'+__e(panels.CALLBACK.back)+'</a>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t\t<!-- ***** Audio call fallback pane ends ***** -->\n\n\t\t<!-- ***** Callback pane ***** -->\n\t\t<div \n\t\t\tclass="'+__e(defaults.prefix)+'-wg-pane" \n\t\t\tdata-'+__e(defaults.prefix)+'-pane="callback">\n\n\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\t\t\t\t<div id="'+__e(defaults.prefix)+'-callback-spinner" class="'+__e(defaults.prefix)+"-hidden "+__e(defaults.prefix)+'-spinner-pane">\n\t\t\t\t\t<h3 class="'+__e(defaults.prefix)+'-text-center">'+__e(panels.CALLBACK.sending_request)+'</h3>\n\t\t\t\t\t<h3 class="'+__e(defaults.prefix)+"-text-center "+__e(defaults.prefix)+"-loader "+__e(defaults.prefix)+'-shown" style="position: relative;">\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t</h3>\n\t\t\t\t</div>\n\t\t\t\t<form id="'+__e(defaults.prefix)+'-callback-settings">\n\t\t\t\t\t<p class="'+__e(defaults.prefix)+'-text-center">'+__e(panels.CALLBACK.title)+"</p>\n\t\t\t\t\t<hr>\n\t\t\t\t\t<label>"+__e(panels.CALLBACK.LABELS.phone)+'</label>\n\t\t\t\t\t<input type="tel" name="phone" placeholder="'+__e(panels.CALLBACK.PLACEHOLDERS.phone)+'" required>\n\t\t\t\t\t<label>'+__e(panels.CALLBACK.LABELS.time)+'</label>\n\t\t\t\t\t<select name="time">\n\t\t\t\t\t\t',_.forEach(panels.CALLBACK.TIME_POINTS,function(t){__p+='\n\t\t\t\t\t\t\t<option value="'+__e(t.minutes)+'">'+__e(t.label)+"</option>\n\t\t\t\t\t\t"}),__p+='\n\t\t\t\t\t</select>\n\t\t\t\t\t<hr>\n\n\t\t\t\t\t<button\n\t\t\t\t\t\ttype="submit"\n\t\t\t\t\t\tclass="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+"-button-primary "+__e(defaults.prefix)+'-block"\n\t\t\t\t\t\tstyle="\n\t\t\t\t\t\t\tbackground: '+__e(defaults.styles.primary.backgroundColor)+"; \n\t\t\t\t\t\t\tcolor: "+__e(defaults.styles.primary.color)+"; \n\t\t\t\t\t\t\tborder: 1px solid "+__e(defaults.styles.primary.color)+';"\n\t\t\t\t\t\tdata-'+__e(defaults.prefix)+'-handler="setCallback">\n\n\t\t\t\t\t\t'+__e(panels.CALLBACK.confirm_callback)+'\n\n\t\t\t\t\t</button>\n\n\t\t\t\t\t<a href="#chooseConnection" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block">'+__e(panels.CALLBACK.back)+'</a>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t\t<!-- ***** Callback pane ends ***** -->\n\n\t\t<!-- ***** Callback sent pane ***** -->\n\t\t<div class="'+__e(defaults.prefix)+'-wg-pane" data-'+__e(defaults.prefix)+'-pane="callbackSent">\n\t\t\t<div class="'+__e(defaults.prefix)+'-pane-body">\n\t\t\t\t<div id="'+__e(defaults.prefix)+'-callback-sent">\n\t\t\t\t\t<h3 class="'+__e(defaults.prefix)+"-text-center "+__e(defaults.prefix)+"-icon-check "+__e(defaults.prefix)+'-text-success"></h3>\n\t\t\t\t\t<p class="'+__e(defaults.prefix)+'-text-center">'+__e(panels.CALLBACK.request_sent)+'</p>\n\t\t\t\t\t<form>\n\t\t\t\t\t\t<hr>\n\t\t\t\t\t\t<a href="#chooseConnection" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block">'+__e(panels.CALLBACK.back)+'</a>\n\t\t\t\t\t\t<a href="#" class="'+__e(defaults.prefix)+"-button "+__e(defaults.prefix)+'-block" data-'+__e(defaults.prefix)+'-handler="closeWidget">'+__e(panels.CALLBACK.close)+'</a>\n\t\t\t\t\t</form>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<!-- ***** Callback sent pane ends ***** -->\n\n\t</div>\n\t<!-- ***** Panes container ends ***** -->\n\n\t<!-- ***** Floating button container ***** -->\n\t<div id="'+__e(defaults.prefix)+'-btn-cont" class="'+__e(defaults.prefix)+'-btn-cont">\n\t\t<div class="'+__e(defaults.prefix)+'-wg-btn">\n\t\t\t<div class="'+__e(defaults.prefix)+'-lastmsg-cont">\n\t\t\t\t<span class="'+__e(defaults.prefix)+'-unnotify-btn" id="'+__e(defaults.prefix)+'-unnotify-btn">'+__e(frases.FLOATING_BUTTON.close)+'</span>\n\t\t\t\t<div id="'+__e(defaults.prefix)+'-lastmsg" class="'+__e(defaults.prefix)+'-lastmsg">\n\t\t\t\t</div>\t\n\t\t\t</div>\n\t\t\t<a href="#" class="'+__e(defaults.prefix)+'-btn-link">\n\t\t\t\t<span class="'+__e(defaults.prefix)+'-btn-icon"></span>\n\t\t\t</a>\n\t\t</div>\n\t</div>\n\t<!-- ***** Floating button container ends ***** -->\n\n</div>'}return __p}},{}],84:[function(t,e,n){function r(){var t=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia,n=window.mozRTCIceCandidate||window.RTCIceCandidate;return!!t&&!!e&&!!n}function s(){g.on("connected",function(t){b.log("sip connected event: ",t)}),g.on("disconnected",function(t){b.log("sip disconnected event: ",t)}),g.on("newMessage",function(t){b.log("sip newMessage event: ",t)}),g.on("newRTCSession",function(t){b.log("sip newRTCSession event: ",t),T.emit("webrtc/newRTCSession",t),_=t.session}),g.on("registered",function(t){b.log("sip registered event: ",t)}),g.on("unregistered",function(t){b.log("sip unregistered event: ",t)}),g.on("registrationFailed",function(t){b.log("sip registrationFailed event: ",t)}),v={progress:function(t){b.log("call progress event: ",t),T.emit("webrtc/progress",t)},failed:function(t){b.log("call failed event:",t),T.emit("webrtc/failed",t)},ended:function(t){b.log("call ended event: ",t),T.emit("webrtc/ended",t)},confirmed:function(t){b.log("call confirmed event: ",t),T.emit("webrtc/confirmed",t)},addstream:function(t){b.log("call addstream event: ",t),T.emit("webrtc/addstream",t);var e=t.stream;m.audioRemote=y.rtcninja.attachMediaStream(m.audioRemote,e)}}}function i(){return _.isEstablished()}function l(){return _.isInProgress()}function o(){return _.isEnded()}function a(){g.stop()}function u(t){_=g.call(t,{eventHandlers:v,mediaConstraints:{audio:!0,video:!1}})}function c(){_.terminate({status_code:200})}function d(){b.log("answer: ",g),_.answer()}function h(){b.log("hold: ",_.isOnHold()),_&&_.isOnHold().local?_.unhold():_.hold()}function p(){var t=document.createElement("audio");return t.setAttribute("autoplay","autoplay"),document.body.appendChild(t),t}function f(t){b.log("Initiating WebRTC module:",t),m=t,void 0===m.sip.register&&(m.sip.register=!1);var e=new y.WebSocketInterface(m.sip.ws_servers);m.sip.sockets=[e],T.emit=t.emit,T.on=t.on,m.audioRemote=p(),g=new y.UA(m.sip),s(),g.start()}var m,g,_,v,b=t("./debug"),T={},y=t("./jssip.min.js");e.exports={lib:y,init:f,unregister:a,audiocall:u,terminate:c,answer:d,hold:h,isInProgress:l,isEstablished:i,isEnded:o,isSupported:r}},{"./debug":77,"./jssip.min.js":78}],85:[function(t,e,n){(function(n){function r(t){return ue.initiated?me:(ee.merge(oe,t||{}),te.log("Widget: ",t),oe.clientPath=t.clientPath?t.clientPath:oe.clientPath||oe.server+oe.path,Pt(),oe.buttonSelector&&et(oe.buttonSelector),le.init(oe.clientPath+"sounds/"),Bt=new Xt(oe).on("session/create",l).on("session/timeout",F).on("session/join",c).on("session/joined",h).on("session/disjoin",p).on("session/init",a),oe.widget&&Bt.on("chat/close",q).on("chat/timeout",j).on("message/new",I).on("message/new",x).on("message/typing",H).on("callback/create",K).on("form/submit",At).on("form/reject",wt).on("widget/load",v),ie.isSupported()&&oe.channels.webrtc&&oe.channels.webrtc.sip&&void 0!==oe.channels.webrtc.sip.ws_servers&&("https:"===window.location.protocol?(oe.webrtcEnabled=!0,Bt.on("webrtc/newRTCSession",function(){V("newRTCSession")}),Bt.on("webrtc/progress",function(t){V(180===t.response.status_code?"ringing":"confirmed")}),Bt.on("webrtc/addstream",function(){V("connected")}),Bt.on("webrtc/ended",function(){V("ended")}),Bt.on("webrtc/failed",function(t){V("Canceled"===t.cause?"canceled":"failed")}),i({sip:oe.channels.webrtc.sip,emit:me.emit,on:me.on})):(te.warn("WebRTC feature is disabled"),te.warn("getUserMedia() no longer works on insecure origins. To use this feature, you should consider switching your application to a secure origin, such as HTTPS. See https://goo.gl/rStTGz for more details."))),Zt.get("frases",(oe.translationsPath||oe.clientPath)+"translations.json",function(t,e){return t?Bt.emit("Error",t):(ne=JSON.parse(e),void(ne=ne[Bt.detectLanguage(ne)]))}),Zt.get("forms_json",oe.clientPath+"forms.json",function(t,e){return t?Bt.emit("Error",t):void(Gt=JSON.parse(e).forms)}),me)}function s(){return Bt.init(),me}function i(t){te.log("initWebrtcModule: ",t),ie.init(t)}function l(){ee.poll(function(){return te.log("poll: ",ne),null!==ne},function(){o(),oe.external||Bt.updateUrl(window.location.href)},function(){return fe<2?(fe++,void r(oe)):Bt.emit("Error","Module wasn't initiated due to network errors")},6e4)}function o(){return!!(oe.chat||oe.webrtcEnabled||oe.channels.callback.task)&&(te.log("session initiated",Bt.session),g(),oe.widget&&!ue.initiated&&Ht()&&b(),yt("timeout")&&Ct("timeout"),void Bt.emit("session/init",{session:Bt.session,options:oe,url:n.location.href}))}function a(t){Qt.saveState("init",!0,"session"),Kt&&!Kt.closed&&Kt.sessionStorage.setItem(oe.prefix+".init",!0)}function u(){x({from:Qt.getState("aname","session"),time:Date.now(),content:"{request_browser_access}"})}function c(t){te.log("onSessionJoinRequest",Qt.getState("shared","session")),Qt.getState("shared","session")?d(t):u()}function d(t){Bt.shareOpened(),h(t)}function h(t){f({url:t.url,entity:Bt.session.entity})}function p(){re.unshare()}function f(t){oe.external||re.isInitiated()||(Bt.on("cobrowsing/init",function(){re.share()}),Bt.on("cobrowsing/update",function(t){re.updateEvents(t)}),Bt.on("cobrowsing/event",function(t){Bt.updateEvents(t.events)}),Bt.on("cobrowsing/shared",function(){Qt.saveState("shared",!0,"session")}),Bt.on("cobrowsing/unshared",function(t){Qt.saveState("shared",!1,"session")}),re.init({widget:t.widget,entity:t.entity,emit:me.emit,path:oe.clientPath}))}function m(){return zt}function g(){Bt.getLanguages(function(t,e){te.log("getLanguages: ",t,e),t||e&&_(e)})}function _(t){var e=t.length?"online":"offline";he=t,gt({state:e}),Bt.emit("chat/languages",t)}function v(){var t,e="";ue.initiated=!0,vt(),tt(zt),gt({state:_t()}),oe.hideOfflineButton&&Tt("no-button"),oe.offer&&T(),Qt.getState("chat","session")===!0&&(A(Qt.getState("credentials","session")||{}),Qt.getState("opened","session")&&St()),oe.webrtcEnabled&&Tt("webrtc-enabled"),zt&&oe.intro.length&&(he.forEach(function(n){ne&&ne.lang&&(t=n===Bt.session.lang?"selected":"",e+='<option value="'+n+'" '+t+" >"+ne.lang+"</option>")}),n[oe.prefix+"IntroForm"].lang.innerHTML=e),Bt.emit("widget/init")}function b(t){compiled=xt("widget",{defaults:oe,languages:he,translations:ne,credentials:Qt.getState("credentials","session")||{},_:ee}),zt=$t(compiled),document.body.appendChild(zt),Bt.emit("widget/load",zt)}function T(){setTimeout(function(){y({from:oe.offer.from||ne.TOP_BAR.title,time:Date.now(),content:oe.offer.text||ne.default_offer})},oe.offer.inSeconds?1e3*oe.offer.inSeconds:3e4)}function y(t){"online"!==ue.state||S()||x(t)}function C(){Qt.getState("interacted","session")||Qt.saveState("interacted",!0,"session")}function S(){return Qt.getState("interacted","session")}function E(){St(),Qt.getState("chat","cache")||(he.length?oe.intro.length?Qt.getState("chat","session")?A(Qt.getState("credentials","session")):mt("credentials"):A({lang:Bt.session.lang}):mt("sendemail"))}function A(t){var e=Qt.getState("chat","session"),n=t.message;t.uname||(t.uname=Bt.session.sid),t.lang||(t.lang=Bt.session.lang),Qt.saveState("credentials",t,"session"),Bt.chatRequest(t),setTimeout(function(){console.log("requestChat: ",t.message,e),n&&!e&&R({message:t.message})},500),w(Bt.session),It(),mt("messages")}function w(t){var e=t.answerTimeout;Qt.saveState("chat",!0,"session"),e&&(Wt=setTimeout(j,1e3*e)),Tt("chat")}function R(t){Bt.sendMessage(t),x({from:Qt.getState("credentials","session").uname,time:Date.now(),content:t.message})}function x(t){te.log("new messages arrived!",t);var e,r,s=!1,i=Qt.getState("credentials","session")||{},l=Qt.getState("aname","session"),o=i.uname?i.uname:"";if(messagesCont=document.getElementById(oe.prefix+"-messages-cont"),t.entity=t.from===o?"user":"agent",t.from="user"===t.entity?"":t.from,t.time=Ot(t.time?t.time:Date.now()),e=Nt(t.content,t.file,t.entity),"form"===e.type)r=xt("forms",{defaults:oe,message:t,form:e.content,credentials:i,frases:ne,_:ee}),n[e.content.name]&&wt({formName:e.content.name}),messagesCont.insertAdjacentHTML("beforeend","<li>"+r+"</li>"),messagesCont.scrollTop=messagesCont.scrollHeight;else{if(!t.content)return;t.content=e.content,r=xt("message",{defaults:oe,message:t}),messagesCont.insertAdjacentHTML("beforeend","<li "+(t.className?'class="'+t.className+'"':"")+">"+r+"</li>"),O(r),t.hidden||(ce.push(r),de.push(t))}"agent"===t.entity&&(l!==t.from&&Qt.saveState("aname",t.from,"session"),t.from&&clearTimeout(Wt)),"user"!==t.entity&&(s=!0),messagesCont.scrollTop=messagesCont.scrollHeight}function I(){var t=[].slice.call(document.querySelectorAll("."+oe.prefix+"-msg-undelivered"));t&&t.length&&t.forEach(function(t){t.classList.add(oe.prefix+"-hidden")})}function O(t){var e;ue.active||(e=document.getElementById(oe.prefix+"-lastmsg"),e.innerHTML=t,Tt("notified"),bt("notified"))}function N(t,e){var n=xt("email",{defaults:oe,content:t,frases:ne,_:ee});if(e)return e(null,n)}function k(t){var e=t.text.join("");N(e,function(e,n){e||(t.text=n,Bt.sendEmail(t))})}function D(t){var e=[],n=xt("message",{defaults:oe,message:{from:ne.EMAIL_SUBJECTS.complain+" "+t.email,content:t.text,entity:"",time:""}});e=e.concat(n,'<br><p class="h1">'+ne.EMAIL_SUBJECTS.dialog+" "+oe.host+"</p><br>",ce).reduce(function(t,e){return t.concat(e)}),N(e,function(e,n){e||(t.text=n,Bt.sendEmail(t))})}function L(t,e){var n=xt("message",{defaults:oe,message:{from:ne.EMAIL_SUBJECTS.request+" "+t.uname+" ("+t.email+")",content:t.text,entity:"",time:""}});N(n,function(n,r){n||(t.text=r,Bt.sendEmail(t),e&&e())})}function U(t,e){var n;return e.email?(e.subject=ne.EMAIL_SUBJECTS.request+" "+e.email,void(e.file?n=Rt(t.file,function(n,r){n?te.warn("File wasn't sent"):(e.filename=r.filename,e.filedata=r.filedata),delete e.file,L(e,function(){t.reset(),Et()})}):L(e,function(){t.reset(),Et()}))):void alert(ne.ERRORS.email)}function M(t,e){var n=e&&e.rating?parseInt(e.rating,10):null;if(e&&e.sendDialog){if(!e.email)return void alert(ne.ERRORS.email);k({to:e.email,subject:ne.EMAIL_SUBJECTS.dialog+" "+oe.host,text:ce})}if(e&&e.text){if(!e.email)return void alert(ne.ERRORS.email);D({email:e.email,subject:ne.EMAIL_SUBJECTS.complain+" "+e.email,text:e.text})}t&&t.reset(),P(n),Et()}function P(t){Qt.saveState("chat",!1,"session"),Bt.closeChat(t),Ct("chat"),Qt.getState("shared","session")&&(Bt.shareClosed(n.location.href),re.unshare())}function q(){Qt.getState("shared","session")&&re.unshare()}function j(){te.log("chat timeout!"),x({from:"",time:Date.now(),content:"{queue_overload}"});var t=n.queue_overload;t&&(t.text.value=de.reduce(function(t,e){return"user"===e.entity&&(t+=e.content+"\n"),t},""))}function H(){Vt||Tt("agent-typing"),clearTimeout(Vt),Vt=setTimeout(function(){Vt=null,Ct("agent-typing")},5e3)}function F(){te.log("Session timeout:"),Qt.getState("chat","session")===!0&&P(),mt("closechat")}function G(){mt("callAgent"),ie.audiocall(oe.channels.webrtc.hotline)}function B(){mt("callAgentFallback")}function W(){mt("callback")}function z(){var t=document.getElementById(oe.prefix+"-callback-settings"),e=Ut(t),n=document.getElementById(oe.prefix+"-callback-spinner");document.getElementById(oe.prefix+"-callback-sent");return e.phone=e.phone?jt(e.phone):null,!e.phone||e.phone.length<10?alert(ne.ERRORS.tel):(e.time=parseFloat(e.time),void(e.time<=0||(e.time=Date.now()+60*e.time*1e3,e.task=oe.channels.callback.task,te.log("setCallback data: ",e),t.classList.add(oe.prefix+"-hidden"),n.classList.remove(oe.prefix+"-hidden"),Bt.requestCallback(e),mt("callbackSent"),t.reset())))}function K(){var t=document.getElementById(oe.prefix+"-callback-settings"),e=document.getElementById(oe.prefix+"-callback-spinner");e.classList.add(oe.prefix+"-hidden"),t.classList.remove(oe.prefix+"-hidden"),err||mt("callbackSent")}function V(t){te.log("initCallState: ",t);var e=document.getElementById(oe.prefix+"-call-spinner"),n=document.getElementById(oe.prefix+"-call-info"),r=document.getElementById(oe.prefix+"-call-state"),s=document.getElementById(oe.prefix+"-call-timer"),i=document.getElementById(oe.prefix+"-tryagain-btn");"newRTCSession"===t?V("oncall"):"confirmed"===t?(r.innerText=ne.PANELS.AUDIO_CALL.calling_agent,n.classList.remove(oe.prefix+"-hidden"),e.classList.add(oe.prefix+"-hidden"),i.classList.add(oe.prefix+"-hidden")):"ringing"===t?(J(s,"init",0),s.classList.remove(oe.prefix+"-hidden")):"connected"===t?(r.innerText=ne.PANELS.AUDIO_CALL.connected_with_agent,J(s,"start",0),le.stop()):"ended"===t?(r.innerText=ne.PANELS.AUDIO_CALL.call_ended,J(s,"stop"),V("oncallend")):"failed"===t||"canceled"===t?("failed"===t?r.innerText=ne.PANELS.AUDIO_CALL.call_failed:r.innerText=ne.PANELS.AUDIO_CALL.call_canceled,n.classList.remove(oe.prefix+"-hidden"),e.classList.add(oe.prefix+"-hidden"),s.classList.add(oe.prefix+"-hidden"),i.classList.remove(oe.prefix+"-hidden"),V("oncallend"),le.play("busy")):"oncall"===t?(window.onbeforeunload=function(){return"Your connection is in progress. Do you realy want to close it?"},Qt.saveState("call",!0,"cache"),Tt("webrtc-call")):"oncallend"===t?(window.onbeforeunload=null,Qt.saveState("call",!1,"cache"),Ct("webrtc-call")):(n.classList.add(oe.prefix+"-hidden"),e.classList.remove(oe.prefix+"-hidden"),i.classList.add(oe.prefix+"-hidden"))}function J(t,e,n){var r=n;"start"===e?Yt=setInterval(function(){r+=1,t.textContent=qt(r)},1e3):"stop"===e?clearInterval(Yt):"init"===e&&(t.textContent=qt(0))}function Y(){ie.isEstablished()||ie.isInProgress()?ie.terminate():(Et(),V("init"))}function $(){var t={};Kt&&!Kt.closed||(ee.merge(t,oe),t.widget=!0,t.external=!0,Kt=window.open("","wchat",oe.widgetWindowOptions),Kt=X(Kt),ee.poll(function(){return void 0!==Kt.Wchat},function(){Kt.Module=Kt.Wchat(t),Kt.Module.on("widget/init",function(){Kt.Module.initWidgetState()}),ee.forEach(Bt._events,function(t,e,r){Kt.Module.on(e,function(t){t.url=n.location.href,Bt.emit("window/"+e,t)})})},function(){console.warn("Wchat module was not initiated due to network connection issues.")},12e4),Kt.onbeforeunload=function(){Qt.getState("chat","session")&&P()}),Kt.focus&&Kt.focus()}function X(t){var e,n,r,s,i=t.document.createElement("div"),l=Q(t,"swc-loader-styles"),o=t.document.getElementsByTagName("head")[0],a=t.document.getElementsByTagName("body")[0];return i.className="swc-widget-loader",i.innerHTML="<span></span><span></span><span></span>",r=t.document.createElement("meta"),r.name="viewport",r.content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0",n=t.document.createElement("meta"),n.setAttribute("charset","utf-8"),s=t.document.createElement("title"),s.textContent=ne.TOP_BAR.title,e=t.document.createElement("script"),e.src=oe.clientPath+"wchat.min.js",e.charset="UTF-8",o.appendChild(r),o.appendChild(n),o.appendChild(s),o.appendChild(l),o.appendChild(e),a.id="swc-wg-window",a.appendChild(i),Z(o.getElementsByTagName("style")[0]),t}function Q(t,e){var n=t.document.createElement("style");return n.type="text/css",e&&(n.id=e),n.appendChild(t.document.createTextNode("")),n}function Z(t){var e=["body { margin:0; background-color: #eee; }","@keyframes preloading {","0 { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","50% { transform: translate(0,15px); -webkit-transform: translate(0,15px); -moz-transform: translate(0,15px); -ms-transform: translate(0,15px); -o-transform: translate(0,15px); }","100% { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","}","@-webkit-keyframes preloading {","0 { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","50% { transform: translate(0,15px); -webkit-transform: translate(0,15px); -moz-transform: translate(0,15px); -ms-transform: translate(0,15px); -o-transform: translate(0,15px); }","100% { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","}","@-moz-keyframes preloading {","0 { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","50% { transform: translate(0,15px); -webkit-transform: translate(0,15px); -moz-transform: translate(0,15px); -ms-transform: translate(0,15px); -o-transform: translate(0,15px); }","100% { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","}","@-ms-keyframes preloading {","0 { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","50% { transform: translate(0,15px); -webkit-transform: translate(0,15px); -moz-transform: translate(0,15px); -ms-transform: translate(0,15px); -o-transform: translate(0,15px); }","100% { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","}","@-o-keyframes preloading {","0 { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","50% { transform: translate(0,15px); -webkit-transform: translate(0,15px); -moz-transform: translate(0,15px); -ms-transform: translate(0,15px); -o-transform: translate(0,15px); }","100% { transform: translate(0,0); -webkit-transform: translate(0,0); -moz-transform: translate(0,0); -ms-transform: translate(0,0); -o-transform: translate(0,0); }","}",".swc-widget-loader {","position: absolute;","width: 100%;","top: 50%;","margin-top: -18px;","text-align: center;","}",".swc-widget-loader span {","display: inline-block;","width: 18px;","height: 18px;","border-radius: 50%;","background-color: #fff;","margin: 3px;","}",".swc-widget-loader span:nth-last-child(1) { -webkit-animation: preloading .8s .1s linear infinite; -moz-animation: preloading .8s .1s linear infinite; -ms-animation: preloading .8s .1s linear infinite; -o-animation: preloading .8s .1s linear infinite; animation: preloading .8s .1s linear infinite; }",".swc-widget-loader span:nth-last-child(2) { -webkit-animation: preloading .8s .3s linear infinite; -moz-animation: preloading .8s .3s linear infinite; -ms-animation: preloading .8s .3s linear infinite; -o-animation: preloading .8s .3s linear infinite; animation: preloading .8s .3s linear infinite; }",".swc-widget-loader span:nth-last-child(3) { -webkit-animation: preloading .8s .5s linear infinite; -moz-animation: preloading .8s .5s linear infinite; -ms-animation: preloading .8s .5s linear infinite; -o-animation: preloading .8s .5s linear infinite; animation: preloading .8s .5s linear infinite; }"].join(" ");t.innerHTML=e}function tt(t){var e=document.getElementById(oe.prefix+"-file-select"),r=document.getElementById(oe.prefix+"-message-text"),s=[].slice.call(t.querySelectorAll("."+oe.prefix+"-inputfile")),i=document.getElementById(oe.prefix+"-btn-cont");[].slice.call(t.querySelectorAll("."+oe.prefix+"-wg-pane")),document.getElementById(oe.prefix+"-messages-cont");s.forEach(function(t){var e=t.nextElementSibling,n=e.textContent;Ft(t,"change",function(t){var r=t.target.value.split("\\").pop();r?e.textContent=r:e.textContent=n})}),Ft(i,"click",it),Ft(t,"click",st),Ft(t,"submit",pt),Ft(e,"change",ft),Ft(r,"keypress",ct),Ft(r,"focus",dt),Ft(r,"blur",ht),Ft(n,"DOMMouseScroll",lt),Ft(n,"wheel",lt),Ft(t,"mouseenter",nt),Ft(t,"mouseleave",rt)}function et(t){var e=oe.widget?at:$,n=[].slice.call(document.querySelectorAll(t));n.map(function(t){return Ft(t,"click",e),t})}function nt(){pe=!0}function rt(){pe=!1}function st(t){var e,n,r,s,i=t.target;"A"!==i.parentNode.tagName&&"BUTTON"!==i.parentNode.tagName||(i=i.parentNode),e=i.getAttribute("data-"+oe.prefix+"-handler"),s=i.getAttribute("data-"+oe.prefix+"-link"),"closeWidget"===e?Et():"finish"===e?Qt.getState("chat","session")?mt("closechat"):Et():"sendMessage"===e?ut():"openWindow"===e?$():"rejectForm"===e?Bt.emit("form/reject",{formName:ee.findParent(i,"form").name}):"initCall"===e?G():"initFallbackCall"===e?B():"initCallback"===e?W():"setCallback"===e?z():"initChat"===e?E():"endCall"===e&&Y(),"A"===i.tagName&&(r=i.href,s?Bt.linkFollowed(s):r.indexOf("#")!==-1&&(t.preventDefault(),
n=r.substring(i.href.indexOf("#")+1),n&&mt(n)))}function it(t){t.preventDefault();var e=t.target,n=t.currentTarget;return e.id===oe.prefix+"-unnotify-btn"?(Ct("notified"),void bt(ue.state)):void(n.id===oe.prefix+"-btn-cont"&&at())}function lt(t){var e=document.getElementById(oe.prefix+"-messages-cont"),n=ot(t);pe&&(0===e.scrollTop&&"up"===n?(t.stopPropagation(),t.preventDefault()):e.scrollTop>=e.scrollHeight-e.clientHeight&&"down"===n&&(t.stopPropagation(),t.preventDefault()))}function ot(t){var e;return e=t.wheelDelta?t.wheelDelta:-1*t.deltaY,e<0?"down":e>0?"up":void 0}function at(){var t=Qt.getState("chat","session"),e=(Qt.getState("opened","session"),Qt.getState("call","cache"));C(),yt("timeout")?s():t?St():he.length?oe.webrtcEnabled?e?St():(oe.chat||oe.channels.callback.task?mt("chooseConnection"):G(),St()):oe.channels.callback.task?oe.chat||oe.webrtcEnabled?(mt("chooseConnection"),St()):(mt("callback"),St()):E():(mt("sendemail"),St())}function ut(){var t,e=document.getElementById(oe.prefix+"-message-text");t=ee.trim(e.value),t&&(Qt.getState("chat","session")||E(),R({message:t}),e.value="",Ct("type-extend"))}function ct(t){var e=t.target,n=document.getElementById("swc-message-text-clone");10===t.keyCode||13===t.keyCode?(t.preventDefault(),ut()):Jt||(Jt=setTimeout(function(){Jt=null,Bt.userIsTyping()},1e3)),n.innerText=e.value,e.style.height=n.clientHeight+"px"}function dt(t){var e=t.target;e.style.borderColor=oe.styles.primary.backgroundColor}function ht(t){var e=t.target;e.style.borderColor="#fff"}function pt(t){var e=t.target;t.preventDefault(),"FORM"===e.tagName&&Bt.emit("form/submit",{formElement:e,formData:Ut(e)})}function ft(t){var e=t.target;Rt(e,function(t,e){te.log("wgSendFile: ",e),t?alert("File was not sent"):R({message:e.filename,file:e.filedata})})}function mt(t){var e="data-"+oe.prefix+"-pane",n=[].slice.call(zt.querySelectorAll("."+oe.prefix+"-wg-pane"));n.forEach(function(n){n.getAttribute(e)===t?n.classList.add("active"):n.classList.remove("active")})}function gt(t){if(zt&&ue.state!==t.state){"offline"===t.state?(P(),Ct("online"),mt("sendemail")):"online"===t.state&&Ct("offline");var e=document.querySelector("."+oe.prefix+"-wg-state");e&&(e.textContent=ne.TOP_BAR.STATUS[t.state]),ue.state=t.state,Tt(t.state),bt(t.state),Bt.emit("widget/statechange",{state:t.state})}}function _t(){return ue.state?ue.state:he&&he.length?"online":"offline"}function vt(){var t=zt.querySelector("."+oe.prefix+"-wg-btn");console.log("setStyles: ",t,oe.buttonStyles),t.style.borderRadius=oe.buttonStyles.borderRadius,t.style.boxShadow=oe.buttonStyles.boxShadow}function bt(t){if(zt&&void 0!==oe.buttonStyles[t]){var e=zt.querySelector("."+oe.prefix+"-wg-btn"),n=zt.querySelector("."+oe.prefix+"-btn-icon");e.style.background=oe.buttonStyles[t].backgroundColor,n.style.color=oe.buttonStyles[t].color||oe.buttonStyles.color}}function Tt(t){zt&&zt.classList.add(t)}function yt(t){return!!zt&&zt.classList.contains(t)}function Ct(t){zt&&zt.classList.remove(t)}function St(){var t=document.getElementById(oe.prefix+"-messages-cont");ue.active=!0,Qt.saveState("opened",!0,"session"),Tt("active"),Ct("notified"),bt(ue.state),t.scrollTop=t.scrollHeight}function Et(){window.opener?window.close():(ue.active=!1,Qt.saveState("opened",!1,"session"),Ct("active"))}function At(t){var e=t.formElement,r=t.formData;if(te.log("onFormSubmit: ",e,r),e.getAttribute("data-validate-form")){var s=Mt(e);if(!s)return}e.id===oe.prefix+"-closechat-form"?M(e,r):e.id===oe.prefix+"-sendmail-form"?U(e,r):e.id===oe.prefix+"-intro-form"?A(r):e.id===oe.prefix+"-call-btn-form"?G():e.id===oe.prefix+"-chat-btn-form"?E():e.id===oe.prefix+"-queue_overload"?(L(r),wt({formName:e.name},!0)):e.id===oe.prefix+"-request_browser_access"?(d({url:n.location.href}),wt({formName:e.name},!0),Et()):wt({formName:e.name},!0)}function wt(t,e){var r=n[t.formName];return!!r&&void(e?r.outerHTML='<p class="'+oe.prefix+'-text-center"><i class="'+oe.prefix+"-text-success "+oe.prefix+'-icon-check"></i><span> '+ne.FORMS.submitted+"</span></p>":r.outerHTML='<p class="'+oe.prefix+'-text-center"><i class="'+oe.prefix+"-text-danger "+oe.prefix+'-icon-remove"></i><span> '+ne.FORMS.canceled+"</span></p>")}function Rt(t,e){var r,s,i,l=t.files;if(l.length){if(!n.FileReader)return void(e&&e("OBSOLETE_BROWSER"));r=l[0],i=new FileReader,i.onload=function(t){s=t.target.result,s=s.substring(s.indexOf(",")+1),e&&e(null,{filedata:s,filename:r.name})},i.onerror=function(t){Bt.emit("Error",t.target.error),e&&e(t.target.error)},i.readAsDataURL(r)}}function xt(t,e){var n=se[t];return n(e)}function It(){var t=document.getElementById(oe.prefix+"-messages-cont"),e=t.cloneNode();t.parentNode.replaceChild(e,t)}function Ot(t){var e=new Date(t),n=e.getHours(),r=e.getMinutes(),s=(n<10?"0"+n:n)+":"+(r<10?"0"+r:r);return s}function Nt(t,e,n){var r,s;return e?(r=t.substring(t.indexOf("_")+1),Lt(e)?{type:"image",content:'<a href="'+Bt.options.server+"/ipcc/"+t+'" download="'+r+'"><img src="'+Bt.options.server+"/ipcc/"+t+'" alt="file preview" /></a>'}:{type:"file",content:'<a href="'+Bt.options.server+"/ipcc/"+t+'" download="'+r+'">'+r+"</a>"}):"agent"===n&&Dt(t)&&Lt(t)?(r=t.substring(t.indexOf("_")+1),{type:"image",content:'<a href="'+t+'" target="_blank"><img src="'+t+'" alt="'+r+'" /></a>'}):"agent"===n&&new RegExp("^{.+}$").test(t)?(Gt.forEach(function(e){e.name===t.substring(1,t.length-1)&&(s=e)}),{type:s?"form":"text",content:s?s:t}):{type:"text",content:t.replace(/\n/g," <br> ").split(" ").map(kt).join(" ").replace(" <br> ","<br>")}}function kt(t){var e=0,n=t;if(Dt(t)){for(;!n.charAt(n.length-1).match(/[a-z0-9\/]/i);)n=n.slice(0,-1),e+=1;return'<a href="'+n+'" target="_blank" data-'+oe.prefix+'-link="'+n+'">'+n+"</a>"+t.substr(t.length-e)}return t}function Dt(t){var e=new RegExp("^http://|^https://");return e.test(t)}function Lt(t){var e=new RegExp("png|PNG|jpg|JPG|JPEG|jpeg|gif|GIF"),n=t.substring(t.lastIndexOf(".")+1);return e.test(n)}function Ut(t){var e={};return[].slice.call(t.elements).forEach(function(t){"checkbox"===t.type?e[t.name]=t.checked:t.value&&(e[t.name]=t.value)}),e}function Mt(t){var e=!0;return[].slice.call(t.elements).every(function(t){return!t.hasAttribute("required")||""!==t.value&&null!==t.value||(alert(ne.ERRORS[t.type]||ne.ERRORS.required),e=!1,!1)}),e}function Pt(){var t=document.createElement("link");t.rel="stylesheet",t.href=oe.stylesPath||oe.clientPath+"main.css",document.head.appendChild(t)}function qt(t){var e=Math.floor(t/60),n=t%60,r=(e>9?e:"0"+e)+":"+(n>9?n:"0"+n);return r}function jt(t){return t.replace(/\D+/g,"")}function Ht(){return void 0!==document.body.classList}function Ft(t,e,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent&&t.attachEvent("on"+e,n)}var Gt,Bt,Wt,zt,Kt,Vt,Jt,Yt,$t=t("domify"),Xt=t("./core"),Qt=t("./storage"),Zt=t("./request"),te=t("./debug"),ee=t("./lodash"),ne=null,re=t("./cobrowsing"),se=t("./templates"),ie=t("./webrtc"),le=t("./audio-control"),oe={prefix:"swc",autoStart:!0,intro:!1,widget:!0,chat:!0,channels:{webrtc:{},callback:{}},cobrowsing:!1,buttonSelector:"",reCreateSession:!0,title:"",lang:"",langFromUrl:!0,position:"right",hideOfflineButton:!1,offer:!1,styles:{primary:{backgroundColor:"#74b9ff",color:"#FFFFFF"},intro:{},sendmail:{},closeChat:{}},buttonStyles:{online:{backgroundColor:"rgba(175,229,255)",color:""},offline:{backgroundColor:"rgba(241,241,241)",color:""},timeout:{backgroundColor:"rgba(241,241,241)",color:""},notified:{backgroundColor:"rgba(253,250,129)",color:""},color:"rgb(70,70,70)"},widgetWindowOptions:"left=10,top=10,width=350,height=550,resizable",path:"/ipcc/webchat/",clientPath:"https://cdn.smile-soft.com/wchat/v1/",stylesPath:"",translationsPath:"",host:window.location.host,webrtcEnabled:!1},ae="WchatSettings",ue={initiated:!1,active:!1,state:"",share:!1,sounds:!0},ce=[],de=[],he=[],pe=!1,fe=1,me={initModule:s,initWidgetState:at,openWidget:$,initChat:E,initCall:G,getWidgetElement:m,isWebrtcSupported:ie.isSupported,getWidgetState:function(){return ue},getEntity:function(){return Qt.getState("entity","session")},on:function(t,e){return Bt.on(t,e),this},emit:function(t,e){return Bt.emit(t,e),this},setDefaultCredentials:function(t){return oe.credentials=t,this}};e.exports={module:r,api:me},n[ae]&&n[ae].autoStart!==!1&&oe.autoStart&&("complete"===document.readyState||"interactive"===document.readyState?r(n[ae]):document.addEventListener("DOMContentLoaded",function(){r(n[ae])},!1))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./audio-control":74,"./cobrowsing":75,"./core":76,"./debug":77,"./lodash":79,"./request":81,"./storage":82,"./templates":83,"./webrtc":84,domify:1}]},{},[80])(80)});